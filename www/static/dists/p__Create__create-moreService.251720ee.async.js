(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[38],{"+zy9":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5Dmo");var n=l(a("3S7+"));a("7Kak");var i=l(a("9yH6"));a("+L6B");var r=l(a("2/Rp"));a("/xke");var d,o,u,c=l(a("TeRw")),m=a("MuoO"),h=a("7DNP"),p=s(a("q1tI")),f=a("LLXN"),v=l(a("exCG")),g=l(a("q76B")),_=l(a("XZXw")),M=l(a("2lxJ")),y=a("xpXo"),E=l(a("QDog")),b=l(a("hMqj")),C=(d=(0,m.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{withRef:!0}),d((u=class extends p.PureComponent{constructor(e){super(e),this.getMultipleModulesInfo=(()=>{this.props.dispatch({type:"appControl/getMultipleModulesInfo",payload:{team_name:E.default.getCurrTeamName(),check_uuid:this.getCheck_uuid()},callback:e=>{e&&200===e.status_code&&this.setState({data:e.list})}})}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return b.default.querySpecifiedPermissionsInfo(t,e)}),this.handleBuild=(()=>{this.setState({buildState:!0});var e=this.state,t=e.JavaMavenData,a=e.is_deploy;if(t.length>0){var l=this.fetchParameter(),s=l.team_name,n=l.app_alias;this.props.dispatch({type:"appControl/createService",payload:{team_name:s,app_alias:n,service_infos:t},callback:e=>{if(e&&200===e.status_code){var t=e.bean&&e.bean.group_id,l=e.bean&&e.bean.service_ids;a?this.BuildShape(t,l):this.fetchGroups(t)}}})}else this.setState({buildState:!1}),c.default.warning({message:(0,f.formatMessage)({id:"notification.warn.need_build_module"})})}),this.BuildShape=((e,t)=>{(0,y.batchOperation)({action:"deploy",team_name:E.default.getCurrTeamName(),serviceIds:t&&t.length>0&&t.join(",")}).then(()=>{this.fetchGroups(e)})}),this.fetchGroups=(e=>{var t=this.fetchParameter(),a=t.team_name,l=t.region_name,s=this.props.dispatch;s({type:"global/fetchGroups",payload:{team_name:a,region_name:l},callback:()=>{c.default.success({message:(0,f.formatMessage)({id:"notification.success.success_create_components"}),duration:"3"}),this.setState({buildState:!1}),this.handleJump("apps/".concat(e,"/overview"))}})}),this.handleDelete=(()=>{var e=this.fetchParameter(),t=e.team_name,a=e.app_alias,l=this.props.dispatch;this.handleDeleteLoading(!0),l({type:"appControl/deleteApp",payload:{team_name:t,app_alias:a,is_force:!0},callback:()=>{this.handleDeleteLoading(!1),this.handleJump("index")}})}),this.handleDeleteLoading=(e=>{this.setState({deleteLoading:e})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.fetchParameter=(()=>{return{team_name:E.default.getCurrTeamName(),region_name:E.default.getCurrRegionName(),app_alias:this.getAppAlias()}}),this.handleJump=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),l=a.team_name,s=a.region_name;t(h.routerRedux.replace("/team/".concat(l,"/region/").concat(s,"/").concat(e)))}),this.renderSuccessOnChange=(()=>{this.setState({is_deploy:!this.state.is_deploy})}),this.state={data:null,JavaMavenData:[],is_deploy:!0,deleteLoading:!1,buildState:!1}}componentDidMount(){this.getMultipleModulesInfo()}componentWillUnmount(){this.props.dispatch({type:"appControl/clearDetail"})}getCheck_uuid(){return this.props.match.params.check_uuid}getAppAlias(){return this.props.match.params.appAlias}render(){var e=this.state,t=e.data,a=e.is_deploy,l=e.buildState,s=e.showDelete,d=e.deleteLoading,o=!0,u=t;return u&&u.length>0&&u.map((e,t)=>{u[t].index=t}),p.default.createElement(p.default.Fragment,null,p.default.createElement(_.default,{titleSvg:M.default.getPageHeaderSvg("advanced",18),title:(0,f.formatMessage)({id:"JavaMaven.title"}),content:(0,f.formatMessage)({id:"versionUpdata_6_1.content"})},p.default.createElement("div",{style:{overflow:"hidden",position:"relative"}},t&&t.length>0&&p.default.createElement(v.default,{data:u,onSubmit:e=>{this.setState({JavaMavenData:e})}}),p.default.createElement("div",{style:{background:"#fff",padding:"20px",textAlign:"right",position:"absolute",bottom:0,left:0,right:0,zIndex:2}},p.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"}},p.default.createElement(r.default,{style:{marginRight:8},onClick:this.handleBuild,loading:l,type:"primary"},(0,f.formatMessage)({id:"button.confirm_create"})),p.default.createElement("div",null,p.default.createElement(n.default,{placement:"topLeft",title:(0,f.formatMessage)({id:"JavaMaven.Tooltip"})},p.default.createElement(i.default,{size:"small",onClick:this.renderSuccessOnChange,checked:a},(0,f.formatMessage)({id:"button.build_start"})))),o&&p.default.createElement(r.default,{onClick:this.showDelete,type:"default"},(0,f.formatMessage)({id:"button.abandon_create"})))),s&&p.default.createElement(g.default,{onOk:this.handleDelete,loading:d,title:(0,f.formatMessage)({id:"confirmModal.abandon_create.create_check.title"}),subDesc:(0,f.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),desc:(0,f.formatMessage)({id:"confirmModal.delete.create_check.desc"}),onCancel:()=>{this.setState({showDelete:!1})}}))))}},o=u))||o);t.default=C},FRTm:function(e,t,a){e.exports={typeBtnWrap:"typeBtnWrap___1asGj",typeBtn:"typeBtn___1uRh_",active:"active___1sarO",content:"content___C0tD4",ant_radio_disabled:"ant_radio_disabled___2AquS"}},exCG:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fOrg");var n=l(a("+KLJ"));a("g9YV");var i=l(a("wCAj")),r=l(a("jehZ"));a("+L6B");var d=l(a("2/Rp"));a("/xke");var o=l(a("TeRw"));a("y8nQ");var u=l(a("Vl3Y"));a("2qtc");var c=l(a("kLXV"));a("5NDa");var m=l(a("5rEg"));a("Znn+");var h=l(a("ZTPi"));a("7Kak");var p,f,v,g,_,M,y=l(a("9yH6")),E=s(a("q1tI")),b=a("MuoO"),C=a("LLXN"),S=(a("7DNP"),l(a("QDog"))),w=(l(a("n9hB")),l(a("8+Sn"))),I=l(a("FRTm")),x=(y.default.Button,y.default.Group,h.default.TabPane,m.default.TextArea),D=(c.default.confirm,p=(0,b.connect)(e=>{var t=e.user;e.appControl,e.teamControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),f=u.default.create(),p(v=f((g=class extends E.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onSubmit&&this.props.onSubmit(t)})}),this.handleArchCpuInfo=(()=>{var e=this.props.dispatch;e({type:"index/fetchArchOverview",payload:{region_name:S.default.getCurrRegionName(),team_name:S.default.getCurrTeamName()},callback:e=>{e&&e.bean&&this.setState({archInfo:e.list},()=>{var e=this.state,t=e.memoryList,a=e.archInfo,l=t;t&&t.length>0&&a&&a.length>0&&l.map(e=>{e.arch=a[0]}),this.setState({memoryList:l})})}})}),this.handleEdit=(e=>{var t="",a="";e&&e.envs&&e.envs.length>0&&e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(t=e.value),"BUILD_PROCFILE"==e.name&&(a=e.value)}),this.setState({isEdit:!0,editData:e,buildValue:t,startValue:a})}),this.handleOk=(()=>{var e=this.state,t=e.memoryList,a=e.editData,l=this.props.form,s=t;l.validateFields((e,t)=>{e||(s.map(e=>{e.id==a.id&&(e.cname=t.cname,e.arch=t.arch,e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(e.value=t.BUILD_MAVEN_CUSTOM_OPTS),"BUILD_PROCFILE"==e.name&&(e.value=t.PROCFILE)}))}),this.setState({memoryList:s},()=>{o.default.destroy(),o.default.success({message:(0,C.formatMessage)({id:"notification.success.edit"})}),this.handleCancel()}))})}),this.handleCancel=(()=>{this.setState({isEdit:!1,isIndex:!1})}),this.state={isShow:[!0,!0],memoryList:this.props.data,isEdit:!1,isIndex:!1,editData:!1,buildValue:"",startValue:"",activeselectedRows:[],activeselectedRowKeys:"",language:"zh-CN"===w.default.get("language"),archInfo:[]}}componentDidMount(){this.handleArchCpuInfo()}render(){var e=[{title:(0,C.formatMessage)({id:"JavaMaven.name"}),dataIndex:"name",rowKey:"name",width:"15%"},{title:(0,C.formatMessage)({id:"JavaMaven.cname"}),dataIndex:"cname",rowKey:"cname",width:"15%"},{title:(0,C.formatMessage)({id:"JavaMaven.packaging"}),dataIndex:"packaging",rowKey:"packaging",width:"8%"},{title:(0,C.formatMessage)({id:"JavaMaven.index"}),dataIndex:"index",rowKey:"index",width:"10%",render:(e,t)=>{return E.default.createElement("span",{key:e},t.ports&&t.ports.length>0?t.ports[0].container_port:e+5e3)}},{title:(0,C.formatMessage)({id:"JavaMaven.envs"}),dataIndex:"envs",rowKey:"envs",width:"45%",render:(e,t,a)=>{var l=this.state.archInfo,s="",n="",i="";return e&&e.length>0&&e.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(s=e.value),"BUILD_MAVEN_CUSTOM_GOALS"==e.name&&(n=e.value),"BUILD_PROCFILE"==e.name&&(i=e.value)}),E.default.createElement("div",{key:a},E.default.createElement("div",{style:{display:"flex",marginBottom:6}},E.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.OPTS"}),":"),E.default.createElement("div",{style:{width:"70%"}},s)),E.default.createElement("div",{style:{display:"flex",marginBottom:6}},E.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.GOALS"}),":"),E.default.createElement("div",{style:{width:"70%"}},n)),E.default.createElement("div",{style:{display:"flex",marginBottom:6}},E.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.startValue"}),":"),E.default.createElement("div",{style:{width:"70%"}},i)),(t.arch||l&&l.length>=1)&&E.default.createElement("div",{style:{display:"flex",marginBottom:6}},E.default.createElement("p",{style:{width:"30%"}},(0,C.formatMessage)({id:"JavaMaven.arch"}),":"),E.default.createElement("div",{style:{width:"70%"}},t.arch||l[0])))}},{title:(0,C.formatMessage)({id:"JavaMaven.id"}),dataIndex:"id",rowKey:"id",width:"7%",render:(e,t)=>{return E.default.createElement(d.default,{onClick:()=>{this.handleEdit(t)}},(0,C.formatMessage)({id:"teamOther.manage.edit"}))}}],t={onChange:(e,t)=>{this.props.onSubmit(t)},getCheckboxProps:e=>({disabled:e.operation,operation:e.operation})},a=this.props.form,l=a.getFieldDecorator,s=(a.getFieldValue,{labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:18},sm:{span:18}}}),n={labelCol:{xs:{span:10},sm:{span:10}},wrapperCol:{xs:{span:14},sm:{span:14}}},o=this.state,h=o.memoryList,p=o.isEdit,f=o.editData,v=o.buildValue,g=o.startValue,_=o.language,M=o.archInfo,b=_?s:n;return E.default.createElement("div",null,p&&E.default.createElement(c.default,{title:(0,C.formatMessage)({id:"teamOther.manage.edit"}),visible:p,onOk:this.handleOk,onCancel:this.handleCancel},E.default.createElement(u.default.Item,(0,r.default)({},b,{label:(0,C.formatMessage)({id:"JavaMaven.cname"})}),l("cname",{initialValue:f&&f.cname,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.cname_input"})}]})(E.default.createElement(m.default,{placeholder:""}))),E.default.createElement(u.default.Item,(0,r.default)({},b,{label:(0,C.formatMessage)({id:"JavaMaven.bulid"})}),l("BUILD_MAVEN_CUSTOM_OPTS",{initialValue:v&&v,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.bulid_input"})}]})(E.default.createElement(x,{placeholder:""}))),E.default.createElement(u.default.Item,(0,r.default)({},b,{label:(0,C.formatMessage)({id:"JavaMaven.start"})}),l("PROCFILE",{initialValue:g&&g,rules:[{required:!0,message:(0,C.formatMessage)({id:"JavaMaven.start_input"})}]})(E.default.createElement(x,{placeholder:""}))),M&&M.length>0&&E.default.createElement(u.default.Item,(0,r.default)({},b,{label:(0,C.formatMessage)({id:"JavaMaven.arch"})}),l("arch",{initialValue:f.arch||M&&M.length>0&&M[0]})(E.default.createElement(y.default.Group,null,M.map(e=>{return E.default.createElement(y.default,{value:e},e)}))))),E.default.createElement(i.default,{rowSelection:t,rowKey:(e,t)=>t,dataSource:h,columns:e,pagination:!1,style:{background:"#fff",marginTop:"20px"}}))}},v=g))||v)||v),L=(_=(0,b.connect)(e=>{var t=e.user;e.appControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),_(M=class extends E.PureComponent{constructor(e){super(e),this.state={}}render(){var e=this.props.data;return E.default.createElement("div",null,E.default.createElement("div",{style:{overflow:"hidden"}},E.default.createElement("div",{className:I.default.content,style:{overflow:"hidden",marginBottom:90}},E.default.createElement(n.default,{message:(0,C.formatMessage)({id:"JavaMaven.Alert"}),type:"success"}),E.default.createElement(D,{data:e,onSubmit:this.props.onSubmit}))))}})||M);t.default=L}}]);