(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[89],{"2+YD":function(e,t,s){"use strict";var r=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("miYZ");var i,o,d,n=r(s("tsqr")),l=s("MuoO"),u=s("7DNP"),h=a(s("q1tI")),c=s("LLXN"),g=r(s("ALo4")),p=r(s("8+Sn")),_=r(s("4W9V")),f=r(s("QDog")),m=r(s("mWxT")),v="/user/login?disable_auto_login=true",w=(i=(0,l.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo}}),i((d=class extends h.Component{constructor(e){super(e),this.handleThirdRegister=((e,t,s,r)=>{var a=this.props.dispatch;e&&t&&s&&a({type:"user/thirdRegister",payload:{user_name:r.oauth_user_name,password:r.oauth_user_name,password_repeat:r.oauth_user_name,email:r.oauth_user_email},callback:e=>{e&&""!==e.token?(p.default.set("token",e.token),a({type:"user/fetchThirdBinding",payload:{service_id:t,oauth_user_id:s},callback:e=>{e&&200===e.status_code?n.default.success((0,c.formatMessage)({id:"login.ThirdLogin.success"}),1,()=>{var e=window.localStorage.getItem("redirect");e&&""!==e||(e="/"),e.startsWith("/")?a(u.routerRedux.push(e)):window.location.href=e}):this.handleError()},handleError:()=>{this.handleError()}})):this.handleError()}})}),this.handleLoginUrl=(()=>{var e=this.props.dispatch;e(u.routerRedux.push(v))}),this.handleError=(e=>{var t=e&&e.status||e.response&&e.response.status;t&&500===t?n.default.warning((0,c.formatMessage)({id:"login.Third.again"})):(0,_.default)(e),setTimeout(()=>{this.handleLoginUrl()},1e3)}),this.handleSuccess=(()=>{var e=this.props.dispatch,t=window.localStorage.getItem("redirect");t&&""!==t||(t="/"),window.localStorage.setItem("redirect",""),t.startsWith("/")?e(u.routerRedux.push(t)):window.location.href=t}),this.state={resultState:"ing",title:(0,c.formatMessage)({id:"login.Third.authentication"}),desc:(0,c.formatMessage)({id:"login.Third.wait_for"})}}componentWillMount(){var e=m.default.OauthParameter("code"),t=m.default.OauthParameter("service_id"),s=this.props,r=s.dispatch,a=s.rainbondInfo,i=(null===a||void 0===a?void 0:a.is_saas)||!1;if(e&&t&&"None"!==e&&"None"!==t&&""!==e&&""!==t){var o=p.default.get("token");if(o)return r({type:"global/hideNeedLogin"}),r({type:"user/fetchThirdLoginBinding",payload:{code:e,service_id:t},callback:e=>{if(e){var t=e.response_data&&e.response_data.status;t&&400===t?this.setState({resultState:"error",title:(0,c.formatMessage)({id:"login.Third.Failed"}),desc:(0,c.formatMessage)({id:"login.Third.Authentication"})},()=>{setTimeout(()=>{this.handleLoginUrl()},1e3)}):e.status_code&&200===e.status_code?this.setState({resultState:"success",title:(0,c.formatMessage)({id:"login.Third.success"}),desc:""},()=>{e.bean&&e.bean.token&&p.default.set("token",e.bean.token),this.handleSuccess()}):this.handleLoginUrl()}else this.handleLoginUrl()},handleError:e=>{this.handleError(e)}}),null;f.default.removeCookie(),r({type:"user/fetchThirdCertification",payload:{code:e,service_id:t,domain:window.location.host},callback:e=>{if(e){var t=e.response_data&&e.response_data.status;if(!t||400!==t&&401!==t&&404!==t)if(200===e.status_code){var s=e.bean;if(s&&s.token)return p.default.set("token",s.token),this.handleSuccess(),null;s&&s.result&&(i?this.handleThirdRegister(s.result.code,s.result.service_id,s.result.oauth_user_id,s.result):s.result.is_authenticated?r(u.routerRedux.push("/user/third/login?code=".concat(s.result.code,"&service_id=").concat(s.result.service_id,"&oauth_user_id=").concat(s.result.oauth_user_id,"&oauth_type=").concat(s.result.oauth_type))):r(u.routerRedux.push("/user/third/register?code=".concat(s.result.code,"&service_id=").concat(s.result.service_id,"&oauth_user_id=").concat(s.result.oauth_user_id,"&oauth_type=").concat(s.result.oauth_type))))}else this.handleLoginUrl();else this.setState({resultState:"error",title:(0,c.formatMessage)({id:"login.Third.Failed"}),desc:e.msg_show||(0,c.formatMessage)({id:"login.Third.token"})},()=>{setTimeout(()=>{this.handleLoginUrl()},1e3)})}else this.handleLoginUrl()},handleError:e=>{this.handleError(e)}})}else f.default.removeCookie(),r(u.routerRedux.replace(v))}render(){var e=this.state,t=e.resultState,s=e.title,r=e.desc;return h.default.createElement("div",{style:{paddingTop:"20%",paddingBottom:16}},h.default.createElement(g.default,{type:t,title:s,description:r}))}},o=d))||o);t.default=w}}]);