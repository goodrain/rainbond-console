(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{2457:function(e,t,a){e.exports={nameID:"nameID___lHOPc",icon:"icon___3bO_J",iconm:"iconm___1h3X6",cmd:"cmd___1CeOh",logline:"logline___2nRMf"}},"52ST":function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=l(a("bx4M"));a("jCWc");var n=l(a("kPKH"));a("5Dmo");var s=l(a("3S7+"));a("14J3");var i=l(a("BMrR"));a("+L6B");var d=l(a("2/Rp")),o=l(a("jehZ"));a("y8nQ");var u=l(a("Vl3Y"));a("FJo9");var c,h,p,f=l(a("L41K")),m=l(a("18gR")),g=a("MuoO"),C=a("7DNP"),v=D(a("q1tI")),k=l(a("sQyZ")),E=l(a("VQ3Z")),b=l(a("LjLi")),y=l(a("s6ox")),I=l(a("5ov5")),w=l(a("XZXw")),S=l(a("AklW")),_=l(a("QDog")),x=l(a("+iC2"));function P(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(P=function(e){return e?a:t})(e)}function D(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=P(t);if(a&&a.has(e))return a.get(e);var l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(l,n,s):l[n]=e[n]}return l.default=e,a&&a.set(e,l),l}var T=f.default.Step,K=(c=u.default.create(),h=(0,g.connect)(e=>{var t=e.user,a=e.list,l=e.loading,r=e.global,n=e.index;return{user:t.currentUser,list:a,loading:l.models.list,rainbondInfo:r.rainbondInfo,enterprise:r.enterprise,isRegist:r.isRegist,oauthLongin:l.effects["global/creatOauth"],overviewInfo:n.overviewInfo}}),c(p=h(p=class extends v.PureComponent{constructor(e){super(e),this.startInit=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,r=a.provider,n=this.state,s=n.selectClusterID,i=n.rainbondInit;t(C.routerRedux.push("/enterprise/".concat(l,"/provider/").concat(r,"/kclusters/").concat(s,"/").concat(i?"link":"init")))}),this.selectCluster=(e=>{this.setState({selectClusterID:e.clusterID,rainbondInit:e.rainbond_init})}),this.loadLastTask=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,r=a.provider;t({type:"cloud/loadLastTask",payload:{enterprise_id:l,provider_name:r},callback:e=>{e&&(this.setState({lastTask:e,currentClusterID:e.clusterID}),"start"===e.status&&this.setState({showTaskDetail:!0}))},handleError:e=>{S.default.handleCloudAPIError(e)}})}),this.loadKubernetesCluster=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,r=a.provider;this.setState({loading:!0}),t({type:"cloud/loadKubereneteClusters",payload:{enterprise_id:l,provider_name:r},callback:e=>{if(e&&e.clusters&&e.clusters.length>0){var t="running"===e.clusters[0].state;this.setState({k8sClusters:e.clusters,loading:!1}),t&&document.getElementById("initializeBtn").scrollIntoView(),this.loadRainbondClusters()}else"custom"!==r&&"rke"!==r||this.showBuyClusterConfig(),this.setState({loading:!1})},handleError:e=>{S.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.handleStartLog=((e,t,a)=>{var l=this.props,r=l.match.params,n=r.eid,s=r.provider,i=l.rainbondInfo,d=l.enterprise;_.default.putInstallClusterLog(d,i,{eid:n,taskID:e,status:a?t:"start",install_step:"createK8s",provider:s})}),this.loadRainbondClusters=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:a,check_status:"no"},callback:e=>{if(e&&e.list){var t=new Map;e.list.map(e=>{return""!==e.provider_cluster_id&&t.set(e.provider_cluster_id,!0),e}),this.setState({linkedClusters:t})}}})}),this.showBuyClusterConfig=(()=>{this.setState({showBuyClusterConfig:!0})}),this.cancelAddCluster=(()=>{this.setState({showBuyClusterConfig:!1})}),this.cancelShowCreateDetail=(()=>{this.setState({showTaskDetail:!1}),this.loadKubernetesCluster()}),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(C.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(C.routerRedux.push("/enterprise/".concat(t,"/addCluster")))}),this.loadSteps=(()=>{var e=[{title:"\u9009\u62e9\u4f9b\u5e94\u5546"},{title:"\u9009\u62e9(\u521b\u5efa)\u5e73\u53f0\u96c6\u7fa4"},{title:"\u521d\u59cb\u5316\u5e73\u53f0\u96c6\u7fa4"},{title:"\u5b8c\u6210\u5bf9\u63a5"}];return e}),this.handleOk=((e,t,a)=>{this.setState(t),e&&e.taskID&&this.handleStartLog(e.taskID,e.status,a),this.cancelAddCluster(),this.loadKubernetesCluster()}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,l=e.handleClick,r=void 0===l?()=>{}:l,n=e.handleClosed,s=void 0===n?()=>{}:n;return v.default.createElement(m.default,(0,o.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close"),this.selectCluster({clusterID:"",rainbond_init:!1}),s()},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(r(),this.handleGuideStep(a))}}))}),this.renderCreateClusterShow=(()=>{var e=this.props.match.params,t=e.eid,a=e.provider,l=this.state.guideStep;switch(a){case"ack":return v.default.createElement(k.default,{eid:t,selectProvider:a,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});case"tke":break;case"custom":return v.default.createElement(E.default,{eid:t,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={currentClusterID:e.clusterID};this.handleOk(e,t,!0)}});case"rke":return v.default.createElement(y.default,{eid:t,guideStep:l,handleNewbieGuiding:this.handleNewbieGuiding,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});default:}});var t=this.props.user,a=x.default.isCompanyAdmin(t);this.state={adminer:a,showBuyClusterConfig:!1,k8sClusters:[],loading:!0,rainbondInit:!1,selectClusterID:"",showTaskDetail:!1,linkedClusters:new Map,lastTask:{},guideStep:3,currentClusterID:""}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(C.routerRedux.push("/"))}componentDidMount(){this.loadKubernetesCluster(),this.loadLastTask()}render(){var e=this.props,t=e.match.params,a=t.eid,l=t.provider,o=e.location.query,u=o.clusterID,c=o.updateKubernetes,h=this.state,p=h.k8sClusters,m=h.showBuyClusterConfig,g=h.loading,C=h.selectClusterID,k=h.showTaskDetail,E=h.lastTask,y=h.linkedClusters,S=h.currentClusterID,_=h.guideStep,x=""===C,P="\u96c6\u7fa4\u5217\u8868";switch(l){case"ack":P+="(\u963f\u91cc\u4e91 ACK)";break;case"tke":P+="(\u817e\u8baf\u4e91 TKE)";break;case"custom":P+="(\u81ea\u5b9a\u4e49)";break;case"rke":P+="(\u57fa\u4e8e\u4e3b\u673a\u81ea\u5efa)";break;default:P+="(\u4e0d\u652f\u6301\u7684\u9a71\u52a8\u7c7b\u578b: ".concat(l,")")}var D=v.default.createElement(d.default,{style:{marginLeft:"16px"},type:"primary",onClick:this.startInit,disabled:x,id:"initializeBtn"},"\u4e0b\u4e00\u6b65"),K=!1,O="",R=!1;return p&&p.length&&p.map(e=>{var t=e.state;"running"===t&&(R=e.rainbond_init,O=e.cluster_id,K=!0)}),v.default.createElement(w.default,{title:"\u6dfb\u52a0\u96c6\u7fa4",content:"\u96c6\u7fa4\u662f\u8d44\u6e90\u7684\u96c6\u5408\uff0c\u4ee5\u96c6\u7fa4\u4e3a\u57fa\u7840\uff0c\u90e8\u7f72\u5e73\u53f0Region\u670d\u52a1\u5373\u53ef\u6210\u4e3a\u5e73\u53f0\u96c6\u7fa4\u8d44\u6e90\u3002"},v.default.createElement(i.default,{style:{marginBottom:"16px"}},v.default.createElement(f.default,{current:1},this.loadSteps().map(e=>v.default.createElement(T,{key:e.title,title:e.title})))),v.default.createElement(r.default,{title:P},v.default.createElement(b.default,{eid:a,loading:g,loadKubernetesCluster:this.loadKubernetesCluster,selectCluster:this.selectCluster,selectProvider:l,data:p,lastTask:E,showLastTaskDetail:()=>{this.setState({showTaskDetail:!0})},guideStep:_,handleNewbieGuiding:this.handleNewbieGuiding,loadLastTask:this.loadLastTask,linkedClusters:y,showBuyClusterConfig:this.showBuyClusterConfig,updateKubernetes:c,updateKubernetesClusterID:u}),!K||3!==_&&8!==_?"":this.handleNewbieGuiding({tit:"\u8bf7\u9009\u62e9Kubernetes\u96c6\u7fa4",desc:"\u53ef\u9009\u62e9\u5df2\u7ecf\u6b63\u5e38\u8fd0\u884c\u7684\u96c6\u7fa4",send:!1,configName:"kclustersInitializationCluster",nextStep:9,svgPosition:{left:"44px",marginTop:"-35px"},handleClick:()=>{this.selectCluster({clusterID:O,rainbond_init:R})}}),m&&this.renderCreateClusterShow(),v.default.createElement(n.default,{style:{textAlign:"center",marginTop:"32px"},span:24},v.default.createElement(d.default,{onClick:this.preStep},"\u4e0a\u4e00\u6b65"),x?v.default.createElement(s.default,{title:"\u8bf7\u9009\u62e9\u9700\u8981\u521d\u59cb\u5316\u7684\u96c6\u7fa4"},D):D,K&&9===_?this.handleNewbieGuiding({tit:"\u5f00\u59cbRainbond\u96c6\u7fa4\u670d\u52a1",desc:"\u521d\u59cb\u5316\u5b89\u88c5",send:!0,configName:"kclustersInitializationCluster",nextStep:10,conPosition:{left:"60%",bottom:"-24px"},svgPosition:{left:"54%",marginTop:"-11px"},handleClick:()=>{x||this.startInit()}}):""),k&&E&&v.default.createElement(I.default,{onCancel:this.cancelShowCreateDetail,eid:a,selectProvider:l,taskID:E.taskID,clusterID:S})))}})||p)||p);t.default=K},"5ov5":function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,s,i,d=l(a("jehZ")),o=a("MuoO"),u=r(a("q1tI")),c=l(a("AklW")),h=l(a("QDog")),p=l(a("UBd8")),f=(n=(0,o.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),n((i=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTask=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.taskID;t({type:"cloud/loadTask",payload:{enterprise_id:a,taskID:l},callback:e=>{e&&this.setState({complete:"complete"===e.status})},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.taskID,r=e.rainbondInfo,n=e.enterprise;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:l},callback:e=>{if(e){var t=c.default.showCreateKubernetesSteps(e.events),s=t.complete,i=t.steps;s&&i&&i.length>0&&h.default.putInstallClusterLog(n,r,{eid:a,taskID:l,status:i[i.length-1].Status,message:i[i.length-1].Message,install_step:"createK8s",provider:"rke"}),this.setState({complete:s,loading:!1,steps:i}),this.refresh&&!s&&setTimeout(()=>{this.loadTaskEvents()},4e3)}},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1}),this.refresh&&setTimeout(()=>{this.loadTaskEvents()},8e3)}})}),this.queryCreateLog=(()=>{this.setState({showCreateLog:!0})}),this.state={loading:!0,complete:!1,steps:[],showCreateLog:!1}}componentDidMount(){this.loadTask(),this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(p.default,(0,d.default)({title:e||"\u96c6\u7fa4\u521b\u5efa\u8fdb\u5ea6",msg:"\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u9884\u8ba110\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u82e5\u9047\u5230\u9519\u8bef\u8bf7\u53cd\u9988\u5230\u793e\u533a"},this.state,this.props))}},s=i))||s),m=f;t.default=m},LjLi:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=l(a("kLXV"));a("g9YV");var n=l(a("wCAj"));a("14J3");var s=l(a("BMrR"));a("P2fV");var i=l(a("NJEC"));a("+L6B");var d=l(a("2/Rp"));a("5Dmo");var o=l(a("3S7+"));a("7Kak");var u=l(a("9yH6"));a("jCWc");var c=l(a("kPKH"));a("Pwec");var h=l(a("CtXQ"));a("/xke");var p=l(a("TeRw"));a("miYZ");var f=l(a("tsqr"));a("tU7J");var m,g,C=l(a("wFql")),v=l(a("+QRC")),k=a("MuoO"),E=R(a("q1tI")),b=l(a("9tdr")),y=a("ArA+"),I=a("mLYH"),w=l(a("AklW")),S=l(a("dBUJ")),_=l(a("imTl")),x=l(a("3//m")),P=l(a("s6ox")),D=l(a("gtfS")),T=l(a("T8HY")),K=l(a("2457"));function O(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(O=function(e){return e?a:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=O(t);if(a&&a.has(e))return a.get(e);var l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(l,n,s):l[n]=e[n]}return l.default=e,a&&a.set(e,l),l}var L=C.default.Paragraph,N=(m=(0,k.connect)(),m(g=class extends E.PureComponent{constructor(e){super(e),this.handleLoadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{this.setState({initCmd:e&&e.response_data&&e.response_data.cmd||""})}})}),this.autoPage=(()=>{var e=this.props,t=e.updateKubernetes,a=e.updateKubernetesClusterID;t&&a&&this.updateCluster(a)}),this.queryCreateLog=(e=>{this.setState({showCreateLog:!0,clusterID:e.cluster_id})}),this.reInstallCluster=(e=>{var t=this.props,a=t.dispatch,l=t.eid,r=t.selectProvider,n=t.loadKubernetesCluster,s=t.loadLastTask;if("rke"!==r)return f.default.warning("\u8be5\u63d0\u4f9b\u5546\u4e0d\u652f\u6301\u96c6\u7fa4\u91cd\u88c5"),void this.handleInstallLoading(!1);a({type:"cloud/reInstall",payload:{enterprise_id:l,clusterID:e},callback:e=>{this.handleInstallRemind(!1),this.handleInstallLoading(!1),e&&(n&&n(),s&&s())},handleError:e=>{this.handleInstallLoading(!1),w.default.handleCloudAPIError(e)}})}),this.updateCluster=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,I.getUpdateKubernetesTask)({clusterID:e,providerName:l,enterprise_id:a},e=>{w.default.handleCloudAPIError(e)}).then(t=>{t.task&&"complete"!==t.task.status?this.setState({showUpdateKubernetesTasks:!0,updateTask:t.task}):this.setState({showUpdateKubernetes:!0,nodeList:t.nodeList,rkeConfig:t.rkeConfig,updateClusterID:e})}).catch(e=>{console.log(e)})}),this.uninstallCluster=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,I.uninstallRegion)({provider_name:l,enterprise_id:a,clusterID:e},e=>{w.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&p.default.success({message:"\u96c6\u7fa4\u6b63\u5728\u5378\u8f7d\u4e2d\uff0c\u7a0d\u540e\u8bf7\u5237\u65b0\u5217\u8868"})})}),this.handleInstallLoading=(e=>{this.setState({installLoading:e})}),this.handleInstallRemind=(e=>{this.setState({isInstallRemind:e})}),this.handleCommandBox=(e=>{return E.default.createElement(c.default,{span:24,style:{marginTop:"16px"}},E.default.createElement("span",{className:D.default.cmd},E.default.createElement(h.default,{className:D.default.copy,type:"copy",onClick:()=>{(0,v.default)(e),p.default.success({message:"\u590d\u5236\u6210\u529f"})}}),e))}),this.cancelShowUpdateKubernetes=(()=>{var e=this.props.loadKubernetesCluster;this.setState({showUpdateKubernetesTasks:!1,updateTask:null}),e&&e()}),this.getKubeConfig=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,I.getKubeConfig)({clusterID:e,enterprise_id:a,providerName:l}).then(e=>{200===e.status_code&&this.setState({kubeConfig:e.config})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.state={selectClusterName:"",clusterID:"",showCreateLog:!1,isInstallRemind:!1,installLoading:!1,isComponents:!1,initCmd:null}}componentDidMount(){this.autoPage(),this.handleLoadInitNodeCmd()}deleteCluster(e){var t=this.props,a=t.dispatch,l=t.eid,r=t.selectProvider,n=t.loadKubernetesCluster;a({type:"cloud/deleteKubernetesCluster",payload:{enterprise_id:l,providerName:r,clusterID:e},callback:()=>{n&&n()},handleError:e=>{w.default.handleCloudAPIError(e)}})}render(){var e=this.props,t=e.selectProvider,a=e.linkedClusters,l=e.eid,f=e.selectCluster,m=this.state,g=m.selectClusterName,C=m.initCmd,k=[{width:50,dataIndex:"radio",render:(e,t)=>{var l=t.cluster_id,r="running"!==t.state||a.get(l)||t.parameters&&t.parameters.DisableRainbondInit,n=t.parameters&&t.parameters.Message,s=t.name;return E.default.createElement(o.default,{title:n},E.default.createElement(u.default,{disabled:r,checked:g===s,onClick:()=>{r||(this.setState({selectClusterName:s}),f&&f({clusterID:l,name:s,can_init:t.can_init,rainbond_init:t.state&&"running"===t.state&&t.rainbond_init}))}},e))}},{title:"\u540d\u79f0(ID)",width:120,dataIndex:"name",render:(e,t)=>{var a="".concat(e,"(").concat(t.cluster_id,")");return E.default.createElement(o.default,{title:a},E.default.createElement("div",{className:K.default.nameID},a))}},{title:"\u7c7b\u578b",width:180,dataIndex:"cluster_type",render:e=>{return w.default.getAliyunClusterName(e)}}];"custom"!==t&&"rke"!==t?(k.push({title:"\u533a\u57df",dataIndex:"region_id",render:e=>{return w.default.getAliyunRegionName(e)}}),k.push({title:"\u53ef\u7528\u533a",dataIndex:"zone_id"})):k.push({title:"API\u5730\u5740",width:300,dataIndex:"master_url.api_server_endpoint"}),k.push({title:"\u8282\u70b9\u6570\u91cf",width:100,dataIndex:"size"}),k.push({title:"\u7248\u672c",width:250,dataIndex:"current_version"}),k.push({title:"\u72b6\u6001",width:150,dataIndex:"state",render:(e,t)=>{return w.default.getAliyunClusterStatus(e,t,a)}}),k.push({title:"\u64cd\u4f5c",dataIndex:"cluster_id",render:(e,r)=>{return E.default.createElement("div",null,"running"===r.state&&E.default.createElement("a",{onClick:()=>this.getKubeConfig(r.cluster_id||r.name)},"KubeConfig"),"failed"===r.state&&"rke"===t&&E.default.createElement("a",{onClick:()=>{this.handleInstallRemind(r.cluster_id||r.name)}},"\u91cd\u65b0\u5b89\u88c5"),!0===r.rainbond_init&&!a.get(r.cluster_id)&&E.default.createElement(y.Link,{to:"/enterprise/".concat(l,"/provider/").concat(t,"/kclusters/").concat(r.cluster_id,"/link")},"\u5bf9\u63a5"),"rke"!==t&&r.create_log_path&&r.create_log_path.startsWith("http")&&E.default.createElement(d.default,{type:"link",style:{padding:0},onClick:()=>{window.open(r.create_log_path,"_blank")}},"\u67e5\u770b\u65e5\u5fd7"),"rke"===t&&E.default.createElement(d.default,{type:"link",style:{padding:0},onClick:()=>{this.queryCreateLog(r)}},"\u67e5\u770b\u65e5\u5fd7"),!r.rainbond_init&&("rke"===t||"custom"===t)&&E.default.createElement(i.default,{placement:"top",title:"\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u96c6\u7fa4\u5417\uff1f",onConfirm:()=>{this.deleteCluster(r.cluster_id||r.name)},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},E.default.createElement("a",null,"\u5220\u9664")),"rke"===t&&E.default.createElement("a",{onClick:()=>this.updateCluster(r.cluster_id||r.name)},"\u96c6\u7fa4\u914d\u7f6e"),"running"===r.state&&("rke"===t||"custom"===t)&&E.default.createElement("a",{onClick:()=>this.handleIsComponents(r.cluster_id)},"\u67e5\u770b\u7ec4\u4ef6"),!0===r.rainbond_init&&E.default.createElement(i.default,{placement:"top",title:"\u5378\u8f7d\u540e\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u8ba4\u8981\u5378\u8f7d\u5f53\u524d\u96c6\u7fa4\u7684\u5e73\u53f0\u670d\u52a1\u5417\uff1f",onConfirm:()=>{this.uninstallCluster(r.cluster_id||r.name)},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},E.default.createElement("a",null,"\u5378\u8f7d")))}});var I=this.props,O=I.data,R=I.showBuyClusterConfig,N=I.loadKubernetesCluster,A=I.loading,M=I.lastTask,j=I.showLastTaskDetail,B=this.state,V=B.clusterID,W=B.kubeConfig,U=B.showUpdateKubernetes,F=B.nodeList,q=B.rkeConfig,G=B.updateClusterID,J=B.showUpdateKubernetesTasks,Z=B.updateTask,H=B.showCreateLog,Q=B.installLoading,z=B.isComponents,Y=B.isInstallRemind,X="docker rm -vf $(docker ps -a | grep 'rke-tools\\|hyperkube\\|coreos-etcd\\|k8s' | awk '{print $1}')",$="rm -rf /var/lib/etcd /etc/kubernetes /etc/cni /opt/cni /var/lib/cni /var/run/calico /opt/rke";return E.default.createElement("div",null,E.default.createElement(s.default,{style:{marginBottom:"20px"}},"ack"===t&&E.default.createElement(c.default,{span:24,style:{padding:"16px"}},E.default.createElement(L,{className:S.default.describe},E.default.createElement("ul",null,E.default.createElement("li",null,E.default.createElement("span",null,"\u76ee\u524d\u5e73\u53f0\u652f\u6301\u963f\u91cc\u4e91\u6258\u7ba1\u96c6\u7fa4\u81ea\u52a8\u5316\u8d2d\u4e70")),E.default.createElement("li",null,E.default.createElement("span",null,"\u82e5\u6682\u65e0\u53ef\u7528\u96c6\u7fa4\uff0c\u53ef\u70b9\u51fb",E.default.createElement(d.default,{type:"link",onClick:R},"\u65b0\u8d2d\u4e70\u96c6\u7fa4"),"\u5feb\u901f\u8d2d\u4e70")),E.default.createElement("li",null,E.default.createElement("span",null,"\u82e5\u96c6\u7fa4\u521b\u5efa\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u518d\u6b21\u786e\u4fdd\u4ee5\u4e0b\u670d\u52a1\u5df2\u5f00\u901a\u6216\u6388\u6743\u5df2\u6388\u4e88\u540e\u91cd\u8bd5\uff1a",w.default.getAliyunCountDescribe().map(e=>{return E.default.createElement("a",{style:{marginRight:"8px"},href:e.href,target:"_blank",rel:"noreferrer"},e.title)}))),E.default.createElement("li",null,E.default.createElement("span",null,"\u96c6\u7fa4\u8d2d\u4e70\u6210\u529f\u540e\u5904\u4e8e\u521d\u59cb\u5316\u4e2d\u7684\u72b6\u6001\uff0c\u963f\u91cc\u4e91\u5c06\u5b8c\u6210\u96c6\u7fa4\u521b\u5efa\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b10\u5206\u949f\u5de6\u53f3\u5373\u53ef\u521d\u59cb\u5316\u5b8c\u6210"))))),E.default.createElement(c.default,{span:12,style:{textAlign:"left"}},g&&E.default.createElement("span",{style:{marginRight:"16px"}},"\u5df2\u9009\u62e9\u96c6\u7fa4: ",g,", \u8be5\u96c6\u7fa4\u7b26\u5408\u5e73\u53f0\u63a5\u5165\u89c4\u5219\uff0c\u53ef\u4ee5\u5f00\u59cb\u5e73\u53f0\u96c6\u7fa4\u521d\u59cb\u5316\u3002"),!g&&M&&M.name&&j&&E.default.createElement("span",null,"\u4e0a\u4e00\u6b21\u521b\u5efa\u4efb\u52a1: ",M.name,",",E.default.createElement(d.default,{onClick:j,type:"link"},"\u70b9\u51fb\u67e5\u770b\u521b\u5efa\u8fdb\u5ea6"))),E.default.createElement(c.default,{span:12,style:{textAlign:"right"}},E.default.createElement(d.default,{type:"primary",onClick:R},"\u65b0\u589e\u96c6\u7fa4"),E.default.createElement(d.default,{style:{marginLeft:"16px"},onClick:N},E.default.createElement(h.default,{type:"reload"})))),E.default.createElement(n.default,{scroll:{x:!(window.innerWidth>1500)&&1500},loading:A,pagination:!1,columns:k,dataSource:O}),Y&&E.default.createElement(r.default,{title:"\u786e\u5b9a\u8981\u91cd\u65b0\u5b89\u88c5\u5f53\u524d\u96c6\u7fa4\u5417?",confirmLoading:Q,className:D.default.TelescopicModal,width:900,visible:!0,onOk:()=>{this.handleInstallLoading(!0),this.reInstallCluster(Y)},onCancel:()=>{this.handleInstallRemind(!1)}},E.default.createElement(s.default,{style:{padding:"0 16px"}},E.default.createElement("span",{style:{fontWeight:600,color:"red"}},"\u8bf7\u5728\u91cd\u65b0\u5b89\u88c5\u524d\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4ee5\u4e0b \u4e24\u6761\u547d\u4ee4\uff08\u8be5\u547d\u4ee4\u5c06\u4f1a\u6e05\u9664k8s\u7684\u76f8\u5173\u5bb9\u5668\u53ca\u914d\u7f6e\uff09",E.default.createElement("br",null),"\u6267\u884c\u7528\u6237\u9700\u8981\u5177\u6709sudo\u6743\u9650\uff1a"),this.handleCommandBox(X),this.handleCommandBox($),this.handleCommandBox(C))),H&&E.default.createElement(x.default,{eid:l,clusterID:V,selectProvider:t,onCancel:()=>{this.setState({clusterID:"",showCreateLog:!1})}}),W&&E.default.createElement(r.default,{visible:!0,width:1e3,maskClosable:!1,onCancel:()=>{this.setState({kubeConfig:""})},title:"KubeConfig",bodyStyle:{background:"#000"},onOk:()=>{(0,v.default)(W),p.default.success({message:"\u590d\u5236\u6210\u529f"})},okText:"\u590d\u5236"},E.default.createElement("div",{className:K.default.cmd},E.default.createElement(b.default,{value:W,options:{mode:{name:"javascript",json:!0},lineNumbers:!0,theme:"seti",lineWrapping:!0,smartIndent:!0,matchBrackets:!0,scrollbarStyle:null,showCursorWhenSelecting:!0,height:500}}))),U&&E.default.createElement(P.default,{eid:l,onOK:e=>{this.setState({clusterID:e.clusterID,showUpdateKubernetes:!1,updateTask:e,showUpdateKubernetesTasks:!0})},onCancel:()=>{this.setState({showUpdateKubernetes:!1})},clusterID:G,nodeList:F,rkeConfig:q}),J&&E.default.createElement(T.default,{eid:l,clusterID:V,task:Z,selectProvider:t,onCancel:this.cancelShowUpdateKubernetes}),z&&E.default.createElement(_.default,{eid:l,clusterID:z,providerName:t,onCancel:()=>{this.handleIsComponents(!1)}}))}})||g);t.default=N},T8HY:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,s,i,d=l(a("jehZ")),o=a("MuoO"),u=r(a("q1tI")),c=l(a("AklW")),h=l(a("QDog")),p=l(a("UBd8")),f=(n=(0,o.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),n((i=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.task,r=e.selectProvider,n=e.enterprise,s=e.rainbondInfo;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:l.taskID},callback:e=>{if(e){var t=c.default.showUpdateClusterSteps(e.events),i=t.complete,d=t.steps;i&&d.length>0&&h.default.putInstallClusterLog(n,s,{eid:a,taskID:l.taskID,status:d[d.length-1].Status,message:d[d.length-1].Message,install_step:"createK8s",provider:r}),this.setState({complete:i,loading:!1,steps:d}),!i&&this.refresh&&setTimeout(()=>this.loadTaskEvents(),4e3)}},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.state={loading:!0,complete:!1,steps:[]}}componentDidMount(){this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(p.default,(0,d.default)({title:e||"Kubernetes \u96c6\u7fa4\u914d\u7f6e\u8fdb\u5ea6\u67e5\u8be2",msg:"\u914d\u7f6e\u6d41\u7a0b\u9884\u8ba1\u8017\u65f610\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u82e5\u9047\u5230\u9519\u8bef\u8bf7\u53cd\u9988\u5230\u793e\u533a"},this.state,this.props))}},s=i))||s),m=f;t.default=m},gtfS:function(e,t,a){e.exports={nameID:"nameID___3Iawl",icon:"icon___Vw_QE",iconm:"iconm___3oFjI",describe:"describe___K7ShE","editable-cell":"editable-cell___2hRGL","editable-cell-value-wrap":"editable-cell-value-wrap___3VH19","editable-row":"editable-row___2R9L_",cmd:"cmd___1wxk3",copy:"copy___3mXdm"}},s6ox:function(e,t,a){"use strict";(function(e){var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var r=l(a("wCAj"));a("fOrg");var n=l(a("+KLJ"));a("2qtc");var s=l(a("kLXV"));a("14J3");var i=l(a("BMrR"));a("jCWc");var d=l(a("kPKH"));a("Pwec");var o=l(a("CtXQ"));a("+L6B");var u=l(a("2/Rp"));a("P2fV");var c=l(a("NJEC"));a("+BJd");var h=l(a("mr32"));a("miYZ");var p=l(a("tsqr"));a("/xke");var f=l(a("TeRw"));a("5Dmo");var m=l(a("3S7+"));a("5NDa");var g=l(a("5rEg"));a("giR+");var C=l(a("fyUT"));a("OaEy");var v=l(a("2fM7")),k=l(a("p0pE"));a("y8nQ");var E=l(a("Vl3Y")),b=l(a("Y/ft"));a("Znn+");var y=l(a("ZTPi"));a("tU7J");var I,w,S,_=l(a("wFql")),x=l(a("ZNrE")),P=l(a("+QRC")),D=a("MuoO"),T=N(a("q1tI")),K=a("mLYH"),O=l(a("AklW")),R=l(a("gtfS"));function L(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(L=function(e){return e?a:t})(e)}function N(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=L(t);if(a&&a.has(e))return a.get(e);var l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(l,n,s):l[n]=e[n]}return l.default=e,a&&a.set(e,l),l}var A=_.default.Paragraph,M=y.default.TabPane,j=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/,B=/^[1-9]\d*$/,V=T.default.createContext(),W=e=>{var t=e.form,a=(e.index,(0,b.default)(e,["form","index"]));return T.default.createElement(V.Provider,{value:t},T.default.createElement("tr",a))},U=E.default.create()(W);class F extends T.default.Component{constructor(){super(...arguments),this.state={editing:!1},this.toggleEdit=(()=>{var e=!this.state.editing;this.setState({editing:e},()=>{e&&this.input.focus()})}),this.save=((e,t)=>{var a=this.props,l=a.record,r=a.handleSave;this.form.validateFields((a,n)=>{r((0,k.default)({},l,n)),a&&a[t||e&&e.currentTarget.id]||this.toggleEdit()})}),this.renderCell=(e=>{this.form=e;var t=this.props,a=t.children,l=t.dataIndex,r=t.record,n=t.title,s=t.dataSource,i=this.state.editing,d=[{required:!0,message:"".concat(n," \u662f\u5fc5\u9700\u7684")}],o="ip"===l||"internalIP"===l;o&&d.push({message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",pattern:new RegExp(j,"g")});var u="sshPort"===l;u&&d.push({message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7",min:1,max:65536,pattern:new RegExp(B,"g")});var c=r[l];return i||o&&!c?T.default.createElement(E.default.Item,{style:{margin:0}},e.getFieldDecorator(l,{rules:d,initialValue:c})("roles"===l?T.default.createElement(v.default,{getPopupContainer:e=>e.parentNode,ref:e=>this.input=e,onPressEnter:this.save,onBlur:()=>{this.save(!1,l)},allowClear:!0,mode:"multiple"},T.default.createElement(v.default.Option,{value:"controlplane"},"\u7ba1\u7406"),T.default.createElement(v.default.Option,{value:"etcd"},"ETCD"),T.default.createElement(v.default.Option,{value:"worker"},"\u8ba1\u7b97")):u?T.default.createElement(C.default,{style:{width:"100%"},ref:e=>this.input=e,onPressEnter:this.save,onBlur:this.save,min:1,max:65536}):T.default.createElement(g.default,{placeholder:"\u8bf7\u8f93\u5165".concat(n),ref:e=>{this.input=e,"ip"===l&&!c&&s&&s.length>1&&e.focus()},onPressEnter:this.save,onBlur:this.save}))):T.default.createElement(m.default,{title:"\u70b9\u51fb\u4fee\u6539"},T.default.createElement("div",{className:"editable-cell-value-wrap",style:{cursor:"pointer"},onClick:this.toggleEdit},a))})}componentWillMount(){var e=this.props.handleClustersMount;e&&e(this)}render(){var e=this.props,t=e.editable,a=e.children,l=(0,b.default)(e,["editable","children"]);return T.default.createElement("td",l,t?T.default.createElement(V.Consumer,null,this.renderCell):a)}}var q=(I=E.default.create(),w=(0,D.connect)(),I(S=w(S=class extends T.PureComponent{constructor(t){var a;super(t),a=this,this.componentDidMount=(()=>{var e=this.props.clusterID;this.loadInitNodeCmd(),e?this.setNodeList():(this.fetchRkeconfig(),this.handleAdd())}),this.setNodeList=(()=>{var e=this.props,t=e.nodeList,a=e.rkeConfig,l=e.form,r=l.setFieldsValue;if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].key=Math.random(),t[n].sshPort&&0!==t[n].sshPort||(t[n].sshPort=22),t[n].disable=!0;if(a){var s=this.decodeBase64Content(a);r({yamls:s}),this.setState({yamlVal:s})}this.setState({dataSource:t||[],count:t&&t.length||0})}),this.handleClustersMount=(e=>{this.clusters=e}),this.encodeBase64Content=(t=>{var a=e.from(t).toString("base64");return a}),this.decodeBase64Content=(t=>{var a=t.replace(/\s/g,"+");return a=e.from(a,"base64").toString(),a}),this.loadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{var t=e&&e.response_data||{},a=e&&e.response_data&&e.data||{},l=e&&e.cmd||a.cmd||t.cmd;this.setState({initNodeCmd:l})}})}),this.fetchRkeconfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,l=a.props,r=l.form,n=l.eid,s=a.state.activeKey,i=r.setFieldsValue,d=Object.assign({},e,{enterprise_id:n});(0,K.rkeconfig)(d).then(e=>{if(e&&200===e.status_code&&e.response_data){var l=e.response_data||{},r=l.encodeRKEConfig,n=l.nodes,d=a.decodeBase64Content(r);i({yamls:d});var o="",u="";n&&(n&&n.length&&n.map(e=>{e.key=Math.random(),t&&(j.test(e.ip||"")?j.test(e.internalIP||"")?B.test(e.sshPort||"")?e.sshPort>65536?(u="sshPort",o="\u7aef\u53e3\u53f7\u6700\u592765536"):e.roles||(u="roles",o="\u8282\u70b9\u7c7b\u578b\u662f\u5fc5\u987b\u7684"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7",u="sshPort"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",u="internalIP"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",u="ip"))}),o&&a.handleCheck(!1),a.setState({helpType:u,helpError:o,dataSource:n})),a.setState({yamlVal:d}),"1"===s&&t&&o&&f.default.warning({message:o}),t&&!o&&a.handleStartCheck(t)}}).catch(e=>{if(e){var l=e.data?e.data.code:e.code;if(!l)return t&&a.setState({activeKey:"2"}),a.setState({isCheck:!1,helpType:"RKE",helpError:"RKE\u96c6\u7fa4\u914d\u7f6e\u4e0d\u5408\u683c\u3001\u8bf7\u91cd\u65b0\u914d\u7f6e"}),null}a.handleCheck(!1),O.default.handleCloudAPIError(e)})},this.updateCluster=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.clusterID,r=e.form,n=this.state,s=n.dataSource,i=n.yamlVal;s&&0===s.length&&p.default.warning("\u8bf7\u5b9a\u4e49\u96c6\u7fa4\u8282\u70b9"),r.validateFields((e,r)=>{e||(this.setState({loading:!0}),t({type:"cloud/updateKubernetesCluster",payload:{enterprise_id:a,clusterID:l,provider:"rke",encodedRKEConfig:this.encodeBase64Content(r.yamls||i)},callback:e=>{this.handleOk(e&&e.response_data)},handleError:e=>{this.handleError(e)}}))})}),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.eid,r=e.clusterID;if(r)return this.updateCluster(),null;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,k.default)({enterprise_id:l,provider_name:"rke",encodedRKEConfig:this.encodeBase64Content(t.yamls)},t),callback:e=>{this.handleOk(e)},handleError:e=>{this.handleError(e)}}))})}),this.handleOk=(e=>{var t=this.props.onOK;e&&t&&t(e||{})}),this.handleError=(e=>{var t=this.props.onOK;e&&e.data&&7005===e.data.code&&t?t(e.data.data):(O.default.handleCloudAPIError(e),this.setState({loading:!1}))}),this.handleDelete=(e=>{var t=[...this.state.dataSource];this.setState({dataSource:t.filter(t=>t.key!==e)})}),this.handleEnvGroup=((e,t)=>{return this.clusters&&this.clusters.form?this.clusters.form.validateFields({force:!0},a=>{if(!a&&e)return e();t()}):t&&t(),!1}),this.handleAdd=(()=>{var e=this.state,t=e.count,a=e.dataSource,l={key:Math.random(),ip:"",internalIP:"",sshPort:22,roles:["etcd","controlplane","worker"]};t>2&&(l.roles=["worker"]);var r=()=>{this.setState({dataSource:[...a,l],count:t+1})};this.handleEnvGroup(r,r)}),this.handleSave=(e=>{var t=[...this.state.dataSource],a=t.findIndex(t=>e.key===t.key),l=t[a];t.splice(a,1,(0,k.default)({},l,e)),this.setState({dataSource:t})}),this.beforeUpload=((e,t)=>{var a=e.name.split("."),l=a.length,r="yaml"===a[l-1]||"yml"===a[l-1];return!!r||(t&&f.default.warning({message:"\u8bf7\u4e0a\u4f20\u4ee5.yaml\u3001.yml\u7ed3\u5c3e\u7684 Region Config \u6587\u4ef6"}),!1)}),this.nodeRole=(e=>{switch(e){case"controlplane":return"\u7ba1\u7406";case"worker":return"\u8ba1\u7b97";case"etcd":return"ETCD";default:return"\u672a\u77e5"}}),this.handleStartCheck=(e=>{var t=!1,a=this.state.activeKey;"1"===a?this.handleEnvGroup(()=>{t=!0},()=>{this.handleActiveKey("1"),this.handleCheck(!1)}):t=!0,this.props.form.validateFields(e=>{t&&e&&e.yamls&&(this.handleActiveKey("2"),t=!1),e&&e.yamls&&this.setState({isCheck:!1,helpType:"RKE",helpError:"\u586b\u5199RKE\u96c6\u7fa4\u914d\u7f6e"}),!e&&t&&this.handleCheck(t)}),t&&e&&this.createCluster()}),this.handleCheck=(e=>{this.setState({isCheck:e,forbiddenConfig:!0,countNum:15,countConfig:!0,countContent:null},()=>{var t=this.props.guideStep;e&&7!==t&&this.handleCountDown(),!e&&clearInterval(this.timerId)})}),this.handleActiveKey=(e=>{this.setState({activeKey:e})}),this.handleTabs=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=a.state,r=l.dataSource,n=l.yamlVal,s=a.props.form,i=s.getFieldValue,d={},o=i("yamls")||n;(o||r&&r.length>0)&&("2"===e?(d.nodes=r,d.encodedRKEConfig=o&&a.encodeBase64Content(o)):d.encodedRKEConfig=o&&a.encodeBase64Content(o)),a.fetchRkeconfig(d,t),t||a.handleActiveKey("".concat(e))},this.handleCountDown=(()=>{var e=this.state.countNum;this.setState({countConfig:!1,countContent:"".concat(e,"s")}),this.timerId=setInterval(()=>{if(this.setState({countNum:e--,countContent:"".concat(e,"s")}),e<0)return clearInterval(this.timerId),this.setState(()=>({forbiddenConfig:!1,countConfig:!0})),null},1e3)}),this.state={loading:!1,dataSource:[],count:0,isCheck:!1,yamlVal:"",initNodeCmd:"",activeKey:"1",helpError:"",helpType:"",forbiddenConfig:!0,countConfig:!0,countNum:15,countContent:null},this.clusters=[]}render(){var e=this.props,t=e.onCancel,a=e.form,l=e.clusterID,p=e.guideStep,m=e.handleNewbieGuiding,C=a.getFieldDecorator,v=a.setFieldsValue,b=this.state,I=b.helpType,w=b.helpError,S=b.loading,_=b.dataSource,D=b.initNodeCmd,K=b.isCheck,O=b.activeKey,L=b.yamlVal,N=b.forbiddenConfig,j=b.countContent,B=b.countConfig,V={labelCol:{xs:{span:3}},wrapperCol:{xs:{span:24}}},W={body:{row:U,cell:F}},q=[{title:"IP \u5730\u5740",dataIndex:"ip",width:150,editable:!0},{title:"\u5185\u7f51 IP \u5730\u5740",dataIndex:"internalIP",width:170,editable:!0},{title:"SSH \u7aef\u53e3",dataIndex:"sshPort",width:140,editable:!0},{title:"\u8282\u70b9\u7c7b\u578b",dataIndex:"roles",width:160,editable:!0,render:e=>e&&e.length>0&&e.map(e=>T.default.createElement(h.default,{color:"blue"},this.nodeRole(e)))},{title:"\u64cd\u4f5c",dataIndex:"name",width:80,align:"center",render:(e,t)=>{return _&&_.length>1?T.default.createElement(c.default,{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417?",onConfirm:()=>this.handleDelete(t.key)},T.default.createElement("a",null,"\u5220\u9664")):"-"}}],G=q.map(e=>{return e.editable?(0,k.default)({},e,{onCell:t=>{return{record:t,helpType:I,helpError:w,index:t.key,editable:e.editable,dataIndex:e.dataIndex,title:e.title,dataSource:_,handleClustersMount:this.handleClustersMount,handleSave:this.handleSave}}}):e}),J={position:"relative",zIndex:1e3,background:"#fff"};return T.default.createElement(s.default,{visible:!0,title:l?"\u914d\u7f6e\u96c6\u7fa4":"\u57fa\u4e8e\u4e3b\u673a\u5b89\u88c5\u96c6\u7fa4",className:R.default.TelescopicModal,width:900,destroyOnClose:!0,footer:T.default.createElement(T.Fragment,null,T.default.createElement(u.default,{type:"primary",onClick:()=>{this.handleStartCheck()},loading:S},l?"\u66f4\u65b0\u96c6\u7fa4":"\u5f00\u59cb\u5b89\u88c5"),p&&6===p&&m&&T.default.createElement(T.Fragment,null,m({tit:"6.\u5f00\u59cb\u5b89\u88c5",send:!0,configName:"kclustersAttention",desc:"\u786e\u8ba4RKE\u96c6\u7fa4\u914d\u7f6e\u4fe1\u606f\u586b\u5199\u6b63\u786e\u5e76\u7acb\u5373\u5f00\u59cb\u5b89\u88c5\u3002",nextStep:7,btnText:"\u5b89\u88c5",conPosition:{right:"110px",bottom:0},svgPosition:{right:"50px",marginTop:"-11px"},handleClick:()=>{this.handleStartCheck()}}))),confirmLoading:S,onCancel:t,maskClosable:!1},K&&T.default.createElement(s.default,{title:"\u786e\u5b9a\u5df2\u5b8c\u6210\u6240\u6709\u8282\u70b9\u7684\u521d\u59cb\u5316\u5e76\u5f00\u59cb\n            ".concat(l?"\u914d\u7f6e":"\u5b89\u88c5","\n           \u96c6\u7fa4\u5417?"),confirmLoading:S,className:R.default.TelescopicModal,width:900,visible:!0,footer:[T.default.createElement(u.default,{key:"back",onClick:()=>{this.handleCheck(!1)}},"\u53d6\u6d88"),T.default.createElement(u.default,{key:"link",type:"primary",onClick:()=>{this.setState({loading:!0},()=>{this.handleTabs("1"===O?"2":"1",!0)})},disabled:N},!B&&"\u6211\u5df2\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4,\u5f00\u59cb\u5b89\u88c5(".concat(j,")")||" \u6211\u5df2\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4,\u5f00\u59cb\u5b89\u88c5")]},T.default.createElement(i.default,{style:{padding:"0 16px"}},T.default.createElement("span",{style:{fontWeight:600,color:"red"}},"\u8bf7\u5728\u5f00\u59cb",l?"\u914d\u7f6e\u524d\u5728\u65b0\u52a0":"\u5b89\u88c5\u524d\u6240\u6709","\u8282\u70b9\u5148\u6267\u884c\u4ee5\u4e0b\u521d\u59cb\u5316\u547d\u4ee4\uff08\u6267\u884c\u7528\u6237\u9700\u8981\u5177\u6709sudo\u6743\u9650\uff09\uff1a"),T.default.createElement(d.default,{span:24,style:{marginTop:"16px"}},T.default.createElement("span",{className:R.default.cmd},T.default.createElement(o.default,{className:R.default.copy,type:"copy",onClick:()=>{(0,P.default)(D),f.default.success({message:"\u590d\u5236\u6210\u529f"})}}),p&&7===p&&m({tit:"\u8282\u70b9\u7684\u521d\u59cb\u5316",send:!0,configName:"nodeInitialization",handleClick:()=>{(0,P.default)(D),this.handleCountDown()},handleClosed:()=>{this.handleCountDown()},desc:"\u8bf7\u590d\u5236\u4e0a\u8ff0\u547d\u4ee4\u5b8c\u6210\u6240\u6709\u8282\u70b9\u7684\u521d\u59cb\u5316,\u70b9\u51fb\u786e\u5b9a\u3001\u8bf7\u7b49\u5f85 RKE \u96c6\u7fa4\u5b89\u88c5\u5b8c\u6210\u3002",prevStep:!1,btnText:"\u590d\u5236\u547d\u4ee4",nextStep:8,conPosition:{left:"0",bottom:"-156px"},svgPosition:{right:"-20px",marginTop:"-11px"}}),D)))),l&&T.default.createElement(n.default,{type:"warning",message:"\u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u7279\u522b\u662f\u7ba1\u7406\u8282\u70b9\u3001ETCD\u8282\u70b9\u914d\u7f6e\u5177\u6709\u4e00\u5b9a\u98ce\u9669\uff0c\u8bf7\u9009\u62e9\u5408\u9002\u7684\u65f6\u95f4\u8fdb\u884c"}),T.default.createElement(E.default,null,T.default.createElement(i.default,null,T.default.createElement(d.default,{span:24,style:{padding:"16px"}},T.default.createElement(A,{className:R.default.describe,style:p&&3===p&&J||{}},T.default.createElement("ul",null,T.default.createElement("li",null,T.default.createElement("span",null,"\u57fa\u4e8e\u63d0\u4f9b\u7684\u4e3b\u673a\u5b89\u88c5\u96c6\u7fa4\u3002")),T.default.createElement("li",null,T.default.createElement("span",null,"\u8bf7\u786e\u4fdd\u63d0\u4f9b\u7684\u4e3b\u673a",!l&&"\u7684 IP \u5730\u5740\u7684",T.default.createElement("b",null,"SSH \u7aef\u53e3"),"\u548c",T.default.createElement("b",null,"6443\u7aef\u53e3"),"\u90fd\u53ef\u4ee5\u88ab\u5f53\u524d\u7f51\u7edc\u76f4\u63a5\u8bbf\u95ee\u3002")),T.default.createElement("li",null,T.default.createElement("span",null,"\u8282\u70b9\u521d\u59cb\u5316\u811a\u672c\u4f1a\u8fdb\u884c",T.default.createElement("b",null,"\u7cfb\u7edf\u68c0\u67e5"),"\u3001",T.default.createElement("b",null,"\u914d\u7f6eSSH\u514d\u5bc6"),"\u3001",T.default.createElement("b",null,"Docker\u5b89\u88c5"),"\u4e09\u9879\u52a8\u4f5c\u3002")),T.default.createElement("li",null,T.default.createElement("span",null,"\u5982\u679c\u4f60\u7684\u4e3b\u673a\u5df2\u7ecf\u5b89\u88c5 Docker\uff0c\u8bf7\u786e\u4fdd\u4e0d\u80fd\u5927\u4e8e",T.default.createElement("b",null,"19.03.x")," \u548c\u4f4e\u4e8e",T.default.createElement("b",null,"1.13.x")," \u7248\u672c\u3002")))),p&&3===p&&m&&T.default.createElement(T.Fragment,null,m({tit:"\u6ce8\u610f\u4e8b\u9879",send:!1,configName:"kclustersAttention",showSvg:!1,showArrow:!0,desc:"\u6ce8\u610f\u67e5\u770b\u4e3b\u673a\u9700\u8981\u6ee1\u8db3\u7684\u524d\u63d0\u6761\u4ef6\u548c\u5b89\u88c5\u8bf4\u660e\u3002",nextStep:4,conPosition:{right:"15px",bottom:"-134px"}})))),!l&&T.default.createElement(i.default,null,T.default.createElement(d.default,{span:12,style:{padding:p&&4===p?"":"0 16px"}},T.default.createElement(E.default.Item,{label:"\u96c6\u7fa4\u540d\u79f0",style:p&&4===p&&Object.assign({},{padding:"0 16px"},J)||{}},C("name",{initialValue:"",rules:[{required:!0,message:"\u96c6\u7fa4\u540d\u79f0\u5fc5\u586b"},{pattern:/^[a-z0-9A-Z-]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e2d\u5212\u7ebf\u7ec4\u5408"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(T.default.createElement(g.default,{placeholder:"\u96c6\u7fa4\u540d\u79f0,\u8bf7\u786e\u4fdd\u5176\u4fdd\u6301\u552f\u4e00"}))),p&&4===p&&m&&T.default.createElement(T.Fragment,null,m({tit:"\u586b\u5199\u96c6\u7fa4\u540d\u79f0",showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:"\u586b\u5199RKE\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u521d\u6b21\u4f53\u9a8c\u5355\u8282\u70b9\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5b89\u88c5\u54e6\u3002",nextStep:5,conPosition:{marginTop:"-22px"}})))),T.default.createElement(y.default,{activeKey:O,onChange:e=>{this.handleTabs(e)}},T.default.createElement(M,{tab:"\u53ef\u89c6\u5316\u914d\u7f6e",key:"1"},T.default.createElement("div",null,T.default.createElement(i.default,null,T.default.createElement(d.default,{span:24,style:{padding:"0 16px"}},T.default.createElement(E.default.Item,{label:"\u8282\u70b9\u5217\u8868",style:p&&5===p&&Object.assign({},{padding:"0 16px"},J)||{}},C("nodeLists",{initialValue:""})(T.default.createElement(r.default,{dataSource:_,columns:G,components:W,bordered:!0,rowClassName:()=>"editable-row",pagination:!1}))),T.default.createElement(u.default,{onClick:this.handleAdd,style:{marginBottom:16}},"\u589e\u52a0\u8282\u70b9"))))),T.default.createElement(M,{tab:"\u81ea\u5b9a\u4e49\u914d\u7f6e",key:"2"})),p&&5===p&&m&&T.default.createElement(T.Fragment,null,m({tit:"\u586b\u5199\u8282\u70b9",showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:"\u586b\u5199RKE\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u521d\u6b21\u4f53\u9a8c\u5355\u8282\u70b9\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5b89\u88c5\u54e6\u3002",nextStep:6,conPosition:{bottom:"-14px",left:"39px"}})),T.default.createElement("div",{style:{display:"1"===O?"none":"block"}},(l&&"2"===O||!l)&&T.default.createElement(x.default,{help:w,data:L||"",label:"RKE\u96c6\u7fa4\u914d\u7f6e",bg:"151718",width:"100%",marginTop:120,setFieldsValue:v,formItemLayout:V,Form:E.default,getFieldDecorator:C,beforeUpload:this.beforeUpload,mode:"yaml",name:"yamls",message:"\u586b\u5199RKE\u96c6\u7fa4\u914d\u7f6e"}))))}})||S)||S);t.default=q}).call(this,a("tjlA").Buffer)},sQyZ:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=l(a("kLXV"));a("14J3");var n=l(a("BMrR"));a("giR+");var s=l(a("fyUT"));a("5NDa");var i=l(a("5rEg"));a("jCWc");var d=l(a("kPKH")),o=l(a("p0pE"));a("y8nQ");var u=l(a("Vl3Y"));a("OaEy");var c=l(a("2fM7"));a("tU7J");var h,p,f,m=l(a("wFql")),g=a("MuoO"),C=b(a("q1tI")),v=l(a("AklW")),k=l(a("dBUJ"));function E(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(E=function(e){return e?a:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=E(t);if(a&&a.has(e))return a.get(e);var l={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=r?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(l,n,s):l[n]=e[n]}return l.default=e,a&&a.set(e,l),l}var y=m.default.Paragraph,I=c.default.Option,w=(h=u.default.create(),p=(0,g.connect)(),h(f=p(f=class extends C.PureComponent{constructor(e){super(e),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.eid,r=e.onOK;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,o.default)({enterprise_id:l,provider_name:"ack"},t),callback:e=>{e&&r&&r(e)},handleError:e=>{e&&e.data&&7005===e.data.code?r(e.data.data):(v.default.handleCloudAPIError(e),this.setState({loading:!1}))}}))})}),this.changeWorkerType=(e=>{""===e&&this.setState({customResource:!0})}),this.state={customResource:!1,loading:!1}}render(){var e=this.props.onCancel,t=this.props.form.getFieldDecorator,a=this.state,l=a.customResource,o=a.loading;return C.default.createElement(r.default,{visible:!0,title:"\u8d2d\u4e70\u963f\u91cc\u4e91 ACK \u96c6\u7fa4",onOk:this.createCluster,width:800,confirmLoading:o,onCancel:e},C.default.createElement(u.default,null,C.default.createElement(n.default,null,C.default.createElement(d.default,{span:24,style:{padding:"16px"}},C.default.createElement(y,{className:k.default.describe},C.default.createElement("ul",null,C.default.createElement("li",null,C.default.createElement("span",null,"\u59d4\u6258\u8d2d\u4e70\u65f6\u5c06\u8d2d\u4e70\u4ee5\u4e0b\u8d44\u6e90\uff1a\u6807\u51c6\u6258\u7ba1\u96c6\u7fa4(1\u4e2a)\u3001VPC(1\u4e2a)")),C.default.createElement("li",null,C.default.createElement("span",null,"\u65b0\u8d2d\u96c6\u7fa4\u90fd\u5c06\u91c7\u7528\u6309\u9700\u540e\u4ed8\u8d39\u6a21\u5f0f\uff0c\u56e0\u6b64\u8bf7\u786e\u4fdd\u4f60\u7684\u963f\u91cc\u4e91\u8d26\u53f7\u80fd\u591f\u8fdb\u884c\u6309\u9700\u8d2d\u4e70\u8d44\u6e90")),C.default.createElement("li",null,C.default.createElement("span",null,"\u8d2d\u4e70\u7684Kubernetes\u5c06\u5f00\u542fEIP,\u901a\u8fc7\u516c\u7f51\u8bbf\u95eeKubeApiserver, \u96c6\u7fa4\u5bf9\u63a5\u5b8c\u6bd5\u540e\u53ef\u4ee5\u624b\u5de5\u5173\u95ed\u96c6\u7fa4\u7684\u5916\u7f51\u8bbf\u95eeEIP")),C.default.createElement("li",null,C.default.createElement("span",null,"\u9ed8\u8ba4\u91c7\u7528\u63a8\u8350\u7684\u8d44\u6e90\u7c7b\u578b\u914d\u7f6e\uff0c\u82e5\u4e0d\u7b26\u5408\u4f60\u7684\u9884\u671f\uff0c\u4f60\u53ef\u76f4\u63a5\u524d\u5f80\u963f\u91cc\u4e91\u63a7\u5236\u53f0\u81ea\u5b9a\u4e49\u8d2d\u4e70\u6258\u7ba1\u96c6\u7fa4\uff0c\u7136\u540e\u8fd4\u56de\u5230\u96c6\u7fa4\u5217\u8868\u9009\u62e9\u540e\u5f00\u59cb\u521d\u59cb\u5316")),C.default.createElement("li",null,C.default.createElement("span",null,"\u8d2d\u4e70\u96c6\u7fa4\u7684\u6210\u529f\u6027\u548c\u8017\u65f6\u53d6\u51b3\u4e8e\u963f\u91cc\u4e91\u7684\u5b9e\u9645\u72b6\u6001\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u9884\u8ba110\u5206\u949f\u53ef\u4ee5\u5b8c\u6210\u96c6\u7fa4\u8d2d\u4e70")),l&&C.default.createElement("li",null,C.default.createElement("span",null,"\u81ea\u5b9a\u4e49\u8d44\u6e90\u89c4\u683c\u65f6\u8bf7\u53c2\u8003"," ",C.default.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://ecs-buy.aliyun.com/instanceTypes"},"\u963f\u91cc\u4e91ECS\u89c4\u683c\u8bf4\u660e\u6587\u6863")," ","\u83b7\u53d6\u8d44\u6e90\u89c4\u683cID"))))),C.default.createElement(d.default,{span:12,style:{padding:"0 16px"}},C.default.createElement(u.default.Item,{label:"\u533a\u57df"},t("region",{initialValue:"cn-hangzhou",rules:[{required:!0,message:"\u96c6\u7fa4\u521b\u5efa\u533a\u57df\u5fc5\u9009"}]})(C.default.createElement(c.default,{placeholder:"\u533a\u57df",getPopupContainer:e=>e.parentNode},v.default.getAllAliyunRegions().map(e=>{return C.default.createElement(I,{key:e.RegionId,value:e.RegionId},e.LocalName)}))))),C.default.createElement(d.default,{span:12,style:{padding:"0 16px"}},C.default.createElement(u.default.Item,{label:"\u540d\u79f0"},t("name",{initialValue:"",rules:[{required:!0,message:"\u96c6\u7fa4\u540d\u79f0\u5fc5\u586b"},{pattern:/^[a-z0-9A-Z-]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e2d\u5212\u7ebf\u7ec4\u5408"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(C.default.createElement(i.default,{placeholder:"\u96c6\u7fa4\u540d\u79f0,\u8bf7\u786e\u4fdd\u5176\u4fdd\u6301\u552f\u4e00"})))),C.default.createElement(d.default,{span:12,style:{padding:"0 16px"}},!l&&C.default.createElement(u.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"ecs.g5.xlarge",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"}]})(C.default.createElement(c.default,{getPopupContainer:e=>e.parentNode,onChange:this.changeWorkerType,placeholder:"\u96c6\u7fa4\u540d\u79f0"},C.default.createElement(I,{value:"ecs.g5.large"},"\u6700\u5c0f\u914d\u7f6e\uff08\u5355\u8282\u70b92Core/8GB RAM, \u6309\u9700\u9884\u8ba12\u5143/\u5c0f\u65f6\uff09"),C.default.createElement(I,{value:"ecs.g5.xlarge"},"\u666e\u901a\u914d\u7f6e\uff08\u5355\u8282\u70b94Core/16GB RAM, \u6309\u9700\u9884\u8ba14\u5143/\u5c0f\u65f6\uff09"),C.default.createElement(I,{value:"ecs.g5.2xlarge"},"\u751f\u4ea7\u914d\u7f6e\uff08\u5355\u8282\u70b98Core/32GB RAM, \u6309\u9700\u9884\u8ba18\u5143/\u5c0f\u65f6\uff09"),C.default.createElement(I,{value:""},"\u81ea\u5b9a\u4e49")))),l&&C.default.createElement(u.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"},{pattern:/^[a-z0-9A-Z.]+$/,message:"\u8bf7\u786e\u5b9a\u8d44\u6e90\u914d\u7f6e\u89c4\u683c\u662f\u5426\u5408\u6cd5"}]})(C.default.createElement(i.default,{placeholder:"\u963f\u91cc\u4e91ECS\u89c4\u683c"})))),C.default.createElement(d.default,{span:12,style:{padding:"0 16px"}},C.default.createElement(u.default.Item,{label:"\u8282\u70b9\u6570\u91cf"},t("workerNum",{initialValue:2,rules:[{required:!0,message:"\u8282\u70b9\u6570\u91cf\u5fc5\u987b\u6307\u5b9a"}]})(C.default.createElement(s.default,{style:{width:"100%"},min:2,placeholder:"\u8282\u70b9\u6570\u91cf"})))))))}})||f)||f);t.default=w}}]);