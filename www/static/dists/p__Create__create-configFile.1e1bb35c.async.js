(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[36],{Wcuw:function(e,t,a){"use strict";var i=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var r=i(a("2/Rp")),l=i(a("p0pE"));a("/xke");var n,o,m,u=i(a("TeRw")),p=a("MuoO"),d=a("7DNP"),c=s(a("q1tI")),h=a("LLXN"),f=i(a("2lxJ")),g=i(a("XZXw")),y=a("4/zt"),v=i(a("hyd8")),_=i(a("q76B")),M=i(a("QDog")),C=i(a("n9hB")),E=i(a("hMqj")),b=i(a("v10I")),S=(n=(0,p.connect)(e=>{var t=e.loading,a=e.teamControl,i=e.user;return{currUser:i.currentUser,buildAppsLoading:t.effects["createApp/buildApps"],deleteAppLoading:t.effects["appControl/deleteApp"],currentTeamPermissionsInfo:a.currentTeamPermissionsInfo,soundCodeLanguage:a.codeLanguage,packageNpmOrYarn:a.packageNpmOrYarn}},null,null,{withRef:!0}),n((m=class extends c.PureComponent{constructor(e){var t;super(e),t=this,this.onRef=(e=>{this.child=e}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return E.default.querySpecifiedPermissionsInfo(t,e)}),this.isShowEnterprisePlugin=(()=>{var e=this.props,t=e.dispatch,a=e.currUser;t({type:"global/getPluginList",payload:{enterprise_id:a.enterprise_id,region_name:M.default.getCurrRegionName()},callback:e=>{if(e&&e.list){var t=b.default.isInstallPlugin(e.list,"rainbond-bill");this.setState({showEnterprisePlugin:t},()=>{this.loadDetail()})}},handleError:()=>{this.setState({showEnterprisePlugin:!1,pluginLoading:!1})}})}),this.loadDetail=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.team_name,i=t.app_alias;e({type:"appControl/fetchDetail",payload:{team_name:a,app_alias:i},callback:e=>{this.setState({appDetail:e})},handleError:e=>{var t=C.default.getCode(e);t&&404===t&&this.handleJump("exception/404")}})}),this.handleBuild=(e=>{var t=this.props,a=t.dispatch,i=t.soundCodeLanguage,s=t.packageNpmOrYarn,r=this.state.appDetail,l=this.fetchParameter(),n=l.team_name,o=l.app_alias;0==e?(0,y.setNodeLanguage)({team_name:n,app_alias:o,lang:i,package_tool:s}).then(e=>{a({type:"createApp/buildApps",payload:{team_name:n,app_alias:o},callback:e=>{var t;e&&(a({type:"global/fetchGroups",payload:{team_name:n}}),window.sessionStorage.removeItem("codeLanguage"),window.sessionStorage.removeItem("packageNpmOrYarn"),window.sessionStorage.removeItem("advanced_setup"),this.handleJump("apps/".concat(null===r||void 0===r?void 0:null===(t=r.service)||void 0===t?void 0:t.group_id,"/overview?type=components&componentID=").concat(o,"&tab=overview")))},handleError:e=>{u.default.error({message:e.data.msg_show})}})}):u.default.warning({message:(0,h.formatMessage)({id:"notification.warn.save"})})}),this.handleDelete=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.team_name,i=t.app_alias;e({type:"appControl/deleteApp",payload:{team_name:a,app_alias:i,is_force:!0},callback:()=>{e({type:"global/fetchGroups",payload:{team_name:a}}),window.sessionStorage.removeItem("codeLanguage"),window.sessionStorage.removeItem("packageNpmOrYarn"),window.sessionStorage.removeItem("advanced_setup"),this.handleJump("index")}})}),this.handleJump=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),i=a.team_name,s=a.region_name;t(d.routerRedux.replace("/team/".concat(i,"/region/").concat(s,"/").concat(e)))}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.fetchParameter=(()=>{return{team_name:M.default.getCurrTeamName(),region_name:M.default.getCurrRegionName(),app_alias:this.getAppAlias()}}),this.handleBuildSwitch=(e=>{this.setState({handleBuildSwitch:e})}),this.handleLinkConfigPort=(e=>{var t=this.props,a=t.match.params,i=a.appAlias,s=a.regionName,r=a.teamName,l=t.dispatch;l(d.routerRedux.replace("/team/".concat(r,"/region/").concat(s,"/create/").concat(e,"/").concat(i)))}),this.handleJumpNext=(()=>{var e=this.child.childFn();!1!==e&&this.handleLinkConfigPort("create-configPort")}),this.handleEditInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.props,i=a.match.params,s=i.appAlias,r=(i.regionName,i.teamName);a.dispatch;t.props.dispatch({type:"appControl/editAppCreateInfo",payload:(0,l.default)({team_name:r,app_alias:s},e),callback:e=>{e&&(t.loadDetail(),t.handleBuildSwitch(!1))}})},this.handleEditRuntime=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.props,i=a.match.params,s=i.appAlias,r=(i.regionName,i.teamName);a.dispatch;t.props.dispatch({type:"appControl/editRuntimeBuildInfo",payload:{team_name:r,app_alias:s,build_env_dict:e},callback:e=>{e&&e.status_code}})},this.state={appDetail:null,handleBuildSwitch:!1,showEnterprisePlugin:!1}}componentDidMount(){this.isShowEnterprisePlugin()}componentWillUnmount(){this.props.dispatch({type:"appControl/clearDetail"})}getAppAlias(){return this.props.match.params.appAlias}handleDebounce(e,t){var a=null;return i=>{null!==a&&clearTimeout(a),a=setTimeout(()=>{e.call(i),a=null},t)}}render(){var e=this.props,t=e.buildAppsLoading,a=e.deleteAppLoading,i=this.state,s=i.showDelete,l=(i.handleBuildSwitch,i.showEnterprisePlugin),n=!0,o=this.state.appDetail||{};return o.service?c.default.createElement(c.default.Fragment,null,c.default.createElement(g.default,{titleSvg:f.default.getPageHeaderSvg("environment",18),title:(0,h.formatMessage)({id:"componentCheck.advanced.env"}),content:(0,h.formatMessage)({id:"versionUpdata_6_1.content3"})},c.default.createElement("div",null,c.default.createElement(v.default,{updateDetail:this.loadDetail,appDetail:o,showEnterprisePlugin:l,handleBuildSwitch:this.handleBuildSwitch,handleEditInfo:this.handleEditInfo,handleEditRuntime:this.handleEditRuntime,onRef:this.onRef}),c.default.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center"}},n&&c.default.createElement(r.default,{onClick:this.showDelete,type:"default",style:{marginRight:8}},(0,h.formatMessage)({id:"button.abandon_create"})),c.default.createElement(r.default,{style:{marginRight:8},onClick:()=>this.handleLinkConfigPort("create-check")},(0,h.formatMessage)({id:"button.previous"})),c.default.createElement(r.default,{loading:t,onClick:this.handleJumpNext,type:"primary"},(0,h.formatMessage)({id:"button.next"}))),s&&c.default.createElement(_.default,{loading:a,onOk:this.handleDelete,title:(0,h.formatMessage)({id:"confirmModal.abandon_create.create_check.title"}),subDesc:(0,h.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),desc:(0,h.formatMessage)({id:"confirmModal.delete.create_check.desc"}),onCancel:()=>{this.setState({showDelete:!1})}})))):null}},o=m))||o);t.default=S},dpL7:function(e,t,a){e.exports={typeBtnWrap:"typeBtnWrap___2cap9",typeBtn:"typeBtn___1BNl-",active:"active___3LXqC",en_typeBtnWrap:"en_typeBtnWrap___1E-kl",en_typeBtn:"en_typeBtn___3lyPf",ant_radio_disabled:"ant_radio_disabled___2nH8-",selectRow:"selectRow___aaLw6"}},hyd8:function(e,t,a){"use strict";var i=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=i(a("bx4M"));a("jCWc");var l=i(a("kPKH"));a("5NDa");var n=i(a("5rEg"));a("8dk+");var o=i(a("eZ87"));a("14J3");var m=i(a("BMrR"));a("O3gP");var u=i(a("lrIw")),p=i(a("jehZ")),d=i(a("p0pE"));a("/xke");var c=i(a("TeRw"));a("y8nQ");var h=i(a("Vl3Y"));a("OaEy");var f=i(a("2fM7"));a("7Kak");var g,y,v,_,M,C,E,b,S,w,k,x,D,B,V=i(a("9yH6")),P=a("MuoO"),R=(a("7DNP"),s(a("q1tI"))),I=a("LLXN"),O=(i(a("q9KF")),i(a("8hm0")),i(a("puxM")),i(a("7C1b")),i(a("q76B")),i(a("wwqj")),i(a("MXRY")),i(a("cUW5"))),G=(i(a("rbEa")),i(a("dpSA")),a("xpXo"),i(a("lpA0"))),N=i(a("QDog")),A=i(a("hMqj")),U=i(a("I/an")),L=i(a("8+Sn")),j=(a("+n12"),i(a("m+FX"))),F=i(a("3iJ6")),T=i(a("dpL7")),q=V.default.Button,J=V.default.Group,X=f.default.Option,W=(f.default.OptGroup,g=(0,P.connect)(null,null,null,{withRef:!0}),y=h.default.create(),g(v=y((_=class extends R.PureComponent{constructor(e){super(e),this.handleSubmitCpu=(()=>{var e=this.state,t=(e.setUnit,e.memoryMarksObj),a=e.cpuMarksObj,i=e.isCustomMemory,s=e.isCustomCpu,r=e.customMemoryValue,l=e.customCpuValue,n=e.customMemoryUnit,o=this.props,m=o.form,u=o.onSubmit;o.showEnterprisePlugin;if(i&&!this.validateCustomMemory())return!1;var p=!0;return m.validateFields((e,o)=>{if(!e&&u&&o){if(i){if(!this.validateCustomMemory())return void(p=!1);var m=parseFloat(r);o.min_memory="GB"===n?1024*m:m}else Object.keys(t).forEach(e=>{t[e]==o.min_memory&&(o.min_memory=e)});if(s){if(!l||""===l)return void c.default.warning({message:"\u8bf7\u8f93\u5165\u81ea\u5b9a\u4e49CPU\u503c"});o.min_cpu=1e3*parseFloat(l)}else Object.keys(a).forEach(e=>{a[e]==o.min_cpu&&(o.min_cpu=e)});o.extend||(o.extend_method="stateless_multiple"),u(o)}else p=!1}),p}),this.onChecks=(e=>{var t=this.props,a=t.appDetail,i=(t.form,t.handleBuildSwitch,this.state),s=(i.method,i.memory,i.cpu,a.service.extend_method);e.target.value!=s?this.setState({method:!0},()=>{this.handleSwitch()}):this.setState({method:!1},()=>{this.handleSwitch()}),"cronjob"===e.target.value?this.setState({is_flag:!0}):this.setState({is_flag:!1})}),this.RadioGroupChange=(e=>{var t=this.props,a=t.appDetail,i=(t.handleBuildSwitch,a.service.min_memory);e.target.value!=i?this.setState({memory:!0},()=>{this.handleSwitch()}):this.setState({memory:!1},()=>{this.handleSwitch()})}),this.inputChange=(e=>{var t=this.props,a=t.appDetail,i=(t.handleBuildSwitch,a.service.min_cpu);e.target.value!=i?this.setState({cpu:!0},()=>{this.handleSwitch()}):this.setState({cpu:!1},()=>{this.handleSwitch()})}),this.handleSwitch=(()=>{var e=this.props.handleBuildSwitch,t=this.state,a=t.method,i=t.memory,s=t.cpu;e(a||i||s)}),this.selectAfterChange=(e=>{this.setState({setUnit:e})}),this.RadioChangeComponentType=(e=>{e.target.value||this.setState({is_flag:!1}),this.setState({isComponentType:e.target.value})}),this.RadioGroupChangeCpu=(e=>{this.setState({isCpu:e.target.value})}),this.RadioGroupChangeMemory=(e=>{this.setState({isMemory:e.target.value})}),this.handleMemoryChange=(e=>{var t={0:0,1:1,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,10:9},a=void 0!==t[e]?t[e]:8,i=10===e;this.setState({memoryValue:e,cpuValue:a,isCustomMemory:i,isCustomCpu:i},()=>{var e=this.props.form;e.setFieldsValue({min_cpu:a})})}),this.handleCpuChange=(e=>{var t=9===e;this.setState({cpuValue:e,isCustomCpu:t})}),this.handleCustomMemoryChange=(e=>{var t=e.target.value;this.setState({customMemoryValue:t,customMemoryError:""})}),this.validateCustomMemory=(()=>{var e=this.state,t=e.customMemoryValue,a=e.customMemoryUnit;if(!t||""===t)return this.setState({customMemoryError:"\u8bf7\u8f93\u5165\u5185\u5b58\u503c"}),!1;var i=parseFloat(t);if(isNaN(i))return this.setState({customMemoryError:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u6570\u5b57"}),!1;if(i<=0)return this.setState({customMemoryError:"\u5185\u5b58\u503c\u5fc5\u987b\u5927\u4e8e0"}),!1;if("MB"===a){if(!Number.isInteger(i))return this.setState({customMemoryError:"MB\u5355\u4f4d\u65f6\u8bf7\u8f93\u5165\u6574\u6570"}),!1;if(i<1)return this.setState({customMemoryError:"MB\u5355\u4f4d\u65f6\u6700\u5c0f\u503c\u4e3a 1 MB"}),!1;if(i>1048576)return this.setState({customMemoryError:"\u5185\u5b58\u4e0d\u80fd\u8d85\u8fc7 1048576 MB"}),!1}if("GB"===a){if(i<1)return this.setState({customMemoryError:"GB\u5355\u4f4d\u65f6\u6700\u5c0f\u503c\u4e3a 1 GB"}),!1;if(i>1024)return this.setState({customMemoryError:"\u5185\u5b58\u4e0d\u80fd\u8d85\u8fc7 1024 GB"}),!1}return this.setState({customMemoryError:""}),!0}),this.handleMemoryUnitChange=(e=>{var t=this.state,a=t.customMemoryValue,i=t.customMemoryUnit;if(a&&""!==a){var s=parseFloat(a),r="";if("GB"===i&&"MB"===e)r=(1024*s).toString();else if("MB"===i&&"GB"===e){var l=s/1024;r=l.toFixed(2),r=parseFloat(r).toString()}this.setState({customMemoryUnit:e,customMemoryValue:r,customMemoryError:""},()=>{this.validateCustomMemory()})}else this.setState({customMemoryUnit:e,customMemoryError:""})}),this.handleCustomCpuChange=(e=>{this.setState({customCpuValue:e.target.value})}),this.checkNum=((e,t)=>{var a=this.state,i=a.memoryMarksObj,s=a.cpuMarksObj,r=this.props.showEnterprisePlugin,l=0;return"memory"==t&&(Object.keys(i).forEach(t=>{t==e&&(l=i[t])}),0===l&&e>0&&!r&&(l=10)),"cpu"==t&&(Object.keys(s).forEach(t=>{t==e&&(l=s[t])}),0===l&&e>0&&!r&&(l=9)),l}),this.getFormValues=((e,t)=>{var a=this.state,i=a.cpuMarksObj,s=a.memoryMarksObj,r=a.isCustomMemory,l=a.isCustomCpu,n=a.customMemoryValue,o=a.customCpuValue,m=a.customMemoryUnit,u=0;return"memory"==t?r&&10===e?u=n&&""!==n?"GB"===m?1024*parseFloat(n):parseFloat(n):0:Object.keys(s).forEach(t=>{s[t]==e&&(u=t)}):l&&9===e?u=o&&""!==o?1e3*parseFloat(o):0:Object.keys(i).forEach(t=>{i[t]==e&&(u=t)}),u});var t=e.appDetail&&e.appDetail.service&&e.appDetail.service.extend_method||"stateless_multiple";this.state={memoryList:[{text:"64M",value:64},{text:"128M",value:128},{text:"256M",value:256},{text:"512M",value:512},{text:"1G",value:1024},{text:"2G",value:2048},{text:"4G",value:4096},{text:"8G",value:8192},{text:"16G",value:16384}],is_flag:!1,method:!1,memory:!1,cpu:!1,isComponentType:"stateless_multiple"!==t,isMemory:0!=e.appDetail.service.min_memory,isCpu:0!=e.appDetail.service.min_cpu,setUnit:e.appDetail.service.min_memory%1024==0?"G":"M",memorySliderMin:1,memorySliderMax:8,cpuSliderMin:1,cpuSliderMax:7,memoryMarks:{1:"128M",2:"256M",3:"512M",4:"1G",5:"2G",6:"4G",7:"8G",8:"16G"},memoryMarksObj:{128:1,256:2,512:3,1024:4,2048:5,4096:6,8192:7,16384:8},cpuMarks:{1:"100m",2:"250m",3:"500m",4:"1Core",5:"2Core",6:"4Core",7:"8Core"},cpuMarksObj:{100:1,250:2,500:3,1000:4,2000:5,4000:6,8000:7},cpuValue:0,memoryValue:0,isCustomMemory:!1,isCustomCpu:!1,customMemoryValue:"",customCpuValue:"",customMemoryUnit:"GB",customMemoryError:""}}componentDidMount(){var e=this.props,t=e.onRefCpu,a=e.appDetail,i=e.showEnterprisePlugin;i||this.setState({memoryMarks:(0,d.default)({0:(0,I.formatMessage)({id:"appOverview.no_limit"})},this.state.memoryMarks,{9:"32G",10:"\u81ea\u5b9a\u4e49"}),cpuMarks:(0,d.default)({0:(0,I.formatMessage)({id:"appOverview.no_limit"})},this.state.cpuMarks,{8:"16Core",9:"\u81ea\u5b9a\u4e49"}),memoryMarksObj:(0,d.default)({0:0},this.state.memoryMarksObj,{32768:9,custom:10}),cpuMarksObj:(0,d.default)({0:0},this.state.cpuMarksObj,{16000:8,custom:9}),memorySliderMax:10,memorySliderMin:0,cpuSliderMax:9,cpuSliderMin:0}),setTimeout(()=>{var e=this.checkNum(a.service.min_memory,"memory"),t=this.checkNum(a.service.min_cpu,"cpu"),i=10===e,s=9===t,r="MB",l="";if(i&&a.service.min_memory>0){var n=a.service.min_memory;if(n>=1024){var o=n/1024;Number.isInteger(o)||o.toFixed(2)==o?(r="GB",l=o.toString()):(r="MB",l=n.toString())}else r="MB",l=n.toString()}this.setState({cpuValue:t,memoryValue:e,isCustomMemory:i,isCustomCpu:s,customMemoryValue:l,customCpuValue:s?(a.service.min_cpu/1e3).toString():"",customMemoryUnit:r})},10),t&&this.props.onRefCpu(this)}render(){var e=this.props,t=e.appDetail,a=e.form,i=e.showEnterprisePlugin,s=this.state,d=s.is_flag,c=(s.setUnit,s.isComponentType),g=(s.isMemory,s.isCpu,s.memoryMarks),y=s.cpuMarks,v=s.cpuValue,_=s.memoryValue,M=s.memorySliderMax,C=s.memorySliderMin,E=s.cpuSliderMax,b=s.cpuSliderMin,S=s.isCustomMemory,w=s.isCustomCpu,k=s.customMemoryValue,x=s.customCpuValue,D=s.customMemoryUnit,B=s.customMemoryError,P=a.getFieldDecorator,O=t.service,G=(O.extend_method,O.min_memory,O.min_cpu,t&&t.service&&t.service.extend_method),A="state_singleton"==G?"state_multiple":"stateless_singleton"==G?"stateless_multiple":"job"==G?"job":"cronjob"==G?"cronjob":G,U=(this.state.memoryList,[{name:(0,I.formatMessage)({id:"componentOverview.body.Strategy.hour"}),value:"0 * * * *"},{name:(0,I.formatMessage)({id:"componentOverview.body.Strategy.day"}),value:"0 0 * * *"},{name:(0,I.formatMessage)({id:"componentOverview.body.Strategy.week"}),value:"0 0 * * 0"},{name:(0,I.formatMessage)({id:"componentOverview.body.Strategy.month"}),value:"0 0 1 * *"},{name:(0,I.formatMessage)({id:"componentOverview.body.Strategy.year"}),value:"0 0 1 1 *"}]),L={display:"block",height:"30px",lineHeight:"30px"},j={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};return R.default.createElement(r.default,{title:(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info"}),style:{marginBottom:16}},R.default.createElement(m.default,null,R.default.createElement(l.default,{span:18},R.default.createElement(h.default.Item,(0,p.default)({style:{marginTop:"6px"}},j,{label:(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info.label.extend_method"})}),P("extend",{initialValue:"stateless_multiple"!==G,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.setting.extend_method"})}]})(R.default.createElement(J,{onChange:this.RadioChangeComponentType},R.default.createElement(q,{key:"default",value:!1},(0,I.formatMessage)({id:"componentCheck.advanced.setup.deploy_attr.Stateless_type"})),R.default.createElement(q,{key:"rest",value:!0},(0,I.formatMessage)({id:"componentCheck.advanced.setup.deploy_attr.Other_types"}))))),c&&R.default.createElement(h.default.Item,(0,p.default)({style:{paddingLeft:"160px"}},j),P("extend_method",{initialValue:A,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.setting.extend_method"})}]})(R.default.createElement(J,null,N.default.getSupportComponentTyps().map(e=>{return R.default.createElement(V.default,{key:e.type,onChange:this.onChecks,style:L,value:e.type},e.desc)})))),d&&R.default.createElement(h.default.Item,j,P("schedule",{initialValue:"0 * * * *",rules:[{required:!1,message:(0,I.formatMessage)({id:"placeholder.setting.schedule"})}]})(R.default.createElement(m.default,{className:T.default.selectRow,type:"flex",style:{margin:"14px 0px",marginTop:"-20px"}},R.default.createElement("div",{style:{marginLeft:"160px",fontWeight:"bolder",marginTop:"-4px"}},(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info.label.schedule"})),R.default.createElement(u.default,{defaultValue:"0 * * * *"},U.length>0?U.map(e=>{var t=R.default.createElement(u.default.Option,{value:e.value},e.name);return t}):null)))),R.default.createElement(h.default.Item,(0,p.default)({},j,{label:(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info.label.min_memory"})}),P("min_memory",{initialValue:_,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.setting.min_memory"})}]})(R.default.createElement(o.default,{style:{width:"500px"},marks:g,min:C,max:M,step:null,defaultValue:_,onChange:this.handleMemoryChange,tooltipVisible:!1}))),!i&&S&&R.default.createElement(h.default.Item,(0,p.default)({},j,{label:(0,I.formatMessage)({id:"componentOverview.body.Expansion.customMemory"}),validateStatus:B?"error":"",help:B}),R.default.createElement(n.default.Group,{compact:!0},R.default.createElement(n.default,{style:{width:"150px"},placeholder:"GB"===D?"\u4f8b\u5982: 1.5":"\u4f8b\u5982: 512",value:k,onChange:this.handleCustomMemoryChange,onBlur:this.validateCustomMemory,type:"number",min:1,step:"GB"===D?.1:1}),R.default.createElement(f.default,{value:D,onChange:this.handleMemoryUnitChange,style:{width:80}},R.default.createElement(X,{value:"MB"},"MB"),R.default.createElement(X,{value:"GB"},"GB")))),R.default.createElement(h.default.Item,(0,p.default)({},j,{label:(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info.label.min_cpu"})}),P("min_cpu",{initialValue:v,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.plugin.min_cpu"})},{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:(0,I.formatMessage)({id:"placeholder.plugin.min_cpuMsg"})}]})(R.default.createElement(o.default,{style:{width:"500px"},marks:y,min:b,max:E,step:null,defaultValue:v,onChange:this.handleCpuChange,tooltipVisible:!1}))),!i&&w&&R.default.createElement(h.default.Item,(0,p.default)({},j,{label:"\u81ea\u5b9a\u4e49CPU"}),R.default.createElement(n.default,{style:{width:"200px"},placeholder:"\u8bf7\u8f93\u5165CPU\u5927\u5c0f",value:x,onChange:this.handleCustomCpuChange,addonAfter:"Core",type:"number",min:.1,step:.1}))),i&&R.default.createElement(l.default,{span:6},R.default.createElement(F.default,{key:v*_,type:"card",cpu_use:this.getFormValues(v,"cpu"),memory_use:this.getFormValues(_,"memory")}))))}},v=_))||v)||v),Y=(M=(0,P.connect)(null,null,null,{withRef:!0}),C=h.default.create(),M(E=C((b=class extends R.PureComponent{constructor(e){super(e),this.handleSubmitCpu=(()=>{var e=this.state,t=e.setUnit,a=(e.setUnitDisk,this.props),i=a.form,s=a.onSubmit;i.validateFields((e,a)=>{if(!e&&s&&a){if("custom"==a.min_memory&&a.memory_value){if(t){var i="G"==t?1024*a.memory_value:a.memory_value;a.min_memory=i}else{var r="G"==U.default.getUnit(512)?Number(1024*a.memory_value):Number(a.memory_value);a.min_memory=r}a.min_cpu=Number(a.min_cpu)}else switch(a.min_memory){case 2048:a.min_memory=2048,a.min_cpu=2e3;break;case 4096:a.min_memory=4096,a.min_cpu=2e3;break;case 8192:a.min_memory=8192,a.min_cpu=4e3;break;case 16384:a.min_memory=16384,a.min_cpu=4e3;break;default:break}a.disk_cap=1*a.disk_cap,s(a)}})}),this.handleAfterChange=(e=>{this.setState({setUnit:e})}),this.handleMemoryChange=(e=>{this.setState({memoryValue:e.target.value})}),this.handleMinMemory=(e=>{if(2048!=e&&4096!=e&&8192!=e&&16384!=e)return"custom";var t=this.props.appDetail;return 2048==e&&2e3==t.service.min_cpu?2048:4096==e&&2e3==t.service.min_cpu?4096:8192==e&&4e3==t.service.min_cpu?8192:16384==e&&4e3==t.service.min_cpu&&16384}),this.state={memoryList:[{text:(0,I.formatMessage)({id:"Vm.createVm.2g"}),value:2048},{text:(0,I.formatMessage)({id:"Vm.createVm.4g"}),value:4096},{text:(0,I.formatMessage)({id:"Vm.createVm.8g"}),value:8192},{text:(0,I.formatMessage)({id:"Vm.createVm.16g"}),value:16384},{text:(0,I.formatMessage)({id:"Vm.createVm.Custom"}),value:"custom"}],is_flag:!1,setUnit:e.appDetail.service.min_memory%1024==0?"G":"M",setUnitDisk:e.appDetail.service.disk_cap%1024==0?"G":"M",memoryValue:e.appDetail&&e.appDetail.service&&e.appDetail.service.min_memory&&this.handleMinMemory(e.appDetail.service.min_memory)}}componentDidMount(){var e=this.props,t=e.onRefCpu;e.appDetail;t&&this.props.onRefCpu(this)}render(){var e=this.props,t=e.appDetail,a=e.form,i=a.getFieldDecorator,s=t.service,l=(s.extend_method,s.min_memory),o=s.min_cpu,m=s.disk_cap,u=this.state,d=u.setUnit,c=u.memoryValue,g=(u.setUnitDisk,{labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}}),y=this.state.memoryList;return R.default.createElement(r.default,{title:(0,I.formatMessage)({id:"componentCheck.advanced.setup.basic_info"}),style:{marginBottom:16}},R.default.createElement(h.default.Item,(0,p.default)({},g,{label:(0,I.formatMessage)({id:"Vm.createVm.specification"}),extra:"custom"==c&&(0,I.formatMessage)({id:"Vm.createVm.distribution"})}),i("min_memory",{initialValue:c||0,rules:[{required:!0}]})(R.default.createElement(J,{style:{position:"relative"},onChange:this.handleMemoryChange},y.map((e,t)=>{return R.default.createElement(q,{key:t,value:e.value},e.text)})))),"custom"==c&&R.default.createElement(h.default.Item,(0,p.default)({},g,{label:"CPU"}),i("min_cpu",{initialValue:o||0,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.plugin.min_cpu"})}]})(R.default.createElement(n.default,{style:{width:"200px"},type:"number",addonAfter:"m"}))),"custom"==c&&R.default.createElement(h.default.Item,(0,p.default)({},g,{label:(0,I.formatMessage)({id:"Vm.createVm.memory"})}),i("memory_value",{initialValue:1*"".concat(l%1024==0?l/1024:l)||0,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.setting.min_memory"})}]})(R.default.createElement(n.default,{style:{width:"160px",margin:"4px 0px 0px 4px"},addonAfter:R.default.createElement(f.default,{value:d||U.default.getUnit(l),onChange:this.handleAfterChange},R.default.createElement(X,{value:"M"},"M"),R.default.createElement(X,{value:"G"},"G"))}))),R.default.createElement(h.default.Item,(0,p.default)({},g,{label:(0,I.formatMessage)({id:"Vm.createVm.disk"})}),i("disk_cap",{initialValue:1*"".concat(m%1024==0?m/1024:m)||0,rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.setting.min_memory"})}]})(R.default.createElement(n.default,{style:{width:"200px"},type:"number",min:1,addonAfter:"GB"}))))}},E=b))||E)||E),H=(S=(0,P.connect)(null,null,null,{withRef:!0}),S((k=class extends R.PureComponent{constructor(e){super(e),this.onRef=(e=>{this.child=e}),this.onRefCpu=(e=>{this.childCpu=e}),this.childFn=(e=>{var t=this.props.appDetail,a=!0,i=this.state.runtimeInfo,s=G.default.getLanguage(t),r=this.childCpu.handleSubmitCpu();return!1!==r&&(s&&i&&a&&this.child.handleSubmit(),!0)}),this.getRuntimeInfo=(()=>{this.props.dispatch({type:"appControl/getRuntimeBuildInfo",payload:{team_name:N.default.getCurrTeamName(),app_alias:this.props.appDetail.service.service_alias},callback:e=>{e&&this.setState({runtimeInfo:e.bean?e.bean:{}})}})}),this.state={runtimeInfo:"",volumes:[],showAddVars:null,editor:null,toDeleteMnt:null,toDeleteVolume:null}}componentDidMount(){this.getRuntimeInfo(),this.props.onRef(this)}render(){var e=this.props,t=(e.visible,e.appDetail),a=e.handleBuildSwitch,i=e.handleEditInfo,s=e.handleEditRuntime,r=e.showEnterprisePlugin,l=!0,n=!0,o=this.state,m=o.runtimeInfo,u=(o.volumes,t&&t.service&&t.service.extend_method);if(!m)return null;var p=G.default.getLanguage(t);return R.default.createElement("div",null,!l&&!n&&R.default.createElement(O.default,null),l&&R.default.createElement(R.default.Fragment,null,"vm"==u?R.default.createElement(Y,{onRefCpu:this.onRefCpu,onSubmit:i,handleBuildSwitch:a,appDetail:t,showEnterprisePlugin:r}):R.default.createElement(W,{onRefCpu:this.onRefCpu,appDetail:t,onSubmit:i,handleBuildSwitch:a,showEnterprisePlugin:r})),p&&m&&n&&R.default.createElement(j.default,{appDetail:this.props.appDetail,onSubmit:s,isBtn:!1,language:p,runtimeInfo:this.state.runtimeInfo,onRef:this.onRef}))}},w=k))||w),z=(x=(0,P.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{withRef:!0}),x((B=class extends R.PureComponent{constructor(e){super(e),this.onRef=(e=>{this.child=e}),this.childFn=(e=>{var t=this.child.childFn();return t}),this.handleType=(e=>{this.state.type!==e&&this.setState({type:e})}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return A.default.querySpecifiedPermissionsInfo(t,e)}),this.state={type:"deploy",language:"zh-CN"===L.default.get("language")}}componentDidMount(){this.props.onRef(this)}getAppAlias(){return this.props.match.params.appAlias}render(){var e=this.props,t=e.appDetail,a=e.handleBuildSwitch,i=e.handleEditInfo,s=e.handleEditRuntime,r=e.showEnterprisePlugin,l=this.state;l.type,l.componentPermissions,l.language;return R.default.createElement("div",null,R.default.createElement("div",{style:{overflow:"hidden"}},R.default.createElement("div",{className:T.default.content,style:{overflow:"hidden",marginBottom:40}},R.default.createElement(H,{updateDetail:this.props.updateDetail,handleEditInfo:i,appDetail:t,handleBuildSwitch:a,handleEditRuntime:s,showEnterprisePlugin:r,onRef:this.onRef}))))}},D=B))||D);t.default=z}}]);