(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{CgHS:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(a("jehZ"));a("+L6B");var n=r(a("2/Rp"));a("Pwec");var o=r(a("CtXQ"));a("/xke");var d,u,l,c=r(a("TeRw")),p=r(a("p0pE")),h=r(a("Y/ft")),m=a("MuoO"),f=a("7DNP"),g=s(a("q1tI")),v=a("LLXN"),b=r(a("I3bc")),_=r(a("XZXw")),y=a("vSx2"),C=r(a("QDog")),I=r(a("tH/r")),E=r(a("mWxT")),k=r(a("9Qkj")),A=r(a("9Y44")),T=r(a("KLZ5")),S=r(a("Tj2Q")),N=r(a("t9D+")),M=r(a("2lxJ")),P=(d=(0,m.connect)(e=>{var t=e.teamControl,a=e.global,r=e.enterprise,s=e.user;return{rainbondInfo:a.rainbondInfo,currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:r.currentEnterprise,enterprises:a.enterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo,currUser:s.currentUser}},null,null,{pure:!1}),d((l=class extends g.PureComponent{constructor(e){var t;super(e),t=this,this.handleArchCpuInfo=(()=>{var e=this.props.dispatch;e({type:"index/fetchArchOverview",payload:{region_name:C.default.getCurrRegionName(),team_name:C.default.getCurrTeamName()},callback:e=>{e&&e.bean&&this.setState({archInfo:e.list})}})}),this.handleTabChange=(e=>{if("add"===e)this.setState({visible:!0});else{var t=this.props.dispatch,a=C.default.getAppID();t(f.routerRedux.push("/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/create/code/").concat(e,"?group_id=").concat(a)))}}),this.fetchEnterpriseInfo=(e=>{if(!e)return null;var t=this.props.dispatch;t({type:"global/fetchEnterpriseInfo",payload:{enterprise_id:e},callback:e=>{e&&e.bean&&this.setState({serversList:e.bean})}})}),this.handelClone=(()=>{this.setState({visible:!1})}),this.fetchOauthInfo=(()=>{var e=this.props,t=e.dispatch,a=e.currUser;this.setState({loading:!0}),t({type:"global/getOauthInfo",payload:{enterprise_id:a.enterprise_id,system:!1},callback:e=>{200===(null===e||void 0===e?void 0:e.status_code)&&this.setState({oauthTable:e.list||[],loading:!1})}})}),this.handleCreatOauth=(e=>{var t=e.oauth_type,a=e.redirect_domain,r=(0,h.default)(e,["oauth_type","redirect_domain"]),s={github:"https://github.com",aliyun:"https://oauth.aliyun.com",dingtalk:"https://oapi.dingtalk.com"},i=(0,p.default)({},r,{oauth_type:t.toLowerCase(),home_url:s[t.toLowerCase()]||"",redirect_uri:"".concat(a,"/console/oauth/redirect"),is_auto_login:!1,is_console:!0});this.handleOauthRequest(i)}),this.handleOauthRequest=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.props,s=r.dispatch,i=r.currUser,n=t.state,o=n.oauthInfo,d=n.oauthTable,u=(0,p.default)({},e,{eid:i.enterprise_id,service_id:(null===o||void 0===o?void 0:o.service_id)||null,enable:!a,system:!1}),l=[...d];if(o){var h=l.findIndex(e=>e.service_id===u.service_id);h>-1&&(l[h]=(0,p.default)({},l[h],u,{is_console:!0}))}else l.push(u);s({type:"global/creatOauth",payload:{enterprise_id:i.enterprise_id,arr:l},callback:e=>{e&&200===e.status_code&&(c.default.success({message:a?(0,v.formatMessage)({id:"notification.success.close"}):o?(0,v.formatMessage)({id:"notification.success.edit"}):(0,v.formatMessage)({id:"notification.success.add"})}),t.setState({visible:!1}))}})},this.state={serversList:null,archInfo:[],teamAppCreatePermission:k.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"team_app_create"),oauthTable:[],visible:!1,loading:!1}}componentWillMount(){}componentDidMount(){var e=this.props.currentEnterprise&&this.props.currentEnterprise.enterprise_id;this.fetchEnterpriseInfo(e),this.handleArchCpuInfo()}render(){var e,t,a=this.props,r=a.rainbondInfo,s=(a.enterprises,a.match),d=a.currentEnterprise,u=a.currentTeam,l=a.currentRegionName,c=this.state,p=c.serversList,h=c.archInfo,m=c.teamAppCreatePermission.isAccess;if(!m)return k.default.noPermission();var P={custom:A.default,demo:T.default,jwar:S.default},w=[{key:"custom",tab:(0,v.formatMessage)({id:"teamAdd.create.code.customSource"})},{key:"jwar",tab:(0,v.formatMessage)({id:"teamAdd.create.code.package"})}];E.default.officialDemoEnable(r)&&w.push({key:"demo",tab:(0,v.formatMessage)({id:"teamAdd.create.code.demo"})});var x=I.default.getEnableGitOauthServer(p);x&&x.length>0&&x.map(e=>{var t=e.name,a=e.service_id,r=e.oauth_type,s={github:"Github",gitlab:"Gitlab",gitee:"Gitee"},i=s[r]||"",n=i?"".concat(i," ").concat(t&&"(".concat(t,")")):"".concat(t,"\u9879\u76ee");return P[a]=b.default,w.push({key:a,types:r,tab:n}),w}),w.push({key:"add",tab:g.default.createElement(o.default,{type:"plus",style:{display:"flex",padding:"12px 0px 5px",marginRight:"0 !important"}})});var R=s.params.type;R=R.split("?")[0],R||(R="custom");var O=P[R],G=[];G=(0,y.createTeam)((0,y.createEnterprise)(G,d),u,l),G.push({title:"\u521b\u5efa\u7ec4\u4ef6"});var L=C.default.getAppID()||"",j=(null===(e=this.props.location)||void 0===e?void 0:null===(t=e.query)||void 0===t?void 0:t.type)||"";return g.default.createElement(_.default,{breadcrumbList:G,title:(0,v.formatMessage)({id:"teamAdd.create.code.title"}),onTabChange:this.handleTabChange,content:g.default.createElement("p",null,g.default.createElement(v.FormattedMessage,{id:"teamAdd.create.code.desc"})),tabActiveKey:R,tabList:w,titleSvg:M.default.getPageHeaderSvg("code",18),isContent:!0,extraContent:g.default.createElement(n.default,{onClick:()=>{var e=this.props.dispatch;e(f.routerRedux.push("/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/create/wizard?group_id=").concat(L,"&type=").concat(j)))},type:"default"},g.default.createElement(o.default,{type:"rollback"}),(0,v.formatMessage)({id:"button.return"}))},O?g.default.createElement(O,(0,i.default)({archInfo:h},this.props,{type:this.props.match.params.type,tabList:w})):g.default.createElement(g.default.Fragment,null,(0,v.formatMessage)({id:"teamAdd.create.error"})),this.state.visible&&g.default.createElement(N.default,{title:(0,v.formatMessage)({id:"versionUpdata_6_1.addPrivateGit"}),type:"private",oauthInfo:!1,onOk:this.handleCreatOauth,onCancel:this.handelClone}))}},u=l))||u);t.default=P},Tj2Q:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i,n,o,d=r(a("bx4M")),u=r(a("jehZ")),l=r(a("p0pE")),c=a("MuoO"),p=a("7DNP"),h=s(a("q1tI")),m=(a("LLXN"),r(a("2OfQ"))),f=r(a("/BFj")),g=r(a("QDog")),v=r(a("9Qkj")),b=r(a("51sS")),_=(i=(0,c.connect)(e=>{var t=e.user,a=e.global;return{currUser:t.currentUser,groups:a.groups}}),i((o=class extends h.PureComponent{constructor(e){super(e),this.onAddGroup=(()=>{this.setState({addGroup:!0})}),this.cancelAddGroup=(()=>{this.setState({addGroup:!1})}),this.handleAddGroup=(e=>{var t=this.props.form.setFieldsValue;this.props.dispatch({type:"application/addGroup",payload:(0,l.default)({team_name:g.default.getCurrTeamName()},e),callback:e=>{e&&this.props.dispatch({type:"global/fetchGroups",payload:{team_name:g.default.getCurrTeamName(),region_name:g.default.getCurrRegionName()},callback:()=>{t({group_id:e.group_id}),this.cancelAddGroup()}})}})}),this.hideShowKey=(()=>{this.setState({showKey:!1})}),this.handleSubmit=((e,t)=>{var a=g.default.getCurrTeamName(),r=g.default.getCurrRegionName(),s=this.props.dispatch;s({type:"createApp/createJarWarFormSubmit",payload:(0,l.default)({region_name:r,team_name:a,event_id:t},e),callback:e=>{var i=e&&e.bean.service_alias;s(p.routerRedux.push("/team/".concat(a,"/region/").concat(r,"/create/create-check/").concat(i,"?event_id=").concat(t)))}})}),this.installApp=((e,t)=>{var a=this.props.dispatch,r=g.default.getCurrTeamName(),s=g.default.getCurrRegionName();a({type:"application/addGroup",payload:{region_name:s,team_name:r,group_name:e.group_name,k8s_app:e.k8s_app,note:""},callback:a=>{a&&a.group_id&&(v.default.refreshPermissionsInfo(),e.group_id=a.group_id,this.handleSubmit(e,t))},handleError:()=>{}})}),this.handleInstallApp=((e,t)=>{e.group_id?this.handleSubmit(e,t):this.installApp(e,t)}),this.state={}}render(){return h.default.createElement(d.default,null,h.default.createElement(f.default,null),h.default.createElement("div",{className:b.default.formWrap},h.default.createElement(m.default,(0,u.default)({onSubmit:this.handleInstallApp},this.props))))}},n=o))||n);t.default=_}}]);