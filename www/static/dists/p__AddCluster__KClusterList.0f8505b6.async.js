(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{"52ST":function(e,t,s){"use strict";var a=s("g09b"),r=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("2qtc");var l=a(s("kLXV"));s("Pwec");var n=a(s("CtXQ"));s("IzEo");var i=a(s("bx4M"));s("g9YV");var o=a(s("wCAj"));s("fOrg");var d=a(s("+KLJ"));s("+L6B");var u=a(s("2/Rp"));s("14J3");var c=a(s("BMrR"));s("5Dmo");var p=a(s("3S7+"));s("+BJd");var f=a(s("mr32"));s("miYZ");var m=a(s("tsqr"));s("/xke");var h=a(s("TeRw"));s("y8nQ");var g=a(s("Vl3Y"));s("sRBo");var v=a(s("kaz8"));s("FJo9");var y,C,I,w,_=a(s("L41K")),E=s("MuoO"),b=s("7DNP"),k=r(s("q1tI")),x=s("LLXN"),M=a(s("7jW7")),N=a(s("XZXw")),S=(s("P5Jw"),a(s("2lxJ"))),L=a(s("+QRC")),H=(a(s("q76B")),a(s("QDog"))),R=a(s("+iC2")),D=a(s("VKzJ")),T=_.default.Step,P=(v.default.Group,["ETCD","Master"]),J=(y=g.default.create(),C=(0,E.connect)(e=>{var t=e.user,s=e.list,a=e.loading,r=e.global,l=e.index;return{user:t.currentUser,list:s,loading:a.models.list,rainbondInfo:r.rainbondInfo,enterprise:r.enterprise,isRegist:r.isRegist,oauthLongin:a.effects["global/creatOauth"],overviewInfo:l.overviewInfo}}),y(I=C((w=class extends k.PureComponent{constructor(e){var t;super(e),t=this,this.toClusterList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rke",s=t.props.dispatch,a=t.props.match.params.eid,r={initializing:"/enterprise/{eid}/provider/{provider}/kclusters/append?event_id={eventId}",initialized:"/enterprise/{eid}/provider/{provider}/kclusters?event_id={eventId}",installing:"/enterprise/{eid}/provider/{provider}/kclusters?type=installing&event_id={eventId}",installed:"/enterprise/{eid}/provider/{provider}/kclusters?event_id={eventId}",integrating:"/enterprise/{eid}/provider/{provider}/kclusters/init?event_id={eventId}",integrated:"/enterprise/{eid}/provider/{provider}/kclusters/check?event_id={eventId}"};s({type:"region/fetchClusterInfo",payload:{cluster_id:""},callback:t=>{if(t&&200===t.status_code){window.localStorage.setItem("event_id",t.bean.event_id);var l=t.bean.create_status,n=r[l]||r.initializing;n=n.replace("{eid}",a).replace("{provider}",e),n.includes("{eventId}")&&(n=n.replace("{eventId}",t.bean.event_id)),s(b.routerRedux.push(n))}}})},this.closeTimer=(()=>{this.timer&&clearInterval(this.timer)}),this.handleTimers=((e,t,s)=>{this[e]=setTimeout(()=>{t()},s)}),this.fetchClusterInfoList=(()=>{var e=this.props.dispatch,t=this.state.eventId;e({type:"region/fetchClusterInfoList",payload:{event_id:t},callback:e=>{e&&200==e.status_code&&this.setState({clusterInfoList:e.list||[],nextBtnstatus:this.countRoles(e.list||[])},()=>{this.handleTimers("timer",()=>{this.fetchClusterInfoList()},3e3)})},handleError:e=>{this.closeTimer(),this.fetchClusterInfoList()}})}),this.showModal=(()=>{this.setState({visible:!0})}),this.handleOk=(()=>{this.setState({confirmLoading:!0}),setTimeout(()=>{this.setState({visible:!1,confirmLoading:!1})},2e3)}),this.handleCancel=(()=>{this.setState({visible:!1})}),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid,s=t||H.default.getCurrEnterpriseId();e(b.routerRedux.push("/enterprise/".concat(s,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid,s=t||H.default.getCurrEnterpriseId();e(b.routerRedux.push("/enterprise/".concat(s,"/addCluster")))}),this.loadSteps=(()=>{var e=[{title:(0,x.formatMessage)({id:"enterpriseColony.addCluster.supplier"})},{title:(0,x.formatMessage)({id:"enterpriseColony.addCluster.cluster"})},{title:(0,x.formatMessage)({id:"enterpriseColony.addCluster.Initialize"})},{title:(0,x.formatMessage)({id:"enterpriseColony.addCluster.clusterInit"})},{title:(0,x.formatMessage)({id:"enterpriseColony.addCluster.docking"})}];return e}),this.lastOrNextSteps=(e=>{var t=this.props.dispatch,s=this.props.match.params,a=s.eid,r=s.provider,l=a||H.default.getCurrEnterpriseId();t("last"==e?b.routerRedux.push("/enterprise/".concat(l,"/addCluster")):b.routerRedux.push("/enterprise/".concat(l,"/provider/").concat(r,"/kclusters/init")))}),this.countRoles=(e=>{if(e&&e.length>0){var t=e.every(e=>"Ready"===e.status);if(!t)return{disabled:!0,msg:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.nodeNotReady"})};for(var s=e.flatMap(e=>e.roles.split(", ").filter(e=>""!==e.trim())).map(e=>e.trim()),a=s.reduce((e,t)=>{return t in e?e[t]++:e[t]=1,e},{}),r=["etcd","master","worker"],l=0,n=r;l<n.length;l++){var i=n[l];if(!(i in a))return{disabled:!0,msg:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.etcd"})}}return a["etcd"]%2===1?{disabled:!1,msg:""}:{disabled:!0,msg:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.etcdNum"})}}return{disabled:!0,msg:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.nodeinfo"})}}),this.handleDeleteNode=(()=>{var e=this.props.dispatch,t=this.state.deleteNode;e({type:"region/deleteClusterNode",payload:{node_name:t.name},callback:e=>{e&&200===e.status_code&&(h.default.success({message:(0,x.formatMessage)({id:"notification.success.delete"})}),this.setState({deleteNode:null}),this.fetchClusterInfoList())}})}),this.showDeleteNode=(e=>{this.setState({deleteNode:e})}),this.cancalDeleteNode=(()=>{this.setState({deleteNode:null})}),this.handleCopy=(e=>{(0,L.default)(e),m.default.success((0,x.formatMessage)({id:"notification.success.copy"}))});var s=this.props.user,a=R.default.isCompanyAdmin(s);this.state={adminer:a,visible:!1,confirmLoading:!1,checkedList:P,registrationCmd:"",copyText:"",clusterInfoList:[],nextBtnstatus:{},deleteNode:null}}componentDidMount(){}componentWillMount(){var e=this.state.adminer,t=this.props,s=t.dispatch,a=t.location.query.event_id;e?this.setState({eventId:void 0==a?window.localStorage.getItem("event_id"):a}):s(b.routerRedux.push("/"))}componentDidMount(){this.state.checkedList;this.fetchClusterInfoList()}componentWillUnmount(){this.closeTimer()}render(){var e=this.props.match.params,t=(e.eid,e.provider,this.state),s=t.visible,a=(t.confirmLoading,t.copyText,t.clusterInfoList),r=t.nextBtnstatus,m=t.eventId,h=t.deleteNode,g=k.default.createElement("svg",{width:"30",height:"30",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},k.default.createElement("g",{fill:"#fff","fill-rule":"evenodd"},k.default.createElement("rect",{opacity:"0.4",x:"7.5",y:"4.5",width:"8",height:"8",rx:"1"}),k.default.createElement("rect",{x:"4.5",y:"7.5",width:"8",height:"8",rx:"1"}))),v=[{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.status"}),dataIndex:"status",key:"status",render:(e,t)=>{return k.default.createElement("p",{className:D.default.status},k.default.createElement(f.default,{color:H.default.getPublicColor("Ready"===e?"rbd-success-status":"rbd-warning-status")},e),"Ready"!==e&&k.default.createElement(p.default,{title:"".concat(null===t||void 0===t?void 0:t.installation_status)},k.default.createElement("p",{className:D.default.log},null===t||void 0===t?void 0:t.installation_status)))}},{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.bame"}),dataIndex:"name",key:"name"},{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.ip"}),dataIndex:"external_ip",key:"external_ip",render:(e,t)=>{return k.default.createElement("span",null,t.external_ip||"-","/",t.internal_ip||"-")}},{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.system"}),dataIndex:"os_image",key:"os_image"},{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.role"}),dataIndex:"roles",key:"roles",render:(e,t)=>{if(!e||"string"!==typeof e)return k.default.createElement("span",null,"-");var s=e.split(",").map(e=>e.trim());return k.default.createElement("span",null,s&&s.length>0?k.default.createElement(k.default.Fragment,null,s.map((e,t)=>{switch(e){case"control-plane":return k.default.createElement(f.default,{color:H.default.getPublicColor(),key:t},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.select.Control-plane"}));case"etcd":return k.default.createElement(f.default,{color:H.default.getPublicColor(),key:t},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.select.ETCD"}));case"worker":return k.default.createElement(f.default,{color:H.default.getPublicColor(),key:t},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.select.Worker"}));default:return null}})):"-")}},{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.live"}),dataIndex:"uptime",key:"uptime"},{title:(0,x.formatMessage)({id:"enterpriseColony.table.handle.quota.table.label.method"}),dataIndex:"operate",key:"operate",render:(e,t)=>{return[k.default.createElement("a",{onClick:()=>{this.showDeleteNode(t)}},k.default.createElement(x.FormattedMessage,{id:"button.delete"}))]}}];return k.default.createElement(N.default,{title:k.default.createElement(x.FormattedMessage,{id:"enterpriseColony.button.text"}),content:k.default.createElement(x.FormattedMessage,{id:"enterpriseColony.PageHeaderLayout.content"}),titleSvg:S.default.getPageHeaderSvg("clusters",18)},k.default.createElement(c.default,{style:{marginBottom:"16px"}},k.default.createElement(_.default,{current:1},this.loadSteps().map(e=>k.default.createElement(T,{key:e.title,title:e.title})))),k.default.createElement(i.default,{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.hostList"}),extra:k.default.createElement(u.default,{type:"primary",onClick:this.showModal},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.addnode"}))},k.default.createElement(d.default,{message:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.lookOut"}),description:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.msg"}),type:"warning",showIcon:!0,style:{marginBottom:24}}),k.default.createElement(o.default,{dataSource:a,columns:v})),s&&k.default.createElement(M.default,{onCancel:this.handleCancel,eventId:m}),k.default.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:24}},k.default.createElement(u.default,{onClick:()=>this.lastOrNextSteps("last"),style:{marginRight:24}},"\u53d6\u6d88"),k.default.createElement(p.default,{title:r.msg},k.default.createElement(u.default,{onClick:()=>this.lastOrNextSteps("next"),type:"primary",disabled:r.disabled},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.next"})))),h&&k.default.createElement(l.default,{title:(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.deleteNode"}),visible:h,onOk:this.handleDeleteNode,onCancel:this.cancalDeleteNode},k.default.createElement("div",{className:D.default.inner},k.default.createElement("span",{className:D.default.icon},k.default.createElement(n.default,{type:"exclamation-circle-o"})),k.default.createElement("div",{className:D.default.desc},(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.deleteNodeDesc"}))),k.default.createElement("span",null,(0,x.formatMessage)({id:"enterpriseColony.newHostInstall.node.deleteNodeSubDesc"})),k.default.createElement("div",{className:D.default.cmd},k.default.createElement("p",null,"/usr/local/bin/rke2-uninstall.sh"),k.default.createElement("div",{className:D.default.copy,onClick:()=>this.handleCopy("/usr/local/bin/rke2-uninstall.sh")},g))))}},I=w))||I)||I);t.default=J},VKzJ:function(e,t,s){e.exports={status:"status___28JYd",log:"log___3iaN9",PopoverStyle:"PopoverStyle___1ayI_",inner:"inner___KjGKI",icon:"icon___3_JbK",desc:"desc___2Kqrc",cmd:"cmd___-p3XH",copy:"copy___2Sdb4"}}}]);