(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"+aXB":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("6UJt");var r=l(a("DFOY"));a("y8nQ");var i=l(a("Vl3Y"));a("5NDa");var o=l(a("5rEg"));a("+L6B");var d=l(a("2/Rp"));a("OaEy");var u,c,p,h=l(a("2fM7")),m=a("MuoO"),f=s(a("q1tI")),g=l(a("PWDA")),v=l(a("cUW5")),_=a("xpXo"),y=l(a("lpA0")),E=l(a("QDog")),b=l(a("OSFV")),C=l(a("a8l+")),S=l(a("zMIy")),k=h.default.Option,w=(u=(0,m.connect)(e=>{var t=e.user;return{currUser:t.currentUser}},null,null,{withRef:!0}),u((p=class extends f.PureComponent{constructor(e){super(e),this.formRef=f.default.createRef(),this.fetchInstanceInfo=(()=>{var e=this.props,t=e.dispatch,a=e.appAlias;t({type:"appControl/fetchPods",payload:{team_name:E.default.getCurrTeamName(),app_alias:a},callback:e=>{var t=[];if(e&&e.list){var a=e.list.new_pods&&e.list.new_pods.length&&e.list.new_pods||[],l=e.list.old_pods&&e.list.old_pods.length&&e.list.old_pods||[];t=[...a,...l]}t&&t.length>0&&t.map(e=>{e.name="\u5b9e\u4f8b\uff1a".concat(e.pod_name),e.container.map(e=>{e.name="\u5bb9\u5668\uff1a".concat(e.container_name)})}),t.push({name:"\u5168\u90e8\u65e5\u5fd7"}),this.setState({instances:t})}})}),this.onFinish=(e=>{this.setState({filter:e},()=>{var t=this.state,a=t.logs,l=t.pod_name;""===e?l?this.fetchContainerLog():this.fetchServiceLog():this.setLogs(a)})}),this.setLogs=(e=>{var t=this.state,a=t.filter,l=t.pod_name,s=e;s=e.filter(e=>{return""==a||-1!=e.indexOf(a)}),s=s.map(e=>{if(-1!=e.indexOf(a)){var t=e.replace(a,"\x1b[33m".concat(a,"\x1b[0m"));return t}return e}),s.length>5e3&&(s=s.slice(e.length-5e3,e.length));var n=l?{containerLog:s}:{logs:s};this.setState(n)}),this.fetchServiceLog=(()=>{(0,_.getServiceLog)({team_name:E.default.getCurrTeamName(),app_alias:this.props.appAlias}).then(e=>{e&&(this.refs.box&&(this.refs.box.scrollTop=this.refs.box.scrollHeight),this.setState({logs:e.list||[]}),this.watchLog())})}),this.hanleTimer=(()=>{var e=this.state.refreshValue;if(this.closeTimer(),!e)return null;this.timer=setTimeout(()=>{this.fetchContainerLog()},1e3*e)}),this.closeTimer=(()=>{this.timer&&clearInterval(this.timer)}),this.fetchContainerLog=(()=>{var e=this.state,t=e.pod_name,a=e.container_name;(0,_.getContainerLog)({team_name:E.default.getCurrTeamName(),app_alias:this.props.appAlias,pod_name:t,container_name:a}).then(e=>{if(e&&e.status_code&&200===e.status_code&&e.response_data){var t=e.response_data.split("\n");this.setState({containerLog:t||[]},()=>{this.hanleTimer()})}})}),this.handleStop=(()=>{this.setState({started:!1}),this.props.socket&&this.props.socket.closeLogMessage()}),this.handleStart=(()=>{this.setState({started:!0}),this.watchLog()}),this.showDownHistoryLog=(()=>{this.setState({showHistoryLog:!0})}),this.hideDownHistoryLog=(()=>{this.setState({showHistoryLog:!1})}),this.showDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!0})}),this.hideDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!1})}),this.onChangeCascader=(e=>{e&&e.length>1?this.setState({pod_name:e[0].slice(3),container_name:e[1].slice(3)},()=>{this.fetchContainerLog()}):this.setState({pod_name:"",container_name:"",containerLog:[]},()=>{this.closeTimer(),this.fetchServiceLog()})}),this.handleChange=(e=>{this.setState({refreshValue:e}),e||this.closeTimer()}),this.state={containerLog:[],logs:[],instances:[],started:!0,showHistoryLog:!1,showHistory1000Log:!1,showHighlighted:"",filter:"",pod_name:"",container_name:"",refreshValue:5}}componentDidMount(){this.canView()&&(this.loadLog(),this.fetchInstanceInfo())}componentDidUpdate(e,t){this.refs.box&&t.logs.length!==this.state.logs.length&&""===this.state.showHighlighted&&(this.refs.box.scrollTop=this.refs.box.scrollHeight)}componentWillUnmount(){this.props.socket&&this.props.socket.closeLogMessage()}watchLog(){this.props.socket&&this.props.socket.setOnLogMessage(e=>{if(e&&e.length>0){var t=this.state.logs||[],a=t.concat(e);this.setLogs(a)}},e=>{if(this.state.started){var t=this.state.logs||[];t=t.concat(e),this.refs.box&&(this.refs.box.scrollTop=this.refs.box.scrollHeight),this.setLogs(t)}})}loadLog(){var e=this.state.logs;0==e.length?this.fetchServiceLog():this.watchLog()}canView(){return y.default.canManageAppLog(this.props.appDetail)}render(){if(!this.canView())return f.default.createElement(v.default,null);var e=this.props.appAlias,t=this.state,a=t.logs,l=t.pod_name,s=t.containerLog,u=t.showHighlighted,c=t.instances,p=t.started,m=t.refreshValue,_=t.showHistoryLog,y=t.showHistory1000Log;return f.default.createElement(n.default,{title:f.default.createElement(f.Fragment,null,p?f.default.createElement(d.default,{onClick:this.handleStop},"\u6682\u505c\u63a8\u9001"):f.default.createElement(d.default,{onClick:this.handleStart},"\u5f00\u59cb\u63a8\u9001")),extra:f.default.createElement(f.Fragment,null,f.default.createElement("a",{onClick:this.showDownHistoryLog,style:{marginRight:10}},"\u5386\u53f2\u65e5\u5fd7\u4e0b\u8f7d"),f.default.createElement("a",{onClick:this.showDownHistory1000Log},"\u6700\u8fd11000\u6761\u65e5\u5fd7"))},f.default.createElement(i.default,{layout:"inline",name:"logFilter",style:{marginBottom:"16px"}},f.default.createElement(i.default.Item,{name:"filter",label:"\u8fc7\u6ee4\u6587\u672c",style:{marginRight:"10px"}},f.default.createElement(o.default.Search,{style:{width:"300px"},placeholder:"\u8bf7\u8f93\u5165\u8fc7\u6ee4\u6587\u672c",onSearch:this.onFinish})),f.default.createElement(i.default.Item,{name:"container",label:"\u5bb9\u5668",style:{marginRight:"10px"},className:S.default.podCascader},f.default.createElement(r.default,{defaultValue:["\u5168\u90e8\u65e5\u5fd7"],fieldNames:{label:"name",value:"name",children:"container"},options:c,onChange:this.onChangeCascader,placeholder:"\u8bf7\u9009\u62e9\u5bb9\u5668"})),l&&f.default.createElement(i.default.Item,{name:"refresh",label:"\u81ea\u52a8\u5237\u65b0",style:{marginRight:"0"}},f.default.createElement(h.default,{value:m,onChange:this.handleChange,style:{width:130}},f.default.createElement(k,{value:5},"5\u79d2"),f.default.createElement(k,{value:10},"10\u79d2"),f.default.createElement(k,{value:30},"30\u79d2"),f.default.createElement(k,{value:0},"\u5173\u95ed")))),f.default.createElement("div",{className:S.default.logsss,ref:"box"},s&&s.length>0&&s.map((e,t)=>{return f.default.createElement("div",{key:t},f.default.createElement("span",{style:{color:"#666666"}},f.default.createElement("span",null,t+1)),f.default.createElement("span",{ref:"texts",style:{width:"100%",color:"#FFF"}},f.default.createElement(g.default,null,e)))})||a&&a.length>0&&a.map((e,t)=>{return f.default.createElement("div",{key:t},f.default.createElement("span",{style:{color:u==e.substring(0,e.indexOf(":"))?"#FFFF91":"#666666"}},f.default.createElement("span",null,""==e?"":"".concat(t+1))),f.default.createElement("span",{ref:"texts",style:{color:u==e.substring(0,e.indexOf(":"))?"#FFFF91":"#FFF"}},f.default.createElement(g.default,null,e.substring(e.indexOf(":")+1,e.length))),1==a.length?f.default.createElement("span",{style:{color:u==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:u==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},f.default.createElement(g.default,null,e.substring(0,e.indexOf(":")))):a.length>1&&t>=1&&e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":f.default.createElement("span",{style:{color:u==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==t&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:u==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},f.default.createElement(g.default,null,e.substring(0,e.indexOf(":")))))})),_&&f.default.createElement(b.default,{onCancel:this.hideDownHistoryLog,appAlias:e}),y&&f.default.createElement(C.default,{onCancel:this.hideDownHistory1000Log,appAlias:e}))}},c=p))||c);t.default=w},"+y/a":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("14J3");var r=l(a("BMrR"));a("jCWc");var i=l(a("kPKH"));a("Pwec");var o=l(a("CtXQ"));a("5Dmo");var d=l(a("3S7+"));a("y8nQ");var u,c,p,h,m=l(a("Vl3Y")),f=a("MuoO"),g=l(a("wd/R")),v=s(a("q1tI")),_=l(a("QDog")),y=l(a("Sw8b")),E=l(a("ctOv")),b=(u=(0,f.connect)(),c=m.default.create(),u(p=c((h=class extends v.PureComponent{constructor(e){super(e),this.handleMore=(()=>{var e=this.props.handleMore;e&&e(!0)}),this.showLogModal=((e,t)=>{var a=this.props,l=a.isopenLog,s=a.onLogPush;l&&s&&s(!1),this.setState({logVisible:!0,selectEventID:e,showSocket:t})}),this.handleCancel=(()=>{this.setState({logVisible:!1})}),this.showUserName=(e=>{return"system"===e?"@\u7cfb\u7edf":e?"@".concat(e):""}),this.state={logVisible:!1,selectEventID:"",showSocket:!1}}componentDidMount(){}render(){var e=this.props,t=e.logList,a=e.has_next,l=e.recordLoading,s=e.isopenLog,u=this.state,c=u.logVisible,p=u.selectEventID,h=u.showSocket,m=_.default.fetchSvg("logs","#cccccc"),f="",b={success:"logpassed",timeout:"logcanceled",failure:"logfailed"};return v.default.createElement(n.default,{bordered:!1,title:"\u64cd\u4f5c\u8bb0\u5f55",loading:l},v.default.createElement(r.default,{gutter:24},v.default.createElement(i.default,{xs:24,xm:24,md:24,lg:24,xl:24},t&&t.map(e=>{var t=e.Status,a=e.FinalStatus,l=e.UserName,n=e.OptType,r=e.Reason,i=e.Message,o=e.EndTime,u=e.SynType,c=e.EventID,p=e.create_time;s&&""===a&&n&&n.indexOf("build")>-1&&""===f&&(f=c);var h=this.showUserName(l),y="success"!==t&&"rgba(0,0,0,0.65)"===_.default.fetchAbnormalcolor(n)&&i;return v.default.createElement("div",{key:c,className:"".concat(E.default.loginfo," ").concat(E.default[b[t]||"logfored"])},v.default.createElement(d.default,{title:(0,g.default)(p).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss")},v.default.createElement("div",{style:{wordBreak:"break-word",lineHeight:"17px"}},_.default.fetchdayTime(p))),v.default.createElement("div",null,v.default.createElement(d.default,{title:y},v.default.createElement("span",{style:{color:_.default.fetchAbnormalcolor(n)}},_.default.fetchStateOptTypeText(n),"\xa0"),_.default.fetchOperation(a,t),"\xa0","failure"===t&&_.default.fetchReason(r),y)),v.default.createElement("div",{className:E.default.nowarpText},v.default.createElement("span",null,v.default.createElement(d.default,{title:h},h))),v.default.createElement("div",null,v.default.createElement("span",{className:E.default.alcen},o&&p&&_.default.fetchSvg("runTime"),v.default.createElement("span",null,o&&p?_.default.fetchTime(new Date(o).getTime()?new Date(o).getTime()-new Date(p).getTime():""):""))),v.default.createElement("div",{style:{position:"static"},className:"table-wrap"},0===u&&v.default.createElement(d.default,{visible:""===a,placement:"top",arrowPointAtCenter:!0,autoAdjustOverflow:!1,title:"\u67e5\u770b\u65e5\u5fd7",getPopupContainer:()=>document.querySelector(".table-wrap")},v.default.createElement("div",{style:{width:"16px"},onClick:()=>{this.showLogModal(c,""===a)}},m))))}),f&&this.showLogModal(f,!0),!t||t&&0===t.length&&v.default.createElement("div",{style:{background:"#fff",paddingBottom:"10px",textAlign:"center"}},"\u6682\u65e0\u64cd\u4f5c\u8bb0\u5f55"),a&&v.default.createElement("p",{style:{textAlign:"center",fontSize:30}},v.default.createElement(o.default,{style:{cursor:"pointer"},onClick:this.props.handleNextPage,type:"down"})))),c&&v.default.createElement(y.default,{title:"\u65e5\u5fd7",width:"1000px",onOk:this.handleCancel,onCancel:this.handleCancel,showSocket:h,EventID:p,socket:this.props.socket}))}},p=h))||p)||p),C=b;t.default=C},"0//z":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("5NDa");var i=l(a("5rEg"));a("/xke");var o=l(a("TeRw")),d=l(a("p0pE"));a("OaEy");var u=l(a("2fM7"));a("y8nQ");var c,p,h,m,f=l(a("Vl3Y")),g=a("MuoO"),v=s(a("q1tI")),_=l(a("6UP8")),y=a("xpXo"),E=l(a("lpA0")),b=l(a("QDog")),C=f.default.Item,S=u.default.Option,k=(c=f.default.create(),p=(0,g.connect)(),c(h=p((m=class extends v.PureComponent{constructor(e){super(e),this.changeServerType=(e=>{var t=this.props.form,a=t.getFieldValue,l=a("user_name");this.setState({serverType:e,showUsernameAndPass:""!==l})}),this.checkURL=((e,t,a)=>{var l=this.getUrlCheck();l.test(t)?a():a("\u975e\u6cd5\u4ed3\u5e93\u5730\u5740")}),this.handleSubmit=(()=>{var e=this.props.form;e.validateFields((e,t)=>{e||("tag"==t.version_type&&(t.code_version="tag:".concat(t.code_version)),this.props.dispatch({type:"appControl/putAppBuidSource",payload:(0,d.default)({team_name:b.default.getCurrTeamName(),service_alias:this.props.appAlias},t),callback:()=>{o.default.success({message:"\u4fee\u6539\u6210\u529f\uff0c\u4e0b\u6b21\u6784\u5efa\u90e8\u7f72\u65f6\u751f\u6548"}),this.props.onOk&&this.props.onOk()}}))})}),this.hideShowKey=(()=>{this.setState({showKey:!1})}),this.state={branch:this.props.branch||[],buildSource:this.props.buildSource||null,showUsernameAndPass:""!==this.props.buildSource.user,showKey:!1,gitUrl:this.props.buildSource.git_url,serverType:this.props.buildSource.server_type?this.props.buildSource.server_type:"git",showCode:E.default.isCodeAppByBuildSource(this.props.buildSource),showImage:E.default.isImageAppByBuildSource(this.props.buildSource)}}componentDidMount(){E.default.isCodeAppByBuildSource(this.state.buildSource)&&this.loadBranch()}shouldComponentUpdate(){return!0}getUrlCheck(){return"svn"==this.state.serverType?/^(ssh:\/\/|svn:\/\/|http:\/\/|https:\/\/).+$/gi:/^(git@|ssh:\/\/|svn:\/\/|http:\/\/|https:\/\/).+$/gi}loadBranch(){(0,y.getCodeBranch)({team_name:b.default.getCurrTeamName(),app_alias:this.props.appAlias}).then(e=>{e&&this.setState({branch:e.list})})}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.appBuidSourceLoading,s=e.form,o=s.getFieldDecorator,d=s.getFieldValue,c=this.state,p=c.showUsernameAndPass,h=c.showKey,m={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:16}}},g=d("git_url"),y=/(http|https):\/\/([\w.]+\/?)\S*/.test(g||"");"git"!==this.state.serverType&&(y=!0);var b=!y,k=o("server_type",{initialValue:this.state.buildSource.server_type})(v.default.createElement(u.default,{getPopupContainer:e=>e.parentNode,onChange:this.changeServerType,style:{width:100}},v.default.createElement(S,{value:"git"},"Git"),v.default.createElement(S,{value:"svn"},"Svn"),v.default.createElement(S,{value:"oss"},"OSS"))),w=this.state.buildSource.code_version,A="branch";w&&0===w.indexOf("tag:")&&(A="tag",w=w.substr(4,w.length));var x=o("version_type",{initialValue:A})(v.default.createElement(u.default,{getPopupContainer:e=>e.parentNode,style:{width:100}},v.default.createElement(S,{value:"branch"},"\u5206\u652f"),v.default.createElement(S,{value:"tag"},"Tag")));this.state.showCode&&o("service_source",{initialValue:"source_code"});var D=E.default.isImageAppByBuildSource(this.state.buildSource);return this.state.showImage&&o("service_source",{initialValue:"docker_run"}),v.default.createElement(n.default,{width:700,title:t,confirmLoading:l,onOk:this.handleSubmit,onCancel:a,visible:!0},v.default.createElement(f.default,{onSubmit:this.handleSubmit},v.default.createElement(C,(0,r.default)({style:{display:D?"":"none"}},m,{label:"\u955c\u50cf\u540d\u79f0"}),o("image",{rules:[{required:!0,message:"\u955c\u50cf\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"},{max:190,message:"\u6700\u5927\u957f\u5ea6190\u4f4d"}],initialValue:this.state.buildSource.image})(v.default.createElement(i.default,null))),v.default.createElement(C,(0,r.default)({style:{display:D?"":"none"}},m,{label:"\u542f\u52a8\u547d\u4ee4"}),o("cmd",{initialValue:this.state.buildSource.cmd})(v.default.createElement(i.default,null))),v.default.createElement(f.default.Item,(0,r.default)({style:{display:D?"":"none"}},m,{label:"\u7528\u6237\u540d"}),o("user_name",{initialValue:this.state.buildSource.user_name||this.state.buildSource.user||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u7528\u6237\u540d"}]})(v.default.createElement(i.default,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u7528\u6237\u540d"}))),v.default.createElement(f.default.Item,(0,r.default)({style:{display:D?"":"none"}},m,{label:"\u5bc6\u7801"}),o("password",{initialValue:this.state.buildSource.password||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5bc6\u7801"}]})(v.default.createElement(i.default,{autoComplete:"new-password",type:"password",placeholder:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5bc6\u7801"}))),this.state.showCode&&v.default.createElement(f.default.Item,(0,r.default)({style:{display:this.state.showCode?"":"none"}},m,{label:"\u4ed3\u5e93\u5730\u5740"}),o("git_url",{initialValue:this.state.buildSource.git_url,force:!0,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5730\u5740"},{validator:this.checkURL,message:"\u4ed3\u5e93\u5730\u5740\u4e0d\u5408\u6cd5"}]})(v.default.createElement(i.default,{addonBefore:k,placeholder:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5730\u5740"}))),this.state.showCode&&v.default.createElement(f.default.Item,(0,r.default)({style:{display:this.state.showCode?"":"none"}},m,{label:"\u4ee3\u7801\u7248\u672c"}),o("code_version",{initialValue:w,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ee3\u7801\u7248\u672c"}]})(v.default.createElement(i.default,{addonBefore:x,placeholder:"\u8bf7\u8f93\u5165\u4ee3\u7801\u7248\u672c"}))),g&&b?v.default.createElement("div",{style:{textAlign:"left"}},"\u8fd9\u662f\u4e00\u4e2a\u79c1\u6709\u4ed3\u5e93?"," ",v.default.createElement("a",{onClick:()=>{this.setState({showKey:!0})}},"\u914d\u7f6e\u6388\u6743Key")):"",g&&y&&!p?v.default.createElement("div",{style:{textAlign:"left"}},"\u8fd9\u662f\u4e00\u4e2a\u79c1\u6709\u4ed3\u5e93?",v.default.createElement("a",{onClick:()=>{this.setState({showUsernameAndPass:!0})}},"\u586b\u5199\u4ed3\u5e93\u8d26\u53f7\u5bc6\u7801")):"",v.default.createElement(f.default.Item,(0,r.default)({style:{display:p&&y?"":"none"}},m,{label:"\u7528\u6237\u540d"}),o("user_name",{initialValue:this.state.buildSource.user_name||this.state.buildSource.user||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u7528\u6237\u540d"}]})(v.default.createElement(i.default,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u7528\u6237\u540d"}))),v.default.createElement(f.default.Item,(0,r.default)({style:{display:p&&y?"":"none"}},m,{label:"\u5bc6\u7801"}),o("password",{initialValue:this.state.buildSource.password||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5bc6\u7801"}]})(v.default.createElement(i.default,{autoComplete:"new-password",type:"password",placeholder:"\u8bf7\u8f93\u5165\u4ed3\u5e93\u5bc6\u7801"})))),h&&b&&v.default.createElement(_.default,{onCancel:this.hideShowKey}))}},h=m))||h)||h);t.default=k},"0oB1":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("+L6B");var r=l(a("2/Rp"));a("fOrg");var i=l(a("+KLJ"));a("/xke");var o,d,u,c=l(a("TeRw")),p=l(a("ALo4")),h=l(a("QDog")),m=a("MuoO"),f=s(a("q1tI")),g=(o=(0,m.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,appDetail:a.appDetail}}),o((u=class extends f.PureComponent{constructor(e){super(e),this.openTrace=(()=>{var e=this.props,t=e.appDetail,a=e.dispatch;a({type:"monitor/setComponsentTrace",payload:{team_name:h.default.getCurrTeamName(),app_alias:t.service.service_alias},callback:()=>{c.default.success({message:"\u8bbe\u7f6e\u6210\u529f\uff0c\u66f4\u65b0\u7ec4\u4ef6\u540e\u751f\u6548"}),this.loadTraceSetting()}})}),this.closeTrace=(()=>{var e=this.props,t=e.appDetail,a=e.dispatch;a({type:"monitor/deleteComponsentTrace",payload:{team_name:h.default.getCurrTeamName(),app_alias:t.service.service_alias},callback:()=>{c.default.success({message:"\u5173\u95ed\u6210\u529f\uff0c\u66f4\u65b0\u7ec4\u4ef6\u540e\u751f\u6548"}),this.loadTraceSetting()}})}),this.state={trace:{}}}componentDidMount(){this.loadTraceSetting()}loadTraceSetting(){var e=this.props,t=e.appDetail,a=e.dispatch;a({type:"monitor/getComponsentTrace",payload:{team_name:h.default.getCurrTeamName(),app_alias:t.service.service_alias},callback:e=>{this.setState({trace:e.bean})}})}componentWillUnmount(){}render(){var e=this.state.trace;return f.default.createElement(f.Fragment,null,f.default.createElement(i.default,{style:{marginBottom:"16px"},message:"\u5f53\u524d\u57fa\u4e8eJava\u7c7b\u6e90\u4ee3\u7801\u6784\u5efa\u7684\u7ec4\u4ef6\u9ed8\u8ba4\u652f\u6301Pinpoint\u94fe\u8def\u8ffd\u8e2a\u6570\u636e\u91c7\u96c6"}),f.default.createElement(n.default,null,e.collector_host&&!e.enable_apm&&f.default.createElement(p.default,{type:"success",description:"\u5df2\u7ecf\u5bf9\u63a5Pinpoint\uff0c\u53ef\u4ee5\u5f00\u542f\u6570\u636e\u91c7\u96c6",actions:[f.default.createElement(r.default,{type:"primary",onClick:this.openTrace},"\u5f00\u542f")]}),e.collector_host&&e.enable_apm&&f.default.createElement(p.default,{type:"success",description:"\u5df2\u7ecf\u5f00\u542fPinpoint\u94fe\u8def\u8ffd\u8e2a\u6570\u636e\u91c7\u96c6",actions:[f.default.createElement(r.default,{type:"primary",onClick:this.closeTrace},"\u5173\u95ed")]}),!e.collector_host&&f.default.createElement(p.default,{type:"warning",description:"\u5f53\u524d\u7ec4\u4ef6\u672a\u4f9d\u8d56Pinpoint\u670d\u52a1\uff0c\u8bf7\u5148\u4f9d\u8d56Pinpoint\u670d\u52a1"})))}},d=u))||d);t.default=g},"18Tw":function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV"));a("/xke");var r=s(a("TeRw"));a("+BJd");var i=s(a("mr32")),o=l(a("q1tI")),d=i.default.CheckableTag;class u extends o.PureComponent{constructor(e){super(e),this.handleOk=(()=>{var e=Object.keys(this.state.selected);e.length?this.props.onOk&&this.props.onOk(e):r.default.warning({message:"\u8bf7\u9009\u62e9\u8981\u6dfb\u52a0\u7684\u6807\u7b7e"})}),this.isCheck=(e=>!!this.state.selected[e]),this.handleChange=((e,t)=>{t?this.state.selected[e]=!0:delete this.state.selected[e],this.forceUpdate()}),this.state={selected:{}}}render(){var e=this.props.tags||[],t=this.props.onCancel;return o.default.createElement(n.default,{title:"\u70b9\u51fb\u6807\u7b7e\u8fdb\u884c\u9009\u62e9",visible:!0,onOk:this.handleOk,onCancel:t},e&&e.length?e.map(e=>o.default.createElement(d,{onChange:t=>{this.handleChange(e.label_id,t)},checked:this.isCheck(e.label_id)},e.label_alias)):o.default.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u53ef\u7528\u6807\u7b7e"))}}t.default=u},"2RmR":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("5NDa");var r=l(a("5rEg")),i=l(a("jehZ"));a("7Kak");var o=l(a("9yH6"));a("OaEy");var d=l(a("2fM7"));a("y8nQ");var u,c,p,h=l(a("Vl3Y")),m=s(a("q1tI")),f=l(a("IhRX")),g=l(a("CQXj")),v=h.default.Item,_=d.default.Option,y=o.default.Group,E=(u=h.default.create(),u((p=class extends m.PureComponent{constructor(){super(...arguments),this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields({force:!0},(e,t)=>{e||this.props.onOk&&this.props.onOk(t)})}),this.checkPath=((e,t,a)=>{var l=this.props.form.getFieldValue("scheme");"tcp"!=l?"tcp"!=l&&t?a():a("\u8bf7\u586b\u5199\u8def\u5f84!"):a()})}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.ports,s=this.props.data||{},o={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},u=this.props.form,c=u.getFieldDecorator,p=u.getFieldValue,E=p("scheme")||"tcp";return m.default.createElement(n.default,{width:700,title:t,onOk:this.handleSubmit,onCancel:a,visible:!0},m.default.createElement(h.default,{onSubmit:this.handleSubmit},m.default.createElement(v,(0,i.default)({},o,{label:"\u68c0\u6d4b\u7aef\u53e3"}),c("port",{initialValue:g.default.getPort(s)||(l.length?l[0].container_port:"")})(m.default.createElement(d.default,{getPopupContainer:e=>e.parentNode},l.map(e=>m.default.createElement(_,{key:e.container_port,value:e.container_port},e.container_port))))),m.default.createElement(v,(0,i.default)({},o,{label:"\u63a2\u9488\u534f\u8bae"}),c("scheme",{initialValue:s.scheme||"tcp"})(m.default.createElement(y,{options:[{label:"tcp",value:"tcp"},{label:"http",value:"http"}]}))),m.default.createElement(v,(0,i.default)({},o,{label:"http\u8bf7\u6c42\u5934",style:{display:"tcp"===E?"none":""}}),c("http_header",{initialValue:s.http_header||""})(m.default.createElement(f.default,null))),m.default.createElement(v,(0,i.default)({},o,{label:"\u8def\u5f84",style:{display:"tcp"===E?"none":""}}),c("path",{initialValue:s.path||"",rules:[{validator:this.checkPath}]})(m.default.createElement(r.default,{placeholder:"\u54cd\u5e94\u78012xx\u30013xx\u4e3a\u6b63\u5e38"}))),m.default.createElement(v,(0,i.default)({},o,{label:"\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"}),c("initial_delay_second",{initialValue:s.initial_delay_second||"20",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"}]})(m.default.createElement(r.default,{type:"number",style:{width:"80%"}})),m.default.createElement("span",{style:{marginLeft:8}},"\u79d2")),m.default.createElement(v,(0,i.default)({},o,{label:"\u68c0\u6d4b\u95f4\u9694\u65f6\u95f4"}),c("period_second",{initialValue:s.period_second||"3",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u68c0\u6d4b\u95f4\u9694\u65f6\u95f4"}]})(m.default.createElement(r.default,{type:"number",style:{width:"80%"}})),m.default.createElement("span",{style:{marginLeft:8}},"\u79d2")),m.default.createElement(v,(0,i.default)({},o,{label:"\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"}),c("timeout_second",{initialValue:s.timeout_second||"20",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"}]})(m.default.createElement(r.default,{type:"number",style:{width:"80%"}})),m.default.createElement("span",{style:{marginLeft:8}},"\u79d2")),m.default.createElement(v,(0,i.default)({},o,{label:"\u8fde\u7eed\u9519\u8bef\u6b21\u6570"}),c("failure_threshold",{initialValue:s.failure_threshold||"3",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u8fde\u7eed\u9519\u8bef\u6b21\u6570"}]})(m.default.createElement(r.default,{type:"number",style:{width:"80%"}})))))}},c=p))||c);t.default=E},"2U5Y":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("14J3");var i=l(a("BMrR"));a("jCWc");var o=l(a("kPKH"));a("sRBo");var d=l(a("kaz8"));a("+L6B");var u=l(a("2/Rp"));a("/xke");var c=l(a("TeRw"));a("y8nQ");var p,h,m,f,g=l(a("Vl3Y")),v=a("MuoO"),_=s(a("q1tI")),y=l(a("e6Ls")),E=g.default.Item,b=(p=(0,v.connect)(),h=g.default.create(),p(m=h((f=class extends _.PureComponent{constructor(e){super(e),this.onChange=(e=>{var t=this.props,a=t.data,l=t.form,s=l.setFieldsValue;this.setState({indeterminate:!!e.length&&e.length<a.length,checkAll:e.length===a.length}),s({graphIds:e})}),this.onCheckAllChange=(e=>{var t=this.state.allCheckedList,a=this.props.form.setFieldsValue;a({graphIds:e.target.checked?t:[]}),this.setState({indeterminate:!1,checkAll:e.target.checked})}),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&this.handleSubmitBatchDelete(t)})}),this.handleSubmitBatchDelete=(e=>{var t=this.props,a=t.dispatch,l=t.onOk,s=t.team_name,n=t.app_alias;a({type:"monitor/batchDeleteServiceMonitorFigure",payload:{app_alias:n,team_name:s,graph_ids:e.graphIds},callback:e=>{e&&200===e.status_code&&(c.default.success({message:"\u5220\u9664\u6210\u529f"}),l())}})});var t=this.props.data,a=t&&t.length>0&&t.map(e=>e.graph_id);this.state={allCheckedList:a,indeterminate:!0,checkAll:!0}}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.data,s=e.form,c=e.loading,p=void 0!==c&&c,h=this.state,m=h.checkAll,f=h.indeterminate,g=l&&l.length>0&&l.map(e=>e.graph_id),v=s.getFieldDecorator,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}};return _.default.createElement(n.default,{title:t,visible:!0,onOk:this.onOk,onCancel:a,className:y.default.TelescopicModal,footer:[_.default.createElement(u.default,{onClick:a}," \u53d6\u6d88 "),_.default.createElement(u.default,{type:"primary",loading:p,onClick:this.onOk},"\u786e\u5b9a")]},_.default.createElement("div",null,_.default.createElement("div",{style:{borderBottom:"1px solid #E9E9E9",paddingBottom:"10px",marginBottom:"10px"}},_.default.createElement(d.default,{indeterminate:f,onChange:this.onCheckAllChange,checked:m},"\u5168\u9009")),_.default.createElement(E,(0,r.default)({},b,{label:""}),v("graphIds",{initialValue:g||[],rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u76d1\u63a7\u89c6\u56fe"}]})(_.default.createElement(d.default.Group,{style:{width:"472px"},onChange:this.onChange},_.default.createElement(i.default,null,l.map(e=>{var t=e.title,a=e.ID,l=e.graph_id;return _.default.createElement(o.default,{span:12,key:a,style:{marginBottom:"5px"}},_.default.createElement(d.default,{value:l},t))})))))))}},m=f))||m)||m),C=b;t.default=C},"308x":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var n=l(a("2/Rp"));a("Mwp2");var r=l(a("VXEj"));a("Pwec");var i=l(a("CtXQ"));a("/xke");var o=l(a("TeRw"));a("IzEo");var d=l(a("bx4M"));a("T2oS");var u=l(a("W9HT"));a("14J3");var c=l(a("BMrR"));a("jCWc");var p=l(a("kPKH"));a("5Dmo");var h=l(a("3S7+"));a("2qtc");var m=l(a("kLXV"));a("5NDa");var f=l(a("5rEg"));a("y8nQ");var g=l(a("Vl3Y"));a("7Kak");var v=l(a("9yH6"));a("OaEy");var _,y,E,b,C,S,k,w,A,x=l(a("2fM7")),D=a("MuoO"),T=a("7DNP"),P=s(a("q1tI")),M=l(a("q76B")),N=l(a("QxhW")),I=l(a("cUW5")),R=l(a("mKRI")),L=l(a("QDog")),O=l(a("/EMh")),V=l(a("LrcT")),B=x.default.Option,q=v.default.Button,F=v.default.Group,U=g.default.Item,z=(_=g.default.create(),_((E=class extends P.PureComponent{constructor(){super(...arguments),this.handleOk=(()=>{var e=this.props.onOk;this.props.form.validateFields((t,a)=>{!t&&e&&(a.min_cpu=Number(a.min_cpu),e(a))})})}render(){var e=this.props,t=e.minCpu,a=e.memory,l=e.form,s=e.onCancel,n=l.getFieldDecorator;return P.default.createElement(m.default,{title:"\u8d44\u6e90\u914d\u7f6e",visible:!0,onOk:this.handleOk,onCancel:s},P.default.createElement(g.default,{onSubmit:this.handleOk,layout:"horizontal"},P.default.createElement(N.default,{labelCol:{span:5},wrapperCol:{span:19},form:l,FormItem:g.default.Item,initialValue:a,setkey:"memory",getFieldDecorator:n}),P.default.createElement(g.default.Item,{label:"CPU",labelCol:{span:5},wrapperCol:{span:19}},n("min_cpu",{initialValue:t||0,rules:[{required:!0,message:"\u8bf7\u8f93\u5165CPU"},{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u53ea\u5141\u8bb8\u8f93\u5165\u6574\u6570"}]})(P.default.createElement(f.default,{type:"number",min:0,addonAfter:"m",placeholder:"\u8bf7\u8f93\u5165CPU"})),P.default.createElement("div",{style:{color:"#999999",fontSize:"12px"}},"CPU\u5206\u914d\u989d0\u4e3a\u4e0d\u9650\u5236\uff0c1000m=1core\u3002"))))}},y=E))||y),H=(b=g.default.create(),b((S=class extends P.PureComponent{constructor(){super(...arguments),this.onChange=((e,t)=>{var a=this.props.data;a&&a.map((a,l)=>{return t===l&&(a.attr_value=e),a}),this.props.onChange&&this.props.onChange(a),this.forceUpdate()}),this.renderItem=((e,t)=>{if("string"===e.attr_type)return P.default.createElement(U,{style:{width:"90%"},label:P.default.createElement(h.default,{title:e.attr_info||e.attr_name},P.default.createElement("div",{className:V.default.nowarpText}," ",e.attr_name,e.attr_info?P.default.createElement("span",null,"(",e.attr_info,")"):""," "))},P.default.createElement(f.default,{disabled:!e.is_change,defaultValue:e.attr_value?e.attr_value:e.attr_default_value,onChange:e=>{this.onChange(e.target.value,t)}}));if("radio"===e.attr_type){var a=e.attr_alt_value.split(",");return P.default.createElement(U,{style:{width:"90%"},label:P.default.createElement(h.default,{title:e.attr_info||e.attr_name},P.default.createElement("div",{className:V.default.nowarpText}," ",e.attr_name,e.attr_info?P.default.createElement("span",null,"(",e.attr_info,")"):""," "))},P.default.createElement(x.default,{getPopupContainer:e=>e.parentNode,onChange:e=>{this.onChange(e,t)},disabled:!e.is_change,value:e.attr_value||e.attr_default_value||""},a.map(e=>P.default.createElement(B,{key:e,value:e},e))))}if("checkbox"===e.attr_type){var l=e.attr_alt_value.split(",");return P.default.createElement(U,{style:{width:"90%"},label:P.default.createElement(h.default,{title:e.attr_info||e.attr_name},P.default.createElement("div",{className:V.default.nowarpText}," ",e.attr_name,e.attr_info?P.default.createElement("span",null,"(",e.attr_info,")"):""," "))},P.default.createElement(x.default,{getPopupContainer:e=>e.parentNode,disabled:!e.is_change,onChange:e=>{this.onChange(e.join(","),t)},value:(e.attr_value||e.attr_default_value||"").split(","),mode:"multiple"},l.map(e=>P.default.createElement(B,{key:e,value:e},e))))}})}componentWillReceiveProps(){}render(){var e=this.props.data||[];return P.default.createElement(g.default,{layout:"vertical"},P.default.createElement(c.default,null,e.map((e,t)=>P.default.createElement(p.default,{span:"8"},this.renderItem(e,t)))))}},C=S))||C);class j extends P.PureComponent{constructor(e){super(e),this.getAppByName=(e=>this.props.data.filter(t=>t.dest_service_alias===e)),this.handleAppChange=(e=>{var t=this.getAppByName(e);this.setState({currAppLoading:!0},()=>{this.setState({currApp:e,currPort:t[0].port,currAppLoading:!1})})}),this.handlePortChange=(e=>{this.setState({currAppLoading:!0},()=>{this.setState({currPort:e,currAppLoading:!1})})}),this.getCurrPorts=(()=>{var e=this.getAppByName(this.state.currApp);return e.map(e=>e.port)}),this.getCurrData=(()=>{var e=this.state.currPort,t=this.state.currApp,a=this.getAppByName(t);return a.filter(t=>t.port===e)[0]}),this.getApps=(()=>{var e=this.props.data,t=[],a=[];return e.map(e=>{-1==t.indexOf(e.dest_service_alias)&&(t.push(e.dest_service_alias),a.push({dest_service_alias:e.dest_service_alias,dest_service_cname:e.dest_service_cname,port:e.port}))}),a});var t=this.props.data;this.state={currApp:t[0].dest_service_alias,currPort:t[0].port,config_name:t[0].config_group_name,currAppLoading:!1}}render(){var e=this.getCurrData(),t=this.state,a=t.currPort,l=t.currApp,s=t.config_name,n=t.currAppLoading,r=this.getCurrPorts(),i=this.getApps();return P.default.createElement(d.default,{style:{marginBottom:24},type:"inner",title:P.default.createElement("div",null,s,P.default.createElement("span",{style:{marginRight:24,marginLeft:16}},"\u4e0b\u6e38\u5e94\u7528:"," ",P.default.createElement(x.default,{getPopupContainer:e=>e.parentNode,onChange:this.handleAppChange,value:l},i.map(e=>e&&P.default.createElement(B,{key:e.dest_service_alias+e.port,value:e.dest_service_alias},e.dest_service_cname))))," ",P.default.createElement("span",{style:{marginRight:24}}," ","\u7aef\u53e3\u53f7 :"," ",P.default.createElement(x.default,{getPopupContainer:e=>e.parentNode,onChange:this.handlePortChange,value:a},r.map(e=>P.default.createElement(B,{value:e},e)))," ")," ",P.default.createElement("span",{style:{marginRight:24}},"\u7aef\u53e3\u534f\u8bae: ",e.protocol)," ")},n?P.default.createElement(u.default,null):P.default.createElement(H,{onChange:this.handleOnChange,data:e.config}))}}class Q extends P.PureComponent{constructor(e){super(e),this.handlePortChange=(e=>{this.setState({currAppLoading:!0},()=>{this.setState({currPort:e,currAppLoading:!1})})}),this.getCurrData=(e=>this.props.data.filter(t=>t.port===e)[0]);var t=this.props.data;t.length>0&&(this.state={currAppLoading:!1,currPort:t[0].port,config_name:t[0].config_group_name})}render(){var e=this.props.data,t=this.state,a=t.currAppLoading,l=t.config_name,s=t.currPort,n=this.getCurrData(s);return P.default.createElement(d.default,{style:{marginBottom:24},type:"inner",title:P.default.createElement("div",null,l,P.default.createElement("span",{style:{marginRight:24,marginLeft:16}},"\u7aef\u53e3\u53f7:"," ",P.default.createElement(x.default,{getPopupContainer:e=>e.parentNode,onChange:this.handlePortChange,value:s},e.map(e=>P.default.createElement(B,{key:e.port,value:e.port},e.port))))," ",P.default.createElement("span",{style:{marginRight:24}}," ","\u7aef\u53e3\u534f\u8bae : ",n.protocol," ")," ")},a?P.default.createElement(u.default,null):P.default.createElement(H,{onChange:this.handleOnChange,data:n.config}))}}class X extends P.PureComponent{render(){var e=this.props.data||[],t=this.props.data.config_group_name;return P.default.createElement(d.default,{style:{marginBottom:24},type:"inner",title:P.default.createElement("div",null,t)},P.default.createElement(H,{onChange:this.handleOnChange,data:e.config}))}}class W extends P.PureComponent{constructor(){super(...arguments),this.renderConfig=((e,t)=>{return"upstream_port"===t?P.default.createElement(Q,{data:e}):"downstream_port"===t?P.default.createElement(P.Fragment,null,P.default.createElement(j,{data:e})):"un_define"===t?P.default.createElement(P.Fragment,null,P.default.createElement(X,{data:e})):null})}render(){var e=this.props.configs||{},t=e.undefine_env||{},a=e.downstream_env||[],l=e.upstream_env||[];return P.default.createElement("div",{style:{padding:"20px 0"}},"{}"!==JSON.stringify(t)?this.renderConfig(t,"un_define"):null,l.length?this.renderConfig(l,"upstream_port"):null,a.length?this.renderConfig(a,"downstream_port"):null)}}var K=(k=(0,D.connect)(e=>{var t=e.user,a=e.loading;return{currUser:t.currentUser,loading:a.appControl}},null,null,{withRef:!0}),k((A=class extends P.PureComponent{constructor(e){var t;super(e),t=this,this.getPlugins=(()=>{var e=L.default.getCurrTeamName(),t=this.props.appAlias;this.props.dispatch({type:"appControl/getPlugins",payload:{team_name:e,app_alias:t,category:this.state.category},callback:e=>{if(e){var t=e.bean.installed_plugins||[],a=e.bean.not_install_plugins||[];this.setState({installedList:t,unInstalledList:a}),this.isInit&&(this.isInit=!1,t.length||this.setState({type:"uninstalled"}))}}})}),this.handleCategoryChange=(e=>{this.setState({category:e.target.value},()=>{this.getPlugins()})}),this.handleTypeChange=(e=>{this.setState({type:e.target.value})}),this.handleStartPlugin=(e=>{var t=L.default.getCurrTeamName(),a=this.props.appAlias;this.props.dispatch({type:"appControl/startPlugin",payload:{team_name:t,app_alias:a,plugin_id:e.plugin_id},callback:()=>{this.getPlugins(),o.default.success({message:"\u542f\u7528\u6210\u529f"})}})}),this.handleStopPlugin=(e=>{var t=L.default.getCurrTeamName(),a=this.props.appAlias;this.props.dispatch({type:"appControl/stopPlugin",payload:{team_name:t,app_alias:a,plugin_id:e.plugin_id},callback:()=>{this.getPlugins(),o.default.success({message:"\u505c\u7528\u6210\u529f"})}})}),this.isOpenedPlugin=(e=>{var t=this.state.openedPlugin;return!!t[e.plugin_id]}),this.openPlugin=(e=>{var t=L.default.getCurrTeamName(),a=this.props.appAlias;this.props.dispatch({type:"appControl/getPluginConfigs",payload:{team_name:t,app_alias:a,plugin_id:e.plugin_id,build_version:e.build_version},callback:t=>{t&&(this.state.openedPlugin[e.plugin_id]=t.bean||{},this.forceUpdate())}})}),this.closePlugin=(e=>{delete this.state.openedPlugin[e.plugin_id],this.forceUpdate()}),this.handleUpdateConfig=((e,t)=>{var a=L.default.getCurrTeamName(),l=this.props.appAlias;this.props.dispatch({type:"appControl/editPluginConfigs",payload:{team_name:a,app_alias:l,plugin_id:e,data:t},callback:()=>{o.default.success({message:"\u4fee\u6539\u6210\u529f"})}})}),this.onUpdateMemory=(e=>{this.setState({updateMemory:e})}),this.cancelUpdateMemory=(()=>{this.setState({updateMemory:null})}),this.renderInstalled=(()=>{var e=this.state.installedList,t=null===this.state.unInstalledList;return P.default.createElement(r.default,{size:"large",rowKey:"id",loading:t,pagination:!1,dataSource:e||[],renderItem:e=>P.default.createElement("div",null,P.default.createElement(r.default.Item,{actions:[this.isOpenedPlugin(e)?P.default.createElement("a",{onClick:()=>{this.closePlugin(e)},href:"javascript:;"},"\u9690\u85cf\u914d\u7f6e"):P.default.createElement("a",{onClick:()=>{this.openPlugin(e)},href:"javascript:;"},"\u67e5\u770b\u914d\u7f6e"),,R.default.isStart(e)?P.default.createElement("a",{onClick:()=>{this.handleStopPlugin(e)},href:"javascript:;"},"\u505c\u7528"):P.default.createElement("a",{onClick:()=>{this.handleStartPlugin(e)},href:"javascript:;"},"\u542f\u7528"),P.default.createElement("a",{onClick:()=>{this.onUpdateMemory(e)},href:"javascript:;"},"\u8d44\u6e90\u914d\u7f6e"),,P.default.createElement("a",{onClick:()=>{this.onDeletePlugin(e)},href:"javascript:;"}," ","\u5378\u8f7d"," ")]},P.default.createElement(r.default.Item.Meta,{avatar:P.default.createElement(i.default,{type:"api",style:{fontSize:40,color:"rgba(0, 0, 0, 0.2)"}}),title:P.default.createElement("div",null," ",P.default.createElement(T.Link,{to:"/team/".concat(L.default.getCurrTeamName(),"/region/").concat(L.default.getCurrRegionName(),"/myplugns/").concat(e.plugin_id)},e.plugin_alias)," ",P.default.createElement("p",{style:{fontSize:12,color:"#dcdcdc"}}," ",P.default.createElement("span",{style:{marginRight:24}},"\u7c7b\u522b\uff1a ",O.default.getCategoryCN(e.category))," ",P.default.createElement("span",{style:{marginRight:24}}," ","\u7248\u672c\uff1a ",e.build_version," ")," ",P.default.createElement("span",null," \u5185\u5b58\uff1a ",e.min_memory," MB "))," "),description:e.desc})),this.isOpenedPlugin(e)?P.default.createElement(P.Fragment,null,P.default.createElement(W,{configs:this.state.openedPlugin[e.plugin_id]||[]}),P.default.createElement("div",{style:{textAlign:"right",marginBottom:80}},P.default.createElement(n.default,{style:{marginRight:8},onClick:()=>{this.handleUpdateConfig(e.plugin_id,this.state.openedPlugin[e.plugin_id])},type:"primary"},"\u66f4\u65b0\u914d\u7f6e"),P.default.createElement(n.default,{onClick:()=>{this.closePlugin(e)},type:"default"},"\u9690\u85cf\u914d\u7f6e"))):null)})}),this.renderUnInstalled=(()=>{var e=this.state.unInstalledList,t=null===this.state.unInstalledList;return e.length?P.default.createElement(r.default,{size:"large",rowKey:"id",loading:t,pagination:!1,dataSource:e||[],renderItem:e=>P.default.createElement(r.default.Item,{actions:[P.default.createElement("a",{onClick:()=>{this.installPlugin(e)},href:"javascript:;"}," ","\u5f00\u901a"," ")]},P.default.createElement(r.default.Item.Meta,{avatar:P.default.createElement(i.default,{type:"api",style:{fontSize:40,color:"rgba(0, 0, 0, 0.2)"}}),title:P.default.createElement("div",null," ",P.default.createElement(T.Link,{to:"/team/".concat(L.default.getCurrTeamName(),"/region/").concat(L.default.getCurrRegionName(),"/myplugns/").concat(e.plugin_id)},e.plugin_alias)," ",P.default.createElement("p",{style:{fontSize:12,color:"#dcdcdc"}}," ",P.default.createElement("span",{style:{marginRight:24}},"\u7c7b\u522b\uff1a ",O.default.getCategoryCN(e.category))," ",P.default.createElement("span",null," \u7248\u672c\uff1a ",e.build_version," "))," "),description:e.desc}))}):P.default.createElement("center",null,"\u6682\u65e0\u53ef\u7528\u63d2\u4ef6"," ",P.default.createElement(T.Link,{style:{marginTop:32},to:"/team/".concat(L.default.getCurrTeamName(),"/region/").concat(L.default.getCurrRegionName(),"/myplugns")},"\u53bb\u5b89\u88c5"))}),this.hasInstalled=(()=>{var e=this.state.installedList;return e&&!!e.length}),this.installPlugin=(e=>{var t=L.default.getCurrTeamName(),a=this.props.appAlias;this.props.dispatch({type:"appControl/installPlugin",payload:{team_name:t,app_alias:a,plugin_id:e.plugin_id,build_version:e.build_version},callback:()=>{o.default.success({message:"\u5f00\u901a\u6210\u529f,\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.getPlugins(),this.props.onshowRestartTips(!0)}})}),this.onDeletePlugin=(e=>{this.setState({showDeletePlugin:e})}),this.cancelDeletePlugin=(()=>{this.setState({showDeletePlugin:null})}),this.hanldeUnInstallPlugin=(()=>{var e=L.default.getCurrTeamName(),t=this.props.appAlias,a=this.state.showDeletePlugin;this.props.dispatch({type:"appControl/unInstallPlugin",payload:{team_name:e,app_alias:t,plugin_id:a.plugin_id},callback:()=>{delete this.state.openedPlugin[a.plugin_id],o.default.success({message:"\u5378\u8f7d\u6210\u529f\uff0c\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.cancelDeletePlugin(),this.getPlugins(),this.props.onshowRestartTips(!0)}})}),this.handleUpdateMemory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=L.default.getCurrTeamName(),l=t.props.appAlias,s=t.state.updateMemory;t.props.dispatch({type:"appControl/updatePluginMemory",payload:{team_name:a,app_alias:l,plugin_id:s.plugin_id,min_memory:e.memory,min_cpu:e.min_cpu},callback:()=>{t.getPlugins(),t.cancelUpdateMemory(),o.default.success({message:"\u64cd\u4f5c\u6210\u529f"})}})},this.state={installedList:null,unInstalledList:null,category:"",type:"installed",showDeletePlugin:null,openedPlugin:{}},this.isInit=!0}componentDidMount(){this.canView()&&this.getPlugins()}canView(){var e=this.props.componentPermissions.isPlugin;return e}render(){if(!this.canView())return P.default.createElement(I.default,null);var e=this.state.type;return P.default.createElement(d.default,null,P.default.createElement("p",{style:{overflow:"hidden"}},P.default.createElement(F,{onChange:this.handleTypeChange,value:e,style:{marginRight:16,float:"left"}},P.default.createElement(q,{value:"installed"},"\u5df2\u5f00\u901a"),P.default.createElement(q,{value:"uninstalled"},"\u672a\u5f00\u901a")),P.default.createElement(F,{onChange:this.handleCategoryChange,defaultValue:"",style:{marginRight:16,float:"right"}},P.default.createElement(q,{value:""},"\u5168\u90e8"),P.default.createElement(q,{value:"analysis"},"\u6027\u80fd\u5206\u6790\u7c7b"),P.default.createElement(q,{value:"net_manage"},"\u7f51\u7edc\u6cbb\u7406\u7c7b"))),"installed"===e?this.renderInstalled():this.renderUnInstalled(),this.state.showDeletePlugin&&P.default.createElement(M.default,{onOk:this.hanldeUnInstallPlugin,onCancel:this.cancelDeletePlugin,title:"\u5378\u8f7d\u63d2\u4ef6",desc:"\u786e\u5b9a\u8981\u5378\u8f7d\u6b64\u63d2\u4ef6\u5417\uff1f"}),this.state.updateMemory&&P.default.createElement(z,{onOk:this.handleUpdateMemory,onCancel:this.cancelUpdateMemory,minCpu:this.state.updateMemory.min_cpu,memory:this.state.updateMemory.min_memory}))}},w=A))||w);t.default=K},"3A2o":function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,n,r=l(a("q1tI")),i=a("MuoO"),o=l(a("MXRY")),d=(s=(0,i.connect)(),s(n=class extends r.default.Component{render(){var e=this.props.appAlias;return r.default.createElement(o.default,{title:"\u7ec4\u4ef6\u8fde\u63a5\u4fe1\u606f",type:"Outer",appAlias:e})}})||n);t.default=d},"4NES":function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Mwp2");var n=s(a("VXEj")),r=l(a("q1tI")),i=s(a("ZzQo")),o=s(a("k3y4"));class d extends r.PureComponent{constructor(e){super(e),this.showName=(e=>{var t=e&&e.split("-"),a=t[t.length-1];return"\u5b9e\u4f8b".concat(a)}),this.getContainerMem=(e=>{var t=0;return e&&e.map(e=>{e.container_name===this.props.k8s_component_name&&(t=e.usage_rate)}),t}),this.state={list:this.props.list}}componentWillReceiveProps(e){e.list!==this.props.list&&this.setState({list:e.list})}componentDidMount(){}render(){var e={Running:"\u6b63\u5e38\u8fd0\u884c",Pending:"\u542f\u52a8\u4e2d",Succeeded:"\u8fd0\u884c\u6210\u529f",Failed:"\u8fd0\u884c\u5931\u8d25",Unknown:"\u672a\u77e5"};return r.default.createElement(n.default,{grid:{gutter:16,column:4},dataSource:this.state.list,renderItem:t=>r.default.createElement(n.default.Item,{className:o.default.cen,key:t.pod_name},r.default.createElement(i.default,{className:o.default.instance,height:120,title:"\u8fd0\u884c\u5185\u5b58",percent:this.getContainerMem(t.container)}),r.default.createElement("div",null,this.showName(t.pod_name)),r.default.createElement("div",null,e[t.pod_status]))})}}var u=d;t.default=u},"6mLI":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("/xke");var r=l(a("TeRw"));a("+L6B");var i,o,d,u,c,p,h,m,f=l(a("2/Rp")),g=a("MuoO"),v=l(a("17x9")),_=s(a("q1tI")),y=l(a("0zE7")),E=a("xpXo"),b=l(a("9/bS")),C=l(a("J5jb")),S=l(a("QDog")),k=l(a("ym8O")),w=l(a("rIpq")),A=l(a("zcww")),x=l(a("+iC2")),D=l(a("dL6S")),T=l(a("+y/a")),P=l(a("ye39")),M=l(a("ruXZ")),N=l(a("LrcT")),I=f.default.Group;i=(0,g.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,appDetail:a.appDetail}}),i((u=d=class extends _.PureComponent{constructor(e){super(e),this.showLogType=(()=>{return"ing"===this.state.status?"none":!1===this.state.opened?"none":""}),this.getSocketUrl=(()=>{var e=x.default.getTeamByTeamName(this.props.currUser,S.default.getCurrTeamName()),t=S.default.getCurrRegionName();if(e){var a=A.default.getRegionByName(e,t);if(a)return w.default.getEventWebSocketUrl(a)}return""}),this.onClose=(()=>{this.isDoing=!1}),this.onSuccess=(e=>{this.setState({resultStatus:"success"}),this.ref.querySelector(".actionresultcn").innerHTML="\u5b8c\u6210"}),this.onTimeout=(e=>{this.setState({resultStatus:"timeout"}),this.ref.querySelector(".actionresultcn").innerHTML="\u8d85\u65f6",this.ref.querySelector(".action-error-msg").innerHTML="(".concat(b.default.getFailMessage(e),")")}),this.onFail=(e=>{this.setState({resultStatus:"fail"}),this.ref.querySelector(".actionresultcn").innerHTML="\u5931\u8d25",this.ref.querySelector(".action-error-msg").innerHTML="(".concat(b.default.getFailMessage(e),")")}),this.onComplete=(e=>{this.setState({status:""}),this.context.isActionIng(!1),this.close()}),this.open=(()=>{this.setState({opened:!0,logType:"info"},()=>{this.loadLog()})}),this.close=(()=>{this.setState({opened:!1})}),this.changeLogType=(e=>{e!==this.state.logType&&this.setState({logType:e,logs:[]},()=>{this.loadLog()})}),this.saveRef=(e=>{this.ref=e}),this.handleRollback=(()=>{this.context.appRolback(b.default.getRollbackVersion(this.props.data))}),this.state={status:"",resultStatus:"",opened:!1,logType:"info",logs:[]}}componentDidMount(){var e=this.props.data;e&&this.ref&&(this.ref.querySelector(".actioncn").innerHTML=b.default.getActionCN(e),b.default.isSuccess(e)&&this.onSuccess(),b.default.isFail(e)&&this.onFail(e),b.default.isTimeout(e)&&this.onTimeout(e),b.default.isActioning(e)&&(this.setState({status:"ing"}),this.ref.querySelector(".actionresultcn").innerHTML="\u8fdb\u884c\u4e2d",this.context.isActionIng(!0)),this.ref.querySelector(".action-user").innerHTML="@".concat(b.default.getActionUser(e)))}loadLog(){(0,E.getActionLogDetail)({app_alias:this.props.appAlias,level:this.state.logType,team_name:S.default.getCurrTeamName(),event_id:this.props.data.event_id}).then(e=>{e&&this.setState({logs:e.list||[]})})}createSocket(){var e=this.props.data,t=this.getSocketUrl();if(t){var a=C.default.isWebSocketOpen(t);a&&"through"===a&&(this.socket=new k.default({url:this.getSocketUrl(),eventId:e.event_id,onMessage:e=>{var t=this.state.logs;t.unshift(e),this.setState({logs:[].concat(t)})}}))}}getLogContHeight(){var e=this.state,t=e.status,a=e.opened;return"ing"!==t||a?a?"auto":0:15}getResultClass(){this.props.data;return"fail"===this.state.resultStatus?N.default.fail:"success"===this.state.resultStatus?N.default.success:""}render(){var e=this.state,t=e.status,a=e.opened,l=e.logType,s=e.logs,n=this.props.data;document.getElementById("box");return n?_.default.createElement("div",{ref:this.saveRef,className:"".concat(N.default.logItem," ").concat(this.getResultClass())},_.default.createElement("div",{className:N.default.logItemDate},_.default.createElement("span",{className:N.default.time},b.default.getActionTime(n)),_.default.createElement("span",{className:N.default.date},C.default.dateToCN(b.default.getActionDateTime(n),"yyyy-MM-dd"))),_.default.createElement("div",{className:N.default.logItemMain},_.default.createElement("div",{className:N.default.hd},_.default.createElement("label",{className:N.default.tit},_.default.createElement("span",{className:"actioncn"}),_.default.createElement("span",{className:"actionresultcn"}),_.default.createElement("span",{className:"action-error-msg"}),_.default.createElement("span",{className:"action-user"})),_.default.createElement("div",{className:N.default.btns},a?_.default.createElement("span",{onClick:this.close,className:N.default.btn},"\u6536\u8d77"):_.default.createElement("span",{onClick:this.open,className:N.default.btn},"\u67e5\u770b\u8be6\u60c5"))),b.default.isShowCommitInfo(n)?_.default.createElement("div",{className:N.default.codeVersion},_.default.createElement("div",{className:N.default.versionInfo},"\u4ee3\u7801\u4fe1\u606f\uff1a ",b.default.getCommitLog(n)),_.default.createElement("div",{className:N.default.versionAuthor},"#",b.default.getCodeVersion(n),"by ",b.default.getCommitUser(n))):"",_.default.createElement(I,{style:{display:this.showLogType()},size:"small",className:N.default.logTypeBtn},_.default.createElement(f.default,{onClick:()=>{this.changeLogType("info")},className:"info"===l?"active":"",type:"dashed"},"Info\u65e5\u5fd7"),_.default.createElement(f.default,{onClick:()=>{this.changeLogType("debug")},className:"debug"===l?"active":"",type:"dashed"},"Debug\u65e5\u5fd7"),_.default.createElement(f.default,{onClick:()=>{this.changeLogType("error")},className:"error"===l?"active":"",type:"dashed"},"Error\u65e5\u5fd7")),_.default.createElement("div",{style:{height:this.getLogContHeight(),maxHeight:350,overflowY:"auto"},className:"".concat(N.default.logContent," logs-cont")},"ing"===t?_.default.createElement(y.default,{resover:!0,onClose:this.onClose,onComplete:this.onComplete,onSuccess:this.onSuccess,onTimeout:this.onTimeout,onFail:this.onFail,socketUrl:this.getSocketUrl(),eventId:n.event_id,opened:a,list:this.state.logs}):_.default.createElement("div",null,s&&s.length>0&&s.map((e,t)=>_.default.createElement("p",{key:t},_.default.createElement("span",{style:{marginRight:10}},C.default.format(e.time,"hh:mm:ss")),_.default.createElement("span",null,e.message))))))):null}},d.contextTypes={isActionIng:v.default.func,appRolback:v.default.func},o=u));var R=(c=(0,g.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,appRequest:a.appRequest,appRequestRange:a.appRequestRange,requestTime:a.requestTime,requestTimeRange:a.requestTimeRange,appDisk:a.appDisk,appMemory:a.appMemory}},null,null,{withRef:!0}),c((m=h=class extends _.PureComponent{constructor(e){var t;super(e),t=this,this.load=(()=>{this.fetchPods(!0),this.fetchOperationLog(!0)}),this.closeTimer=(()=>{this.fetchOperationLogTimer&&clearInterval(this.fetchOperationLogTimer),this.fetchPodsTimer&&clearInterval(this.fetchPodsTimer)}),this.handleResourcesLoading=(()=>{this.setState({resourcesLoading:!1})}),this.fetchOperationLog=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.props.dispatch({type:"appControl/fetchOperationLog",payload:{team_name:S.default.getCurrTeamName(),app_alias:t.props.appAlias,target:"service",page:t.state.page,page_size:t.state.page_size},callback:l=>{l&&200===l.status_code&&t.setState({isopenLog:a,has_next:l.has_next||!1,logList:l.list||[],recordLoading:!1},()=>{e&&t.handleTimers("fetchOperationLogTimer",()=>{t.fetchOperationLog(!0)},5e3)})},handleError:e=>{t.handleError(e),t.handleTimers("fetchOperationLogTimer",()=>{t.fetchOperationLog(!0)},1e4)}})},this.handleError=(e=>{var t=this.state.componentTimers;if(!t)return null;e&&e.data&&e.data.msg_show&&r.default.warning({message:"\u8bf7\u6c42\u9519\u8bef",description:e.data.msg_show})}),this.handleTimers=((e,t,a)=>{var l=this.state.componentTimers;if(!l)return null;this[e]=setTimeout(()=>{t()},a)}),this.handleNextPage=(()=>{this.setState({page:1,page_size:this.state.page_size*(this.state.page+1)},()=>{this.fetchOperationLog(!1)})}),this.handleRollback=(e=>{this.context.appRolback(e)}),this.onAction=(e=>{this.fetchOperationLog(!1),this.getVersionList()}),this.onLogPush=(e=>{this.fetchOperationLog(!1,e)}),this.handleDel=(e=>{this.props.dispatch({type:"appControl/delAppVersion",payload:{team_name:S.default.getCurrTeamName(),service_alias:this.props.appAlias,version_id:e.build_version},callback:e=>{e&&(r.default.success({message:"\u5220\u9664\u6210\u529f"}),this.getVersionList())}})}),this.onPageChange=(e=>{this.setState({pages:e},()=>{this.getVersionList()})}),this.onShowSizeChange=((e,t)=>{this.setState({pages:e,pageSize:t},()=>{this.getVersionList()})}),this.getVersionList=(e=>{var t=this.props,a=t.setShowUpgrade,l=t.appAlias,s=t.dispatch;e&&a();var n=this.state,r=n.pages,i=n.pageSize;s({type:"appControl/getAppVersionList",payload:{team_name:S.default.getCurrTeamName(),service_alias:l,page_num:r,page_size:i},callback:e=>{if(e&&e.bean&&e.list){var t=e.bean,a=e.list,l=e.total,s=void 0===l?0:l,n=null;a.length>0&&a.map(e=>{e.build_version===t.current_version&&(n=e)}),this.setState({current_version:t.current_version,beanData:n,dataList:a,total:s})}}})}),this.loadBuildSourceInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/getAppBuidSource",payload:{team_name:S.default.getCurrTeamName(),service_alias:this.props.appAlias},callback:e=>{e&&this.setState({buildSource:e.bean&&e.bean.service_source&&e.bean.service_source})}})}),this.fetchPods=(e=>{var t=this.props,a=t.appAlias,l=t.dispatch;l({type:"appControl/fetchPods",payload:{team_name:S.default.getCurrTeamName(),app_alias:a},callback:t=>{t&&200===t.status_code&&this.setState({new_pods:t.list.new_pods,old_pods:t.list.old_pods,runLoading:!1},()=>{e&&this.handleTimers("fetchPodsTimer",()=>{this.fetchPods(!0)},5e3)})},handleError:e=>{this.handleError(e),this.handleTimers("fetchPodsTimer",()=>{this.fetchPods(!0)},1e4)}})}),this.handleMore=(e=>{this.setState({more:e})}),this.state={logList:[],recordLoading:!0,page:1,page_size:6,disk:0,memory:0,resourcesLoading:!0,beanData:null,dataList:[],runLoading:!0,new_pods:null,old_pods:null,more:!1,current_version:null,pages:1,pageSize:10,total:0,status:"",isopenLog:!1,buildSource:null,componentTimers:this.props.timers},this.inerval=5e3}componentDidMount(){this.mounted=!0,this.loadBuildSourceInfo(),this.fetchAppDiskAndMemory(),this.getVersionList(),this.load()}componentWillReceiveProps(e){var t=e.status,a=e.timers,l=this.props,s=l.status,n=l.timers;t!==s&&this.setState({status:t}),a!==n&&this.setState({componentTimers:a},()=>{a?this.load():this.closeTimer()})}componentWillUnmount(){this.mounted=!1,this.closeTimer()}fetchAppDiskAndMemory(){this.props.dispatch({type:"appControl/getAppResource",payload:{team_name:S.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{e&&e.bean&&this.setState({disk:e.bean.disk||0,memory:e.bean.memory||0}),this.handleResourcesLoading()},handleError:e=>{this.handleResourcesLoading(),this.handleError(e)}})}getStartTime(){return(new Date).getTime()/1e3-3600}getStep(){return 60}render(){var e=this.props,t=e.status,a=e.componentPermissions,l=e.socket,s=this.state,r=s.resourcesLoading,i=s.logList,o=s.memory,d=s.beanData,u=s.dataList,c=s.new_pods,p=s.old_pods,h=s.runLoading,m=s.more,f=s.disk,g=s.buildSource,v=s.isopenLog,y=s.recordLoading,E=s.has_next,b=s.current_version,C=s.pages,S=s.pageSize,k=s.total;return _.default.createElement(_.Fragment,null,_.default.createElement(D.default,{buildSource:g,beanData:d,resourcesLoading:r,memory:o,disk:f,dataList:u,status:t,onPageChange:this.onPageChange,handleMore:this.handleMore,more:m,socket:l&&l}),m&&_.default.createElement(P.default,{componentPermissions:a,beanData:d,current_version:b,dataList:u,onPageChange:this.onPageChange,onShowSizeChange:this.onShowSizeChange,handleDel:this.handleDel,onRollback:this.handleRollback,socket:l&&l,pages:C,pageSize:S,total:k}),!m&&_.default.createElement(n.default,{bordered:0,loading:h,title:"\u8fd0\u884c\u5b9e\u4f8b",style:{margin:"20px 0",minHeight:"170px"},bodyStyle:{padding:"0",background:"#F0F2F5"}},_.default.createElement(M.default,{status:t,runLoading:h,new_pods:c,old_pods:p,appAlias:this.props.appAlias,socket:l&&l})),!m&&_.default.createElement(T.default,{socket:l&&l,isopenLog:v,onLogPush:this.onLogPush,has_next:E,logList:i,recordLoading:y,handleNextPage:this.handleNextPage}))}},h.contextTypes={isActionIng:v.default.func,appRolback:v.default.func},p=m))||p);t.default=R},"760Q":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("y8nQ");var r,i,o,d=l(a("Vl3Y")),u=s(a("q1tI")),c=l(a("ll25")),p=d.default.Item,h=(r=d.default.create(),r((o=class extends u.PureComponent{constructor(){super(...arguments),this.onCancel=(()=>{this.props.onCancel()}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onSubmit(t)})})}render(){var e=this.props.form.getFieldDecorator,t=this.props,a=t.actions,l=t.value;return u.default.createElement(n.default,{title:"\u7f16\u8f91\u6743\u9650",visible:!0,onOk:this.handleSubmit,maskClosable:!1,onCancel:this.onCancel},u.default.createElement(d.default,{onSubmit:this.handleSubmit},u.default.createElement(p,{label:""},e("perm_ids",{initialValue:l,rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(u.default.createElement(c.default,{showGroupName:!1,hides:["\u56e2\u961f\u76f8\u5173"],datas:a})))))}},i=o))||i);t.default=h},"8Drs":function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var s=l(a("bx4M"));a("/xke");var n=l(a("TeRw")),r=l(a("p0pE"));a("y8nQ");var i,o,d,u,c=l(a("Vl3Y")),p=a("MuoO"),h=l(a("q1tI")),m=l(a("CQXj")),f=l(a("QDog")),g=l(a("Bg2k")),v=(i=(0,p.connect)(e=>{var t=e.user,a=e.appControl,l=e.teamControl;return{currUser:t.currentUser,innerEnvs:a.innerEnvs,startProbe:a.startProbe,runningProbe:a.runningProbe,ports:a.ports,baseInfo:a.baseInfo,appDetail:a.appDetail,teamControl:l,appControl:a}},null,null,{withRef:!0}),o=c.default.create(),i(d=o((u=class extends h.default.Component{constructor(e){super(e),this.handleParameter=(()=>{return{team_name:f.default.getCurrTeamName(),app_alias:this.props.appAlias}}),this.handleGetList=(()=>{var e=this.props.dispatch;e({type:"appControl/getInstanceList",payload:this.handleParameter(),callback:e=>{this.setState({list:e&&e.list||[],loading:!1})}})}),this.fetchInterface=(e=>{var t=this.props.dispatch;t({type:e,payload:this.handleParameter()})}),this.fetchBaseInfo=(()=>{this.fetchInterface("appControl/fetchBaseInfo")}),this.fetchPorts=(()=>{this.fetchInterface("appControl/fetchPorts")}),this.fetchTags=(()=>{this.fetchInterface("appControl/fetchTags")}),this.handleSubmitEdit=(e=>{this.setState({healthCheckLoading:!0});var t=this.props,a=t.startProbe,l=t.dispatch;l({type:"appControl/editStartProbe",payload:(0,r.default)({},this.handleParameter(),e,{old_mode:a.mode}),callback:e=>{this.handleCancel(),this.fetchStartProbe(),e&&e.status_code&&200===e.status_code&&n.default.info({message:"\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"})}})}),this.handleCancel=(()=>{this.setState({showHealth:!1,healthCheckLoading:!1})}),this.openCancel=(()=>{this.setState({showHealth:!0})}),this.handleState=(()=>{var e=this.state.list||[{status:"-"}],t=0,a=0,l=0,s="";return e.map(e=>{var n=e.status;return"healthy"==n?t++:"unhealthy"==n?a++:"Unknown"==n||"unknown"==n?l++:s="-",e}),0!=t&&0==a&&0===l&&0===l&&""==s?h.default.createElement("span",null,"(",h.default.createElement("span",{style:{color:"green"}},"\u5065\u5eb7"),")"):0==t||0==a&&0==l?0==t&&0!=a&&0==l&&""==s?h.default.createElement("span",null,"(",h.default.createElement("span",{style:{color:"red"}},"\u4e0d\u5065\u5eb7"),")"):0==t&&0==a&&0!=l&&""==s?"(\u672a\u77e5)":"(-)":h.default.createElement("span",null,"(",h.default.createElement("span",{style:{color:"green"}},"\u90e8\u5206\u5065\u5eb7"),")")}),this.handleStartProbeStart=(e=>{var t=this.props,a=t.startProbe,l=t.dispatch;l({type:"appControl/editStartProbe",payload:(0,r.default)({},this.handleParameter(),a,{is_used:e}),callback:e=>{e&&e.status_code&&200===e.status_code&&n.default.info({message:"\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.fetchStartProbe()}})}),this.state={showHealth:!1,loading:!0,list:[]}}componentDidMount(){this.props.dispatch({type:"teamControl/fetchAllPerm"}),this.fetchStartProbe(),this.fetchPorts(),this.fetchBaseInfo(),this.fetchTags(),this.handleGetList()}fetchStartProbe(){this.fetchInterface("appControl/fetchStartProbe")}render(){var e=this.props,t=e.baseInfo,a=e.startProbe,l=e.ports;if("boolean"!==typeof t.build_upgrade)return null;var n=this.state,r=n.showHealth,i=n.loading,o=n.healthCheckLoading,d={readiness:"\u4e0b\u7ebf",liveness:"\u91cd\u542f"},u="{}"!=JSON.stringify(a),c={width:"33%",textAlign:"center"};return h.default.createElement("div",null,a&&h.default.createElement(s.default,{loading:i,title:h.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},"\u5065\u5eb7\u68c0\u6d4b",h.default.createElement("div",null,a&&h.default.createElement("a",{style:{marginRight:"5px",fontSize:"14px",fontWeight:400},onClick:()=>{this.openCancel()}},u?"\u7f16\u8f91":"\u8bbe\u7f6e"),u&&m.default.isStartProbeStart(a)?h.default.createElement("a",{onClick:()=>{this.handleStartProbeStart(!1)},style:{marginRight:"5px",fontSize:"14px",fontWeight:400},href:"javascript:;"},"\u7981\u7528"):u&&h.default.createElement("a",{onClick:()=>{this.handleStartProbeStart(!0)},style:{marginRight:"5px",fontSize:"14px",fontWeight:400},href:"javascript:;"},"\u542f\u7528")))},a&&h.default.createElement("div",{style:{display:"flex"}},h.default.createElement("div",{style:c},"\u5f53\u524d\u72b6\u6001:",this.handleState()),h.default.createElement("div",{style:c},"\u68c0\u6d4b\u65b9\u5f0f:",a.scheme||"\u672a\u8bbe\u7f6e"),h.default.createElement("div",{style:c},"\u4e0d\u5065\u5eb7\u5904\u7406\u65b9\u5f0f:",d[a.mode]||"\u672a\u8bbe\u7f6e"))),r&&h.default.createElement(g.default,{title:"\u5065\u5eb7\u68c0\u6d4b",types:"third",ports:l,loading:o,data:a,onOk:this.handleSubmitEdit,onCancel:this.handleCancel}))}},d=u))||d)||d);t.default=v},"8N5S":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5Dmo");var n=l(a("3S7+"));a("IzEo");var r=l(a("bx4M"));a("g9YV");var i=l(a("wCAj"));a("+L6B");var o=l(a("2/Rp"));a("Pwec");var d=l(a("CtXQ"));a("14J3");var u=l(a("BMrR"));a("jCWc");var c=l(a("kPKH"));a("fOrg");var p=l(a("+KLJ"));a("/xke");var h,m,f,g=l(a("TeRw")),v=l(a("p0pE")),_=a("MuoO"),y=a("7DNP"),E=s(a("q1tI")),b=l(a("Zxzx")),C=l(a("7C1b")),S=l(a("q76B")),k=l(a("cUW5")),w=l(a("gOyy")),A=l(a("puxM")),x=a("xpXo"),D=l(a("QDog")),T=a("+n12"),P=(h=(0,_.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,volumes:a.volumes,appBaseInfo:a.baseInfo}},null,null,{withRef:!0}),h((f=class extends E.PureComponent{constructor(e){super(e),this.onDeleteMnt=(e=>{this.setState({toDeleteMnt:e})}),this.onDeleteVolume=(e=>{this.setState({toDeleteVolume:e})}),this.onEditVolume=(e=>{this.setState({showAddVar:e,editor:e})}),this.onCancelDeleteVolume=(()=>{this.setState({toDeleteVolume:null})}),this.getVolumeTypeShowName=(e=>{var t=this.state.volumeOpts;return(0,T.getVolumeTypeShowName)(t,e)}),this.handleOpenRelyComponent=(e=>{this.setState({relyComponent:!0,relyComponentList:e})}),this.handleCloseRelyComponent=(()=>{this.setState({relyComponent:!1,relyComponentList:[]})}),this.fetchVolumes=(()=>{this.props.dispatch({type:"appControl/fetchVolumes",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,is_config:!1}})}),this.fetchVolumeOpts=(()=>{this.props.dispatch({type:"appControl/fetchVolumeOpts",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{e&&this.setState({volumeOpts:e.list||[]})}})}),this.fetchBaseInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchBaseInfo",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias}})}),this.loadMntList=(()=>{(0,x.getMnt)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,page:1,page_size:1e3,volume_type:["share-file","memoryfs","local"],type:"mnt"}).then(e=>{e&&this.setState({mntList:e.list||[]})})}),this.handleAddVar=(()=>{this.setState({showAddVar:{new:!0}})}),this.handleCancelAddVar=(()=>{this.setState({showAddVar:null,editor:null})}),this.handleSubmitAddVar=(e=>{this.fetchBaseInfo();var t=this.state.editor;t?this.props.dispatch({type:"appControl/editorVolume",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,new_volume_path:e.volume_path,new_file_content:e.file_content,ID:t.ID},callback:()=>{this.fetchVolumes(),this.handleCancelAddVar(),this.props.onshowRestartTips(!0),this.remindInfo()}}):this.props.dispatch({type:"appControl/addVolume",payload:(0,v.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:()=>{this.fetchVolumes(),this.handleCancelAddVar(),this.props.onshowRestartTips(!0),this.remindInfo()}})}),this.remindInfo=(()=>{var e=this.props.appBaseInfo;e&&e.extend_method&&D.default.isStateComponent(e.extend_method)?g.default.warning({message:E.default.createElement("div",null,"\u6709\u72b6\u6001\u7ec4\u4ef6\u5b58\u50a8\u914d\u7f6e\u53d1\u751f\u53d8\u5316\u540e",E.default.createElement("br",null),"\u9700\u8981\u91cd\u542f\u7ec4\u4ef6\u624d\u80fd\u751f\u6548!")}):g.default.success({message:"\u64cd\u4f5c\u6210\u529f"})}),this.showAddRelation=(()=>{this.loadMntList(),this.setState({showAddRelation:!0})}),this.handleCancelAddRelation=(()=>{this.loadMntList(),this.setState({showAddRelation:!1})}),this.handleSubmitAddMnt=(e=>{(0,x.addMnt)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,body:e}).then(e=>{e&&(this.handleCancelAddRelation(),g.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0))})}),this.handleDeleteVolume=(()=>{this.props.dispatch({type:"appControl/deleteVolume",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,volume_id:this.state.toDeleteVolume.ID},callback:()=>{this.onCancelDeleteVolume(),this.fetchVolumes(),g.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleDeleteMnt=(()=>{this.props.dispatch({type:"appControl/deleteMnt",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,dep_vol_id:this.state.toDeleteMnt.dep_vol_id},callback:()=>{this.cancelDeleteMnt(),this.loadMntList(),g.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.cancelDeleteMnt=(()=>{this.setState({toDeleteMnt:null})}),this.state={showAddVar:null,showAddRelation:!1,mntList:[],toDeleteMnt:null,toDeleteVolume:null,editor:null,volumeOpts:[],relyComponent:!1,relyComponentList:[]}}componentDidMount(){this.fetchVolumeOpts(),this.loadMntList(),this.fetchVolumes(),this.fetchBaseInfo()}canView(){var e=this.props.componentPermissions.isStorage;return e}render(){var e=this.state,t=e.mntList,a=e.relyComponent,l=e.relyComponentList,s=this.props.volumes;return this.canView()?E.default.createElement(E.Fragment,null,E.default.createElement(u.default,null,E.default.createElement(c.default,{span:12},E.default.createElement(p.default,{showIcon:!0,message:"\u5b58\u50a8\u914d\u7f6e\u53d1\u751f\u53d8\u5316\u540e\u9700\u8981\u66f4\u65b0\u7ec4\u4ef6\u624d\u80fd\u751f\u6548",type:"info",style:{marginBottom:24}}))),E.default.createElement(r.default,{style:{marginBottom:24},title:E.default.createElement("span",null," \u5b58\u50a8\u8bbe\u7f6e "),extra:E.default.createElement(o.default,{onClick:this.handleAddVar},E.default.createElement(d.default,{type:"plus"}),"\u6dfb\u52a0\u5b58\u50a8")},E.default.createElement(A.default,{sm:650},E.default.createElement(i.default,{pagination:!1,columns:[{title:"\u5b58\u50a8\u540d\u79f0",dataIndex:"volume_name",render:(e,t)=>{return E.default.createElement("span",{style:{cursor:"pointer",color:t.dep_services&&"#1890ff"},onClick:()=>{t.dep_services&&this.handleOpenRelyComponent(t.dep_services)}},e)}},{title:"\u6302\u8f7d\u8def\u5f84",dataIndex:"volume_path"},{title:"\u5b58\u50a8\u7c7b\u578b",dataIndex:"volume_type",render:e=>{return E.default.createElement("span",null,this.getVolumeTypeShowName(e))}},{title:"\u5b58\u50a8\u5bb9\u91cf",dataIndex:"volume_capacity",render:e=>{return 0==e?E.default.createElement("span",null,"\u4e0d\u9650\u5236"):E.default.createElement("span",null,e,"GB")}},{title:"\u72b6\u6001",dataIndex:"status",render:e=>{return"not_bound"==e?E.default.createElement("span",{style:{color:"red"}},"\u672a\u6302\u8f7d"):E.default.createElement("span",{style:{color:"green"}},"\u5df2\u6302\u8f7d")}},{title:"\u64cd\u4f5c",dataIndex:"action",render:(e,t)=>E.default.createElement("div",null,E.default.createElement("a",{onClick:()=>{this.onDeleteVolume(t)},href:"javascript:;"},"\u5220\u9664"),E.default.createElement("a",{onClick:()=>{this.onEditVolume(t)},href:"javascript:;"},"\u7f16\u8f91"))}],dataSource:s}))),E.default.createElement(r.default,{title:E.default.createElement("span",null," \u5171\u4eab\u5176\u4ed6\u7ec4\u4ef6\u5b58\u50a8 "),extra:E.default.createElement(o.default,{onClick:this.showAddRelation},E.default.createElement(d.default,{type:"plus"}),"\u6302\u8f7d\u5171\u4eab\u5b58\u50a8")},E.default.createElement(A.default,{sm:850},E.default.createElement(i.default,{pagination:!1,columns:[{title:"\u672c\u5730\u6302\u8f7d\u8def\u5f84",dataIndex:"local_vol_path",key:"1",width:"20%",render:e=>E.default.createElement(n.default,{title:e},E.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e))},{title:"\u76ee\u6807\u5b58\u50a8\u540d\u79f0",dataIndex:"dep_vol_name",key:"2",width:"15%",render:e=>E.default.createElement(n.default,{title:e},E.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e))},{title:"\u76ee\u6807\u6302\u8f7d\u8def\u5f84",dataIndex:"dep_vol_path",key:"3",width:"15%",render:e=>E.default.createElement(n.default,{title:e},E.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e))},{title:"\u76ee\u6807\u5b58\u50a8\u7c7b\u578b",dataIndex:"dep_vol_type",key:"4",width:"10%",render:e=>{return E.default.createElement("span",null,this.getVolumeTypeShowName(e))}},{title:"\u76ee\u6807\u6240\u5c5e\u7ec4\u4ef6",dataIndex:"dep_app_name",key:"5",width:"10%",render:(e,t)=>E.default.createElement(y.Link,{to:"/team/".concat(D.default.getCurrTeamName(),"/region/").concat(D.default.getCurrRegionName(),"/components/").concat(t.dep_app_alias,"/overview")},e)},{title:"\u76ee\u6807\u7ec4\u4ef6\u6240\u5c5e\u5e94\u7528",dataIndex:"dep_app_group",key:"6",width:"15%",render:(e,t)=>E.default.createElement(y.Link,{to:"/team/".concat(D.default.getCurrTeamName(),"/region/").concat(D.default.getCurrRegionName(),"/apps/").concat(t.dep_group_id)},e)},{title:"\u64cd\u4f5c",dataIndex:"action",key:"7",width:"15%",render:(e,t)=>E.default.createElement("a",{onClick:()=>{this.onDeleteMnt(t)},href:"javascript:;"},"\u53d6\u6d88\u6302\u8f7d")}],dataSource:t}))),this.state.showAddVar&&E.default.createElement(b.default,{onCancel:this.handleCancelAddVar,onSubmit:this.handleSubmitAddVar,data:this.state.showAddVar,volumeOpts:this.state.volumeOpts,editor:this.state.editor}),this.state.showAddRelation&&E.default.createElement(C.default,{appAlias:this.props.appAlias,onCancel:this.handleCancelAddRelation,onSubmit:this.handleSubmitAddMnt,volume_type:["share-file","memoryfs","local"]}),this.state.toDeleteMnt&&E.default.createElement(S.default,{title:"\u53d6\u6d88\u6302\u8f7d",desc:"\u786e\u5b9a\u8981\u53d6\u6d88\u6b64\u6302\u8f7d\u76ee\u5f55\u5417?",onCancel:this.cancelDeleteMnt,onOk:this.handleDeleteMnt}),this.state.toDeleteVolume&&E.default.createElement(S.default,{title:"\u5220\u9664\u5b58\u50a8\u76ee\u5f55",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u5b58\u50a8\u76ee\u5f55\u5417?",onCancel:this.onCancelDeleteVolume,onOk:this.handleDeleteVolume}),a&&E.default.createElement(w.default,{title:"\u5b58\u50a8\u88ab\u4f9d\u8d56\u7684\u7ec4\u4ef6",relyComponentList:l,onCancel:this.handleCloseRelyComponent,onOk:this.handleCloseRelyComponent})):E.default.createElement(k.default,null)}},m=f))||m);t.default=P},"8kxS":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("jehZ"));a("fOrg");var r=l(a("+KLJ"));a("5Dmo");var i=l(a("3S7+"));a("Awhp");var o=l(a("KrTs"));a("+L6B");var d=l(a("2/Rp"));a("/zsF");var u=l(a("PArb"));a("Pwec");var c=l(a("CtXQ")),p=l(a("p0pE"));a("5NDa");var h=l(a("5rEg"));a("2qtc");var m=l(a("kLXV"));a("/xke");var f=l(a("TeRw"));a("7Kak");var g=l(a("9yH6"));a("OaEy");var v=l(a("2fM7"));a("y8nQ");var _,y,E,b,C,S,k,w,A,x,D,T,P,M,N,I,R,L=l(a("Vl3Y")),O=a("MuoO"),V=a("7DNP"),B=l(a("17x9")),q=s(a("q1tI")),F=l(a("q76B")),U=l(a("e6Ls")),z=l(a("iPMB")),H=l(a("hJQD")),j=l(a("XZXw")),Q=a("xpXo"),X=l(a("lpA0")),W=l(a("DPVJ")),K=l(a("WTXe")),Y=a("vSx2"),G=l(a("J5jb")),J=l(a("QDog")),Z=l(a("rIpq")),$=l(a("hMqj")),ee=l(a("zcww")),te=l(a("+iC2")),ae=l(a("3A2o")),le=l(a("sC1O")),se=l(a("ZwJH")),ne=l(a("LrcT")),re=l(a("+aXB")),ie=l(a("8Drs")),oe=l(a("8N5S")),de=l(a("YoF6")),ue=l(a("6mLI")),ce=l(a("308x")),pe=l(a("dhX0")),he=l(a("Szue")),me=l(a("Lo2C")),fe=l(a("Lu99")),ge=l(a("vX3j")),ve=L.default.Item,_e=v.default.Option,ye=g.default.Group,Ee=(_=L.default.create(),y=(0,O.connect)(null,null,null,{withRef:!0}),_(E=y((b=class extends q.PureComponent{constructor(){super(...arguments),this.onCancel=(()=>{this.props.onCancel()}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.currGroup;a.validateFields((e,t)=>{e||(t.group_id!==l?this.props.onOk(t):f.default.warning({message:"\u4e0d\u80fd\u9009\u62e9\u5f53\u524d\u6240\u5728\u5e94\u7528"}))})})}render(){var e=this.props,t=e.groups,a=void 0===t?[]:t,l=e.currGroup,s=e.form,n=e.loading,r=void 0!==n&&n,i=s.getFieldDecorator,o=l.toString();return q.default.createElement(m.default,{title:"\u4fee\u6539\u7ec4\u4ef6\u6240\u5c5e\u5e94\u7528",visible:!0,className:U.default.TelescopicModal,onOk:this.handleSubmit,onCancel:this.onCancel,confirmLoading:r},q.default.createElement(L.default,{onSubmit:this.handleSubmit},q.default.createElement(ve,{label:""},i("group_id",{initialValue:o||"",rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(q.default.createElement(v.default,{getPopupContainer:e=>e.parentNode},a&&a.length>0&&a.map(e=>{return q.default.createElement(_e,{key:e.group_id,value:e.group_id.toString()},e.group_name)}))))))}},E=b))||E)||E),be=(C=L.default.create(),S=(0,O.connect)(null,null,null,{withRef:!0}),C(k=S((w=class extends q.PureComponent{constructor(){super(...arguments),this.onCancel=(()=>{this.props.onCancel()}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onOk(t)})}),this.handleValiateNameSpace=((e,t,a)=>{if(!t)return a(new Error("\u8bf7\u8f93\u5165\u7ec4\u4ef6\u82f1\u6587\u540d\u79f0"));if(t&&t.length<=32){var l=/^[a-z]([-a-z0-9]*[a-z0-9])?$/;if(!l.test(t))return a(new Error("\u53ea\u652f\u6301\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u6216\u201c-\u201d\uff0c\u5e76\u4e14\u5fc5\u987b\u4ee5\u5b57\u6bcd\u5f00\u59cb\u3001\u4ee5\u6570\u5b57\u6216\u5b57\u6bcd\u7ed3\u5c3e"));a()}return t.length>32?a(new Error("\u4e0d\u80fd\u5927\u4e8e32\u4e2a\u5b57\u7b26")):void 0})}render(){var e=this.props,t=e.title,a=e.name,l=e.loading,s=void 0!==l&&l,n=e.form,r=e.k8sComponentName,i=e.isEditEnglishName,o="closed"===i||"undeploy"===i,d=n.getFieldDecorator;return q.default.createElement(m.default,{title:t||"\u4fee\u6539\u7ec4\u4ef6\u540d\u79f0",visible:!0,className:U.default.TelescopicModal,confirmLoading:s,onOk:this.handleSubmit,onCancel:this.onCancel},q.default.createElement(L.default,{onSubmit:this.handleSubmit},q.default.createElement(ve,{label:"\u7ec4\u4ef6\u540d\u79f0"},d("service_cname",{initialValue:a||"",rules:[{required:!0,message:"\u7ec4\u4ef6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\u3002"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(q.default.createElement(h.default,{placeholder:t?"\u8bf7\u8f93\u5165\u65b0\u7684\u7ec4\u4ef6\u540d\u79f0":"\u8bf7\u8f93\u5165\u65b0\u7684\u5e94\u7528\u540d\u79f0"}))),q.default.createElement(ve,{label:"\u7ec4\u4ef6\u82f1\u6587\u540d\u79f0",extra:"\u5173\u95ed\u5f53\u524d\u7ec4\u4ef6\u65b9\u53ef\u4fee\u6539\u7ec4\u4ef6\u82f1\u6587\u540d\u79f0"},d("k8s_component_name",{initialValue:r||"",rules:[{required:!0,validator:this.handleValiateNameSpace}]})(q.default.createElement(h.default,{placeholder:"\u7ec4\u4ef6\u7684\u82f1\u6587\u540d\u79f0",disabled:!o})))))}},k=w))||k)||k),Ce=(A=L.default.create(),x=(0,O.connect)(e=>{var t=e.user,a=e.appControl,l=e.global,s=e.teamControl,n=e.enterprise,r=e.loading;return{currUser:t.currentUser,appDetail:a.appDetail,pods:a.pods,groups:l.groups,build_upgrade:a.build_upgrade,currentTeam:s.currentTeam,currentRegionName:s.currentRegionName,currentEnterprise:n.currentEnterprise,deleteAppLoading:r.effects["appControl/deleteApp"],reStartLoading:r.effects["appControl/putReStart"],startLoading:r.effects["appControl/putStart"],stopLoading:r.effects["appControl/putStop"],moveGroupLoading:r.effects["appControl/moveGroup"],editNameLoading:r.effects["appControl/editName"],updateRollingLoading:r.effects["appControl/putUpdateRolling"],deployLoading:r.effects["appControl/putUpgrade"],buildInformationLoading:r.effects["appControl/getBuildInformation"]}},null,null,{withRef:!0}),A(D=x((P=T=class extends q.PureComponent{constructor(e){var t;super(e),t=this,this.onDeleteApp=(()=>{this.setState({showDeleteApp:!0})}),this.getStatus=(e=>{var t=this.props.dispatch,a=this.state.componentTimer,l=this.fetchParameter(),s=l.team_name,n=l.app_alias;t({type:"appControl/fetchComponentState",payload:{team_name:s,app_alias:n},callback:t=>{t&&200===t.status_code&&this.setState({status:t.bean},()=>{e&&a&&this.handleTimers("timer",()=>{this.getStatus(!0)},5e3)})},handleError:t=>{this.handleError(t),e&&a&&404!==t.status&&this.handleTimers("timer",()=>{this.getStatus(!0)},1e4)}})}),this.getChildCom=(()=>{return this.ref?this.ref.getWrappedInstance({}):null}),this.handleTeamPermissions=(e=>{var t=this.props.currUser,a=te.default.getTeamByTeamPermissions(t.teams,J.default.getCurrTeamName());a&&0!==a.length?e():this.closeComponentTimer()}),this.handleError=(e=>{var t=this.state.componentTimer,a=this.props.dispatch,l=this.fetchParameter(),s=l.group_id;return this.handleTeamPermissions(()=>{return t?e&&404===e.status?(this.closeComponentTimer(),this.destroy||a(V.routerRedux.push("".concat(this.fetchPrefixUrl(),"apps/").concat(s))),null):void(e&&e.data&&e.data.msg_show&&f.default.warning({message:"\u8bf7\u6c42\u9519\u8bef",description:e.data.msg_show})):null}),null}),this.handleTimers=((e,t,a)=>{var l=this.state.componentTimer;if(!l)return null;this[e]=setTimeout(()=>{t()},a)}),this.handleTabChange=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),l=a.app_alias;t(V.routerRedux.push("".concat(this.fetchPrefixUrl(),"components/").concat(l,"/").concat(e)))}),this.closeTimer=(()=>{this.timer&&clearInterval(this.timer)}),this.loadBuildState=(e=>{var t=this.fetchParameter(),a=t.team_name,l=t.serviceAlias,s=this.props.dispatch;e&&e.service&&"market"===e.service.service_source&&s({type:"appControl/getBuildInformation",payload:{team_name:a,app_alias:l},callback:e=>{e&&200===e.status_code&&this.setState({BuildState:e.list&&e.list.length>0?e.list.length:null})}})}),this.fetchPrefixUrl=(()=>{var e=this.fetchParameter(),t=e.team_name,a=e.region_name;return"/team/".concat(t,"/region/").concat(a,"/")}),this.loadDetail=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.app_alias,l=t.team_name,s=t.group_id,n=t.serviceAlias,r=this.fetchPrefixUrl();e({type:"appControl/fetchDetail",payload:{team_name:l,app_alias:a},callback:t=>{this.fetchAppDetail(),this.loadBuildState(t),t.service.service_source&&this.setState({isShowThirdParty:!!t.is_third&&t.is_third}),X.default.isCreateComplete(t)||X.default.isMarketApp(t)?this.getStatus(!1):t.service&&"complete"===t.service.create_status?this.getStatus(!1):X.default.isCreateFromCompose(t)?e(V.routerRedux.replace("".concat(r,"create/create-compose-check/").concat(s,"/").concat(t.service.compose_id))):n&&e(V.routerRedux.replace("".concat(r,"create/create-check/").concat(n))),this.getWebSocketUrl(t.service.service_id)},handleError:t=>{var a=this.state.componentTimer;return a?(404===t.status&&e(V.routerRedux.push("".concat(r,"exception/404"))),null):null}})}),this.fetchParameter=(()=>{var e=this.props,t=e.appDetail,a=e.match,l=t&&t.service;return{app_alias:a&&a.params&&a.params.appAlias,team_name:J.default.getCurrTeamName(),region_name:J.default.getCurrRegionName(),serviceAlias:l&&l.service_alias,group_id:l&&l.group_id,group_name:l&&l.group_name,service_cname:l&&l.service_cname,k8s_component_name:l&&l.k8s_component_name}}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.team_name,l=t.region_name,s=t.group_id;e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:l,group_id:s},callback:e=>{e&&200===e.status_code&&this.setState({groupDetail:e.bean,loadingDetail:!1})},handleError:t=>{t&&404===t.code&&e(V.routerRedux.push("".concat(this.fetchPrefixUrl(),"apps")))}})}),this.handleshowDeployTips=(e=>{this.setState({showDeployTips:e})}),this.handleDeploy=(e=>{this.setState({showDeployTips:!1,showreStartTips:!1});var t=this.props,a=t.build_upgrade,l=t.dispatch,s=t.appDetail;if(this.state.actionIng)f.default.warning({message:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u540e"});else{var n=this.fetchParameter(),r=n.team_name,i=n.app_alias;l({type:e?"appControl/putUpgrade":"appControl/putDeploy",payload:{team_name:r,app_alias:i,group_version:e||"",is_upgrate:a},callback:e=>{if(e){this.handleCancelBuild(),this.loadBuildState(s),f.default.success({message:"\u64cd\u4f5c\u6210\u529f\uff0c\u90e8\u7f72\u4e2d"});var t=this.getChildCom();t&&t.onLogPush&&t.onLogPush(!0),t&&t.onAction&&t.onAction(e.bean)}this.handleOffHelpfulHints()}})}}),this.handleRollback=(e=>{if(this.state.actionIng)f.default.warning({message:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u540e"});else{var t=this.fetchParameter(),a=t.team_name,l=t.app_alias;(0,Q.rollback)({team_name:a,app_alias:l,deploy_version:e.build_version?e.build_version:e.deploy_version?e.deploy_version:"",upgrade_or_rollback:e.upgrade_or_rollback?e.upgrade_or_rollback:-1}).then(t=>{if(t){f.default.success({message:e.upgrade_or_rollback&&1==e.upgrade_or_rollback?"\u64cd\u4f5c\u6210\u529f\uff0c\u5347\u7ea7\u4e2d":"\u64cd\u4f5c\u6210\u529f\uff0c\u56de\u6eda\u4e2d"});var a=this.getChildCom();a&&a.onAction&&a.onAction(t.bean)}})}}),this.handleshowRestartTips=(e=>{this.setState({showreStartTips:e})}),this.saveRef=(e=>{this.ref=e}),this.handleDropClick=(e=>{"deleteApp"===e&&(this.closeComponentTimer(),this.onDeleteApp()),"moveGroup"===e&&this.showMoveGroup(),"restart"===e&&this.setState({promptModal:"restart"})}),this.closeComponentTimer=(()=>{this.setState({componentTimer:!1}),this.closeTimer()}),this.openComponentTimer=(()=>{this.setState({componentTimer:!0},()=>{this.getStatus(!0)})}),this.cancelDeleteApp=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.setState({showDeleteApp:!1}),e&&t.openComponentTimer()},this.handleDeleteApp=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.team_name,l=t.app_alias,s=t.group_id;e({type:"appControl/deleteApp",payload:{team_name:a,app_alias:l},callback:()=>{this.closeComponentTimer(),this.cancelDeleteApp(!1),e({type:"global/fetchGroups",payload:{team_name:a}}),e(V.routerRedux.replace("".concat(this.fetchPrefixUrl(),"apps/").concat(s)))}})}),this.showEditName=(()=>{this.setState({showEditName:!0})}),this.hideEditName=(()=>{this.setState({showEditName:!1})}),this.handleEditName=(e=>{var t=this.fetchParameter(),a=t.team_name,l=t.serviceAlias,s=t.group_id,n=this.props.dispatch;n({type:"appControl/editName",payload:(0,p.default)({team_name:a,app_alias:l},e),callback:()=>{n({type:"application/editGroups",payload:{team_name:a,group_id:s},callback:e=>{f.default.success({message:"\u91cd\u542f\u5e94\u7528\u540e\u751f\u6548"})}}),this.handleUpDataHeader(),this.loadDetail(),this.hideEditName()}})}),this.handleUpDataHeader=(()=>{var e=this.props.dispatch;e({type:"global/IsUpDataHeader",payload:{isUpData:!0}})}),this.showMoveGroup=(()=>{this.setState({showMoveGroup:!0})}),this.hideMoveGroup=(()=>{this.setState({showMoveGroup:!1})}),this.handleMoveGroup=(e=>{var t=this.fetchParameter(),a=t.team_name,l=t.serviceAlias,s=this.props.dispatch;s({type:"appControl/moveGroup",payload:(0,p.default)({team_name:a,app_alias:l},e),callback:()=>{this.hideMoveGroup(),this.loadDetail(),s({type:"global/fetchGroups",payload:{team_name:a}}),f.default.success({message:"\u64cd\u4f5c\u6210\u529f"})}})}),this.handleOperation=(e=>{var t=this.props.dispatch,a=this.state.actionIng;if("putUpdateRolling"===e?this.setState({showDeployTips:!1,showreStartTips:!1}):"putReStart"===e&&this.setState({showreStartTips:!1}),a)f.default.warning({message:"\u6b63\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u8bf7\u7a0d\u540e"});else{var l={putReStart:"\u64cd\u4f5c\u6210\u529f\uff0c\u91cd\u542f\u4e2d",putStart:"\u64cd\u4f5c\u6210\u529f\uff0c\u542f\u52a8\u4e2d",putStop:"\u64cd\u4f5c\u6210\u529f\uff0c\u5173\u95ed\u4e2d",putUpdateRolling:"\u64cd\u4f5c\u6210\u529f\uff0c\u66f4\u65b0\u4e2d"},s=this.fetchParameter(),n=s.team_name,r=s.app_alias;t({type:"appControl/".concat(e),payload:{team_name:n,app_alias:r},callback:t=>{if(t){f.default.success({message:l[e]});var a=this.getChildCom();a&&a.onAction&&a.onAction(t.bean)}this.handleOffHelpfulHints()}})}}),this.handleChecked=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),l=a.team_name,s=a.app_alias;t({type:"appControl/changeApplicationState",payload:{build_upgrade:e,team_name:l,app_alias:s},callback:e=>{e&&f.default.info({message:"\u4fee\u6539\u6210\u529f"})}})}),this.handleOkBuild=(()=>{this.props.form.validateFields((e,t)=>{e||this.handleDeploy(t.group_version)})}),this.handleOpenBuild=(()=>{var e=this.props,t=e.appDetail,a=e.dispatch;console.log(t,"appDetail");var l=t.service.service_source,s=t.rain_app_name,n=this.state.status,r=this.fetchParameter(),i=r.team_name,o=r.serviceAlias;"market"===l&&n&&"undeploy"!==n.status?a({type:"appControl/getBuildInformation",payload:{team_name:i,app_alias:o},callback:e=>{e&&200===e.status_code&&this.setState({BuildList:e.list,visibleBuild:!0,BuildText:s,BuildState:e.list&&e.list.length>0?e.list.length:null,showApp:{details:!1,group_name:s}})}}):this.handleOpenHelpfulHints("deploy")}),this.handleCancelBuild=(()=>{this.setState({visibleBuild:null,BuildText:""})}),this.hideMarketAppDetail=(()=>{this.setState({showMarketAppDetail:null})}),this.hideMarketOpenAppDetail=(()=>{this.setState({showMarketAppDetail:!0})}),this.handleOpenHelpfulHints=(e=>{this.setState({promptModal:e})}),this.handleOffHelpfulHints=(()=>{this.setState({promptModal:null})}),this.handleJumpAgain=(()=>{var e=this.state.promptModal;if("deploy"===e)return this.handleDeploy(),null;var t="stop"===e?"putStop":"start"===e?"putStart":"restart"===e?"putReStart":"rolling"===e?"putUpdateRolling":"";this.handleOperation(t)}),this.toWebConsole=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.serviceAlias;e(V.routerRedux.replace("".concat(this.fetchPrefixUrl(),"components/").concat(a,"/webconsole")))}),this.state={actionIng:!1,groupDetail:{},loadingDetail:!0,status:{},showDeleteApp:!1,showEditName:!1,showMoveGroup:!1,visibleBuild:null,BuildText:"",BuildList:[],showMarketAppDetail:null,showApp:{},BuildState:null,isShowThirdParty:!1,promptModal:null,websocketURL:"",componentTimer:!0},this.socket=null,this.destroy=!1}getChildContext(){return{isActionIng:e=>{this.setState({actionIng:e})},appRolback:e=>{this.handleRollback(e)}}}componentDidMount(){this.loadDetail(),setTimeout(()=>{this.getStatus(!0)},5e3)}componentWillUnmount(){this.closeComponentTimer(),this.props.dispatch({type:"appControl/clearPods"}),this.props.dispatch({type:"appControl/clearDetail"}),this.socket&&(this.socket.destroy(),this.socket=null),this.destroy=!0}getWebSocketUrl(e){var t=te.default.getTeamByTeamName(this.props.currUser,J.default.getCurrTeamName()),a=J.default.getCurrRegionName();if(t){var l=ee.default.getRegionByName(t,a);if(l){var s=Z.default.getNewWebSocketUrl(l,e);this.setState({websocketURL:s},()=>{this.createSocket()})}}}createSocket(){var e=this.props.appDetail,t=this.state.websocketURL;if(t){var a=G.default.isWebSocketOpen(t);a&&"through"===a&&(this.socket=new W.default({url:t,serviceId:e.service.service_id,isAutoConnect:!0,destroyed:!1}))}}renderTitle(e){var t=this.props,a=t.appDetail,l=t.componentPermissions,s=l.isRestart,n=l.isStop,r=l.isDelete,i=l.isEdit,o=t.appPermissions.isEdit,d=this.state,p=d.status,h=d.groupDetail,m=d.loadingDetail,f=h&&h.app_type&&"helm"===h.app_type;return q.default.createElement(q.Fragment,null,q.default.createElement("div",{style:{display:"flex"}},q.default.createElement("div",{style:{marginTop:"3px"}},J.default.fetchSvg("component")),q.default.createElement("div",{style:{marginLeft:"14px"}},q.default.createElement("div",{className:ne.default.contentTitle},e||"-",i&&q.default.createElement(c.default,{style:{cursor:"pointer"},onClick:this.showEditName,type:"edit"})),q.default.createElement("div",{className:ne.default.content_Box},!a.is_third&&s&&q.default.createElement("a",{onClick:()=>{K.default.canRestart(p)&&this.handleDropClick("restart")},style:{cursor:K.default.canRestart(p)?"pointer":"no-drop"}},"\u91cd\u542f"),!a.is_third&&s&&q.default.createElement(u.default,{type:"vertical"}),n&&!K.default.canStart(p)?q.default.createElement("span",null,q.default.createElement("a",{style:{cursor:K.default.canStop(p)?"pointer":"no-drop"},onClick:()=>{K.default.canStop(p)&&this.handleOpenHelpfulHints("stop")}},"\u5173\u95ed"),q.default.createElement(u.default,{type:"vertical"})):n&&p&&p.status&&"upgrade"===p.status?q.default.createElement("span",null,q.default.createElement("a",{onClick:()=>{this.handleOpenHelpfulHints("stop")}},"\u5173\u95ed"),q.default.createElement(u.default,{type:"vertical"})):null,o&&!m&&!f&&q.default.createElement("a",{onClick:()=>{this.handleDropClick("moveGroup")},style:{cursor:"pointer"}},"\u4fee\u6539\u6240\u5c5e\u5e94\u7528"),i&&!m&&!f&&q.default.createElement(u.default,{type:"vertical"}),r&&q.default.createElement("a",{onClick:()=>{this.handleDropClick("deleteApp")},style:{cursor:"pointer"}},"\u5220\u9664")))))}render(){var e=this.props,t=e.appDetail,a=e.currentEnterprise,l=e.currentTeam,s=e.currentRegionName,u=e.componentPermissions,c=u.isAccess,p=u.isStart,h=u.isVisitWebTerminal,f=u.isConstruct,v=u.isUpdate,_=u.isTelescopic,y=u.isEnv,E=u.isRely,b=u.isStorage,C=u.isPort,S=u.isPlugin,k=u.isSource,w=u.isDeploytype,A=u.isCharacteristic,x=u.isHealth,D=e.appPermissions,T=e.componentPermissions,P=e.groups,M=void 0===P?[]:P,N=e.form,I=e.deleteAppLoading,R=e.reStartLoading,O=e.startLoading,B=e.stopLoading,Q=e.moveGroupLoading,X=e.editNameLoading,W=e.updateRollingLoading,G=e.deployLoading,J=e.buildInformationLoading,Z=this.state,$=Z.BuildList,ee=Z.componentTimer,te=Z.isShowThirdParty,ve=Z.status,_e=Z.promptModal,Ce=Z.showDeleteApp,Se=Z.showEditName,ke=Z.showMoveGroup,we=Z.groupDetail,Ae=N.getFieldDecorator,xe=te?"\u66f4\u65b0":"\u66f4\u65b0(\u6eda\u52a8\uff09",De={start:"\u542f\u52a8",restart:"\u91cd\u542f",stop:"\u5173\u95ed",deploy:"\u6784\u5efa",rolling:xe};if(!t.service)return null;var Te=this.fetchParameter(),Pe=Te.serviceAlias,Me=Te.app_alias,Ne=Te.group_id,Ie=Te.group_name,Re=Te.service_cname,Le=Te.k8s_component_name,Oe=q.default.createElement(H.default,{timers:ee,btntype:"primary",app_alias:Me});if(!ve.status)return null;var Ve=q.default.createElement("div",null,p&&!K.default.canStop(ve)&&q.default.createElement(d.default,{disabled:!K.default.canStart(ve),onClick:()=>{this.handleOpenHelpfulHints("start")}},"\u542f\u52a8"),h&&!te&&q.default.createElement(d.default,null,q.default.createElement(V.Link,{to:"".concat(this.fetchPrefixUrl(),"components/").concat(Pe,"/webconsole"),target:"_blank"},"Web\u7ec8\u7aef")),te?"":this.state.BuildState&&f?q.default.createElement(i.default,{title:"\u6709\u65b0\u7248\u672c"},q.default.createElement(d.default,{onClick:this.handleOpenBuild,loading:J},q.default.createElement(o.default,{className:ne.default.badge,status:"success",text:"",count:"\u6709\u66f4\u65b0\u7248\u672c",title:"\u6709\u66f4\u65b0\u7248\u672c"}),"\u6784\u5efa")):ve&&"undeploy"===ve.status&&f?q.default.createElement(d.default,{onClick:this.handleOpenBuild,loading:J},"\u6784\u5efa"):f&&q.default.createElement(d.default,{onClick:this.handleOpenBuild,loading:J},"\u6784\u5efa"),"undeploy"===ve.status||"closed"===ve.status||"stopping"===ve.status?"":v&&q.default.createElement(d.default,{onClick:()=>{this.handleOpenHelpfulHints("rolling")}},xe),"market"===t.service.service_source&&K.default.canVisit(ve)&&!te&&c&&Oe,"market"!==t.service.service_source&&K.default.canVisit(ve)&&!te&&c&&Oe,te&&c&&Oe),Be=[{key:"overview",tab:"\u603b\u89c8"},{key:"monitor",tab:"\u76d1\u63a7"},{key:"log",tab:"\u65e5\u5fd7"}];_&&Be.push({key:"expansion",tab:"\u4f38\u7f29"}),y&&Be.push({key:"environmentConfiguration",tab:"\u73af\u5883\u914d\u7f6e"}),E&&Be.push({key:"relation",tab:"\u4f9d\u8d56"}),b&&Be.push({key:"mnt",tab:"\u5b58\u50a8"}),C&&Be.push({key:"port",tab:"\u7aef\u53e3"}),S&&Be.push({key:"plugin",tab:"\u63d2\u4ef6"}),k&&Be.push({key:"resource",tab:"\u6784\u5efa\u6e90"}),(w||A||x)&&Be.push({key:"setting",tab:"\u5176\u4ed6\u8bbe\u7f6e"});var qe=te?[{key:"thirdPartyServices",tab:"\u603b\u89c8"},{key:"port",tab:"\u7aef\u53e3"},{key:"connectionInformation",tab:"\u8fde\u63a5\u4fe1\u606f"},{key:"members",tab:"\u66f4\u591a\u8bbe\u7f6e"}]:Be,Fe={thirdPartyServices:ge.default,connectionInformation:ae.default,members:ie.default,overview:te?ge.default:ue.default,monitor:de.default,log:re.default,expansion:se.default,environmentConfiguration:le.default,relation:he.default,mnt:oe.default,port:pe.default,plugin:ce.default,resource:me.default,setting:fe.default},Ue=this.props.match.params.type;Ue||(Ue=te?"thirdPartyServices":"overview");var ze=Fe[Ue],He={labelCol:{span:1},wrapperCol:{span:23}},je=[];return je=(0,Y.createComponent)((0,Y.createApp)((0,Y.createTeam)((0,Y.createEnterprise)(je,a),l,s),l,s,{appName:Ie,appID:Ne}),l,s,{componentName:Re,componentID:Pe}),q.default.createElement(j.default,{breadcrumbList:je,action:Ve,title:this.renderTitle(Re),onTabChange:this.handleTabChange,tabActiveKey:Ue,tabList:qe},this.state.showMarketAppDetail&&q.default.createElement(z.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:this.state.showApp}),_e&&q.default.createElement(m.default,{title:"\u53cb\u60c5\u63d0\u793a",visible:_e,className:U.default.TelescopicModal,onOk:this.handleJumpAgain,onCancel:this.handleOffHelpfulHints,confirmLoading:"restart"===_e?R:"stop"===_e?B:"start"===_e?O:"deploy"===_e?G:"rolling"===_e?W:!_e},q.default.createElement("p",{style:{textAlign:"center"}},"\u786e\u5b9a",De[_e],"\u5f53\u524d\u7ec4\u4ef6\uff1f")),q.default.createElement(m.default,{title:[q.default.createElement("span",null,"\u4ece\u5e94\u7528\u5546\u5e97\u5347\u7ea7\u6784\u5efa")],className:U.default.TelescopicModal,visible:this.state.visibleBuild,onOk:this.handleOkBuild,onCancel:this.handleCancelBuild,afterClose:()=>{this.setState({BuildList:[]})},footer:$&&$.length>0&&f?[q.default.createElement(d.default,{onClick:()=>{this.handleCancelBuild()}},"\u53d6\u6d88"),q.default.createElement(d.default,{type:"primary",loading:G,onClick:()=>{this.handleOkBuild()}},"\u6784\u5efa")]:f&&[q.default.createElement(d.default,{onClick:()=>{this.handleCancelBuild()}},"\u53d6\u6d88"),q.default.createElement(d.default,{type:"primary",loading:G,onClick:()=>{this.handleOkBuild()}},"\u5f3a\u5236\u6784\u5efa")]},q.default.createElement("div",null,$&&$.length>0&&v?q.default.createElement(L.default,{onSubmit:this.handleOkBuild},q.default.createElement(r.default,{message:[q.default.createElement("span",null,"\u4ece\u5e94\u7528\u5546\u5e97\u5e94\u7528 "),q.default.createElement("a",{onClick:()=>{this.hideMarketOpenAppDetail()}},this.state.BuildText),q.default.createElement("span",null,"\u6784\u5efa\u800c\u6765,\u5f53\u524d\u4e91\u5e02\u5e94\u7528\u7248\u672c\u6709\u66f4\u65b0!")],type:"success",style:{marginBottom:"5px"}}),q.default.createElement(L.default.Item,(0,n.default)({},He,{label:""}),Ae("group_version",{initialValue:$[0],rules:[{required:!0,message:"\u9009\u62e9\u7248\u672c"}]})(q.default.createElement(ye,null,$.map((e,t)=>{return q.default.createElement("div",null,"\u7248\u672c:\xa0",q.default.createElement(g.default,{key:t,value:e},q.default.createElement("a",null,e),"\u53ef\u66f4\u65b0"))}))))):q.default.createElement(r.default,{message:"\u4e91\u5e02\u5e94\u7528\u6682\u672a\u6709\u65b0\u7248\u672c\u66f4\u65b0\uff0c\u60a8\u65e0\u9700\u6784\u5efa\u3002",type:"success",style:{marginBottom:"5px"}}))),ze?q.default.createElement(ze,(0,n.default)({groupDetail:we,appPermissions:D,componentPermissions:T,timers:ee,status:ve,ref:this.saveRef},this.props.match.params,this.props,{onshowDeployTips:e=>{this.handleshowDeployTips(e)},onshowRestartTips:e=>{this.handleshowRestartTips(e)},socket:this.socket,onChecked:this.handleChecked})):"\u53c2\u6570\u9519\u8bef",Ce&&q.default.createElement(F.default,{onOk:this.handleDeleteApp,onCancel:this.cancelDeleteApp,loading:I,title:"\u5220\u9664\u7ec4\u4ef6",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u7ec4\u4ef6\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d"}),Se&&q.default.createElement(be,{loading:X,name:Re,onOk:this.handleEditName,onCancel:this.hideEditName,title:"\u4fee\u6539\u7ec4\u4ef6\u540d\u79f0",k8sComponentName:Le,isEditEnglishName:ve.status}),ke&&q.default.createElement(Ee,{loading:Q,currGroup:Ne,groups:M,onOk:this.handleMoveGroup,onCancel:this.hideMoveGroup}))}},T.childContextTypes={isActionIng:B.default.func,appRolback:B.default.func},D=P))||D)||D),Se=(M=L.default.create(),N=(0,O.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{pure:!1,withRef:!0}),M(I=N((R=class extends q.PureComponent{constructor(e){super(e),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return $.default.querySpecifiedPermissionsInfo(t,e)}),this.getAlias=(()=>{return this.props.match.params.appAlias}),this.flash=(()=>{this.setState({show:!1},()=>{this.setState({show:!0})})}),this.id="",this.state={show:!0,componentPermissions:this.handlePermissions("queryComponentInfo"),appPermissions:this.handlePermissions("queryAppInfo")}}componentWillMount(){var e=this.props.dispatch,t=this.state.componentPermissions.isAccess;t||J.default.withoutPermission(e)}componentDidMount(){}render(){return this.id!==this.getAlias()&&(this.id=this.getAlias(),this.flash()),this.state.show?q.default.createElement(Ce,(0,n.default)({},this.props,this.state)):null}},I=R))||I)||I);t.default=Se},"9/bS":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={isActioning(e){return!("complete"===e.final_status||"timeout"===e.final_status||!e.event_id)},getActionCN(e){return e.type_cn||""},getActionResultCN(e){var t,a={success:"\u5b8c\u6210",failure:"\u5931\u8d25",timeout:"\u8d85\u65f6",abnormal:"\u5f02\u5e38"},l={complate:"\u5b8c\u6210",timeout:"\u8d85\u65f6",failure:"\u5931\u8d25",timeout:"\u8d85\u65f6"};return t="complete"==e.final_status?a[e.status]:"timeout"==e.final_status?l[e.final_status]:"\u8fdb\u884c\u4e2d",t},getActionUser(e){return e.user_name||""},isFail(e){return!(!this.isComplete(e)||"failure"!==e.status)},isTimeout(e){return!(!this.isComplete(e)||"timeout"!==e.status)},isSuccess(e){return!(!this.isComplete(e)||"success"!==e.status)},isComplete(e){return"complete"===e.final_status},getFailMessage(e){return e.message||""},getCommitUser(e){return e.code_version?e.code_version.user:""},getCodeVersion(e){return e.code_version?e.code_version.code_version:""},getCommitLog(e){return e.code_version?e.code_version.commit:""},isDeploy(e){return"deploy"===e.type},isShowCommitInfo(e){return this.isDeploy(e)&&e.code_version},canRollback(e){return!(this.isFail(e)||!this.isDeploy(e)||!e.code_version||!e.code_version.rollback)},getRollbackVersion(e){return e},getActionTime(e){return(e.start_time||"").split(" ")[1]},getActionDate(e){return(e.start_time||"").split(" ")[0]},getActionDateTime(e){return e.start_time||""}},s=l;t.default=s},AFhn:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("g9YV");var r=l(a("wCAj"));a("14J3");var i=l(a("BMrR"));a("+L6B");var o=l(a("2/Rp"));a("jCWc");var d=l(a("kPKH"));a("fOrg");var u=l(a("+KLJ"));a("/xke");var c,p,h,m=l(a("TeRw")),f=l(a("p0pE")),g=l(a("QDog")),v=l(a("H6Z4")),_=l(a("q76B")),y=l(a("puxM")),E=l(a("hMqj")),b=a("MuoO"),C=s(a("q1tI")),S=(c=(0,b.connect)(e=>{var t=e.loading,a=e.teamControl,l=e.enterprise;return{deleteServiceMonitorLoading:t.effects["monitor/deleteServiceMonitor"],updateServiceMonitorLoading:t.effects["monitor/updateServiceMonitor"],addServiceMonitorLoading:t.effects["monitor/addServiceMonitor"],currentRegionName:a.currentRegionName,currentEnterprise:l.currentEnterprise,currentTeamPermissionsInfo:a.currentTeamPermissionsInfo}}),c((h=class extends C.PureComponent{constructor(e){super(e),this.onAddCustomMonitor=(()=>{this.setState({addCustomMonitor:!0})}),this.fetchServiceMonitor=(()=>{var e=this.props.dispatch,t=this.handleParameter();e({type:"monitor/fetchServiceMonitor",payload:t,callback:e=>{if(e&&200===e.status_code){var t=e.list;this.setState({loading:!1,monitors:t}),t&&0===t.length&&this.onAddCustomMonitor()}}})}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return E.default.querySpecifiedPermissionsInfo(t,e)}),this.cancelAddCustomMonitor=(()=>{this.setState({addCustomMonitor:!1,editorData:{}})}),this.handleDelete=(e=>{this.setState({dleCustomMonitor:e})}),this.handleDeleteCustomMonitor=(()=>{var e=this.props.dispatch,t=this.state.dleCustomMonitor,a=this.handleParameter();e({type:"monitor/deleteServiceMonitor",payload:(0,f.default)({},a,{name:t}),callback:e=>{e&&(m.default.success({message:"\u5220\u9664\u6210\u529f"}),this.fetchServiceMonitor(),this.cancelDeleteCustomMonitor())}})}),this.cancelDeleteCustomMonitor=(()=>{this.setState({dleCustomMonitor:!1})}),this.handleEditor=(e=>{this.setState({editorData:e,addCustomMonitor:!0})}),this.handleAddCustomMonitor=(e=>{var t=this.props.dispatch,a=this.state.editorData,l=this.handleParameter();t({type:a.name?"monitor/updateServiceMonitor":"monitor/addServiceMonitor",payload:(0,f.default)({},l,e),callback:e=>{e&&(m.default.success({message:a.name?"\u4fdd\u5b58\u6210\u529f":"\u6dfb\u52a0\u6210\u529f"}),this.fetchServiceMonitor(),this.cancelAddCustomMonitor())}})}),this.handleParameter=(()=>{var e=this.props.appDetail;return{team_name:g.default.getCurrTeamName(),app_alias:e.service.service_alias}}),this.state={monitors:[],addCustomMonitor:!1,loading:!0,editorData:{},dleCustomMonitor:!1,operationPermissions:this.handlePermissions("queryAppInfo")}}componentWillMount(){var e=this.props.dispatch,t=this.state.operationPermissions.isAccess;t||g.default.withoutPermission(e)}componentDidMount(){this.fetchServiceMonitor()}render(){var e=this.props,t=e.deleteServiceMonitorLoading,a=e.updateServiceMonitorLoading,l=e.addServiceMonitorLoading,s=e.onCancel,c=this.state,p=c.monitors,h=c.loading,m=c.editorData,f=c.addCustomMonitor,g=c.dleCustomMonitor,E=c.operationPermissions.isCreate;return C.default.createElement("div",null,C.default.createElement(i.default,null,C.default.createElement(d.default,{span:12},C.default.createElement(u.default,{message:"\u652f\u6301Prometheus\u7684metric\u76d1\u63a7\u6307\u6807\u89c4\u8303",type:"info",showIcon:!0})),E&&C.default.createElement(o.default,{type:"primary",icon:"plus",style:{float:"right",marginBottom:"20px"},onClick:this.onAddCustomMonitor},"\u6dfb\u52a0\u914d\u7f6e"),C.default.createElement(o.default,{style:{float:"right",margin:"0 10px 20px 0"},onClick:s},"\u8fd4\u56de\u76d1\u63a7\u56fe")),f&&C.default.createElement(v.default,{parameter:this.handleParameter(),data:m,loading:a||l,onCancel:this.cancelAddCustomMonitor,onOk:this.handleAddCustomMonitor}),C.default.createElement(n.default,{loading:h},g&&C.default.createElement(_.default,{title:"\u5220\u9664\u914d\u7f6e",desc:"\u786e\u5b9a\u8981\u5220\u9664\u914d\u7f6e?",loading:t,onCancel:this.cancelDeleteCustomMonitor,onOk:this.handleDeleteCustomMonitor}),C.default.createElement(y.default,{sm:800},C.default.createElement(r.default,{pagination:!1,dataSource:p,columns:[{title:"\u914d\u7f6e\u540d\u79f0",dataIndex:"name"},{title:"\u6536\u96c6\u4efb\u52a1\u540d\u79f0",dataIndex:"service_show_name",align:"center"},{title:"\u8def\u5f84",dataIndex:"path",align:"center"},{title:"\u7aef\u53e3",dataIndex:"port",align:"center"},{title:"\u6536\u96c6\u95f4\u9694\u65f6\u95f4",dataIndex:"interval",align:"center"},{title:"\u64cd\u4f5c",width:"200px",dataIndex:"backup_record_num",align:"center",render:(e,t)=>C.default.createElement(C.Fragment,null,C.default.createElement("a",{onClick:()=>this.handleDelete(t.name),style:{margintRight:10}},"\u5220\u9664"),C.default.createElement("a",{onClick:()=>{this.handleEditor(t)},style:{margintRight:10}},"\u7f16\u8f91"))}]}))))}},p=h))||p);t.default=S},AipW:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("OaEy");var i=l(a("2fM7"));a("y8nQ");var o,d,u,c,p=l(a("Vl3Y")),h=a("MuoO"),m=s(a("q1tI")),f=l(a("QDog")),g=l(a("ll25")),v=p.default.Item,_=(o=(0,h.connect)(e=>{var t=e.teamControl;return{teamControl:t}}),d=p.default.create(),o(u=d((c=class extends m.PureComponent{constructor(){super(...arguments),this.handleSubmit=(()=>{var e=this.props,t=e.onOk,a=e.form;a.validateFields((e,a)=>{!e&&t&&t(a)})}),this.loadMembers=(()=>{var e=this.props.dispatch;e({type:"teamControl/fetchMember",payload:{team_name:f.default.getCurrTeamName(),region_name:f.default.getCurrRegionName(),page_size:200}})})}componentDidMount(){this.loadMembers()}render(){var e=this.props,t=e.onCancel,a=e.actions,l=e.form,s=l.getFieldDecorator,o={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},d=a||[],u=this.props.members||[];return m.default.createElement(n.default,{title:"\u8bbe\u7f6e\u6210\u5458\u5e94\u7528\u6743\u9650",visible:!0,width:800,onOk:this.handleSubmit,onCancel:t,maskClosable:!1},m.default.createElement(p.default,{onSubmit:this.handleSubmit},m.default.createElement(v,(0,r.default)({},o,{label:"\u9009\u62e9\u6210\u5458",hasFeedback:!0}),s("user_ids",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u56e2\u961f\u6210\u5458"}]})(m.default.createElement(i.default,{getPopupContainer:e=>e.parentNode,mode:"multiple"},u.map((e,t)=>{return m.default.createElement(i.default.Option,{key:t,value:e.user_id},e.user_name)})))),m.default.createElement(v,(0,r.default)({},o,{label:"\u9009\u62e9\u6743\u9650"}),s("perm_ids",{initialValue:[],rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650"}]})(m.default.createElement(g.default,{showGroupName:!1,hides:["\u56e2\u961f\u76f8\u5173"],datas:d})))))}},u=c))||u)||u),y=_;t.default=y},BBei:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("Pwec");var r=l(a("CtXQ"));a("/zsF");var i=l(a("PArb"));a("5NDa");var o=l(a("5rEg")),d=l(a("jehZ"));a("fOrg");var u=l(a("+KLJ"));a("OaEy");var c=l(a("2fM7"));a("y8nQ");var p,h,m,f=l(a("Vl3Y")),g=a("7DNP"),v=s(a("q1tI")),_=l(a("QDog")),y=f.default.Item,E=c.default.Option,b=(p=f.default.create(),p((m=class extends v.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields({force:!0},(e,t)=>{e||this.props.onOk&&this.props.onOk(t)})}),this.handleCancel=(()=>{this.props.onCancel&&this.props.onCancel()}),this.checkKey=((e,t,a)=>{var l=this.props.form.getFieldValue("protocol");"http"!=l?"http"!=l&&t?a():a("\u8bf7\u9009\u62e9\u8bc1\u4e66!"):a()}),this.state={}}render(){var e=this.props.form,t=e.getFieldDecorator,a=e.getFieldValue,l={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}},s=a("protocol")||"http",p=this.props,h=p.isAddLicense,m=p.certificates,b=p.addLicense;return v.default.createElement(n.default,{title:"\u7ed1\u5b9a\u57df\u540d",onOk:this.handleSubmit,visible:!0,onCancel:this.handleCancel},v.default.createElement(u.default,{style:{textAlign:"center",marginBottom:16},message:"\u8bf7\u786e\u4fdd\u5c06\u57df\u540dcname\u6307\u5411\u5230\u672c\u7ec4\u4ef6\u7684\u5bf9\u5916\u670d\u52a1\u8bbf\u95ee\u5730\u5740",type:"warning"}),v.default.createElement(f.default,{onSubmit:this.handleSubmit},v.default.createElement(y,(0,d.default)({},l,{label:"\u534f\u8bae"}),t("protocol",{initialValue:"http",rules:[{required:!0,message:"\u8bf7\u6dfb\u52a0\u7aef\u53e3"}]})(v.default.createElement(c.default,{getPopupContainer:e=>e.parentNode},v.default.createElement(E,{value:"http"},"HTTP"),v.default.createElement(E,{value:"https"},"HTTPS"),v.default.createElement(E,{value:"httptohttps"},"HTTP\u8f6cHTTPS"),v.default.createElement(E,{value:"httpandhttps"},"HTTP\u4e0eHTTPS\u5171\u5b58")))),v.default.createElement(y,(0,d.default)({},l,{label:"\u57df\u540d"}),t("domain",{rules:[{required:!0,message:"\u8bf7\u6dfb\u52a0\u57df\u540d"},{pattern:/^(?=^.{3,255}$)[a-zA-Z0-9*][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/,message:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u57df\u540d\u683c\u5f0f\uff0c\u652f\u6301\u6cdb\u57df\u540d"}]})(v.default.createElement(o.default,{placeholder:"\u8bf7\u586b\u5199\u57df\u540d"}))),"http"==s?"":v.default.createElement(y,(0,d.default)({},l,{label:"\u9009\u62e9\u8bc1\u4e66"}),t("certificate_id",{initialValue:"",rules:[{required:!0},{validator:this.checkKey}]})(v.default.createElement(c.default,{getPopupContainer:e=>e.parentNode,placeholder:"\u8bf7\u9009\u62e9\u8bc1\u4e66",dropdownRender:e=>v.default.createElement("div",null,e,h&&v.default.createElement("div",null,v.default.createElement(i.default,{style:{margin:"4px 0"}}),v.default.createElement("div",{style:{padding:"4px 8px",cursor:"pointer"},onMouseDown:e=>e.preventDefault(),onClick:()=>{b&&b()}},v.default.createElement(r.default,{type:"plus"})," \u52a0\u8f7d\u66f4\u591a")))},v.default.createElement(E,{value:""},"\u8bf7\u9009\u62e9\u8bc1\u4e66"),m.map(e=>v.default.createElement(E,{key:e.id,value:e.id},e.alias)))),v.default.createElement("p",null,"\u65e0\u53ef\u7528\u8bc1\u4e66\uff1f",v.default.createElement("a",{onClick:()=>{this.props.onCreateKey()},href:"javascript:;"},"\u53bb\u65b0\u5efa"))),v.default.createElement("div",null,"\u5982\u679c\u9700\u8981\u8bbe\u7f6e\u66f4\u591a\u8def\u7531\u7b56\u7565\u53c2\u6570 \uff1a",v.default.createElement(g.Link,{to:"/team/".concat(_.default.getCurrTeamName(),"/region/").concat(_.default.getCurrRegionName(),"/gateway/control/http/true"),style:{wordBreak:"break-all",wordWrap:"break-word",color:"#1890ff"}},"\u70b9\u51fb\u8fdb\u5165\u8bbf\u95ee\u7b56\u7565\u8bbe\u7f6e"))))}},h=m))||h);t.default=b},Bg2k:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("5NDa");var i=l(a("5rEg"));a("7Kak");var o=l(a("9yH6"));a("OaEy");var d=l(a("2fM7"));a("y8nQ");var u,c,p,h=l(a("Vl3Y")),m=s(a("q1tI")),f=l(a("IhRX")),g=l(a("CQXj")),v=h.default.Item,_=d.default.Option,y=o.default.Group,E=(u=h.default.create(),u((p=class extends m.PureComponent{constructor(e){super(e),this.onChanges=(e=>{var t=e.target.value,a=this.props.form.setFieldsValue,l=this.handleUnhealthyTreatment(t),s={mode:t};l&&(s.success_threshold="1"),a(s),this.setState({isRestart:l})}),this.handleUnhealthyTreatment=(e=>{return"liveness"===e}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.checkPath=((e,t,a)=>{var l=this.props.form.getFieldValue("scheme");"tcp"!==l?"tcp"!==l&&t?a():a("\u8bf7\u586b\u5199\u8def\u5f84!"):a()}),this.checkNums=((e,t,a)=>{t&&t<1?a("\u6700\u5c0f\u503c\u4e3a1"):a()}),this.handleHeavyList=(e=>{var t=[];return e.map(e=>{t.push(e.container_port)}),t}),this.handleList=(e=>{if(null!=e||""!==e){var t=this.state.list?this.state.list:[];if(e&&t.unshift("".concat(e)),!(t&&t.length>0&&"null"===t[0]||""===t[0])){for(var a=[t[0]],l=1;l<t.length;l++){for(var s=!1,n=0;n<a.length;n++)if(t[l]==a[n]){s=!0;break}s||a.push(t[l])}this.setState({list:a}),this.props.form.setFieldsValue({port:e})}}});var t=this.props,a=t.ports,l=t.data,s=a?this.handleHeavyList(a):[];this.state={isRestart:this.handleUnhealthyTreatment(l&&l.mode),list:s,prolist:s,showHTTP:"http"===l.scheme}}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.form,s=e.types,u=e.loading,c=void 0!==u&&u,p=this.props.data||{},E={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},b=l.getFieldDecorator,C=l.getFieldValue,S=this.state,k=S.list,w=S.prolist,A=S.isRestart,x=S.showHTTP,D=(C("scheme"),m.default.createElement("span",{style:{marginLeft:8}},"\u79d2")),T=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return m.default.createElement(i.default,{disabled:e,type:"number",min:1,style:{width:"80%"}})},P=[{validator:this.checkNums}];return m.default.createElement(n.default,{width:700,title:t,onOk:this.handleSubmit,maskClosable:!1,onCancel:a,visible:!0,confirmLoading:c},m.default.createElement(h.default,{onSubmit:this.handleSubmit},m.default.createElement(v,(0,r.default)({},E,{label:"\u68c0\u6d4b\u7aef\u53e3"}),b("port",{initialValue:g.default.getPort(p)||(k&&k.length?k[0]:""),rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]})(m.default.createElement(d.default,{getPopupContainer:e=>e.parentNode,showSearch:!(w&&w.length>0),onSearch:e=>{this.handleList(e)}},k&&k.map(e=>m.default.createElement(_,{key:e,value:e},e))))),m.default.createElement(v,(0,r.default)({},E,{label:"\u63a2\u9488\u534f\u8bae"}),b("scheme",{initialValue:p.scheme||"tcp"})(m.default.createElement(y,{onChange:e=>{this.setState({showHTTP:"http"===e.target.value})},options:[{label:"tcp",value:"tcp"},{label:"http",value:"http"}]}))),m.default.createElement(v,(0,r.default)({},E,{label:"\u4e0d\u5065\u5eb7\u5904\u7406\u65b9\u5f0f:"}),b("mode",{initialValue:p.mode||"readiness",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]})(m.default.createElement(y,{onChange:this.onChanges},m.default.createElement(o.default,{value:"readiness"},"\u4e0b\u7ebf"),!s&&m.default.createElement(o.default,{value:"liveness"},"\u91cd\u542f")))),m.default.createElement(v,(0,r.default)({},E,{label:"http\u8bf7\u6c42\u5934",style:{display:x?"":"none"}}),b("http_header",{initialValue:p.http_header||""})(m.default.createElement(f.default,null))),m.default.createElement(v,(0,r.default)({},E,{label:"\u8def\u5f84",style:{display:x?"":"none"}}),b("path",{initialValue:p.path||"",rules:[{validator:this.checkPath}]})(m.default.createElement(i.default,{placeholder:"\u54cd\u5e94\u78012xx\u30013xx\u4e3a\u6b63\u5e38"}))),m.default.createElement(v,(0,r.default)({},E,{label:"\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"}),b("initial_delay_second",{initialValue:p.initial_delay_second||"2",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"},...P]})(T()),D),m.default.createElement(v,(0,r.default)({},E,{label:"\u68c0\u6d4b\u95f4\u9694\u65f6\u95f4"}),b("period_second",{initialValue:p.period_second||"3",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u68c0\u6d4b\u95f4\u9694\u65f6\u95f4"},...P]})(T()),D),m.default.createElement(v,(0,r.default)({},E,{label:"\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"}),b("timeout_second",{initialValue:p.timeout_second||"20",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"},...P]})(T()),D),m.default.createElement(v,(0,r.default)({},E,{label:"\u8fde\u7eed\u6210\u529f\u6b21\u6570"}),b("success_threshold",{initialValue:A?"1":p.success_threshold||"1",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u8fde\u7eed\u6210\u529f\u6b21\u6570"},...P]})(T(A)))))}},c=p))||c);t.default=E},CQXj:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={getInitWaitTime(e){return e.initial_delay_second},getIntervalTime(e){return e.period_second},getTimeoutTime(e){return e.timeout_second},getSuccessTimes(e){return e.success_threshold},getFailTimes(e){return e.failure_threshold},getPort(e){return e.port},getProtocol(e){return e.scheme},getHeaders(e){return e.http_header},getPath(e){return e.path},getcnName(e){return"readiness"===e.mode?"\u542f\u52a8\u65f6\u68c0\u6d4b":"liveness"===e.mode?"\u8fd0\u884c\u65f6\u68c0\u6d4b":""},isStartProbeUsed(e){return"readiness"===e.mode||"liveness"===e.mode},isStartProbeStart(e){return!0===e.is_used},isRunningProbeUsed(e){return"liveness"===e.mode},isRunningProbeStart(e){return!0===e.is_used},isUsed(e){return e.is_used}},s=l;t.default=s},DPVJ:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=l(a("NCF1"));function n(){}function r(e){var t=e||{};this.url=t.url,this.serviceId=t.serviceId,this.onOpen=t.onOpen||n,this.onLogMessage=t.onLogMessage||n,this.onMonitorMessage=t.onMonitorMessage||n,this.onError=t.onError||n,this.onClose=t.onClose||n,this.onError=t.onError||n,this.onSuccess=t.onSuccess||n,this.onComplete=t.onComplete||n,this.onFail=t.onFail||n,this.isAutoConnect=t.isAutoConnect,this.destroyed=t.destroyed;try{this.init()}catch(e){console.log(e)}}r.prototype={constructor:r,init(){this.webSocket=new WebSocket(this.url),this.webSocket.onopen=this._onOpen.bind(this),this.webSocket.onmessage=this._onMessage.bind(this),this.webSocket.onclose=this._onClose.bind(this),this.webSocket.onerror=this._onError.bind(this),this.serviceLogQueue=new s.default({interval:20,autoStart:!1,batchout:!0,maxCache:5e3,onExecute:e=>{void 0!==e&&this.onLogMessage(e)}}),this.monitorLogQueue=new s.default({interval:5,autoStart:!1,onExecute:e=>{void 0!==e&&this.onMonitorMessage(e)}}),this.eventLogQueue=new Map,this.opened=!1,this.waitingSendMessage=[]},getEventLogQueue(e){if(this.eventLogQueue.has(e))return this.eventLogQueue.get(e);var t=new s.default({autoStart:!0});return this.eventLogQueue.set(e,t),t},watchEventLog(e,t,a,l){var n="event-".concat(l);if(this.eventLogQueue.has(n))this.eventLogQueue.get(n).onExecute=(l=>{void 0!==l.action&&void 0!==l.status&&("success"===l.status?t(l.message):a(l.message)),e(l)});else{this.eventLogQueue.set(n,new s.default({autoStart:!0,onExecute:l=>{void 0!==l.action&&void 0!==l.status&&("success"===l.status?t(l.message):a(l.message)),e(l)}}));var r={event:"pusher:subscribe",data:{channel:"e-".concat(l)}};try{this.opened?this.webSocket.send(JSON.stringify(r)):this.waitingSendMessage.push(JSON.stringify(r))}catch(e){return console.log("err",e),!1}}},setOnLogMessage(e,t){try{if(this.serviceId){var a={event:"pusher:subscribe",data:{channel:"l-".concat(this.serviceId)}};this.webSocket.send(JSON.stringify(a))}e(this.serviceLogQueue.brushout()),this.onLogMessage=t,this.serviceLogQueue.start()}catch(e){return console.log("err",e),!1}},setOnMonitorMessage(e){try{if(this.serviceId){var t={event:"pusher:subscribe",data:{channel:"m-".concat(this.serviceId)}};this.webSocket.send(JSON.stringify(t))}this.onMonitorMessage=e,this.monitorLogQueue.start()}catch(e){return console.log("err",e),!1}},closeLogMessage(){try{if(this.serviceId){var e={event:"cancel:subscribe",data:{channel:"docker-".concat(this.serviceId)}};this.webSocket.send(JSON.stringify(e))}this.serviceLogQueue.stop()}catch(e){return console.log("err",e),!1}},closeMonitorMessage(){try{if(this.serviceId){var e={event:"cancel:subscribe",data:{channel:"newmonitor-".concat(this.serviceId)}};this.webSocket.send(JSON.stringify(e))}}catch(e){return console.log("err",e),!1}},close(){this.webSocket&&this.webSocket.close()},_onOpen(){try{this.onOpen(this.webSocket),this.opened=!0,this.waitingSendMessage.length>0&&this.waitingSendMessage.map(e=>{return this.webSocket.send(e),null})}catch(e){console.log("err",e)}},_onMessage(e){var t=JSON.parse(e.data);if(t&&t.event){if("monitor"===t.event&&t.data){var a=JSON.parse(t.data);a&&this.monitorLogQueue.add(a)}if("service:log"===t.event&&t.data&&this.serviceLogQueue.add(t.data),"event:log"===t.event&&t.data){var l=JSON.parse(t.data);l&&this.getEventLogQueue(t.channel).add(l)}"event:success"===t.event&&this.getEventLogQueue(t.channel).add({action:"closed",message:t.data,status:"success"}),"event:failure"===t.event&&this.getEventLogQueue(t.channel).add({action:"closed",message:t.data,status:"failure"})}},_onClose(){this.webSocket.onopen=null,this.webSocket.onmessage=null,this.webSocket.onclose=null,this.webSocket.onerror=null,this.webSocket=null,!this.destroyed&&this.isAutoConnect&&setTimeout(()=>{this.init()},2e3)},_onError(){this.onError()},destroy(){this.destroyed=!0,this.webSocket&&this.webSocket.close()}};var i=r;t.default=i},DXno:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("g9YV");var r=l(a("wCAj"));a("14J3");var i=l(a("BMrR"));a("jCWc");var o=l(a("kPKH"));a("5Dmo");var d=l(a("3S7+"));a("Pwec");var u=l(a("CtXQ"));a("+L6B");var c,p,h,m=l(a("2/Rp")),f=a("KTCi"),g=l(a("puxM")),v=l(a("QDog")),_=l(a("YM/Z")),y=l(a("rIpq")),E=l(a("zcww")),b=l(a("+iC2")),C=a("MuoO"),S=l(a("ZhIB")),k=s(a("q1tI")),w=(m.default.Group,c=(0,C.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,appDetail:a.appDetail,onlineNumber:a.onlineNumber,onlineNumberRange:a.onlineNumberRange,appRequest:a.appRequest,appRequestRange:a.appRequestRange,requestTime:a.requestTime,requestTimeRange:a.requestTimeRange}}),c((h=class extends k.PureComponent{constructor(e){super(e),this.getSocketUrl=(()=>{var e=b.default.getTeamByTeamName(this.props.currUser,v.default.getCurrTeamName()),t=v.default.getCurrRegionName();if(e){var a=E.default.getRegionByName(e,t);if(a)return y.default.getMonitorWebSocketUrl(a)}return""}),this.inerval=5e3,this.state={logs:[]}}componentDidMount(){this.mounted=!0,this.fetchRequestTime(),this.fetchRequestTimeRange(),this.fetchRequest(),this.fetchRequestRange(),this.fetchOnlineNumber(),this.fetchOnlineNumberRange(),this.createSocket()}componentWillUnmount(){this.mounted=!1,this.props.dispatch({type:"appControl/clearOnlineNumberRange"}),this.props.dispatch({type:"appControl/clearRequestTime"}),this.props.dispatch({type:"appControl/clearRequestTimeRange"}),this.props.dispatch({type:"appControl/clearRequest"}),this.props.dispatch({type:"appControl/clearRequestRange"}),this.props.dispatch({type:"appControl/clearOnlineNumber"});var e=this.props.socket;e&&e.closeMonitorMessage()}getStartTime(){return(new Date).getTime()/1e3-3600}getStep(){return 60}fetchRequestTime(){this.mounted&&this.props.dispatch({type:"appControl/fetchRequestTime",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,serviceId:this.props.appDetail.service.service_id},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchRequestTime()},this.inerval)}})}fetchRequestTimeRange(){this.mounted&&this.props.dispatch({type:"appControl/fetchRequestTimeRange",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,start:this.getStartTime(),serviceId:this.props.appDetail.service.service_id,step:this.getStep()},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchRequestTimeRange()},this.inerval)}})}fetchRequest(){this.mounted&&this.props.dispatch({type:"appControl/fetchRequest",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,serviceId:this.props.appDetail.service.service_id},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchRequest()},this.inerval)}})}fetchRequestRange(){this.mounted&&this.props.dispatch({type:"appControl/fetchRequestRange",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,start:this.getStartTime(),serviceId:this.props.appDetail.service.service_id,step:this.getStep()},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchRequestRange()},this.inerval)}})}fetchOnlineNumber(){this.mounted&&this.props.dispatch({type:"appControl/fetchOnlineNumber",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,serviceId:this.props.appDetail.service.service_id},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchOnlineNumber()},this.inerval)}})}fetchOnlineNumberRange(){this.mounted&&this.props.dispatch({type:"appControl/fetchOnlineNumberRange",payload:{team_name:v.default.getCurrTeamName(),app_alias:this.props.appAlias,start:this.getStartTime(),serviceId:this.props.appDetail.service.service_id,step:this.getStep()},complete:()=>{this.mounted&&setTimeout(()=>{this.fetchOnlineNumberRange()},this.inerval)}})}createSocket(){var e=this.props.socket;e&&e.setOnMonitorMessage(e=>{this.updateTable(e)})}updateTable(e){try{e=JSON.parse(e)}catch(e){}this.setState({logs:e})}render(){var e={xs:24,sm:12,md:12,lg:12,xl:8,style:{marginBottom:24}};return k.default.createElement(k.Fragment,null,k.default.createElement(i.default,{gutter:24},k.default.createElement(o.default,e,k.default.createElement(f.ChartCard,{bordered:!1,title:"\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\uff08ms\uff09",action:k.default.createElement(d.default,{title:"\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2"}," ",k.default.createElement(u.default,{type:"info-circle-o"})," "),total:(0,S.default)(_.default.queryTog2(this.props.requestTime)).format("0,0"),footer:k.default.createElement(f.Field,{label:"",value:""}),contentHeight:46},k.default.createElement(f.MiniArea,{color:"#975FE4",data:_.default.queryRangeTog2(this.props.requestTimeRange)}))),k.default.createElement(o.default,e,k.default.createElement(f.ChartCard,{bordered:!1,title:"\u541e\u5410\u7387\uff08dps\uff09",action:k.default.createElement(d.default,{title:"\u8fc7\u53bb\u4e00\u5206\u949f\u5e73\u5747\u6bcf5s\u7684\u8bf7\u6c42\u6b21\u6570"}," ",k.default.createElement(u.default,{type:"info-circle-o"})," "),total:(0,S.default)(_.default.queryTog2(this.props.appRequest)).format("0,0"),footer:k.default.createElement(f.Field,{label:"",value:""}),contentHeight:46},k.default.createElement(f.MiniArea,{color:"#4593fc",data:_.default.queryRangeTog2(this.props.appRequestRange)}))),k.default.createElement(o.default,e,k.default.createElement(f.ChartCard,{bordered:!1,title:"\u5728\u7ebf\u4eba\u6570",action:k.default.createElement(d.default,{title:"\u8fc7\u53bb5\u5206\u949f\u7684\u72ec\u7acbIP\u6570\u91cf"}," ",k.default.createElement(u.default,{type:"info-circle-o"})," "),total:(0,S.default)(_.default.queryTog2(this.props.onlineNumber)).format("0,0"),footer:k.default.createElement(f.Field,{label:"",value:""}),contentHeight:46},k.default.createElement(f.MiniBar,{data:_.default.queryRangeTog2(this.props.onlineNumberRange)})))),k.default.createElement(n.default,{title:"\u8fc7\u53bb5\u5206\u949f\u8017\u65f6\u6700\u591a\u7684URL\u6392\u884c"},k.default.createElement(g.default,{sm:700},k.default.createElement(r.default,{columns:[{title:"Url",dataIndex:"Key"},{title:"\u7d2f\u8ba1\u65f6\u95f4(ms)",dataIndex:"CumulativeTime",width:150},{title:"\u5e73\u5747\u65f6\u95f4(ms)",dataIndex:"AverageTime",width:150},{title:"\u8bf7\u6c42\u6b21\u6570",dataIndex:"Count",width:100},{title:"\u5f02\u5e38\u6b21\u6570",dataIndex:"AbnormalCount",width:100}],pagination:!1,dataSource:this.state.logs}))))}},p=h))||p);t.default=w},GUlx:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV")),r=s(a("jehZ"));a("+L6B");var i=s(a("2/Rp"));a("y8nQ");var o=s(a("Vl3Y")),d=l(a("q1tI")),u=s(a("CQXj")),c=o.default.Item;class p extends d.PureComponent{render(){var e=this.props,t=e.title,a=e.onCancel,l=this.props.data||{},s={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};return d.default.createElement(n.default,{title:t,visible:!0,onCancel:a,footer:[d.default.createElement(i.default,{onClick:a}," \u5173\u95ed ")]},d.default.createElement(o.default,null,d.default.createElement(c,(0,r.default)({},s,{label:"\u76d1\u6d4b\u7aef\u53e3"}),d.default.createElement("span",null,l.port)),d.default.createElement(c,(0,r.default)({},s,{label:"\u63a2\u9488\u4f7f\u7528\u534f\u8bae"}),d.default.createElement("span",null,l.scheme)),d.default.createElement(c,(0,r.default)({},s,{label:"\u4e0d\u5065\u5eb7\u5904\u7406\u65b9\u5f0f"}),d.default.createElement("span",null,"readiness"==l.mode?"\u4e0b\u7ebf":"liveness"==l.mode?"\u91cd\u542f":"\u672a\u8bbe\u7f6e")),"http"===l.scheme?d.default.createElement(d.Fragment,null,d.default.createElement(c,(0,r.default)({},s,{label:"http\u8bf7\u6c42\u5934"}),d.default.createElement("span",null,u.default.getHeaders(l))),d.default.createElement(c,(0,r.default)({},s,{label:"\u8def\u5f84"}),d.default.createElement("span",null,u.default.getPath(l)))):null,d.default.createElement(c,(0,r.default)({},s,{label:"\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getInitWaitTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u68c0\u6d4b\u76d1\u6d4b\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getIntervalTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getTimeoutTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u8fde\u7eed\u6210\u529f\u6b21\u6570"}),d.default.createElement("span",null,u.default.getSuccessTimes(l)))))}}t.default=p},H6Z4:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("jehZ"));a("5NDa");var r=l(a("5rEg"));a("/xke");var i=l(a("TeRw")),o=l(a("p0pE"));a("2qtc");var d=l(a("kLXV"));a("OaEy");var u=l(a("2fM7"));a("y8nQ");var c,p,h,m,f=l(a("Vl3Y")),g=a("MuoO"),v=s(a("q1tI")),_=l(a("e6Ls")),y=f.default.Item,E=u.default.Option,b=d.default.confirm,C=(c=f.default.create(),p=(0,g.connect)(),c(h=p((m=class extends v.PureComponent{constructor(e){super(e),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk,s=this.state,n=s.unit,r=s.portList;a.validateFields({force:!0},(e,t)=>{if(!e&&l){t.interval+="".concat(n),t.port=Number(t.port);var a=r.filter(e=>{return"".concat(t.port)==="".concat(e.container_port)})[0];a.is_outer_service||a.is_inner_service?l(t):this.handleOpenInner(t)}})}),this.handleOpenInner=(e=>{var t=this.props,a=t.dispatch,l=t.parameter,s=t.onOk;b({title:"\u5f00\u901a\u7aef\u53e3",content:"\u7ec4\u4ef6\u7aef\u53e3\u9700\u8981\u5f00\u901a\u5bf9\u5185\u670d\u52a1",okText:"\u5f00\u901a",cancelText:"\u53d6\u6d88",onOk(){return new Promise((t,n)=>{a({type:"appControl/openPortInner",payload:(0,o.default)({},l,{port:e.port}),callback:()=>{s(e),i.default.success({message:"\u5f00\u901a\u6210\u529f"}),d.default.destroyAll()}}),setTimeout(Math.random()>.5?t:n,2e3)})},onCancel(){}})}),this.handleChange=(e=>{this.setState({unit:e})}),this.handlePorts=(()=>{var e=this.props,t=e.dispatch,a=e.parameter;t({type:"appControl/fetchPorts",payload:a,callback:e=>{e&&this.setState({portList:e.list})}})}),this.checkContent=((e,t,a)=>{var l=Number(t);if(l||0===l){if(l<1)return void a("\u6700\u5c0f\u8f93\u5165\u503c1");if(l>65535)return void a("\u6700\u5927\u8f93\u5165\u503c65535")}a()});var t=this.props.data;this.state={portList:[],unit:t.interval?t.interval.slice(t.interval.length-1):"s"}}componentDidMount(){this.handlePorts()}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.form,s=e.data,i=void 0===s?{}:s,o=e.loading,c=void 0!==o&&o,p=this.state,h=p.unit,m=p.portList,g=l.getFieldDecorator,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},C=v.default.createElement(u.default,{getPopupContainer:e=>e.parentNode,defaultValue:h,style:{width:80},onChange:this.handleChange},v.default.createElement(E,{value:"s"},"\u79d2"),v.default.createElement(E,{value:"m"},"\u5206\u949f"),v.default.createElement(E,{value:"h"},"\u5c0f\u65f6")),S="";i.interval&&(S=i.interval.slice(0,i.interval.length-1));var k={pattern:/^[a-zA-Z]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u7ec4\u5408"},w={max:40,message:"\u6700\u5927\u957f\u5ea640\u4f4d"};return v.default.createElement(d.default,{title:t||i.name?"\u7f16\u8f91\u914d\u7f6e":"\u6dfb\u52a0\u914d\u7f6e",visible:!0,confirmLoading:c,className:_.default.TelescopicModal,onCancel:a,onOk:this.onOk,okText:i.name?"\u4fdd\u5b58":"\u6dfb\u52a0"},v.default.createElement(f.default,{onSubmit:this.onOk},v.default.createElement(y,(0,n.default)({},b,{label:"\u914d\u7f6e\u540d"}),g("name",{initialValue:i.name||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u914d\u7f6e\u540d"},k,w]})(v.default.createElement(r.default,{disabled:i.name,placeholder:"\u8bf7\u586b\u5199\u914d\u7f6e\u540d"}))),v.default.createElement(y,(0,n.default)({},b,{label:"\u6536\u96c6\u4efb\u52a1\u540d\u79f0"}),g("service_show_name",{initialValue:i.service_show_name||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u6536\u96c6\u4efb\u52a1\u540d\u79f0"},k,w]})(v.default.createElement(r.default,{placeholder:"\u8bf7\u586b\u5199\u6536\u96c6\u4efb\u52a1\u540d\u79f0"}))),v.default.createElement(y,(0,n.default)({},b,{label:"\u6536\u96c6\u95f4\u9694\u65f6\u95f4"}),g("interval",{initialValue:S||"10",rules:[{required:!0,message:"\u6536\u96c6\u95f4\u9694\u65f6\u95f4"},{validator:this.checkContent}]})(v.default.createElement(r.default,{type:"number",min:1,max:65535,addonAfter:C,defaultValue:"\u6536\u96c6\u95f4\u9694\u65f6\u95f4"}))),v.default.createElement(y,(0,n.default)({},b,{label:"\u6307\u6807\u8def\u5f84"}),g("path",{initialValue:i.path||"/metrics",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u6307\u6807\u8def\u5f84"},{max:255,message:"\u6700\u5927\u957f\u5ea6255\u4f4d"}]})(v.default.createElement(r.default,{placeholder:"\u8bf7\u586b\u5199\u6307\u6807\u8def\u5f84"}))),v.default.createElement(y,(0,n.default)({},b,{label:"\u7aef\u53e3\u53f7"}),g("port",{initialValue:i.port||(m.length>0?m[0].container_port:""),rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7aef\u53e3\u53f7"}]})(v.default.createElement(u.default,{placeholder:"\u8bf7\u9009\u62e9\u7aef\u53e3\u53f7",getPopupContainer:e=>e.parentNode},m.map(e=>{var t=e.container_port,a=e.ID;return v.default.createElement(E,{value:t,key:a},t)}))))))}},h=m))||h)||h);t.default=C},"I/an":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={getMemoryAndUnit(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(void 0===e)return"";if(e<1024)return"".concat(e,"M");var a=e/1024;return"".concat(a%1===0?a:a.toFixed(t,2),"G")},getDiskAndUnit(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return void 0===e?"":e<1024?"".concat(e.toFixed(t),"G"):"".concat((e/1024).toFixed(t),"T")},getNetAndUnit(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return void 0===e?"":"".concat(e.toFixed(t),"G")},getMonthlyAndUnit(e){return void 0===e?"":e<12?"".concat(e,"\u4e2a\u6708"):"".concat(e/12,"\u5e74")}},s=l;t.default=s},IhRX:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=s(a("BMrR"));a("+L6B");var r=s(a("2/Rp"));a("jCWc");var i=s(a("kPKH"));a("5NDa");var o=s(a("5rEg")),d=l(a("q1tI"));class u extends d.Component{constructor(e){super(e),this.add=(()=>{var e=this.state.values;this.setState({values:e.concat({key:"",value:""})})}),this.remove=(e=>{var t=this.state.values;t.splice(e,1),this.setValues(t),this.triggerChange(t)}),this.onKeyChange=((e,t)=>{var a=this.state.values;a[e].key=t.target.value,this.triggerChange(a),this.setValues(a)}),this.onValueChange=((e,t)=>{var a=this.state.values;a[e].value=t.target.value,this.triggerChange(a),this.setValues(a)}),this.state={values:[{key:"",value:""}]},this.initFromProps()}componentWillReceiveProps(e){if("value"in e){var t=e.value;this.initFromProps(t)}}initFromProps(e){e=e||this.props.value;if(e){for(var t=[],a=e.split(","),l=0;l<a.length;l++)""!==a[l].split("=")[0]&&t.push({key:a[l].split("=")[0],value:a[l].split("=")[1]});this.setValues(t)}}setValues(e){e=e||[],e.length||e.push({key:"",value:""}),this.setState({values:e})}triggerChange(e){for(var t=[],a=0;a<e.length;a++)""!==e[a].key&&t.push("".concat(e[a].key,"=").concat(e[a].value));var l=this.props.onChange;l&&l(t.join(","))}render(){var e=this.props.keyPlaceholder||"\u8bf7\u8f93\u5165key\u503c",t=this.props.valuePlaceholder||"\u8bf7\u8f93\u5165value\u503c",a=this.state.values;return d.default.createElement("div",null,a.map((a,l)=>{return d.default.createElement(n.default,{key:l},d.default.createElement(i.default,{span:8},d.default.createElement(o.default,{name:"key",onChange:this.onKeyChange.bind(this,l),value:a.key,placeholder:e})),d.default.createElement(i.default,{span:2,style:{textAlign:"center"}},"="),d.default.createElement(i.default,{span:8},d.default.createElement(o.default,{name:"value",onChange:this.onValueChange.bind(this,l),value:a.value,placeholder:t})),d.default.createElement(i.default,{span:6,style:{textAlign:"center"}},0==l?d.default.createElement(r.default,{onClick:this.add,type:"primary"},"\u6dfb\u52a0"):d.default.createElement(r.default,{onClick:this.remove.bind(this,l)},"\u5220\u9664")))}))}}var c=u;t.default=c},Lo2C:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5NDa");var n=l(a("5rEg"));a("/zsF");var r=l(a("PArb"));a("2qtc");var i=l(a("kLXV"));a("Pwec");var o=l(a("CtXQ"));a("T2oS");var d=l(a("W9HT"));a("IzEo");var u=l(a("bx4M"));a("+L6B");var c=l(a("2/Rp")),p=l(a("jehZ")),h=l(a("p0pE"));a("/xke");var m=l(a("TeRw"));a("OaEy");var f=l(a("2fM7"));a("y8nQ");var g=l(a("Vl3Y"));a("Znn+");var v,_,y,E,b=l(a("ZTPi")),C=a("MuoO"),S=a("7DNP"),k=s(a("q1tI")),w=l(a("m+FX")),A=l(a("iPMB")),x=l(a("cUW5")),D=l(a("lpA0")),T=l(a("QDog")),P=l(a("mWxT")),M=a("+n12"),N=l(a("Oz9w")),I=l(a("ot6+")),R=l(a("0//z")),L=b.default.TabPane,O=g.default.Item,V=f.default.Option,B=f.default.OptGroup,q=(v=(0,C.connect)(e=>{var t=e.user,a=e.appControl,l=e.global;return{currUser:t.currentUser,createWay:a.createWay,rainbondInfo:l.rainbondInfo,enterprise:l.enterprise}},null,null,{withRef:!0}),_=g.default.create(),v(y=_((E=class extends k.PureComponent{constructor(e){var t;super(e),t=this,this.setOauthService=(()=>{var e=this.props,t=e.rainbondInfo,a=e.enterprise,l=[];P.default.OauthbEnable(t)&&P.default.OauthEnterpriseEnable(a)&&(a.oauth_services.value.map(e=>{var t=e.oauth_type,a=e.service_id,s=e.is_git,n=e.name,r=e.enable;return s&&l.push({name:n,type:t,enable:r,id:"".concat(a)}),e}),this.setState({tabList:l}))}),this.onChangeBuildSource=(()=>{this.hideBuildSource(),this.loadBuildSourceInfo()}),this.getRuntimeInfo=(()=>{this.props.dispatch({type:"appControl/getRuntimeBuildInfo",payload:{team_name:T.default.getCurrTeamName(),app_alias:this.props.appDetail.service.service_alias},callback:e=>{e&&this.setState({runtimeInfo:e.bean?e.bean:{}})}})}),this.handleEditRuntime=(e=>{this.props.dispatch({type:"appControl/editRuntimeBuildInfo",payload:{team_name:T.default.getCurrTeamName(),app_alias:this.props.appDetail.service.service_alias,build_env_dict:e},callback:e=>{e&&200===e.status_code&&(m.default.success({message:"\u4fee\u6539\u6210\u529f"}),this.getRuntimeInfo())}})}),this.handleEditInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.props.dispatch({type:"appControl/editAppCreateInfo",payload:(0,h.default)({team_name:T.default.getCurrTeamName(),app_alias:t.props.appDetail.service.service_alias},e),callback:e=>{e&&t.props.updateDetail()}})},this.changeBuildSource=(()=>{this.setState({changeBuildSource:!0})}),this.hideBuildSource=(()=>{this.setState({changeBuildSource:!1})}),this.changeEditOauth=(()=>{this.handleProvinceChange(),this.setState({editOauth:!0})}),this.hideEditOauth=(()=>{this.setState({editOauth:!1})}),this.loadBuildSourceInfo=(()=>{var e=this.props.dispatch,t=T.default.getCurrTeamName();e({type:"appControl/getAppBuidSource",payload:{team_name:t,service_alias:this.props.appDetail.service.service_alias},callback:e=>{if(e){var t=e.bean;this.setState({buildSource:t},()=>{t&&t.code_from&&t.code_from.indexOf("oauth")>-1&&this.loadThirdInfo()})}}})}),this.loadThirdInfo=(()=>{var e=this.props.dispatch,t=this.state.buildSource;e({type:"global/codeThirdInfo",payload:{full_name:t.full_name,oauth_service_id:t.oauth_service_id},callback:e=>{e&&200===e.status_code&&this.setState({thirdInfo:e.bean})}})}),this.handleToDetect=(()=>{this.setState({languageBox:!0})}),this.handlelanguageBox=(()=>{this.setState({languageBox:!1,create_status:""})}),this.handleDetectGetLanguage=(()=>{var e=this.props.dispatch,t=this;e({type:"appControl/getLanguage",payload:{team_name:T.default.getCurrTeamName(),service_alias:this.props.appDetail.service.service_alias,check_uuid:this.state.check_uuid},callback:e=>{e&&200===e.status_code&&(e.bean&&"success"!=e.bean.check_status&&"failure"!=e.bean.check_status?setTimeout(function(){t.handleDetectGetLanguage()},3e3):(this.loadBuildSourceInfo(),this.setState({create_status:e.bean&&e.bean.check_status,service_info:e.bean&&e.bean.service_info,error_infos:e.bean&&e.bean.error_infos})))}})}),this.handleDetectPutLanguage=(()=>{var e=this.props.dispatch;e({type:"appControl/putLanguage",payload:{team_name:T.default.getCurrTeamName(),service_alias:this.props.appDetail.service.service_alias},callback:e=>{e&&this.setState({create_status:e.bean&&e.bean.create_status,check_uuid:e.bean&&e.bean.check_uuid},()=>{"failure"==this.state.create_status?m.default.warning({message:"\u66f4\u65b0\u8bed\u8a00\u5931\u8d25"}):this.handleDetectGetLanguage()})}})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.handleCodeWarehouseType=(e=>{var t=e.dispatch,a=this.state,l=a.tabType,s=a.buildSource,n=this.props.form.getFieldValue("oauth_service_id"),r=this.props.form.getFieldValue("full_name");t({type:"global/codeWarehouseType",payload:{type:l,full_name:r||s.full_name,oauth_service_id:n||s.oauth_service_id},callback:e=>{e&&200===e.status_code&&this.setState({tags:e.bean?e.bean[l]:[],tagsLoading:!1,OauthLoading:!1})}})}),this.onTabChange=(e=>{this.setState({tabType:e,tagsLoading:!0},()=>{this.handleCodeWarehouseType(this.props)})}),this.onPagePre=(()=>{var e=this.state.page;if(e>1){var t=e-1,a=1==e;this.setState({firstPage:a,page:t},()=>{this.handleProvinceChange()})}}),this.onPageNext=(()=>{var e=this.state,t=e.lastPage,a=e.page;if(!t){var l=a+1;this.setState({page:l},()=>{this.handleProvinceChange()})}}),this.handleProvinceChange=(e=>{var t=this.props.dispatch,a=this.props.form.setFieldsValue,l=this.state,s=l.tabList,n=l.buildSource,r=l.page,i=this.props.form.getFieldValue("oauth_service_id");this.setState({OauthLoading:!0}),t({type:"global/codeWarehouseInfo",payload:{page:r,oauth_service_id:e||i||n&&n.oauth_service_id||(s.length>0?s[0].id:"")},callback:t=>{if(t&&200===t.status_code&&t.bean&&t.bean.repositories&&t.bean.repositories.length>0){var l=1==r,s=t.bean.repositories.length<10,n=t.bean.repositories[0].project_full_name,i=t.bean.repositories[0].project_url,o=t.bean.repositories[0].project_default_branch;e&&a({full_name:n,git_url:i,code_version:o}),this.setState({firstPage:l,lastPage:s,fullList:t.bean.repositories},()=>{this.handleCodeWarehouseType(this.props)})}else this.setState({tagsLoading:!1,OauthLoading:!1})}})}),this.handleProjectChange=(e=>{this.setState({OauthLoading:!0});var t=this.props.form.setFieldsValue,a=this.state.fullList;a.map(a=>{a.project_full_name===e&&t({git_url:a.project_url,code_version:a.project_default_branch},()=>{this.handleCodeWarehouseType(this.props),this.setState({OauthLoading:!1})})})}),this.handleSubmitOauth=(()=>{var e=this.props.form;e.validateFields((e,t)=>{e||this.props.dispatch({type:"appControl/putAppBuidSource",payload:{team_name:T.default.getCurrTeamName(),service_alias:this.props.appAlias,is_oauth:!0,oauth_service_id:t.oauth_service_id,full_name:t.full_name,git_url:t.git_url,code_version:t.code_version,service_source:"source_code"},callback:()=>{m.default.success({message:"\u4fee\u6539\u6210\u529f\uff0c\u4e0b\u6b21\u6784\u5efa\u90e8\u7f72\u65f6\u751f\u6548"}),this.loadBuildSourceInfo(),this.hideEditOauth()}})})}),this.state={runtimeInfo:"",changeBuildSource:!1,editOauth:!1,buildSource:null,showMarketAppDetail:!1,showApp:{},create_status:"",languageBox:!1,service_info:"",error_infos:"",thirdInfo:!1,tags:[],tagsLoading:!0,tabType:"branches",fullList:[],tabList:[],OauthLoading:!0,page:1}}componentDidMount(){this.setOauthService(),this.getRuntimeInfo(),this.loadBuildSourceInfo()}getParams(){return{group_id:this.props.match.params.appID,compose_id:this.props.match.params.composeId}}canView(){var e=this.props.componentPermissions.isSource;return e}render(){if(!this.canView())return k.default.createElement(x.default,null);var e=this.props,t=e.form,a=e.match,l=e.appDetail,s=this.state,h=s.runtimeInfo,m=s.thirdInfo,v=s.buildSource,_=s.tags,y=s.tagsLoading,E=s.fullList,C=s.tabList,T=s.firstPage,P=s.lastPage,q=D.default.getLanguage(l),F={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},U={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}},z=a.params,H=z.teamName,j=z.regionName,Q=t.getFieldDecorator,X=v?v.language:"",W=D.default.getCreateTypeCNByBuildSource(v),K=W&&"\u672c\u5730\u5171\u4eab\u5e93"===W,Y=X||"";return k.default.createElement(k.Fragment,null,v&&k.default.createElement(u.default,{title:"\u6784\u5efa\u6e90",style:{marginBottom:24},extra:[D.default.isOauthByBuildSource(v)?k.default.createElement("a",{onClick:this.changeEditOauth,href:"javascript:;"},"\u7f16\u8f91"):!D.default.isMarketAppByBuildSource(v)&&k.default.createElement("a",{onClick:this.changeBuildSource,href:"javascript:;"},"\u66f4\u6539")]},k.default.createElement("div",null,k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:D.default.isOauthByBuildSource(v)&&m?"OAuth\u670d\u52a1":"\u521b\u5efa\u65b9\u5f0f"}),k.default.createElement(S.Link,{to:K&&"/team/".concat(H,"/region/").concat(j,"/create/market"),style:{color:!K&&"rgba(0, 0, 0, 0.65)"}},D.default.isOauthByBuildSource(v)&&m?m.service_name:W))),D.default.isImageAppByBuildSource(v)?k.default.createElement("div",null,k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u955c\u50cf\u540d\u79f0"}),v.image),k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u7248\u672c"}),v.version),k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u542f\u52a8\u547d\u4ee4"}),v.cmd||"")):"",D.default.isMarketAppByBuildSource(v)?k.default.createElement(k.Fragment,null,k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u5e94\u7528\u6a21\u7248\u540d\u79f0"}),v.group_key?k.default.createElement("a",{href:"javascript:;",onClick:()=>{this.setState({showApp:{details:v.details,group_name:v.rain_app_name,group_key:v.group_key},showMarketAppDetail:!0})}},v.rain_app_name):"\u65e0\u6cd5\u627e\u5230\u6e90\u5e94\u7528\uff0c\u53ef\u80fd\u5df2\u5220\u9664"),k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u7248\u672c"}),v.version)):"",D.default.isOauthByBuildSource(v)&&k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u9879\u76ee\u540d\u79f0"}),k.default.createElement("a",{href:v.git_url,target:"_blank"},v.full_name)),D.default.isCodeAppByBuildSource(v)?k.default.createElement(k.Fragment,null,k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u4ed3\u5e93\u5730\u5740"}),k.default.createElement("a",{href:v.git_url,target:"_blank"},v.git_url)),k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{label:"\u4ee3\u7801\u7248\u672c"}),v.code_version),k.default.createElement(O,(0,p.default)({style:{marginBottom:0}},F,{className:N.default.ant_form_item,label:"\u8bed\u8a00"}),"static"!=Y?k.default.createElement("a",{target:"blank",href:M.languageObj["".concat(Y)]},Y):k.default.createElement("a",{href:"javascript:void(0);"},Y),k.default.createElement(c.default,{size:"small",type:"primary",onClick:this.handleToDetect},"\u91cd\u65b0\u68c0\u6d4b"))):""),v&&k.default.createElement(I.default,{app:this.props.appDetail,service_source:D.default.getCreateTypeCNByBuildSource(v)}),this.state.languageBox&&k.default.createElement(i.default,{visible:this.state.languageBox,onCancel:this.handlelanguageBox,title:"\u91cd\u65b0\u68c0\u6d4b",footer:this.state.create_status?"success"==this.state.create_status?[k.default.createElement(c.default,{key:"back",onClick:this.handlelanguageBox},"\u5173\u95ed"),k.default.createElement(c.default,{key:"submit",type:"primary",onClick:this.handlelanguageBox},"\u786e\u8ba4")]:[k.default.createElement(c.default,{key:"back"},"\u5173\u95ed")]:[k.default.createElement(c.default,{key:"back",onClick:this.handlelanguageBox},"\u5173\u95ed"),k.default.createElement(c.default,{key:"submit",type:"primary",onClick:this.handleDetectPutLanguage},"\u68c0\u6d4b")]},k.default.createElement("div",null,"checking"==this.state.create_status||"complete"==this.state.create_status?k.default.createElement("div",null,k.default.createElement("p",{style:{textAlign:"center"}},k.default.createElement(d.default,null)),k.default.createElement("p",{style:{textAlign:"center",fontSize:"14px"}},"\u68c0\u6d4b\u4e2d\uff0c\u8bf7\u7a0d\u540e(\u8bf7\u52ff\u5173\u95ed\u5f39\u7a97)")):"","failure"==this.state.create_status?k.default.createElement("div",null,k.default.createElement("p",{style:{textAlign:"center",color:"#28cb75",fontSize:"36px"}},k.default.createElement(o.default,{style:{color:"#f5222d",marginRight:8},type:"close-circle-o"})),this.state.error_infos&&this.state.error_infos.map(e=>{return k.default.createElement("div",null,k.default.createElement("span",{dangerouslySetInnerHTML:{__html:"<span>".concat(e.error_info||""," ").concat(e.solve_advice||"","</span>")}}))})):"","success"==this.state.create_status?k.default.createElement("div",null,k.default.createElement("p",{style:{textAlign:"center",color:"#28cb75",fontSize:"36px"}},k.default.createElement(o.default,{type:"check-circle-o"})),this.state.service_info&&this.state.service_info.map(e=>{return k.default.createElement("p",{style:{textAlign:"center",fontSize:"14px"}},e.key,":",e.value," ")})):"","failed"==this.state.create_status?k.default.createElement("div",null,k.default.createElement("p",{style:{textAlign:"center",color:"999",fontSize:"36px"}},k.default.createElement(o.default,{type:"close-circle-o"})),k.default.createElement("p",{style:{textAlign:"center",fontSize:"14px"}},"\u68c0\u6d4b\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u68c0\u6d4b")):"",!this.state.create_status&&k.default.createElement("div",null,k.default.createElement("p",{style:{textAlign:"center",fontSize:"14px"}},"\u786e\u5b9a\u8981\u91cd\u65b0\u68c0\u6d4b\u5417?")))),q&&h&&k.default.createElement(w.default,{appDetail:this.props.appDetail,onSubmit:this.handleEditRuntime,language:q,runtimeInfo:this.state.runtimeInfo}),this.state.changeBuildSource&&k.default.createElement(R.default,{onOk:this.onChangeBuildSource,buildSource:v,appAlias:this.props.appDetail.service.service_alias,title:"\u66f4\u6539\u7ec4\u4ef6\u6784\u5efa\u6e90",onCancel:this.hideBuildSource}),this.state.editOauth&&k.default.createElement(i.default,{visible:this.state.editOauth,onCancel:this.hideEditOauth,onOk:this.handleSubmitOauth,loading:this.state.OauthLoading,title:"\u7f16\u8f91"},k.default.createElement(d.default,{spinning:this.state.OauthLoading},k.default.createElement(g.default,{onSubmit:this.handleSubmitOauth},k.default.createElement(O,(0,p.default)({},U,{label:"OAuth\u670d\u52a1"}),Q("oauth_service_id",{initialValue:m?"".concat(m.service_id):"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9OAuth\u670d\u52a1"}]})(k.default.createElement(f.default,{getPopupContainer:e=>e.parentNode,onChange:this.handleProvinceChange,placeholder:"\u8bf7\u9009\u62e9OAuth\u670d\u52a1"},C.length>0&&C.map(e=>e.enable&&k.default.createElement(V,{key:e.id,value:e.id},e.name))))),k.default.createElement(O,(0,p.default)({},U,{label:"\u9879\u76ee\u540d\u79f0"}),Q("full_name",{initialValue:v?v.full_name:E.length>0&&E[0].project_full_name,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u9879\u76ee"}]})(k.default.createElement(f.default,{getPopupContainer:e=>e.parentNode,onChange:this.handleProjectChange,dropdownRender:e=>k.default.createElement("div",null,e,!T&&k.default.createElement("div",null,k.default.createElement(r.default,{style:{margin:"4px 0"}}),k.default.createElement("div",{style:{padding:"4px 8px",cursor:"pointer"},onMouseDown:e=>e.preventDefault(),onClick:this.onPagePre},"\u4e0a\u4e00\u9875")),!P&&k.default.createElement("div",null,k.default.createElement(r.default,{style:{margin:"4px 0"}}),k.default.createElement("div",{style:{padding:"4px 8px",cursor:"pointer"},onMouseDown:e=>e.preventDefault(),onClick:this.onPageNext},"\u4e0b\u4e00\u9875"))),placeholder:"\u8bf7\u9009\u62e9\u9879\u76ee"},E.length>0&&E.map(e=>k.default.createElement(V,{key:e.project_url,value:e.project_full_name},e.project_full_name))))),k.default.createElement(O,(0,p.default)({},U,{label:"\u4ed3\u5e93\u5730\u5740"}),Q("git_url",{initialValue:v?v.git_url:E.length>0&&E[0].git_url,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u521b\u5efa\u65b9\u5f0f"}]})(k.default.createElement(n.default,{placeholder:"\u8bf7\u8f93\u5165\u914d\u7f6e\u7ec4\u540d",disabled:!0}))),k.default.createElement(g.default.Item,(0,p.default)({className:N.default.clearConform},U,{label:"\u4ee3\u7801\u7248\u672c"}),Q("code_version",{initialValue:v?v.code_version:"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ee3\u7801\u7248\u672c"}]})(k.default.createElement(f.default,{getPopupContainer:e=>e.parentNode,placeholder:"\u8bf7\u8f93\u5165\u4ee3\u7801\u7248\u672c"},k.default.createElement(B,{label:k.default.createElement(b.default,{defaultActiveKey:"branches",onChange:this.onTabChange,className:N.default.selectTabs},k.default.createElement(L,{tab:"\u5206\u652f",key:"branches"}),k.default.createElement(L,{tab:"Tags",key:"tags"}))},_.length>0?_.map(e=>{return k.default.createElement(V,{key:e,value:e},e)}):k.default.createElement(V,{value:"loading"},k.default.createElement(d.default,{spinning:y}))))))))," "),this.state.showMarketAppDetail&&k.default.createElement(A.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:this.state.showApp}))}},y=E))||y)||y);t.default=q},Lu99:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("P2fV");var r=l(a("NJEC"));a("IzEo");var i=l(a("bx4M"));a("BoS7");var o=l(a("Sdc0"));a("+BJd");var d=l(a("mr32"));a("+L6B");var u=l(a("2/Rp")),c=l(a("jehZ"));a("/xke");var p=l(a("TeRw")),h=l(a("p0pE"));a("7Kak");var m=l(a("9yH6"));a("y8nQ");var f,g,v,_,y=l(a("Vl3Y")),E=a("MuoO"),b=s(a("q1tI")),C=l(a("q76B")),S=l(a("iPMB")),k=l(a("cUW5")),w=l(a("AipW")),A=l(a("CQXj")),x=l(a("WTXe")),D=l(a("QDog")),T=l(a("18Tw")),P=l(a("Bg2k")),M=l(a("2RmR")),N=l(a("YTVB")),I=l(a("GUlx")),R=l(a("760Q")),L=l(a("qPtA")),O=y.default.Item,V=m.default.Group,B=(f=(0,E.connect)(e=>{var t=e.user,a=e.appControl,l=e.teamControl;return{currUser:t.currentUser,startProbe:a.startProbe,runningProbe:a.runningProbe,ports:a.ports,baseInfo:a.baseInfo,appDetail:a.appDetail,teamControl:l,appControl:a}},null,null,{withRef:!0}),g=y.default.create(),f(v=g((_=class extends b.default.Component{constructor(e){super(e),this.onTransfer=(e=>{this.setState({transfer:e})}),this.onDeleteVar=(e=>{this.setState({deleteVar:e})}),this.fetchBaseInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchBaseInfo",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias}})}),this.fetchPorts=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchPorts",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias}})}),this.fetchTags=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchTags",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{e&&this.setState({tags:e.used_labels})}})}),this.fetchInnerEnvs=(()=>{var e=this.state,t=e.page,a=e.page_size,l=e.env_name;this.props.dispatch({type:"appControl/fetchInnerEnvs",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,page:t,page_size:a,env_name:l}})}),this.loadMembers=(()=>{var e=this.props.dispatch,t=D.default.getCurrTeamName();e({type:"teamControl/fetchMember",payload:{team_name:t,app_alias:this.props.appAlias},callback:e=>{e&&this.setState({memberslist:e.list})}})}),this.showAddMember=(()=>{this.setState({showAddMember:!0})}),this.hideAddMember=(()=>{this.setState({showAddMember:!1})}),this.handleAddMember=(e=>{this.props.dispatch({type:"appControl/setMemberAction",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:()=>{this.loadMembers(),this.hideAddMember()}})}),this.handleAddVar=(()=>{this.setState({showAddVar:!0})}),this.handleCancelAddVar=(()=>{this.setState({showAddVar:!1})}),this.handleSubmitAddVar=(e=>{this.props.dispatch({type:"appControl/addInnerEnvs",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,attr_name:e.attr_name,attr_value:e.attr_value,name:e.name},callback:()=>{this.handleCancelAddVar(),this.fetchInnerEnvs()}})}),this.cancelDeleteVar=(()=>{this.setState({deleteVar:null})}),this.cancelTransfer=(()=>{this.setState({transfer:null})}),this.handleDeleteVar=(()=>{this.props.dispatch({type:"appControl/deleteEnvs",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:this.state.deleteVar.ID},callback:()=>{this.cancelDeleteVar(),this.fetchInnerEnvs(),p.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleTransfer=(()=>{var e=this.state.transfer;this.props.dispatch({type:"appControl/putTransfer",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:e.ID,scope:"inner"==e.scope?"outer":"inner"},callback:()=>{this.cancelTransfer(),this.fetchInnerEnvs(),p.default.success({message:"\u64cd\u4f5c\u6210\u529f"})}})}),this.onEditVar=(e=>{this.setState({showEditVar:e})}),this.cancelEditVar=(()=>{this.setState({showEditVar:null})}),this.handleEditVar=(e=>{var t=this.state.showEditVar;this.props.dispatch({type:"appControl/editEvns",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:t.ID,attr_value:e.attr_value,name:e.name},callback:()=>{this.cancelEditVar(),this.fetchInnerEnvs()}})}),this.handleStartProbeStart=(e=>{var t=this.props.startProbe;this.props.dispatch({type:"appControl/editStartProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},t,{is_used:e}),callback:t=>{t&&t.status_code&&200===t.status_code&&(this.fetchStartProbe(),e?p.default.success({message:"\u542f\u7528\u6210\u529f,\u8bf7\u66f4\u65b0\u7ec4\u4ef6\u540e\u751f\u6548"}):p.default.success({message:"\u7981\u7528\u6210\u529f,\u8bf7\u66f4\u65b0\u7ec4\u4ef6\u540e\u751f\u6548"}))}})}),this.handleRunProbeStart=(e=>{var t=this.props.runningProbe;this.props.dispatch({type:"appControl/editRunProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},t,{is_used:e}),callback:()=>{this.fetchRunningProbe()}})}),this.handleEditHealth=(e=>{var t=this.props.startProbe;this.setState({loading:!0}),A.default.isStartProbeUsed(this.state.editStartHealth)?this.props.dispatch({type:"appControl/editStartProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e,{old_mode:t.mode}),callback:e=>{e&&e.status_code&&200===e.status_code&&(this.onCancelEditStartProbe(),this.fetchStartProbe(),p.default.success({message:"\u7f16\u8f91\u6210\u529f,\u8bf7\u66f4\u65b0\u7ec4\u4ef6\u540e\u751f\u6548!"}))}}):this.props.dispatch({type:"appControl/addStartProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:e=>{e&&e.status_code&&200===e.status_code&&(this.onCancelEditStartProbe(),this.fetchStartProbe(),p.default.success({message:"\u6dfb\u52a0\u6210\u529f"}),p.default.info({message:"\u9700\u8981\u66f4\u65b0\u540e\u624d\u80fd\u751f\u6548"}))}})}),this.handleEditRunHealth=(e=>{A.default.isRunningProbeUsed(this.state.editRunHealth)?this.props.dispatch({type:"appControl/editRunProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:()=>{this.onCancelEditRunProbe(),this.fetchRunningProbe()}}):this.props.dispatch({type:"appControl/addRunProbe",payload:(0,h.default)({team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:()=>{this.onCancelEditRunProbe(),this.fetchRunningProbe()}})}),this.showViewStartHealth=(e=>{this.setState({viewStartHealth:e})}),this.hiddenViewStartHealth=(()=>{this.setState({viewStartHealth:null})}),this.showViewRunningHealth=(e=>{this.setState({viewRunHealth:e})}),this.hiddenViewRunningHealth=(()=>{this.setState({viewRunHealth:null})}),this.onCancelEditStartProbe=(()=>{this.setState({editStartHealth:null,loading:!1})}),this.onCancelEditRunProbe=(()=>{this.setState({editRunHealth:null})}),this.handleRemoveTag=(e=>{this.props.dispatch({type:"appControl/deleteTag",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,label_id:e.label_id},callback:()=>{p.default.success({message:"\u5220\u9664\u6210\u529f"}),this.fetchTags()}})}),this.onAddTag=(()=>{this.props.dispatch({type:"appControl/getTagInformation",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{e&&this.setState({addTag:!0,tabData:e.list})}})}),this.cancelAddTag=(()=>{this.setState({addTag:!1,tabData:[]})}),this.handleAddTag=(e=>{this.props.dispatch({type:"appControl/addTag",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,label_ids:e},callback:()=>{this.cancelAddTag(),p.default.success({message:"\u6dfb\u52a0\u6210\u529f\u9700\u91cd\u542f\u6216\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.fetchTags(),this.setState({tabData:[]})}})}),this.onEditAction=(e=>{this.setState({toEditAction:e})}),this.hideEditAction=(()=>{this.setState({toEditAction:null})}),this.handleEditAction=(e=>{var t=D.default.getCurrTeamName();this.props.dispatch({type:"appControl/editMemberAction",payload:(0,h.default)({team_name:t,user_id:this.state.toEditAction.user_id,app_alias:this.props.appAlias},e),callback:()=>{this.loadMembers(),this.hideEditAction()}})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.updateComponentDetail=(()=>{var e=this.props.match.params.teamName,t=this.props.appAlias;this.props.dispatch({type:"appControl/fetchDetail",payload:{team_name:e,app_alias:t},callback:e=>{this.setState({currentComponent:e.service})}})}),this.setupAttribute=(()=>{x.default.canVisit(this.props.status)?p.default.warning({message:"\u8bf7\u5148\u5173\u95ed\u7ec4\u4ef6\u540e\u518d\u66f4\u6539\u72b6\u6001"}):this.setState({visibleAppSetting:!0})}),this.handleOk_AppSetting=(()=>{var e=this.props.dispatch;this.props.form.validateFields((t,a)=>{t||e({type:"appControl/updateComponentDeployType",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias,extend_method:a.extend_method},callback:e=>{e&&(p.default.success({message:e.msg_show||"\u4fee\u6539\u6210\u529f"}),this.setState({visibleAppSetting:!1,isShow:!1},()=>{this.fetchBaseInfo(),this.updateComponentDetail()}))}})})}),this.handleChange=(e=>{var t=this.props.onChecked;t&&(t(e),setTimeout(()=>{this.fetchBaseInfo()},1e3))}),this.handleCancel_AppSetting=(()=>{this.setState({visibleAppSetting:!1,isShow:!1})}),this.onChange1=(e=>{var t=e.target.value!=(this.props.baseInfo.extend_method||"stateless_multiple");this.setState({isShow:t})}),this.handleState=(e=>{return A.default.isStartProbeUsed(e)?A.default.isStartProbeStart(e)?"\u5df2\u542f\u7528":"\u5df2\u7981\u7528":"\u672a\u8bbe\u7f6e"}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchInnerEnvs()})}),this.handleSearch=(e=>{this.setState({page:1,env_name:e},()=>{this.fetchInnerEnvs()})}),this.state={isShow:!1,showAddVar:!1,showEditVar:null,deleteVar:null,transfer:null,viewStartHealth:null,editStartHealth:null,viewRunHealth:null,editRunHealth:null,addTag:!1,tabData:[],showAddMember:!1,toEditAction:null,memberslist:null,showMarketAppDetail:!1,showApp:{},visibleAppSetting:!1,tags:[],page:1,page_size:5,env_name:"",loading:!1}}componentDidMount(){this.canView()&&(this.props.dispatch({type:"teamControl/fetchAllPerm"}),this.fetchInnerEnvs(),this.fetchStartProbe(),this.fetchRunningProbe(),this.fetchPorts(),this.fetchBaseInfo(),this.fetchTags(),this.loadMembers())}componentWillUnmount(){var e=this.props.dispatch;e({type:"appControl/clearTags"}),e({type:"appControl/clearPorts"}),e({type:"appControl/clearInnerEnvs"}),e({type:"appControl/clearStartProbe"}),e({type:"appControl/clearRunningProbe"}),e({type:"appControl/clearMembers"})}fetchStartProbe(){this.props.dispatch({type:"appControl/fetchStartProbe",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias}})}fetchRunningProbe(){this.props.dispatch({type:"appControl/fetchRunningProbe",payload:{team_name:D.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{}})}canView(){var e=this.props.componentPermissions,t=e.isDeploytype,a=e.isCharacteristic,l=e.isHealth;return t||a||l}render(){if(!this.canView())return b.default.createElement(k.default,null);var e=this.props,t=e.startProbe,a=e.ports,l=e.baseInfo,s=e.teamControl,p=e.form,h=e.componentPermissions,f=h.isDeploytype,g=h.isCharacteristic,v=h.isHealth,_=this.state,E=_.viewStartHealth,x=_.tags,B=_.tabData,q=_.isShow,F=_.loading,U=p.getFieldDecorator,z={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},H={wrapperCol:{span:24}},j={display:"block",height:"30px",lineHeight:"30px"};return"boolean"!==typeof l.build_upgrade?null:b.default.createElement(b.Fragment,null,b.default.createElement(i.default,{style:{marginBottom:24},title:"\u57fa\u7840\u4fe1\u606f"},b.default.createElement(y.default,null,b.default.createElement(O,(0,c.default)({style:{marginBottom:0}},z,{label:"\u521b\u5efa\u65f6\u95f4"}),l.create_time||""),b.default.createElement(O,(0,c.default)({style:{marginBottom:0}},z,{label:"\u7ec4\u4ef6\u90e8\u7f72\u7c7b\u578b"}),D.default.getComponentType(l.extend_method),f&&b.default.createElement(u.default,{onClick:this.setupAttribute,size:"small",style:{marginLeft:"10px"}},"\u66f4\u6539")),b.default.createElement(O,(0,c.default)({style:{marginBottom:0}},z,{label:"\u7ec4\u4ef6\u7279\u6027"}),(x||[]).map((e,t)=>b.default.createElement(d.default,{key:"tag".concat(t),closable:!0,onClose:t=>{t.preventDefault(),this.handleRemoveTag(e)}},e.label_alias)),g&&b.default.createElement(u.default,{onClick:this.onAddTag,size:"small"},"\u6dfb\u52a0\u7279\u6027")),b.default.createElement(O,(0,c.default)({style:{marginBottom:0}},z,{label:"\u7ec4\u4ef6\u6784\u5efa\u540e\u81ea\u52a8\u5347\u7ea7"}),b.default.createElement(o.default,{defaultChecked:l.build_upgrade,onChange:this.handleChange})))),v&&b.default.createElement(i.default,{style:{marginBottom:24},title:b.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},"\u5065\u5eb7\u68c0\u6d4b",t&&b.default.createElement("div",null,b.default.createElement("a",{onClick:()=>{this.setState({editStartHealth:t})},style:{marginRight:"5px",fontSize:"14px",fontWeight:400}},"{}"!=JSON.stringify(t)?"\u7f16\u8f91":"\u8bbe\u7f6e"),"{}"!=JSON.stringify(t)&&A.default.isStartProbeStart(t)?b.default.createElement("a",{onClick:()=>{this.handleStartProbeStart(!1)},style:{fontSize:"14px",fontWeight:400}},"\u7981\u7528"):"{}"!=JSON.stringify(t)&&b.default.createElement("a",{onClick:()=>{this.handleStartProbeStart(!0)},style:{fontSize:"14px",fontWeight:400}},"\u542f\u7528")))},t&&b.default.createElement("div",{style:{display:"flex"}},b.default.createElement("div",{style:{width:"33%",textAlign:"center"}},"\u5f53\u524d\u72b6\u6001:",this.handleState(t)),b.default.createElement("div",{style:{width:"33%",textAlign:"center"}},"\u68c0\u6d4b\u65b9\u5f0f:",t.scheme?t.scheme:"\u672a\u8bbe\u7f6e"),b.default.createElement("div",{style:{width:"33%",textAlign:"center"}},"\u4e0d\u5065\u5eb7\u5904\u7406\u65b9\u5f0f:","readiness"===t.mode?"\u4e0b\u7ebf":"liveness"===t.mode?"\u91cd\u542f":"\u672a\u8bbe\u7f6e"))),this.state.addTag&&b.default.createElement(T.default,{tags:B||[],onCancel:this.cancelAddTag,onOk:this.handleAddTag}),this.state.showAddVar&&b.default.createElement(N.default,{onCancel:this.handleCancelAddVar,onSubmit:this.handleSubmitAddVar,isShowRestartTips:e=>{this.props.onshowRestartTips(e)}}),this.state.showEditVar&&b.default.createElement(N.default,{onCancel:this.cancelEditVar,onSubmit:this.handleEditVar,data:this.state.showEditVar,isShowRestartTips:e=>{this.props.onshowRestartTips(e)}}),this.state.deleteVar&&b.default.createElement(C.default,{onOk:this.handleDeleteVar,onCancel:this.cancelDeleteVar,title:"\u5220\u9664\u53d8\u91cf",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u53d8\u91cf\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d"}),this.state.transfer&&b.default.createElement(C.default,{onOk:this.handleTransfer,onCancel:this.cancelTransfer,title:"\u8f6c\u79fb\u73af\u5883\u53d8\u91cf",desc:"\u786e\u5b9a\u8981\u8f6c\u79fb\u6b64\u53d8\u91cf\u5417\uff1f",subDesc:""}),E&&b.default.createElement(I.default,{title:"\u5065\u5eb7\u68c0\u67e5\u67e5\u770b",data:E,onCancel:()=>{this.setState({viewStartHealth:null})}}),this.state.editStartHealth&&b.default.createElement(P.default,{ports:a,onOk:this.handleEditHealth,title:"\u5065\u5eb7\u68c0\u6d4b",data:this.state.editStartHealth,onCancel:this.onCancelEditStartProbe,loading:F}),this.state.toEditAction&&b.default.createElement(R.default,{onSubmit:this.handleEditAction,onCancel:this.hideEditAction,actions:s.actions,value:this.state.toEditAction.service_perms.map(e=>e.id)}),this.state.viewRunHealth&&b.default.createElement(L.default,{title:"\u8fd0\u884c\u65f6\u68c0\u67e5\u67e5\u770b",data:this.state.viewRunHealth,onCancel:()=>{this.setState({viewRunHealth:null})}}),this.state.editRunHealth&&b.default.createElement(M.default,{ports:a,onOk:this.handleEditRunHealth,title:"\u8bbe\u7f6e\u8fd0\u884c\u65f6\u68c0\u67e5",data:this.state.editRunHealth,onCancel:this.onCancelEditRunProbe}),this.state.showAddMember&&b.default.createElement(w.default,{members:this.state.memberslist,actions:s.actions,onOk:this.handleAddMember,onCancel:this.hideAddMember}),this.state.showMarketAppDetail&&b.default.createElement(S.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:this.state.showApp}),this.state.visibleAppSetting&&b.default.createElement(n.default,{title:"\u7ec4\u4ef6\u90e8\u7f72\u7c7b\u578b\u8bbe\u7f6e",visible:this.state.visibleAppSetting,width:600,onCancel:this.handleCancel_AppSetting,footer:q?[b.default.createElement(r.default,{title:"\u4fee\u6539\u90e8\u7f72\u7c7b\u578b\uff0c\u5b58\u50a8\u6570\u636e\u53ef\u80fd\u4e22\u5931\u6216\u5b58\u50a8\u4e0d\u53ef\u7528,\u4f60\u786e\u5b9a\u8981\u4fee\u6539\u5417\uff1f",onConfirm:this.handleOk_AppSetting,onCancel:this.handleCancel_AppSetting,okText:"Yes",cancelText:"No"},b.default.createElement(u.default,{type:"primary"},"\u786e\u5b9a")),b.default.createElement(u.default,{onClick:this.handleCancel_AppSetting},"\u53d6\u6d88")]:b.default.createElement("div",null,b.default.createElement(u.default,{type:"primary",onClick:this.handleCancel_AppSetting},"\u786e\u5b9a"),b.default.createElement(u.default,{onClick:this.handleCancel_AppSetting},"\u53d6\u6d88"))},b.default.createElement(y.default.Item,H,U("extend_method",{initialValue:l.extend_method||"stateless_multiple",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7ec4\u4ef6\u7c7b\u578b"}]})(b.default.createElement(V,{onChange:this.onChange1},D.default.getSupportComponentTyps().map(e=>{return b.default.createElement("div",{key:e.type},b.default.createElement(m.default,{style:j,value:e.type},e.name),b.default.createElement("p",{style:{color:"#999999",paddingLeft:"26px"}},e.desc))}))))))}},v=_))||v)||v);t.default=B},LzeT:function(e,t,a){e.exports={customCard:"customCard___3BuzB"}},OSFV:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV"));a("Pwec");var r=s(a("CtXQ"));a("+L6B");var i=s(a("2/Rp")),o=l(a("q1tI")),d=a("xpXo"),u=s(a("QDog"));class c extends o.PureComponent{constructor(e){super(e),this.state={list:[],loading:!0}}componentDidMount(){this.loadData()}loadData(){(0,d.getHistoryLog)({team_name:u.default.getCurrTeamName(),app_alias:this.props.appAlias}).then(e=>{e&&this.setState({loading:!1,list:e.list||[]})})}render(){var e=this.state,t=e.loading,a=e.list;return o.default.createElement(n.default,{title:"\u5386\u53f2\u65e5\u5fd7\u4e0b\u8f7d",visible:!0,width:700,onCancel:this.props.onCancel,footer:[o.default.createElement(i.default,{onClick:this.props.onCancel},"\u5173\u95ed")]},t?o.default.createElement("div",{style:{textAlign:"center"}},o.default.createElement(r.default,{type:"loading",style:{marginTop:100,marginBottom:100}})):"",t?"":o.default.createElement("div",{style:{textAlign:"left"}},a.length>0?o.default.createElement("div",null,a.map(e=>{return o.default.createElement("p",{key:e.file_name},o.default.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:e.file_url},e.file_name))})):o.default.createElement("p",{style:{textAlign:"center"}},"\u6682\u65e0\u5386\u53f2\u65e5\u5fd7")))}}t.default=c},Oz9w:function(e,t,a){e.exports={ant_form_item:"ant_form_item___IsEuZ",ant_radio_disabled:"ant_radio_disabled___26CQv",selectTabs:"selectTabs___3ppt5"}},P5R6:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAABNklEQVQ4T2P8////fwYoePv+A8PilRsZ9h0+wfD46XOwqKy0JIOTrQVDbLg/g7CgAEwpAyNM4469hxnq2icyeLnaM/h7uTCoKcuDFd26+4Bh47a9DNt2H2Roqsxn8HC2BYuDNYI0NfdOY5jR08igq6UGNxWZcfnaLYaMknqG2uIssGbGN+/e//cMTWGYO6kNRdP2vYfA+jyd7eD6QZqT86oYtq+ew8DYP33B/w8fPzE0lOei2NQ9eS6YX5qbjCLe0DmZQYCfj4HRNyrjf2NFHoOhriZRGs9fvsZQ3zGZgdHA3v//kW3LGLi5uIjS+PXbNwYbrygKNOJy6smzl8AuMDfWQ3EJ3Km4Auf1m3cMDIwMDKLCQtgDB1d07Nx/BKzB3dEGe3SAEgAozlp6p5OWAChKcuQkcgDSq8inQDppLQAAAABJRU5ErkJggg=="},Pp4N:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("T2oS");var r=l(a("W9HT"));a("IzEo");var i=l(a("bx4M")),o=l(a("jehZ"));a("O3gP");var d=l(a("lrIw"));a("5NDa");var u=l(a("5rEg"));a("fOrg");var c=l(a("+KLJ"));a("+L6B");var p=l(a("2/Rp"));a("y8nQ");var h,m,f,g,v=l(a("Vl3Y")),_=s(a("q1tI")),y=a("MuoO"),E=l(a("LzeT")),b=l(a("e6Ls")),C=l(a("UTiu")),S=v.default.Item,k=(h=v.default.create(),m=(0,y.connect)(e=>{var t=e.user,a=e.appControl,l=e.loading;return{currUser:t.currentUser,appDetail:a.appDetail,addLoading:l.effects["monitor/addServiceMonitorFigure"],editLoading:l.effects["monitor/editServiceMonitorFigure"]}}),h(f=m((g=class extends _.PureComponent{constructor(e){super(e),this.fetchComponentMetrics=(()=>{var e=this.props,t=e.dispatch,a=e.serviceId,l=e.teamName,s=e.appAlias;t({type:"monitor/fetchComponentMetrics",payload:{team_name:l,service_alias:s,serviceId:a},callback:e=>{var t=e.list.map(e=>e.metric);this.setState({indicators:t})}})}),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.handleSearch=(()=>{var e=this.props.form;e.validateFields({force:!0},(e,t)=>{e||this.setState({RangeData:[t],isRender:!0},()=>{this.setState({isRender:!1})})})}),this.handleSubmitDelete=(()=>{this.cancalDelete()}),this.state={indicators:[],RangeData:this.props.info.graph_id?[this.props.info]:[],loading:!1,isRender:!1}}componentDidMount(){this.fetchComponentMetrics()}render(){var e=this.props,t=e.form,a=e.onCancel,l=e.dispatch,s=e.appDetail,h=e.appAlias,m=e.info,f=void 0===m?{}:m,g=e.addLoading,y=e.editLoading,k=t.getFieldDecorator,w=this.state,A=w.loading,x=w.indicators,D=w.RangeData,T=w.isRender,P={moduleName:"CustomMonitor",start:(new Date).getTime()/1e3-3600,end:(new Date).getTime()/1e3,dispatch:l,appDetail:s,appAlias:h};return _.default.createElement(n.default,{title:f&&f.ID?"\u7f16\u8f91\u56fe\u8868":"\u6dfb\u52a0\u56fe\u8868",visible:!0,width:600,confirmLoading:A,className:b.default.TelescopicModal,onCancel:a,onOk:this.onOk,footer:[_.default.createElement(p.default,{style:{marginTop:"10px"},onClick:a},"\u53d6\u6d88"),_.default.createElement(p.default,{style:{marginTop:"10px"},type:"primary",loading:g||y,onClick:this.onOk},f&&f.graph_id?"\u4fdd\u5b58":"\u6dfb\u52a0")]},_.default.createElement(_.Fragment,null,_.default.createElement(v.default,{onSubmit:this.onOk},_.default.createElement(r.default,{spinning:A},_.default.createElement(c.default,{style:{marginBottom:"10px"},message:"\u8bf7\u8f93\u5165 \u6807\u51c6PromQL \u8bed\u6cd5\u8fdb\u884c\u67e5\u8be2\u663e\u793a\u56fe\u8868",type:"info",showIcon:!0}),_.default.createElement(i.default,{className:E.default.customCard,headStyle:{padding:"0 24px"},title:_.default.createElement(S,null,k("title",{initialValue:f.title||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u6807\u9898"},{max:64,message:"\u6700\u5927\u957f\u5ea664\u4f4d"}]})(_.default.createElement(u.default,{style:{width:"calc(100% - 15px)"},placeholder:"\u8bf7\u586b\u5199\u6807\u9898"})))},_.default.createElement("div",null,_.default.createElement(S,null,k("promql",{initialValue:f.promql||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u67e5\u8be2\u6761\u4ef6"},{max:255,message:"\u6700\u5927\u957f\u5ea6255\u4f4d"}]})(_.default.createElement(d.default,{style:{width:"calc(100% - 75px)",marginRight:"5px"},dataSource:x,filterOption:(e,t)=>-1!==t.props.children.toUpperCase().indexOf(e.toUpperCase()),placeholder:"\u8bf7\u586b\u5199\u67e5\u8be2\u6761\u4ef6"})),_.default.createElement(p.default,{onClick:this.handleSearch},"\u67e5\u8be2")),_.default.createElement("div",{style:{minHeight:"300px"}},D.length>0&&D.map(e=>{var t=e.title,a=e.promql;return _.default.createElement(C.default,(0,o.default)({moduleName:"CustomMonitor",isEdit:!1,key:t,isRender:T},P,{title:t,type:a}))}))))))))}},f=g))||f)||f);t.default=k},QKd8:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAAAoUlEQVQoU9WQMQrEIBBFv6QJpk5t5VGEXCBFriDY5RIeICmtBQv7QK4iWAW8gxgMu4GwucBO9WfmMfz5pJRSAOA4DmzbVuVVlFKM43j3xDlX9n3Hh78XX0EIgRACpF6UUiLn/APVQdM0WNf1CU7TBGst2rbFMAzw3r+DSiksy4Ku6y5/xpj/BRljiDGiZtf3PVJKz2e01gghvObIOcc8zzgBRWqW6sMFhjYAAAAASUVORK5CYII="},SgVc:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("14J3");var r=l(a("BMrR"));a("jCWc");var i=l(a("kPKH")),o=l(a("jehZ"));a("5NDa");var d=l(a("5rEg"));a("OaEy");var u=l(a("2fM7"));a("y8nQ");var c,p,h,m=l(a("Vl3Y")),f=s(a("q1tI")),g=m.default.Item,v=(u.default.Option,d.default.TextArea,c=m.default.create(),c((h=class extends f.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields({force:!0},(e,t)=>{e||this.props.onOk&&this.props.onOk(t)})}),this.handleCancel=(()=>{this.props.onCancel&&this.props.onCancel()}),this.state={}}render(){var e=this.props.form,t=e.getFieldDecorator,a=(e.getFieldValue,{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}});return f.default.createElement(n.default,{title:"\u65b0\u589e\u4e8c\u7ea7\u57df\u540d",onOk:this.handleSubmit,visible:!0,onCancel:this.handleCancel},f.default.createElement(r.default,{gutter:24},f.default.createElement(i.default,{className:"gutter-row",span:12},f.default.createElement(m.default,{onSubmit:this.handleSubmit},f.default.createElement(g,(0,o.default)({},a,{label:"\u57df\u540d"}),t("domain",{rules:[{required:!0,message:"\u8bf7\u6dfb\u52a0\u57df\u540d"},{pattern:/^[0-9a-zA-Z.]*$/,message:"\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u8f93\u5165\u6570\u5b57\u6216\u5b57\u6bcd"}]})(f.default.createElement(d.default,{placeholder:"\u8bf7\u586b\u5199\u57df\u540d"}))))),f.default.createElement(i.default,{className:"gutter-row",span:12,style:{lineHeight:"36px"}},".",this.props.sld_suffix)))}},p=h))||p);t.default=v},Szue:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("g9YV");var r=l(a("wCAj"));a("Pwec");var i=l(a("CtXQ"));a("/xke");var o=l(a("TeRw"));a("2qtc");var d=l(a("kLXV"));a("+L6B");var u,c,p,h=l(a("2/Rp")),m=a("MuoO"),f=a("7DNP"),g=s(a("q1tI")),v=l(a("8hm0")),_=l(a("MXRY")),y=l(a("cUW5")),E=l(a("puxM")),b=a("xpXo"),C=l(a("QDog"));class S extends g.PureComponent{render(){var e=this.props,t=e.appAlias,a=e.onCancel;return g.default.createElement(d.default,{title:"\u4f9d\u8d56\u4fe1\u606f\u67e5\u770b",width:1e3,visible:!0,onCancel:a,footer:[g.default.createElement(h.default,{onClick:a},"\u5173\u95ed")]},g.default.createElement(_.default,{title:"",type:"OuterEnvs",autoQuery:!0,appAlias:t}))}}var k=(u=(0,m.connect)(null,null,null,{withRef:!0}),u((p=class extends g.PureComponent{constructor(e){super(e),this.onViewRelationInfo=(e=>{this.setState({viewRelationInfo:e})}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.loadRelationedApp()})}),this.loadRelationedApp=(()=>{var e=this.state,t=e.page,a=e.pageSize;(0,b.getRelationedApp)({team_name:C.default.getCurrTeamName(),app_alias:this.props.appAlias,page:t,pageSize:a}).then(e=>{if(e){var t=e.bean.port_list;e.list&&e.list.length>0&&e.list.map(e=>{var a=e.ports_list;return t=t.concat(a),e}),t=this.isRepeat(t),this.setState({relationList:e.list||[],showText:t,total:e.bean.total})}})}),this.isRepeat=(e=>{var t={};for(var a in e){if(t[e[a]])return!0;t[e[a]]=!0}return!1}),this.showAddRelation=(()=>{this.setState({showAddRelation:!0})}),this.handleCancelAddRelation=(()=>{this.setState({showAddRelation:!1})}),this.handleSubmitAddRelation=(e=>{(0,b.batchAddRelationedApp)({team_name:C.default.getCurrTeamName(),app_alias:this.props.appAlias,dep_service_ids:e}).then(e=>{e&&(o.default.info({message:"\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.loadRelationedApp(),this.handleCancelAddRelation())})}),this.handleRemoveRelationed=(e=>{(0,b.removeRelationedApp)({team_name:C.default.getCurrTeamName(),app_alias:this.props.appAlias,dep_service_id:e.service_id}).then(e=>{e&&this.loadRelationedApp()})}),this.cancelViewRelationInfo=(()=>{this.setState({viewRelationInfo:null})}),this.state={showAddRelation:!1,relationList:[],viewRelationInfo:null,showText:null,page:1,pageSize:8,total:0}}componentDidMount(){this.loadRelationedApp()}shouldComponentUpdate(){return!0}canView(){var e=this.props.componentPermissions.isRely;return e}render(){var e=this.state,t=e.showText,a=e.relationList,l=this.props.appAlias;return this.canView()?g.default.createElement(g.Fragment,null,g.default.createElement(_.default,{title:"\u7ec4\u4ef6\u8fde\u63a5\u4fe1\u606f",type:"Outer",autoQuery:!0,appAlias:l}),g.default.createElement(n.default,{title:[g.default.createElement("span",null,"\u4f9d\u8d56\u7ec4\u4ef6\u4fe1\u606f"),g.default.createElement("span",{style:{color:"red"}},t&&"\uff08\u4f9d\u8d56\u7684\u7ec4\u4ef6\u6709\u76f8\u540c\u7684\u7aef\u53e3\u51b2\u7a81,\u8bf7\u5904\u7406\uff09")],extra:g.default.createElement(h.default,{onClick:this.showAddRelation},g.default.createElement(i.default,{type:"plus"})," \u6dfb\u52a0\u4f9d\u8d56")},g.default.createElement(E.default,{sm:650},g.default.createElement(r.default,{pagination:{current:this.state.page,pageSize:this.state.pageSize,total:this.state.total,onChange:this.onPageChange},columns:[{title:"\u7ec4\u4ef6\u540d",dataIndex:"service_cname",render:(e,t)=>g.default.createElement(f.Link,{to:"/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/components/").concat(t.service_alias,"/overview")},e)},{title:"\u6240\u5c5e\u5e94\u7528",dataIndex:"group_name",render:(e,t)=>g.default.createElement(f.Link,{to:"/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/apps/").concat(t.group_id)},e)},{title:"\u64cd\u4f5c",dataIndex:"var",render:(e,t)=>g.default.createElement(g.Fragment,null,g.default.createElement("a",{onClick:()=>this.onViewRelationInfo(t),href:"javascript:;",style:{margintRight:10}},"\u8fde\u63a5\u4fe1\u606f"),g.default.createElement("a",{onClick:()=>{this.handleRemoveRelationed(t)},href:"javascript:;",style:{margintRight:10}},"\u53d6\u6d88\u4f9d\u8d56"))}],dataSource:a}))),this.state.showAddRelation&&g.default.createElement(v.default,{appAlias:this.props.appAlias,onCancel:this.handleCancelAddRelation,onSubmit:this.handleSubmitAddRelation}),this.state.viewRelationInfo&&g.default.createElement(S,{appAlias:this.state.viewRelationInfo.service_alias,onCancel:this.cancelViewRelationInfo})):g.default.createElement(y.default,null)}},c=p))||c);t.default=k},UTiu:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var n=l(a("W9HT"));a("IzEo");var r=l(a("bx4M"));a("/xke");var i,o,d,u=l(a("TeRw")),c=l(a("p0pE")),p=l(a("QDog")),h=l(a("YM/Z")),m=a("yP6+"),f=a("MuoO"),g=l(a("wd/R")),v=s(a("q1tI")),_=l(a("YUe+")),y=(i=(0,f.connect)(),i((d=class extends v.PureComponent{constructor(e){var t;super(e),t=this,this.loadPerformanceAnalysis=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.setState({loading:!0});var l=e.dispatch,s=e.appAlias;l({type:"appControl/fetchPerformanceAnalysis",payload:Object.assign({},t.handleParameter(e,a),{app_alias:s}),callback:e=>{t.setState({loading:!1}),e.bean&&e.bean.result&&e.bean.result.length>0&&t.setState({memoryRange:e.bean.result,performanceObj:e.bean})}})},this.loadRangeData=(e=>{this.setState({loading:!0});var t=e.appDetail,a=e.dispatch;a({type:"monitor/getMonitorRangeData",payload:Object.assign({},this.handleParameter(e),{componentAlias:t.service.service_alias}),callback:e=>{this.setState({loading:!1}),e.bean&&e.bean.result&&e.bean.result.length>0&&this.setState({memoryRange:e.bean.result})}})}),this.handleParameter=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=e.moduleName,s=e.type,n=e.start,r=e.end;return{query:"CustomMonitor"===l?s:t.getQueryByType(s),start:a?(new Date).getTime()/1e3-3600:n,end:a?(new Date).getTime()/1e3:r,step:Math.ceil((r-n)/100)||15,teamName:p.default.getCurrTeamName(),disable_auto_label:!("containerNetR"!==s&&"containerNetT"!==s)}},this.getQueryByType=(e=>{var t=this.props,a=t.appDetail,l=t.baseInfo;if(a&&a.service){var s=a.service,n=s.service_id,r=s.service_alias,i=p.default.isStateComponent(l&&l.extend_method),o=i?r:n;switch(e){case"containerMem":return'container_memory_rss{name=~"k8s_'.concat(n,'.*"}/1024/1024');case"containerCpu":return'sum(rate(container_cpu_usage_seconds_total{name=~"k8s_'.concat(n,'.*"}[1m])) by (pod, namespace) / (sum(container_spec_cpu_quota{name=~"k8s_').concat(n,'.*"}/container_spec_cpu_period{name=~"k8s_').concat(n,'.*"}) by (pod, namespace)) * 100');case"containerNetR":return'rate(container_network_receive_bytes_total{name=~"k8s_POD_'.concat(o,'.*"}[1m])/1024');case"containerNetT":return'rate(container_network_transmit_bytes_total{name=~"k8s_POD_'.concat(o,'.*"}[1m])/1024');case"responseTime":return'ceil(avg(app_requesttime{mode="avg",service_id="'.concat(n,'"}))');case"throughput":return'sum(ceil(increase(app_request{service_id="'.concat(n,'",method="total"}[1m])/12))');case"numberOnline":return'max(app_requestclient{service_id="'.concat(n,'"})');default:return""}}return""}),this.getMeta=(()=>{var e=this.props,t=e.type,a=e.title,l=e.moduleName;if("CustomMonitor"===l)return{title:a,label:a,unit:""};switch(t){case"containerMem":return{title:"\u5185\u5b58\u4f7f\u7528\u91cf",label:"\u5185\u5b58\uff08MB\uff09",unit:" MB"};case"containerCpu":return{title:"CPU\u4f7f\u7528\u7387",label:"CPU\u4f7f\u7528\u7387\uff08%\uff09",unit:"%"};case"containerNetR":return{title:"\u4f20\u5165\u6d41\u91cf",label:"\u6d41\u91cf\uff08KB/s\uff09",unit:" KB/s"};case"containerNetT":return{title:"\u4f20\u51fa\u6d41\u91cf",label:"\u6d41\u91cf\uff08KB/s\uff09",unit:" KB/s"};case"responseTime":return{title:"\u54cd\u5e94\u65f6\u95f4",label:"\u54cd\u5e94\u65f6\u95f4\uff08ms\uff09",unit:" ms"};case"throughput":return{title:"\u541e\u5410\u7387",label:"\u541e\u5410\u7387\uff08dps\uff09",unit:" dps"};case"numberOnline":return{title:"\u5728\u7ebf\u4eba\u6570",label:"\u5728\u7ebf\u4eba\u6570",unit:""};default:return{title:"",label:"",unit:""}}}),this.converData=(e=>{var t=[];return e&&e.map(e=>{var a=Object.assign({},e.metric),l="";a&&a.__name__&&(delete a.__name__,l=e.metric.__name__+JSON.stringify(a)),a&&a.pod&&(l=e.metric.pod+JSON.stringify(a)),e.values&&e.values.map(e=>{t.push({cid:l,time:1e3*e[0],value:Math.floor(100*Number(e[1]))/100})})}),t}),this.loadRefresh=(()=>{var e=this.props.moduleName;"PerformanceAnalysis"===e||"CustomMonitor"===e?this.loadPerformanceAnalysis(this.props,!0):this.loadRangeData(this.props)}),this.handleSubmit=(e=>{var t=this.props,a=t.dispatch,l=t.appAlias,s=t.CustomMonitorInfo,n=t.upData;s&&s.graph_id&&n&&a({type:"monitor/editServiceMonitorFigure",payload:(0,c.default)({app_alias:l,team_name:p.default.getCurrTeamName()},e,{graph_id:s.graph_id,sequence:s.sequence}),callback:e=>{e&&200===e.status_code&&(u.default.success({message:"\u4fdd\u5b58\u6210\u529f"}),n(),this.onCancelCustomMonitoring())}})}),this.state={memoryRange:[],performanceObj:{}}}componentWillMount(){var e=this.props.moduleName;"PerformanceAnalysis"===e||"CustomMonitor"===e?this.loadPerformanceAnalysis(this.props):this.loadRangeData(this.props)}componentWillReceiveProps(e){var t=this.props,a=t.start,l=t.end,s=t.step,n=t.moduleName,r=e.start,i=e.end,o=e.step,d=e.isRender,u=a!==r||l!==i||s!==o;"CustomMonitor"===n&&u&&d&&this.loadPerformanceAnalysis(e),"PerformanceAnalysis"===n&&u?this.loadPerformanceAnalysis(e):u&&"CustomMonitor"!==n&&this.loadRangeData(e)}render(){var e=this.props,t=e.moduleName,a=e.onDelete,l=e.onEdit,s=e.CustomMonitorInfo,i=e.isEdit,o=void 0===i||i,d=this.state,u=d.memoryRange,c=d.performanceObj,p=d.loading,f="CustomMonitor"===t,y=this.getMeta(),E=y.title,b=y.label,C=y.unit,S="PerformanceAnalysis"===t?h.default.queryRangeTog2F(c,E):this.converData(u),k={time:{alias:"\u65f6\u95f4",tickCount:10,type:"time",formatter:e=>(0,g.default)(new Date(e)).locale("zh-cn").format("HH:mm")},value:{alias:{label:b},tickCount:5,formatter:e=>{return e>1e3?"".concat(e/1e3,"k"):e}},cid:{type:"cat"}};return v.default.createElement(v.Fragment,null,v.default.createElement(n.default,{spinning:p},v.default.createElement(r.default,{className:f&&_.default.rangeChart,title:E,extra:o&&v.default.createElement("div",null,f&&v.default.createElement("span",null,v.default.createElement("a",{onClick:e=>{e.preventDefault(),l(e,s)},style:{marginRight:"10px"}},"\u7f16\u8f91"),v.default.createElement("a",{onClick:e=>{e.preventDefault(),a(s)},style:{marginRight:"10px"}},"\u5220\u9664")),v.default.createElement("a",{onClick:this.loadRefresh},"\u5237\u65b0"))},v.default.createElement(m.Chart,{height:f?222:400,data:S,scale:k,forceFit:!0},v.default.createElement(m.Legend,{useHtml:!0,containerTpl:'<div class="g2-legend" style="position:absolute;top:20px;right:60px;width:100%;margin-top:-2px;">\n                      <h4 class="g2-legend-title"></h4>\n                      <div class='.concat(_.default.ov,'><ul class="g2-legend-list" style="list-style-type:none;margin:0;padding:0;"></ul></div>\n                    </div>\n               '),itemTpl:'\n                  <li class="g2-legend-list-item item-{index} {checked}" data-color="{originColor}" data-value="{originValue}" style="cursor: pointer;font-size: 14px;">\n                  <i class="g2-legend-marker" style="width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:10px;background-color: {color};"></i>\n                  <span title={value} class="g2-legend-text" style="display:inline-block;max-width:94%;white-space:nowrap;font-size:80%;">{value}</span>\n                  </li>',"g2-legend":{overflow:"hidden",marginTop:"-2px"},"g2-legend-list":{marginTop:"-5px",border:"none",height:"50px"},"g2-legend-list-item":{display:"flex",alignItems:"center",flexWrap:"wrap",justifyContent:"center",marginRight:0}}),v.default.createElement(m.Axis,{name:"value",label:{offset:75,htmlTemplate:e=>{var t=C?"50px":"75px";return"<div \n                                title=".concat(e,'\n                                style="width:75px;display: flex;align-items: center;"\n                            >\n                              <div style="width:').concat(t,';text-align: right;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">').concat(e,"</div>\n                              <div>").concat(C,"</div>\n                            </div>")}}}),v.default.createElement(m.Axis,{name:"time"}),v.default.createElement(m.Tooltip,{shared:!0,follow:!0,"g2-tooltip":{zIndex:99,width:"80%",overflow:"hidden"},crosshairs:{type:"y"},containerTpl:'<div class="g2-tooltip"> <p class="g2-tooltip-title"></p> <table class="g2-tooltip-list" style="display: block;width: 400px;"></table></div>',itemTpl:'<tr class="g2-tooltip-list-item" style="display: flex;justify-content: space-between;">\n                    <td style="font-size:80%;color:{color};width:90%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">{name}</td>\n                    <td style="margin-left: 5px;">{value}</td>\n                  </tr>'}),v.default.createElement(m.Geom,{type:"line",position:"time*value",color:"cid",shape:"smooth",size:1})))))}},o=d))||o);t.default=y},WTXe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={canDeploy(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("deploy")>-1},canRestart(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("reboot")>-1},canStart(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("restart")>-1},canVisit(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("visit")>-1},canStop(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("stop")>-1},canManageDocker(e){if(!e)return!1;var t=e.activeAction||[];return t.indexOf("manage_container")>-1}},s=l;t.default=s},"X+Fk":function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(a("iLo2")),r=l(a("q1tI"));class i extends r.PureComponent{render(){return r.default.createElement(r.Fragment,null,r.default.createElement(n.default,{RangeData:["containerMem","containerCpu","containerNetR","containerNetT"],moduleName:"ResourceMonitoring"}))}}t.default=i},YAxI:function(e,t,a){e.exports={table:"table___32H57",label:"label___VFMAB",lr:"lr___3fcJL",ul:"ul___CpWTW",tdPadding:"tdPadding___tN2Gs"}},"YM/Z":function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=l(a("wd/R")),n={queryTog2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e.result&&e.result.length&&e.result[0].value?t?t(e.result[0].value[1]):e.result[0].value[1]:0},queryRangeTog2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return e.result&&e.result.length&&e.result[0].values&&(t=e.result[0].values.map(e=>({x:(0,s.default)(new Date(1e3*e[0])).locale("zh-cn").format("HH:mm:ss"),y:Number(e[1]),y1:Number(e[1]),y2:Number(e[1])}))),t},queryRangeTog2F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=[];return e.result&&e.result.length&&e.result[0].values&&(a=e.result[0].values.map(e=>({cid:t,time:Number(1e3*e[0]),value:Math.round(Number(e[1]))}))),a}},r=n;t.default=r},YTVB:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("5NDa");var i=l(a("5rEg"));a("/xke");var o=l(a("TeRw"));a("OaEy");var d=l(a("2fM7"));a("y8nQ");var u,c,p,h,m=l(a("Vl3Y")),f=s(a("q1tI")),g=a("MuoO"),v=l(a("QDog")),_=m.default.Item,y=(d.default.Option,u=(0,g.connect)(e=>{var t=e.user,a=e.appControl,l=e.teamControl;return{currUser:t.currentUser,innerEnvs:a.innerEnvs,startProbe:a.startProbe,runningProbe:a.runningProbe,ports:a.ports,baseInfo:a.baseInfo,tags:a.tags,teamControl:l,appControl:a}},null,null,{withRef:!0}),c=m.default.create(),u(p=c((h=class extends f.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onSubmit,s=t.isShowRestartTips;a.validateFields((e,t)=>{e||(l&&l(t),s&&s(!0))})}),this.handleCancel=(()=>{this.props.onCancel&&this.props.onCancel()}),this.handleList=((e,t)=>{if(null==e&&null==t)return!1;var a=this.props.dispatch;a({type:"appControl/getVariableList",payload:{team_name:v.default.getCurrTeamName(),attr_name:e,attr_value:t},callback:a=>{var l=a&&a.list?a.list:[];l.unshift("".concat(e||t)),Array.from(new Set(l)),l&&l.length>0&&"null"==l[0]||(this.setState({list:l}),e&&form.setFieldsValue({attr_name:e}),t&&form.setFieldsValue({attr_value:t}))},handleError:e=>{if(e&&e.data&&10401==e.data.code)return null;e&&e.data&&e.data.msg_show&&o.default.warning({message:"\u8bf7\u6c42\u9519\u8bef",description:e.data.msg_show})}})}),this.state={fontSizeVal:"",list:[]}}render(){var e=this.props.form.getFieldDecorator,t=this.props.data||"",a={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}};this.state.list;return f.default.createElement(n.default,{title:t?"\u7f16\u8f91\u53d8\u91cf":"\u6dfb\u52a0\u53d8\u91cf",onOk:this.handleSubmit,maskClosable:!1,onCancel:this.handleCancel,visible:!0},f.default.createElement(m.default,{onSubmit:this.handleSubmit},f.default.createElement(_,(0,r.default)({},a,{label:"\u53d8\u91cf\u540d"}),e("attr_name",{initialValue:t&&t.attr_name||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53d8\u91cf\u540d\u79f0"},{pattern:/[-._a-zA-Z][-._a-zA-Z0-9]/,message:" \u5fc5\u987b\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u548c - . _ \u7ec4\u6210\uff0c\u4e0d\u652f\u6301\u6570\u5b57\u5f00\u5934"}]})(f.default.createElement(i.default,{disabled:!(!t||!t.attr_name),placeholder:"\u8bf7\u8f93\u5165\u53d8\u91cf\u540d\u79f0"}))),f.default.createElement(_,(0,r.default)({},a,{label:"\u53d8\u91cf\u503c"}),e("attr_value",{initialValue:t&&t.attr_value||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u53d8\u91cf\u503c"}]})(f.default.createElement(i.default,{placeholder:"\u8bf7\u8f93\u5165\u53d8\u91cf\u503c"}))),f.default.createElement(_,(0,r.default)({},a,{label:"\u8bf4\u660e"}),e("name",{initialValue:t&&t.name||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u53d8\u91cf\u8bf4\u660e"}]})(f.default.createElement(i.default,{placeholder:"\u8bf7\u8f93\u5165\u53d8\u91cf\u8bf4\u660e"})))))}},p=h))||p)||p);t.default=y},"YUe+":function(e,t,a){e.exports={rangeChart:"rangeChart___3yniD",ov:"ov___1gyx6",tooltips:"tooltips___2Len0",RangeChartBox:"RangeChartBox___3tyZx",customBox:"customBox___1YJPM"}},YoF6:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=l(a("BMrR"));a("jCWc");var r=l(a("kPKH"));a("lUTK");var i=l(a("BvKs"));a("IzEo");var o=l(a("bx4M"));a("+L6B");var d,u,c,p=l(a("2/Rp")),h=a("MuoO"),m=a("7DNP"),f=s(a("q1tI")),g=l(a("cUW5")),v=l(a("lpA0")),_=l(a("QDog")),y=l(a("nIwP")),E=l(a("pybC")),b=l(a("DXno")),C=l(a("X+Fk")),S=l(a("0oB1")),k=p.default.Group,w=(d=(0,h.connect)(e=>{var t=e.user;return{currUser:t.currentUser}},null,null,{withRef:!0}),d((c=class extends f.PureComponent{constructor(e){super(e),this.fetchBaseInfo=(()=>{var e=this.props,t=e.dispatch,a=e.appAlias;t({type:"appControl/fetchBaseInfo",payload:{team_name:_.default.getCurrTeamName(),app_alias:a}})}),this.changeType=(e=>{e!==this.state.type&&this.setState({type:e})}),this.changeMenu=(e=>{this.setState({showMenu:e.key})}),this.state={type:"now",showMenu:"pm",anaPlugins:null}}componentWillMount(){this.fetchBaseInfo()}componentDidMount(){this.canView()&&this.getAnalyzePlugins()}getAnalyzePlugins(){this.props.dispatch({type:"appControl/getAnalyzePlugins",payload:{team_name:_.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{var t=e&&e.list||[];this.setState({anaPlugins:t})}})}canView(){return v.default.canManageAppMonitor(this.props.appDetail)}renderPM(){var e=this.state,t=e.type,a=e.anaPlugins,l=this.props.appDetail,s=a&&a.length>0;return s?f.default.createElement(f.Fragment,null,f.default.createElement("div",{style:{textAlign:"left",marginBottom:25}},f.default.createElement(k,null,f.default.createElement(p.default,{onClick:()=>{this.changeType("now")},type:"now"===t?"primary":""},"\u5b9e\u65f6"),f.default.createElement(p.default,{onClick:()=>{this.changeType("history")},type:"history"===t?"primary":""},"\u5386\u53f2"))),"now"===t?f.default.createElement(b.default,this.props):f.default.createElement(E.default,this.props)):f.default.createElement(o.default,null,f.default.createElement("div",{style:{textAlign:"center",fontSize:18,padding:"30px 0"}},"\u5c1a\u672a\u5f00\u901a\u6027\u80fd\u5206\u6790\u63d2\u4ef6",f.default.createElement("p",{style:{paddingTop:8}},f.default.createElement(m.Link,{to:"/team/".concat(_.default.getCurrTeamName(),"/region/").concat(_.default.getCurrRegionName(),"/components/").concat(l.service.service_alias,"/plugin")},"\u53bb\u5f00\u901a"))))}render(){if(!this.canView())return f.default.createElement(g.default,null);var e=this.state.showMenu,t=this.props,a=t.appDetail,l=t.componentPermissions.isServiceMonitor,s=["pm"],o=a.service.language&&a.service.language.toLowerCase().indexOf("java")>-1;return f.default.createElement(n.default,null,f.default.createElement(r.default,{span:4},f.default.createElement("div",{style:{paddingRight:"16px"}},f.default.createElement(i.default,{onSelect:this.changeMenu,defaultSelectedKeys:s,style:{height:"590px"}},f.default.createElement(i.default.Item,{key:"pm"},"\u6027\u80fd\u5206\u6790"),f.default.createElement(i.default.Item,{key:"resource"},"\u8d44\u6e90\u76d1\u63a7"),o&&f.default.createElement(i.default.Item,{key:"trace"},"\u94fe\u8def\u8ffd\u8e2a"),l&&f.default.createElement(i.default.Item,{key:"custom"},"\u4e1a\u52a1\u76d1\u63a7")))),f.default.createElement(r.default,{span:20},"pm"===e&&this.renderPM(),"trace"===e&&f.default.createElement(S.default,null),"resource"===e&&f.default.createElement(C.default,null),"custom"===e&&f.default.createElement(y.default,{appDetail:a})))}},u=c))||u);t.default=w},ZwJH:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var n=l(a("wCAj"));a("Pwec");var r=l(a("CtXQ"));a("BoS7");var i=l(a("Sdc0"));a("fOrg");var o=l(a("+KLJ"));a("IzEo");var d=l(a("bx4M"));a("14J3");var u=l(a("BMrR"));a("jCWc");var c=l(a("kPKH"));a("+L6B");var p=l(a("2/Rp"));a("5NDa");var h=l(a("5rEg"));a("/zsF");var m=l(a("PArb"));a("T2oS");var f=l(a("W9HT"));a("/xke");var g=l(a("TeRw"));a("y8nQ");var v=l(a("Vl3Y"));a("OaEy");var _,y,E,b,C=l(a("2fM7")),S=a("MuoO"),k=a("7DNP"),w=l(a("wd/R")),A=s(a("q1tI")),x=a("P5Jw"),D=l(a("QKd8")),T=l(a("4NES")),P=l(a("q76B")),M=l(a("cUW5")),N=a("xpXo"),I=l(a("QDog")),R=l(a("zQST")),L=l(a("I/an")),O=l(a("giye")),V=l(a("LrcT")),B=C.default.Option,q=(_=(0,S.connect)(e=>{var t=e.user,a=e.appControl,l=e.teamControl;return{currUser:t.currentUser,baseInfo:a.baseInfo,extendInfo:a.extendInfo,instances:a.pods,scaling:a.scalingRules,features:l.features}},null,null,{pure:!1,withRef:!0}),y=v.default.create(),_(E=y((b=class extends A.PureComponent{constructor(e){super(e),this.handleVertical=(()=>{var e=this.props,t=e.form,a=e.appAlias,l=t.getFieldValue,s=l("memory"),n=Number(l("gpu")),r=Number(l("new_cpu"));(0,N.vertical)({team_name:I.default.getCurrTeamName(),app_alias:a,new_memory:s,new_gpu:n,new_cpu:r}).then(e=>{e&&!e.status&&g.default.success({message:"\u64cd\u4f5c\u6210\u529f\uff0c\u6267\u884c\u4e2d"})})}),this.handleHorizontal=(()=>{var e=this.props.form.getFieldValue("node");(0,N.horizontal)({team_name:I.default.getCurrTeamName(),app_alias:this.props.appAlias,new_node:e}).then(e=>{e&&!e.status&&g.default.success({message:"\u64cd\u4f5c\u6210\u529f\uff0c\u6267\u884c\u4e2d"})})}),this.openEditModal=(e=>{var t=this.props,a=t.dispatch,l=t.appDetail;if("add"===e)this.setState({showEditAutoScaling:!0});else{var s=this.state.id;a({type:"appControl/telescopic",payload:{team_name:I.default.getCurrTeamName(),rule_id:s,service_alias:l.service.service_alias},callback:t=>{t&&("close"===e?this.setState({rulesInfo:t.bean},()=>{this.shutDownAutoScaling()}):this.setState({rulesInfo:t.bean},()=>{this.changeAutoScaling(this.state.rulesInfo)}))}})}}),this.cancelEditAutoScaling=(()=>{this.setState({showEditAutoScaling:!1,addindicators:!1,rulesInfo:!1})}),this.handlePodClick=((e,t)=>{var a=window.open("about:blank"),l=this.props.appAlias;e&&t&&this.props.dispatch({type:"appControl/managePod",payload:{team_name:I.default.getCurrTeamName(),app_alias:l,pod_name:e,manage_name:t},callback:()=>{a.location.href="/console/teams/".concat(I.default.getCurrTeamName(),"/apps/").concat(l,"/docker_console/")}})}),this.fetchExtendInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchExtendInfo",payload:{team_name:I.default.getCurrTeamName(),app_alias:this.props.appAlias},handleError:e=>{e&&403===e.status&&this.props.dispatch(k.routerRedux.push("/exception/403"))}})}),this.fetchInstanceInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchPods",payload:{team_name:I.default.getCurrTeamName(),app_alias:this.props.appAlias},callback:e=>{e&&200===e.status_code?this.setState({instances:(e.list.new_pods||[]).concat(e.list.old_pods||[]),loading:!1}):this.setState({loading:!1})}})}),this.openAutoScaling=(e=>{this.addScalingRules(e)}),this.changeAutoScaling=(e=>{this.changeScalingRules(e)}),this.shutDownAutoScaling=(()=>{this.setState({automaLoading:!0});var e=this.props,t=e.dispatch,a=e.appDetail,l=this.state,s=l.rulesInfo,n=l.id,r=I.default.getCurrTeamName(),i=a.service.service_alias;t({type:"appControl/changeScalingRules",payload:{xpa_type:"hpa",metrics:s.metrics,maxNum:s.max_replicas,minNum:s.min_replicas,tenant_name:r,service_alias:i,enable:!1,rule_id:n},callback:e=>{e&&200===e.status_code?(g.default.success({message:"\u5173\u95ed\u6210\u529f"}),this.setState({showEditAutoScaling:!1,addindicators:!1,id:"",enable:!1},()=>{this.getScalingRules()})):g.default.success({message:"\u5173\u95ed\u5931\u8d25"})}})}),this.addScalingRules=(e=>{this.setState({automaLoading:!0});var t=this.props,a=t.dispatch,l=t.appDetail,s=I.default.getCurrTeamName(),n=l.service.service_alias,r=[{metric_type:"resource_metrics",metric_name:e.selectMemory.indexOf("cpu")>-1?"cpu":"memory",metric_target_type:e.selectMemory.indexOf("utilization")>-1?"utilization":"average_value",metric_target_value:e.value?parseInt(e.value):0}];a({type:"appControl/addScalingRules",payload:{enable:!0,metrics:r,maxNum:parseInt(e.maxNum),minNum:parseInt(e.minNum),tenant_name:s,service_alias:n},callback:e=>{e&&200===e.status_code?(g.default.success({message:"\u5f00\u542f\u6210\u529f"}),this.setState({showEditAutoScaling:!1,addindicators:!1},()=>{this.getScalingRules()})):this.setState({showEditAutoScaling:!1,addindicators:!1,loading:!1})}})}),this.changeScalingRules=(e=>{this.setState({automaLoading:!0});var t=this.props,a=t.dispatch,l=t.appDetail,s=this.state,n=s.id,r=s.addindicators,i=s.rulesInfo,o=s.toDeleteMnt,d=s.automaticTelescopic,u=I.default.getCurrTeamName(),c=l.service.service_alias,p=i&&i.metrics;r&&p.push({metric_type:"resource_metrics",metric_name:e.selectMemory.indexOf("cpu")>-1?"cpu":"memory",metric_target_type:e.selectMemory.indexOf("utilization")>-1?"utilization":"average_value",metric_target_value:e.value?parseInt(e.value):0});var h=this;n&&a({type:"appControl/changeScalingRules",payload:{xpa_type:"hpa",enable:!0,maxNum:e.max_replicas?Number(e.max_replicas):Number(i.max_replicas),minNum:e.min_replicas?Number(e.min_replicas):Number(i.min_replicas),metrics:r?p:e.metrics,tenant_name:u,service_alias:c,rule_id:n},callback:e=>{e&&200===e.status_code?(g.default.success({message:o?"\u5220\u9664\u6210\u529f":d?r?"\u6dfb\u52a0\u6210\u529f":"\u7f16\u8f91\u6210\u529f":"\u5f00\u542f\u6210\u529f"}),h.setState({showEditAutoScaling:!1,addindicators:!1,toDeleteMnt:!1,id:e.bean.id},()=>{h.getScalingRules()})):(g.default.success({message:"\u5931\u8d25\uff01"}),h.setState({showEditAutoScaling:!1,addindicators:!1}))}})}),this.getScalingRules=(()=>{var e=this.props,t=e.dispatch,a=e.appDetail;t({type:"appControl/getScalingRules",payload:{tenant_name:I.default.getCurrTeamName(),service_alias:a.service.service_alias},callback:e=>{if(e&&200===e.status_code){var t=e.list,a=!!(t&&t.length>0);this.setState({enable:a,rulesList:a?t:[],id:t&&a?t[0].rule_id:"",editRules:!(!a||!t[0].enable),automaticTelescopic:!(!a||!t[0].enable),loading:!1,automaLoading:!1})}else this.setState({loading:!1,automaLoading:!1})}})}),this.onPageChange=(e=>{this.setState({page_num:e},()=>{this.getScalingRecord()})}),this.getScalingRecord=(()=>{var e=this.props,t=e.dispatch,a=e.appDetail,l=this.state,s=l.page_num,n=l.page_size;t({type:"appControl/getScalingRecord",payload:{tenant_name:I.default.getCurrTeamName(),service_alias:a.service.service_alias,page:s,page_size:n},callback:e=>{e&&200===e.status_code&&this.setState({total:e.bean.total,sclaingRecord:e.bean.data})}})}),this.saveForm=(e=>{this.form=e;var t=this.state,a=t.rulesList,l=t.enable;l&&this.form&&this.form.setFieldsValue(a[0])}),this.setMetric_target_value=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=0;return e&&e.length>0&&e.map(e=>{var s=e.metric_name,n=e.metric_target_value,r=e.metric_target_type;if(t===s)return l=a?r:n,n}),void 0===l?0:l},this.setMetric_target_show=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=!1;return e&&e.length>0&&e.map(e=>{var l=e.metric_name;t===l&&(a=!0)}),a},this.onChangeAutomaticTelescopic=(()=>{var e=this.state,t=e.enable,a=e.automaticTelescopic;this.openEditModal(a?"close":t?"edit":"add")}),this.handleSubmit=(e=>{e.preventDefault();var t=this.state.enable;this.props.form.validateFields((e,a)=>{e||(t?this.changeAutoScaling(a):this.openAutoScaling(a))})}),this.handleAddIndicators=(e=>{var t=this.props,a=t.dispatch,l=t.appDetail,s=this.state,n=s.id,r=s.deleteType,i=s.editInfo;a({type:"appControl/telescopic",payload:{team_name:I.default.getCurrTeamName(),rule_id:n,service_alias:l.service.service_alias},callback:t=>{if(t)if("add"===e)this.setState({rulesInfo:t.bean,showEditAutoScaling:!0,addindicators:!0});else if("delete"===e){var a=t.bean;a.metrics.splice(a.metrics.findIndex(e=>e.metric_name===r),1),this.changeScalingRules(a)}else if(i){var l=t.bean;l.max_replicas=Number(i.maxNum),l.min_replicas=Number(i.minNum);var s=t.bean.metrics;i.cpuValue&&s.map((e,t)=>{"cpu"==e.metric_name&&(l.metrics[t].metric_target_value=Number(i.cpuValue))}),i.memoryValue&&s.map((e,t)=>{"memory"==e.metric_name&&(l.metrics[t].metric_target_value=Number(i.memoryValue))}),this.changeScalingRules(l)}}})}),this.cancelDeleteMnt=(()=>{this.setState({toDeleteMnt:null,deleteType:""})}),this.handleDeleteMnt=(e=>{this.setState({deleteType:e,toDeleteMnt:!0})}),this.handlerules=(e=>{var t=this.props.form,a=this.state.rulesList,l=t.getFieldValue,s=t.validateFields,n=a&&a.length>0&&a[0],r=l(e),i=Number(l("maxNum")),o=Number(l("minNum")),d=Number(l("cpuValue")),u=Number(l("memoryValue")),c=n&&Number(n.max_replicas),p=n&&Number(n.min_replicas),h=1,m=1;n&&n.metrics&&n.metrics.length>0&&n.metrics.map(e=>{"cpu"==e.metric_name&&(h=Number(e.metric_target_value)),"memory"==e.metric_name&&(m=Number(e.metric_target_value))});var f="",g="maxNum"===e?"errorMaxNum":"minNum"===e?"errorMinNum":"cpuValue"===e?"errorCpuValue":"errorMemoryValue";if(""==r||null==r)return this.setState({errorDesc:"\u4e0d\u80fd\u4e3a\u7a7a",[g]:f,errorType:e}),!1;r=Number(r);var v=n&&this.setMetric_target_show(n.metrics,"cpu"),_=n&&this.setMetric_target_show(n.metrics,"memory"),y=!0;i!==c||o!==p||v&&d!==h||_&&u!==m||(y=!1);var E=/^[0-9]+.?[0-9]*/;E.test(r)?r<=0||r>65535?f="\u8f93\u5165\u8303\u56f41-65535":"minNum"===e&&r>Number(i)?f="\u4e0d\u80fd\u5927\u4e8e\u6700\u5927\u5b9e\u4f8b\u6570":"maxNum"===e&&r<Number(o)?f="\u4e0d\u80fd\u5c0f\u4e8e\u6700\u5c0f\u5b9e\u4f8b\u6570":this.setState({[g]:"",errorType:e},()=>{var e=this.state,t=e.errorMinNum,a=e.errorMaxNum,l=e.errorCpuValue,n=e.errorMemoryValue;return y&&""===t&&""===a&&""===l&&""===n&&s((e,t)=>{this.setState({editInfo:t},()=>{this.handleAddIndicators("edit")})}),null}):f="\u8bf7\u8f93\u5165\u6570\u5b57",this.setState({[g]:f,errorType:e})}),this.state={new_pods:this.props.instances&&this.props.instances.new_pods?this.props.instances.new_pods:[],old_pods:this.props.instances&&this.props.instances.old_pods?this.props.instances.old_pods:[],instances:[],loading:!1,showEditAutoScaling:!1,editRules:!1,rulesList:[],sclaingRecord:[],page_num:1,page_size:10,enable:!1,rulesInfo:!1,total:0,automaticTelescopic:!1,addindicators:!1,toDeleteMnt:!1,deleteType:"",editInfo:!1,automaLoading:!0,errorMinNum:"",errorMaxNum:"",errorCpuValue:"",errorMemoryValue:"",enableGPU:R.default.haveFeature(this.props.features,"GPU")}}componentWillReceiveProps(e){e.instances.new_pods!==this.state.new_pods||e.instances.old_pods!==this.state.old_pods?this.setState({new_pods:e.instances.new_pods||[],old_pods:e.instances.old_pods||[],instances:(e.instances.new_pods||[]).concat(e.instances.old_pods||[]),loading:!1}):this.setState({loading:!1})}componentDidMount(){this.canView()&&(this.getScalingRules(),this.getScalingRecord(),this.fetchInstanceInfo(),this.fetchExtendInfo(),this.timeClick=setInterval(()=>{this.fetchInstanceInfo()},6e4))}componentWillUnmount(){var e=this.props.dispatch;e({type:"appControl/clearExtendInfo"}),this.timeClick&&clearInterval(this.timeClick)}canView(){var e=this.props.componentPermissions.isTelescopic;return e}render(){if(!this.canView())return A.default.createElement(M.default,null);var e=this.props,t=e.extendInfo,a=e.appAlias,l=e.form,s=e.appDetail,_=!1;s&&I.default.isSingletonComponent(s.service.extend_method)&&(_=!0);var y=this.props.match.params,E=y.teamName,b=y.regionName,S=l.getFieldDecorator,N=l.getFieldValue,R=this.state,q=R.page_num,F=R.page_size,U=R.total,z=R.loading,H=R.rulesList,j=R.sclaingRecord,Q=R.rulesInfo,X=R.editRules,W=R.enable,K=R.automaticTelescopic,Y=R.showEditAutoScaling,G=R.addindicators,J=R.errorMinNum,Z=R.errorMaxNum,$=R.errorCpuValue,ee=R.errorMemoryValue,te=R.enableGPU;if(!t)return null;var ae=N("minNum")||0,le="grctl service get ".concat(a," -t ").concat(I.default.getCurrTeamName()),se=[],ne=H&&H.length>0&&this.setMetric_target_show(H[0].metrics,"cpu"),re=H&&H.length>0&&this.setMetric_target_show(H[0].metrics,"memory");ne||se.push({value:"cpuaverage_value",name:"CPU\u4f7f\u7528\u91cf"},{value:"cpuutilization",name:"CPU\u4f7f\u7528\u7387"}),re||se.push({value:"memoryaverage_value",name:"\u5185\u5b58\u4f7f\u7528\u91cf"},{value:"memoryutilization",name:"\u5185\u5b58\u4f7f\u7528\u7387"});var ie=e=>A.default.createElement("div",{className:V.default.remindDesc},e);return A.default.createElement("div",null,A.default.createElement(d.default,{className:V.default.InstancesCard,title:"\u5b9e\u4f8b\u60c5\u51b5",extra:A.default.createElement("a",{style:{marginRight:"22px",color:"#1790FF"},onClick:()=>{this.setState({loading:!0},()=>{this.fetchInstanceInfo()})}},"\u5237\u65b0")},z?A.default.createElement(f.default,{tip:"Loading..."},A.default.createElement("div",{style:{minHeight:"190px"}})):A.default.createElement("div",null,A.default.createElement(T.default,{handlePodClick:this.handlePodClick,list:this.state.instances,serviceID:this.props.appDetail.service.service_id,k8s_component_name:this.props.appDetail.service.k8s_component_name}),A.default.createElement(m.default,null),A.default.createElement("div",null,A.default.createElement(u.default,null,A.default.createElement(c.default,{span:24,style:{display:"flex"}},A.default.createElement("span",{className:V.default.commandText},"\u67e5\u8be2\u547d\u4ee4\uff1a"),A.default.createElement("div",{className:V.default.commandWidth},A.default.createElement(h.default,{value:le,style:{background:"#F9FAFC",textAlign:"center"}}),A.default.createElement("div",{className:V.default.remindDesc},"\u67e5\u8be2\u8be6\u7ec6\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4fe1\u606f,\u8bf7\u590d\u5236\u67e5\u8be2\u547d\u4ee4\u5230\u96c6\u7fa4\u7ba1\u7406\u8282\u70b9\u67e5\u8be2")),A.default.createElement(x.CopyToClipboard,{text:le,onCopy:()=>{g.default.success({message:"\u590d\u5236\u6210\u529f"})}},A.default.createElement(p.default,{type:"primary",style:{marginLeft:19}},"\u590d\u5236"))))))),_&&A.default.createElement(o.default,{style:{marginTop:"16px"},message:A.default.createElement("p",{style:{marginBottom:0}},"\u5355\u5b9e\u4f8b\u7c7b\u578b\u7ec4\u4ef6\u4e0d\u80fd\u8fdb\u884c\u6c34\u5e73\u4f38\u7f29\uff0c\u82e5\u9700\u8981\u8bf7\u4fee\u6539\u4e3a\u76f8\u5e94\u7684\u591a\u5b9e\u4f8b\u7ec4\u4ef6\u7c7b\u578b\u3002"," ",A.default.createElement(k.Link,{to:"/team/".concat(E,"/region/").concat(b,"/components/").concat(a,"/setting")},"\u53bb\u8bbe\u7f6e")),type:"warning"}),A.default.createElement(d.default,{className:V.default.clerBorder,border:!1,title:"\u624b\u52a8\u4f38\u7f29"},!te&&A.default.createElement(o.default,{style:{marginBottom:"16px"},type:"warning",closable:!0,message:"\u5f53\u524d\u4ea7\u54c1\u6388\u6743\u4e0d\u652f\u6301 GPU \u8c03\u5ea6\uff0c\u9700\u8981 GPU \u5171\u4eab\u8c03\u5ea6\u80fd\u529b\u8bf7\u83b7\u53d6\u4f01\u4e1a\u7248\u6388\u6743\u3002"}),A.default.createElement(v.default,{layout:"inline",hideRequiredMark:!0,className:V.default.fromItem},A.default.createElement(u.default,{gutter:16},A.default.createElement(c.default,{lg:8,md:8,sm:24},A.default.createElement(v.default.Item,{labelCol:{span:5},wrapperCol:{span:19},label:"\u5185\u5b58",className:V.default.customFormItem},S("memory",{initialValue:"".concat(t.current_memory)||0})(A.default.createElement(C.default,{getPopupContainer:e=>e.parentNode,className:V.default.memorySelect},A.default.createElement(B,{key:0,value:0},"\u4e0d\u9650\u5236"),(t.memory_list||[]).map(e=>A.default.createElement(B,{key:e,value:e},L.default.getMemoryAndUnit(e)))))),ie("CPU \u9650\u5236\u503c\u76ee\u524d\u57fa\u4e8e\u6bd4\u4f8b\u7b97\u6cd5\u57fa\u4e8e\u8bbe\u7f6e\u5185\u5b58\u503c\u8ba1\u7b97\u3002")),A.default.createElement(c.default,{lg:8,md:8,sm:24},A.default.createElement(v.default.Item,{labelCol:{span:6},wrapperCol:{span:18},className:V.default.customFormItem,label:"GPU\u663e\u5b58"},S("gpu",{initialValue:"".concat(t.current_gpu)})(A.default.createElement(h.default,{disabled:!te,type:"number",addonAfter:"MiB"}))),ie("GPU\u8bbe\u7f6e\u4e3a0\u5219\u4e0d\u5206\u914dGPU\u8d44\u6e90\uff0c\u8bf7\u6c42\u663e\u5b58\u8d85\u8fc7\u96c6\u7fa4\u4e2d\u5355\u9897\u663e\u5361\u7684\u6700\u5927\u53ef\u7528\u5bb9\u91cf\u65f6\u65e0\u6cd5\u8fdb\u884c\u8c03\u5ea6\u3002")),A.default.createElement(c.default,{lg:8,md:8,sm:24},A.default.createElement(v.default.Item,{label:"CPU",labelCol:{span:5},wrapperCol:{span:19},className:V.default.customFormItem},S("new_cpu",{initialValue:t.current_cpu||0,rules:[{required:!0,message:"\u8bf7\u8f93\u5165CPU"},{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u53ea\u5141\u8bb8\u8f93\u5165\u6574\u6570"}]})(A.default.createElement(h.default,{type:"number",min:0,addonAfter:"m",placeholder:"\u8bf7\u8f93\u5165CPU"})),A.default.createElement(p.default,{onClick:this.handleVertical,size:"default",type:"primary",style:{marginLeft:"10px"}},"\u8bbe\u7f6e")),ie("CPU\u5206\u914d\u989d0\u4e3a\u4e0d\u9650\u5236\uff0c1000m=1core\u3001\u8d85\u51fa\u96c6\u7fa4\u4e2d\u5355\u8282\u70b9CPU\u7684\u6700\u5927\u53ef\u7528\u5bb9\u91cf\u65f6\u65e0\u6cd5\u8fdb\u884c\u8c03\u5ea6\u3002"))),A.default.createElement(u.default,{gutter:16},A.default.createElement(c.default,{lg:8,md:8,sm:24},A.default.createElement(v.default.Item,{label:"\u5b9e\u4f8b\u6570\u91cf",labelCol:{span:5},wrapperCol:{span:19},className:V.default.customFormItem},S("node",{initialValue:t.current_node})(A.default.createElement(C.default,{getPopupContainer:e=>e.parentNode,className:V.default.nodeSelect},(t.node_list||[]).map(e=>A.default.createElement(B,{key:e,value:e},e)))),A.default.createElement(p.default,{disabled:_,onClick:this.handleHorizontal,size:"default",type:"primary",style:{marginLeft:"10px"}},"\u8bbe\u7f6e")),ie("\u8be5\u503c\u5b9a\u4e49\u7ec4\u4ef6\u5b9e\u4f8b\u6570\u91cf\u7684\u521d\u59cb\u503c\uff0c\u5b9e\u9645\u503c\u53ef\u80fd\u88ab\u81ea\u52a8\u4f38\u7f29\u8c03\u6574\u3002"))))),A.default.createElement(d.default,{style:{marginTop:16,border:"none"},className:V.default.clearCard,title:"\u81ea\u52a8\u4f38\u7f29"},A.default.createElement(u.default,{gutter:24,className:V.default.automaTictelescopingBOX},A.default.createElement(c.default,{span:12,className:V.default.automaTictelescopingTitle},A.default.createElement("div",null,"\u529f\u80fd\u5f00\u5173"),A.default.createElement("div",null,"\u6700\u5c0f\u5b9e\u4f8b\u6570"),A.default.createElement("div",null,"\u6700\u5927\u5b9e\u4f8b\u6570")),A.default.createElement(c.default,{span:12,className:V.default.automaTictelescopingTitle},ne&&A.default.createElement("div",null,"CPU\u4f7f\u7528","utilization"===this.setMetric_target_value(H[0].metrics,"cpu",!0)?"\u7387":"\u91cf(m)",re&&A.default.createElement("img",{src:D.default,alt:"",onClick:()=>{this.handleDeleteMnt("cpu")}})),re&&A.default.createElement("div",null,"\u5185\u5b58\u4f7f\u7528","utilization"===this.setMetric_target_value(H[0].metrics,"memory",!0)?"\u7387":"\u91cf(Mi)",ne&&A.default.createElement("img",{src:D.default,alt:"",onClick:()=>{this.handleDeleteMnt("memory")}})))),A.default.createElement(f.default,{spinning:this.state.automaLoading},A.default.createElement(v.default,{layout:"inline",hideRequiredMark:!0,className:V.default.fromItem,onSubmit:this.handleSubmit},A.default.createElement(u.default,{gutter:24,className:V.default.automaTictelescoping},A.default.createElement(c.default,{span:12},A.default.createElement("div",{className:V.default.automaTictelescopingContent},A.default.createElement(i.default,{disabled:_,className:V.default.automaTictelescopingSwitch,checked:K,onClick:()=>{this.onChangeAutomaticTelescopic()}})),A.default.createElement("div",{className:V.default.automaTictelescopingContent},S("minNum",{initialValue:H&&H.length>0&&H[0].min_replicas||0})(A.default.createElement(h.default,{disabled:!K,onBlur:e=>{this.handlerules("minNum")}}))),A.default.createElement("div",{className:V.default.automaTictelescopingContent},S("maxNum",{initialValue:H&&H.length>0&&H[0].max_replicas||1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165\u6700\u5927\u6570\u91cf"},{validator:this.checkContent}]})(A.default.createElement(h.default,{disabled:!K,min:ae,onBlur:e=>{this.handlerules("maxNum")}})))),A.default.createElement(c.default,{span:12},ne&&A.default.createElement("div",{className:V.default.automaTictelescopingContent},S("cpuValue",{initialValue:this.setMetric_target_value(H[0].metrics,"cpu")||1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165CPU"},{validator:this.checkContent}]})(A.default.createElement(h.default,{disabled:!K,onBlur:e=>{this.handlerules("cpuValue")}}))),re&&A.default.createElement("div",{className:V.default.automaTictelescopingContent},S("memoryValue",{initialValue:this.setMetric_target_value(H[0].metrics,"memory")||1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165\u5185\u5b58"},{validator:this.checkContent}]})(A.default.createElement(h.default,{disabled:!K,onBlur:e=>{this.handlerules("memoryValue")}}))),!ne&&A.default.createElement("div",{style:{height:"56px"}}),!re&&A.default.createElement("div",{style:{height:"56px"}}),A.default.createElement("div",{className:V.default.automaTictelescopingContent},A.default.createElement(r.default,{type:"plus",style:{fontSize:"23px"},onClick:()=>{se.length>0&&K&&this.handleAddIndicators("add")}})))))),A.default.createElement(u.default,{gutter:24,className:V.default.errorDescBox},A.default.createElement(c.default,{span:12,className:V.default.automaTictelescopingTitle},A.default.createElement("div",null),A.default.createElement("div",null,A.default.createElement("span",{className:V.default.errorDesc},J)),A.default.createElement("div",null,A.default.createElement("span",{className:V.default.errorDesc}," ",Z))),A.default.createElement(c.default,{span:12,className:V.default.automaTictelescopingTitle},ne&&A.default.createElement("div",null,A.default.createElement("span",{className:V.default.errorDesc},$)),re&&A.default.createElement("div",null,A.default.createElement("span",{className:V.default.errorDesc},ee))))),this.state.toDeleteMnt&&A.default.createElement(P.default,{title:"\u5220\u9664\u6307\u6807",desc:"\u662f\u5426\u5220\u9664\u8be5\u6307\u6807?",onCancel:this.cancelDeleteMnt,onOk:()=>{this.handleAddIndicators("delete")}}),Y&&A.default.createElement(O.default,{data:Q,ref:this.saveForm,isvisable:Y,isaddindicators:G,memoryList:se,onClose:this.cancelEditAutoScaling,onOk:e=>{W?this.changeAutoScaling(e):this.openAutoScaling(e)},editRules:X}),A.default.createElement(d.default,{className:V.default.clearCard,style:{marginTop:16},title:"\u6c34\u5e73\u4f38\u7f29\u8bb0\u5f55"},A.default.createElement(n.default,{className:V.default.horizontalExpansionRecordTable,dataSource:j,pagination:{current:q,pageSize:F,total:U,onChange:this.onPageChange},columns:[{title:"\u65f6\u95f4",dataIndex:"last_time",key:"last_time",align:"center",width:"18%",render:e=>A.default.createElement("div",{style:{wordWrap:"break-word",wordBreak:"break-word"}},(0,w.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u4f38\u7f29\u8be6\u60c5",dataIndex:"description",key:"description",align:"center",width:"43%",render:e=>A.default.createElement("div",{style:{textAlign:"left",wordWrap:"break-word",wordBreak:"break-word"}},e)},{title:"\u7c7b\u578b",dataIndex:"record_type",key:"record_type",align:"center",width:"13%",render:e=>A.default.createElement("div",null,"hpa"===e?"\u6c34\u5e73\u81ea\u52a8\u4f38\u7f29":"manual"===e?"\u624b\u52a8\u4f38\u7f29":"\u5782\u76f4\u81ea\u52a8\u4f38\u7f29")},{title:"\u64cd\u4f5c\u4eba",dataIndex:"operator",key:"operator",align:"center",width:"13%",render:e=>{return A.default.createElement("span",null," ",e||"-"," ")}},{title:"\u539f\u56e0",dataIndex:"reason",align:"center",key:"reason",width:"13%"}]})))}},E=b))||E)||E);t.default=q},"a8l+":function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV"));a("Pwec");var r=s(a("CtXQ")),i=s(a("PWDA")),o=l(a("q1tI")),d=a("xpXo"),u=s(a("QDog")),c=s(a("zMIy"));class p extends o.PureComponent{constructor(e){super(e),this.state={list:[],loading:!0,showHighlighted:""}}componentDidMount(){this.loadData()}loadData(){(0,d.getServiceLog)({team_name:u.default.getCurrTeamName(),app_alias:this.props.appAlias,lines:1e3}).then(e=>{e&&this.setState({loading:!1,list:e.list||[]})})}render(){var e=this.state,t=e.loading,a=e.list,l=e.showHighlighted;return o.default.createElement(n.default,{title:"\u6700\u8fd11000\u6761\u65e5\u5fd7",visible:!0,width:1e3,bodyStyle:{background:"#222222",color:"#fff"},className:c.default.logModal,onCancel:this.props.onCancel,footer:null},t?o.default.createElement("div",{style:{textAlign:"center"}},o.default.createElement(r.default,{type:"loading",style:{marginTop:20,marginBottom:20}})):"",t?"":o.default.createElement("div",{style:{padding:"20px 0",maxHeight:500,overflowY:"auto",background:"#212121"}},a.length>0?o.default.createElement("div",{className:c.default.History1000Log},a.map((e,t)=>{return o.default.createElement("div",{key:t},o.default.createElement("span",{style:{color:l===e.substring(0,e.indexOf(":"))?"#FFFF91":"#666666"}},o.default.createElement("b",null),o.default.createElement("span",null,""===e?"":"".concat(t+1))),o.default.createElement("span",{ref:"texts",style:{color:l==e.substring(0,e.indexOf(":"))?"#FFFF91":"#FFF"}},o.default.createElement(i.default,null,e.substring(e.indexOf(":")+1,e.length))),1===a.length?o.default.createElement("span",{style:{color:l===e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:l==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},o.default.createElement(i.default,null,e.substring(0,e.indexOf(":")))," "):a.length>1&&t>=1&&e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":o.default.createElement("span",{style:{color:l==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==t&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==a[t<=0?t+1:t-1].substring(0,a[t<=0?t+1:t-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:l==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},o.default.createElement(i.default,null,e.substring(0,e.indexOf(":")))," "))})):o.default.createElement("p",{style:{textAlign:"center",marginBottom:0,color:"#999"}},"\u6682\u65e0\u65e5\u5fd7")))}}t.default=p},agpv:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("bbsP");var n=l(a("/wGt"));a("+L6B");var r=l(a("2/Rp"));a("giR+");var i=l(a("fyUT"));a("5Dmo");var o=l(a("3S7+")),d=l(a("jehZ"));a("5NDa");var u=l(a("5rEg"));a("7Kak");var c=l(a("9yH6"));a("y8nQ");var p,h,m,f=l(a("Vl3Y")),g=s(a("q1tI")),v=l(a("ZNrE")),_=f.default.Item,y=c.default.Group,E=(p=f.default.create(),p((m=class extends g.PureComponent{constructor(){super(...arguments),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onSubmit,s=a.validateFields;s((e,t)=>{!e&&l&&l(t)})}),this.handleCancel=(()=>{var e=this.props.onCancel;e&&e()}),this.modeCheck=((e,t,a)=>{!t||/^[0-7]{1,3}$/.test(t)?a():a("\u6743\u9650\u7684\u6570\u503c\u9650\u5236\u57280-777\u4e4b\u95f4\u76848\u8fdb\u5236\u6570")})}render(){var e=this.props,t=e.data,a=e.editor,l=e.form,s=l.getFieldDecorator,p=l.setFieldsValue,h={labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}};return g.default.createElement(n.default,{title:a?"\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6":"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6",placement:"right",width:500,closable:!1,onClose:this.handleCancel,visible:!0,maskClosable:!1,style:{overflow:"auto"}},g.default.createElement(f.default,{onSubmit:this.handleSubmit,labelAlign:"left"},g.default.createElement(_,(0,d.default)({},h,{label:"\u914d\u7f6e\u6587\u4ef6\u540d\u79f0"}),s("volume_name",{initialValue:t.volume_name||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u914d\u7f6e\u6587\u4ef6\u540d\u79f0"},{pattern:/^[^\s]*$/,message:"\u7981\u6b62\u8f93\u5165\u7a7a\u683c"},{max:30,message:"\u6700\u5927\u957f\u5ea630\u4f4d"}]})(g.default.createElement(u.default,{placeholder:"\u8bf7\u8f93\u5165\u914d\u7f6e\u6587\u4ef6\u540d\u79f0",disabled:!!this.props.editor}))),g.default.createElement(_,(0,d.default)({},h,{label:"\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u8def\u5f84"}),s("volume_path",{initialValue:t.volume_path||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u8def\u5f84"},{pattern:/^[^\s]*$/,message:"\u7981\u6b62\u8f93\u5165\u7a7a\u683c"},{max:255,message:"\u6700\u5927\u957f\u5ea6255\u4f4d"}]})(g.default.createElement(u.default,{placeholder:"\u8bf7\u8f93\u5165\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u8def\u5f84"}))),g.default.createElement("div",{style:{display:"none"}},g.default.createElement(_,(0,d.default)({},h,{label:"\u7c7b\u578b"}),s("volume_type",{initialValue:"config-file",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5b58\u50a8\u7c7b\u578b"}]})(g.default.createElement(y,null,g.default.createElement(c.default,{value:"config-file",disabled:!!this.props.editor},g.default.createElement(o.default,{title:"\u7f16\u8f91\u6216\u4e0a\u4f20\u60a8\u7684\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9"},"\u914d\u7f6e\u6587\u4ef6")))))),g.default.createElement(_,(0,d.default)({},h,{label:"\u6743\u9650"}),s("mode",{initialValue:t.mode||777,rules:[{required:!0,validator:this.modeCheck}]})(g.default.createElement(i.default,{min:0,style:{width:"100%"}}))),g.default.createElement(v.default,{setFieldsValue:p,formItemLayout:h,Form:f.default,style:{marginBottom:"20px"},getFieldDecorator:s,name:"file_content",label:"\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9",message:"\u8bf7\u7f16\u8f91\u5185\u5bb9",data:t.file_content||""})),g.default.createElement("div",{style:{borderTop:"1px solid #e8e8e8",padding:"10px 16px",textAlign:"right",background:"#fff",borderRadius:"0 0 4px 4px"}},g.default.createElement(r.default,{style:{marginRight:8},onClick:this.handleCancel},"\u53d6\u6d88"),g.default.createElement(r.default,{onClick:this.handleSubmit,type:"primary"},"\u786e\u8ba4")))}},h=m))||h);t.default=E},bLLg:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAANCAYAAACdKY9CAAAAr0lEQVQoU2P8////fwYGBoY79x4ylDV2M/Bwc4O4cPDl61eGrvpSBhUlebAYI0zDui27GUB6g33dUDSs3byLgZGRkSHIxxVdwy6wQJAPqobzl66BxQ31tCAaDh49BXbS0VPnwALWZkYoNqBzGJ0C4v9HBnnjVQSTXL5uKwNjdHrJ/yUzuonSEJNRSiUNambuDLdO7cSwFacNtNeAKwTI87SxU9B/LXUVooL12s07DAAEf2F6q3srMgAAAABJRU5ErkJggg=="},ctOv:function(e,t,a){e.exports={nameID:"nameID___2Ease",icon:"icon___16vqz",iconm:"iconm___3OCSr",nowarpText:"nowarpText___2zPhp",logModal:"logModal___2hns0",logsss:"logsss___2uJ-X",logpassed:"logpassed___3Q8Va",logfailed:"logfailed___2U4bI",logfored:"logfored___2pTsm",logcanceled:"logcanceled___3aDnB",loginfo:"loginfo___3HoxI",nodeBox:"nodeBox___2n2e2",text:"text___WagKL",imgs:"imgs____CG40",boxImg:"boxImg___2RBrV",button:"button___1AoUM",active:"active___30tgj",passeda:"passeda___1lCaR",faileda:"faileda___2TFCf",canceleda:"canceleda___1_-JY",alcen:"alcen___Ftyib",passed:"passed___AkHXr",failed:"failed___3N0Cr",canceled:"canceled___30_w8",rowLi:"rowLi___2fdpu",prRow:"prRow___3mS-7",statusIcon:"statusIcon___2OuhP",labelAlign:"labelAlign___2v_lc",rowMessage:"rowMessage___2v7P0",buildHistoryBox:"buildHistoryBox___23GlQ",buildHistoryList:"buildHistoryList___3wkx5",lineone:"lineone___2s7Q1",linetwo:"linetwo___3ZRYg",linestree:"linestree___2v1xj",linefour:"linefour___18sMg",rowRtem:"rowRtem___2CLXc",rowDuration:"rowDuration___3m3A3",buildInfo:"buildInfo___247Nr",buildCommitter:"buildCommitter___3RTNu",rowBranch:"rowBranch___1vSSh",pageHeaderContent:"pageHeaderContent___V6X2X",avatar:"avatar___3k3k6",content:"content___NdyZA",contentTitle:"contentTitle___9Whj_",extraContent:"extraContent___3S2aN",statItem:"statItem___1UJ2r","ant-btn-group":"ant-btn-group___Vc9n-",activeCard:"activeCard___3P3sd",members:"members___2Kxmw",projectList:"projectList___2fxXZ",projectGrid:"projectGrid___3W5dN",tableList:"tableList___o3-D6",tableListOperator:"tableListOperator___3mQ1m",statuscn:"statuscn___cOVgo",charContent:"charContent___3HE66",statusIconWraper:"statusIconWraper___33C2b",charContentTit:"charContentTit___1snvM",sub:"sub___2UB7R",logs:"logs___2fu0x",pluginList:"pluginList___2d2T6",logItem:"logItem___3fbK8",logItemDate:"logItemDate___3ttZL",date:"date___3fnMt",time:"time___y01ER",logItemMain:"logItemMain___2eLeN",hd:"hd___QCMli",tit:"tit___28KRi",btns:"btns___3TqdD",btn:"btn___1KmIh",codeVersion:"codeVersion___3cHUI",versionInfo:"versionInfo___wSAvf",versionAuthor:"versionAuthor___15hhN",logContent:"logContent___IiqxR",success:"success___vYrFn",fail:"fail___xepGk",iconGroup:"iconGroup___2Stp2",rankingList:"rankingList___64u59",salesExtra:"salesExtra___1keSn",currentDate:"currentDate___3QbSw",salesCard:"salesCard___3Stvx",salesBar:"salesBar___1TUEz",salesRank:"salesRank___IojWE",salesCardExtra:"salesCardExtra___Ci1it",salesTypeRadio:"salesTypeRadio___2IXvR",offlineCard:"offlineCard___3A9CV",trendText:"trendText___5rQ8y",blueant:"blueant___24_K_",blueanimation:"blueanimation___1ROL9",rankingTitle:"rankingTitle___1mEif",salesExtraWrap:"salesExtraWrap___2QfeB"}},dL6S:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=l(a("BMrR"));a("jCWc");var r=l(a("kPKH"));a("5Dmo");var i=l(a("3S7+"));a("y8nQ");var o,d,u,c=l(a("Vl3Y")),p=l(a("ZhIB")),h=s(a("q1tI")),m=l(a("QDog")),f=l(a("LrcT")),g=(o=c.default.create(),o((u=class extends h.PureComponent{constructor(e){super(e),this.handleMore=(e=>{var t=this.props,a=t.handleMore,l=t.onPageChange;a&&l&&(l(1),a(e))}),this.state={}}componentDidMount(){}render(){var e=this.props,t=e.status,a=e.beanData,l=e.more,s=e.resourcesLoading,o=e.memory,d=e.disk,u=e.dataList,c=e.buildSource,g=0===o?"\u4e0d\u9650\u5236":(0,p.default)(o).format("0,0");return h.default.createElement(n.default,{gutter:24},h.default.createElement(r.default,{xs:24,xm:24,md:24,lg:24,xl:24},h.default.createElement("div",{className:f.default.buildBox,style:{background:m.default.fetchStateBJColor(t&&t.status)}},h.default.createElement("div",{className:f.default.buildContent},h.default.createElement("div",{className:f.default.buildLeftBox},h.default.createElement("h2",{className:f.default.buildState,style:{color:m.default.fetchStateColor(t&&t.status)}},t&&t.status_cn||""),h.default.createElement("div",{className:f.default.buildCommitInfo},h.default.createElement("ul",{className:f.default.buildInfo},t&&"undeploy"!==t.status&&"undeploy"!==t.status&&"closed"!==t.status&&h.default.createElement("li",null,h.default.createElement("a",{target:"_blank"},m.default.fetchSvg("runTime"),"\u8fd0\u884c",h.default.createElement("span",{style:{color:"rgba(0,0,0,0.45)",paddingLeft:"20px"}},t&&t.start_time?m.default.fetchTime(Date.parse(new Date)-new Date(t.start_time).getTime()):""))),h.default.createElement("li",null,h.default.createElement("a",null,m.default.fetchSvg("distributionMemory"),"\u5206\u914d",!s&&h.default.createElement(h.Fragment,null,h.default.createElement(i.default,{title:g},h.default.createElement("span",{style:{color:"rgba(0,0,0,0.45)",padding:"0 20px",minWidth:"80px"}},g)),0!==o&&"MB \u5185\u5b58"))),h.default.createElement("li",null,h.default.createElement("a",null,m.default.fetchSvg("useDisk"),"\u5360\u7528",!s&&h.default.createElement(h.Fragment,null,h.default.createElement(i.default,{title:(0,p.default)(d).format("0,0")},h.default.createElement("span",{style:{color:"rgba(0,0,0,0.45)",padding:"0 20px",minWidth:"80px"}},(0,p.default)(d).format("0,0"))),"MB \u78c1\u76d8")))))),h.default.createElement("div",{className:f.default.buildRightBox},h.default.createElement("h2",{className:" ".concat(f.default.alcen," ").concat(f.default.buildState," ")},h.default.createElement("span",{className:" ".concat(f.default.alcen," ").concat(f.default.buildwidth," ")},m.default.fetchSvg("version"),h.default.createElement("span",{style:{color:"rgba(0,0,0,0.65)"}},"\u7248\u672c\u53f7")),h.default.createElement("span",{style:{color:a&&a.build_version?"#39aa56":"rgba(0, 0, 0, 0.45)"}},a&&a.build_version?a.build_version:"\u6682\u65e0")),h.default.createElement("div",{className:f.default.buildCommitInfo},h.default.createElement("ul",{className:f.default.buildInfo},h.default.createElement("li",null,h.default.createElement("a",{target:"_blank"},h.default.createElement("span",{className:" ".concat(f.default.alcen," ").concat(f.default.buildwidth," ")},m.default.fetchSvg("warehouse"),c&&"source_code"===c?"\u4ee3\u7801\u7248\u672c":"\u4ed3\u5e93\u5730\u5740"),h.default.createElement(i.default,{title:a&&(a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind?a.code_version&&"":a.image_domain&&a.image_domain)},h.default.createElement("span",{className:f.default.buildText},a?a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind&&a.code_version?a.code_version.substr(0,8):a.image_domain?a.image_domain:"\u6682\u65e0":"\u6682\u65e0")))),h.default.createElement("li",null,h.default.createElement("a",{target:"_blank"},h.default.createElement("span",{className:" ".concat(f.default.alcen," ").concat(f.default.buildwidth," ")},m.default.fetchSvg("basicInfo"),c&&"source_code"===c?"\u63d0\u4ea4\u4fe1\u606f":"\u955c\u50cf\u540d\u79f0"),h.default.createElement(i.default,{title:a&&(a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind?a.code_commit_msg&&a.code_commit_msg:a.image_repo&&a.image_repo)},h.default.createElement("span",{className:f.default.buildText},a?a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind?a.code_commit_msg&&a.code_commit_msg:a.image_repo?a.image_repo:"\u6682\u65e0":"\u6682\u65e0")))),h.default.createElement("li",null,h.default.createElement("a",{target:"_blank"},h.default.createElement("span",{className:" ".concat(f.default.alcen," ").concat(f.default.buildwidth," ")},m.default.fetchSvg("branch"),c&&"source_code"===c?"\u4ee3\u7801\u5206\u652f":"\u955c\u50cftag"),h.default.createElement(i.default,{title:a&&(a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind?a.code_branch&&a.code_branch:a.image_tag&&a.image_tag)},h.default.createElement("span",{className:f.default.buildText},a?a.kind&&"\u6e90\u7801\u6784\u5efa"===a.kind?a.code_branch&&a.code_branch:a.image_tag?a.image_tag:"\u6682\u65e0":"\u6682\u65e0"))))),h.default.createElement("p",{className:f.default.buildAuthor},u&&u.length>0&&!l?h.default.createElement("a",{onClick:()=>{this.handleMore(!0)}},"\u67e5\u770b\u66f4\u591a\u7248\u672c"):!0===l&&h.default.createElement("a",{onClick:()=>{this.handleMore(!1)}},"\u8fd4\u56de\u5b9e\u4f8b\u5217\u8868"))))))))}},d=u))||d),v=g;t.default=v},dhX0:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("14J3");var r=l(a("BMrR"));a("+L6B");var i=l(a("2/Rp"));a("Pwec");var o=l(a("CtXQ"));a("jCWc");var d=l(a("kPKH"));a("fOrg");var u=l(a("+KLJ"));a("/xke");var c=l(a("TeRw"));a("2qtc");var p=l(a("kLXV")),h=l(a("jehZ"));a("5NDa");var m=l(a("5rEg"));a("y8nQ");var f,g,v,_,y,E,b,C,S,k=l(a("Vl3Y")),w=a("MuoO"),A=s(a("q1tI")),x=l(a("BBei")),D=l(a("q9KF")),T=l(a("q76B")),P=l(a("cUW5")),M=l(a("rbEa")),N=l(a("puxM")),I=l(a("SgVc")),R=l(a("pkKe")),L=l(a("lpA0")),O=l(a("QDog")),V=k.default.Item,B=m.default.TextArea,q=(f=k.default.create(),f((v=class extends A.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.onOk,l=t.form;l.validateFields({force:!0},(e,t)=>{!e&&a&&a(t)})}),this.handleCancel=(()=>{var e=this.props.onCancel;e&&e()}),this.state={}}render(){var e=this.props.form.getFieldDecorator,t={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}},a=this.props.port||{};return A.default.createElement(p.default,{title:"\u7f16\u8f91\u522b\u540d",onOk:this.handleSubmit,maskClosable:!1,visible:!0,onCancel:this.handleCancel},A.default.createElement(k.default,{onSubmit:this.handleSubmit},A.default.createElement(V,(0,h.default)({},t,{label:"\u522b\u540d"}),e("alias",{initialValue:a.port_alias,rules:[{required:!0,message:"\u8bf7\u586b\u5199\u7aef\u53e3\u522b\u540d"}]})(A.default.createElement(m.default,{placeholder:"\u8bf7\u586b\u5199\u7aef\u53e3\u522b\u540d"}))),A.default.createElement(V,(0,h.default)({},t,{label:"\u5185\u90e8\u57df\u540d"}),e("k8s_service_name",{initialValue:a.k8s_service_name,rules:[{required:!0,message:"\u8bf7\u586b\u5199\u5185\u90e8\u57df\u540d"},{max:63,message:"\u6700\u5927\u957f\u5ea663\u4f4d"},{pattern:/^[a-z]([-a-z0-9]*[a-z0-9])?$/,message:"\u5fc5\u987b\u7531\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u548c-\u7ec4\u6210\uff0c\u5e76\u4e14\u5fc5\u987b\u4ee5\u5c0f\u5199\u5b57\u6bcd\u5f00\u59cb,\u6570\u5b57\u548c\u5c0f\u5199\u5b57\u6bcd\u7ed3\u675f"}]})(A.default.createElement(m.default,{placeholder:"\u8bf7\u586b\u5199\u5185\u90e8\u57df\u540d"})))))}},g=v))||g),F=(_=k.default.create(),_((E=class extends A.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.onOk,l=t.form;l.validateFields({force:!0},(e,t)=>{!e&&a&&a(t)})}),this.handleCancel=(()=>{var e=this.props.onCancel;e&&e()}),this.state={}}render(){var e=this.props.form.getFieldDecorator,t={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}};return A.default.createElement(p.default,{title:"\u65b0\u5efa\u8bc1\u4e66",onOk:this.handleSubmit,visible:!0,onCancel:this.handleCancel},A.default.createElement(k.default,{onSubmit:this.handleSubmit},A.default.createElement(V,(0,h.default)({},t,{label:"\u8bc1\u4e66\u540d\u79f0"}),e("alias",{initialValue:"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u8bc1\u4e66\u540d\u79f0"},{max:64,message:"\u6700\u5927\u957f\u5ea664\u4f4d"}]})(A.default.createElement(m.default,{placeholder:"\u8bf7\u586b\u5199\u8bc1\u4e66\u540d\u79f0"}))),A.default.createElement(V,(0,h.default)({},t,{label:"key"}),e("private_key",{rules:[{required:!0,message:"\u8bf7\u6dfb\u52a0key"}]})(A.default.createElement(B,{placeholder:"\u8bf7\u6dfb\u52a0key"}))),A.default.createElement(V,(0,h.default)({},t,{label:"\u8bc1\u4e66"}),e("certificate",{rules:[{required:!0,message:"\u8bf7\u6dfb\u52a0\u8bc1\u4e66"}]})(A.default.createElement(B,{placeholder:"\u8bf7\u6dfb\u52a0\u8bc1\u4e66"})))))}},y=E))||y),U=(b=(0,w.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,ports:a.ports,certificates:a.certificates}},null,null,{withRef:!0}),b((S=class extends A.PureComponent{constructor(e){super(e),this.onCloseInner=(e=>{this.props.dispatch({type:"appControl/closePortInner",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:e},callback:()=>{this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.onCloseOuter=(e=>{this.props.dispatch({type:"appControl/closePortOuter",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:e},callback:()=>{this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.onCancelAddDomain=(()=>{this.setState({showAddDomain:null})}),this.onAddDomain=(e=>{this.setState({showAddDomain:e})}),this.onCancelAddPort=(()=>{this.setState({showAddPort:!1})}),this.addLicense=(()=>{this.setState({page_size:this.state.page_size+10},()=>{this.fetchCertificates()})}),this.fetchPorts=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchPorts",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias}})}),this.handleSubmitProtocol=((e,t,a)=>{var l=this.props.dispatch;l({type:"appControl/changeProtocol",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:t,protocol:e},callback:()=>{this.fetchPorts(),a()}})}),this.handleDeletePort=(e=>{this.setState({showDeletePort:e})}),this.cancalDeletePort=(()=>{this.setState({showDeletePort:null})}),this.handleSubmitDeletePort=(()=>{this.props.dispatch({type:"appControl/deletePort",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:this.state.showDeletePort},callback:()=>{this.cancalDeletePort(),this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleDeleteDomain=(e=>{this.setState({showDeleteDomain:e})}),this.cancalDeleteDomain=(()=>{this.setState({showDeleteDomain:null})}),this.handleSubmitDeleteDomain=(()=>{this.props.dispatch({type:"appControl/unbindDomain",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:this.state.showDeleteDomain.port,domain:this.state.showDeleteDomain.domain},callback:()=>{this.cancalDeleteDomain(),this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.showAddPort=(()=>{this.setState({showAddPort:!0})}),this.showSubPort=(e=>{this.props.dispatch({type:"appControl/getSubPort",payload:{team_name:O.default.getCurrTeamName(),service_alias:this.props.appAlias,port:e.container_port},callback:t=>{var a=t&&t.list;a&&0==a.length?c.default.info({message:"\u7aef\u53e3\u4e0d\u80fd\u4fee\u6539"}):this.setState({showSubPort:!0,tcp_ports:a,subPort:e.container_port})}})}),this.handleSubPort=(e=>{var t=e.port.split("||");this.props.dispatch({type:"appControl/SubPort",payload:{team_name:O.default.getCurrTeamName(),service_alias:this.props.appAlias,port:this.state.subPort,lb_mapping_port:t[1],service_id:t[0]},callback:e=>{this.setState({showSubPort:!1}),c.default.success({message:"\u7aef\u53e3\u4fee\u6539\u6210\u529f"}),this.fetchPorts()}})}),this.hideSubPort=(()=>{this.setState({showSubPort:!1})}),this.showSubDomain=(e=>{this.setState({showSubDomain:!0,single_port:e.mapping_port}),this.props.dispatch({type:"appControl/getSubDomain",payload:{team_name:O.default.getCurrTeamName(),service_alias:this.props.appAlias},callback:e=>{e&&this.setState({sld_suffix:e.bean.sld_suffix})}})}),this.hideSubDomain=(()=>{this.setState({showSubDomain:!1})}),this.handleSubDomain=(e=>{var t="".concat(e.domain,".").concat(this.state.sld_suffix);this.props.dispatch({type:"appControl/SubDomain",payload:{team_name:O.default.getCurrTeamName(),service_alias:this.props.appAlias,domain_name:t,container_port:this.state.single_port},callback:e=>{this.setState({sld_suffix:null,showSubDomain:!1}),c.default.success({message:"\u4e8c\u7ea7\u57df\u540d\u6dfb\u52a0\u6210\u529f"}),this.fetchPorts()}})}),this.handleAddPort=(e=>{this.props.dispatch({type:"appControl/addPort",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,protocol:e.protocol,port:e.port},callback:()=>{this.onCancelAddPort(),this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleCreateKey=(()=>{this.setState({showAddDomain:null,showAddKey:!0})}),this.cancelCreateKey=(()=>{this.setState({showAddKey:!1})}),this.handleSubmitKey=(e=>{this.props.dispatch({type:"appControl/addCertificate",payload:{team_name:O.default.getCurrTeamName(),alias:e.alias,private_key:e.private_key,certificate:e.certificate},callback:()=>{this.cancelCreateKey(),this.fetchCertificates()}})}),this.handleOpenOuter=(e=>{this.props.dispatch({type:"appControl/openPortOuter",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:e},callback:()=>{this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleOpenInner=(e=>{this.props.dispatch({type:"appControl/openPortInner",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:e},callback:()=>{this.fetchPorts(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.handleAddDomain=(e=>{"httptohttps"==e.protocol&&(e.rule_extensions=[{key:e.protocol,value:"true"}]);var t=this.props.appDetail,a=this.state.showAddDomain;this.props.dispatch({type:"appControl/bindDomain",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,port:a.container_port,domain:e.domain,protocol:e.protocol,certificate_id:e.certificate_id,group_id:t.service.group_id,rule_extensions:e.rule_extensions?e.rule_extensions:[]},callback:()=>{this.fetchPorts(),this.onCancelAddDomain()}})}),this.showEditAlias=(e=>{this.setState({showEditAlias:e})}),this.hideEditAlias=(()=>{this.setState({showEditAlias:null})}),this.handleEditAlias=(e=>{this.props.dispatch({type:"appControl/editPortAlias",payload:{team_name:O.default.getCurrTeamName(),app_alias:this.props.appAlias,k8s_service_name:e.k8s_service_name,port:this.state.showEditAlias.container_port,port_alias:e.alias},callback:()=>{this.fetchPorts(),this.hideEditAlias(),(!this.props.appDetail||!this.props.appDetail.is_third)&&c.default.success({message:"\u64cd\u4f5c\u6210\u529f\u3001\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}),this.props.onshowRestartTips(!0)}})}),this.state={showDeletePort:null,showDeleteDomain:null,showAddPort:!1,showAddDomain:null,showAddKey:!1,showEditAlias:null,showSubDomain:!1,showSubPort:!1,sld_suffix:"",single_port:null,tcp_ports:[],subPort:"",page:1,page_size:10,isAddLicense:!1}}componentDidMount(){this.fetchPorts(),this.fetchCertificates()}fetchCertificates(){var e=this.props.dispatch,t=this.state,a=t.page,l=t.page_size;e({type:"appControl/fetchCertificates",payload:{page:a,page_size:l,team_name:O.default.getCurrTeamName()},callback:e=>{if(e&&e.list){var t=e.bean&&e.bean.nums||0,a=!!(t&&t>l);this.setState({isAddLicense:a})}}})}canView(){var e=this.props.componentPermissions.isPort;return e}render(){var e=this.props,t=e.ports,a=e.certificates,l=e.appDetail,s=this.state.isAddLicense,c=L.default.isImageApp(l),p=L.default.isDockerfile(l);if(!this.canView())return A.default.createElement(P.default,null);var h=l.service&&"helm"===l.service.component_type;return A.default.createElement(A.Fragment,null,A.default.createElement(r.default,null,A.default.createElement(d.default,{span:12},A.default.createElement(u.default,{showIcon:!0,message:"\u7aef\u53e3\u914d\u7f6e\u4fe1\u606f\u53d1\u751f\u53d8\u5316\u540e\u9700\u8981\u91cd\u542f\u7ec4\u4ef6\u624d\u80fd\u751f\u6548",type:"info",style:{marginBottom:24}})),!h&&A.default.createElement(d.default,{span:12,style:{textAlign:"right"}},A.default.createElement(i.default,{onClick:this.showAddPort,type:"primary"},A.default.createElement(o.default,{type:"plus"}),"\u6dfb\u52a0\u7aef\u53e3"))),t.length?A.default.createElement(n.default,null,A.default.createElement(N.default,{sm:700},t.map(e=>A.default.createElement(M.default,{port:e,onDelete:this.handleDeletePort,onEditAlias:this.showEditAlias,onSubmitProtocol:this.handleSubmitProtocol,onOpenInner:this.handleOpenInner,onCloseInner:this.onCloseInner,onOpenOuter:this.handleOpenOuter,onCloseOuter:this.onCloseOuter,onAddDomain:this.onAddDomain,onDeleteDomain:this.handleDeleteDomain,onSubDomain:this.showSubDomain,onSubPort:this.showSubPort})))):A.default.createElement(n.default,null,A.default.createElement("p",{style:{marginTop:100,marginBottom:100,fontSize:20,textAlign:"center"}},"\u5982\u9700\u8981\u63d0\u4f9b\u8bbf\u95ee\u670d\u52a1\uff0c\u8bf7",A.default.createElement("a",{onClick:this.showAddPort,href:"javascript:;"},"\u6dfb\u52a0\u7aef\u53e3"))),this.state.showDeletePort&&A.default.createElement(T.default,{title:"\u7aef\u53e3\u5220\u9664",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u7aef\u53e3\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d",onOk:this.handleSubmitDeletePort,onCancel:this.cancalDeletePort}),this.state.showDeleteDomain&&A.default.createElement(T.default,{title:"\u57df\u540d\u89e3\u7ed1",desc:"\u786e\u5b9a\u8981\u89e3\u7ed1\u6b64\u57df\u540d\u5417\uff1f",subDesc:this.state.showDeleteDomain.domain,onOk:this.handleSubmitDeleteDomain,onCancel:this.cancalDeleteDomain}),this.state.showAddPort&&A.default.createElement(D.default,{isImageApp:c,isDockerfile:p,onCancel:this.onCancelAddPort,onOk:this.handleAddPort}),this.state.showAddDomain&&A.default.createElement(x.default,{addLicense:this.addLicense,isAddLicense:s,certificates:a||[],onCreateKey:this.handleCreateKey,onOk:this.handleAddDomain,onCancel:this.onCancelAddDomain}),this.state.showAddKey&&A.default.createElement(F,{onOk:this.handleSubmitKey,onCancel:this.cancelCreateKey}),this.state.showEditAlias&&A.default.createElement(q,{port:this.state.showEditAlias,onOk:this.handleEditAlias,onCancel:this.hideEditAlias}),this.state.showSubDomain&&A.default.createElement(I.default,{sld_suffix:this.state.sld_suffix,onCancel:this.hideSubDomain,onOk:this.handleSubDomain}),this.state.showSubPort&&A.default.createElement(R.default,{postList:this.state.tcp_ports,onCancel:this.hideSubPort,onOk:this.handleSubPort}))}},C=S))||C);t.default=U},fyL3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAQCAYAAAAmlE46AAACHklEQVQ4T2P8////fwYk8O//f4atuw4wzFu6hkFeVpqhMCMeTKMDRmSNR06cZZg6dymDqaEuQ2pcGMO9B48Z+mcsZFCUk2bITo5mEBEWhOsHa7x87RZD/4wFDDKS4gw5KTEMYqLCKBYcPHqKYdq85QxWZoYMyTEhDDzcXAyMJfWd/z9//spQnpfKoCgvg+EkmMC/f/8YNu3YxzBn8WqGsrxUBkYbr6j/4qJCYKc42lrg1Pjl6zeGSbMWM9x7+JihoSyHgTEhp+J/f0sVQ++0eQzvP3xkqCrMYJCSEEMxYNvugwxzl65hSI4OYfBytQfLgTW21RQxXL52k0FMVIShc+IsBgcbc4akqGCGp89fMrT0TWdQlJNhyE+PA/sNBIpq2yEap/c0MHRPnsvw4tVrhpriLIY9B48xrN28k4GXhwfsAk01JRQXJOZWQjTOn9wOljh/6RrDh4+fGRxtzRmaeqYyxIb5g21DBxgakRXQTqNfdOb/srwUBmszIxQX4bJx76HjDJNmLWJgfPv+w//WvhkMbKysDBX5qQz8fLxgA9A1Pnn2gqG1fwaDmLAQQ1FWIgM8rR44epJh8uwlDGnx4QzujjZwjdIS4gxzl6xmOHziLENFQRqDnpY6JB6REzkodXRPmcvw/v1HBgZGBgZzY32GDdv2MAR4uTBEBnkzMDExoSZy9OA+ff4yQ23bRAY9bXWG8rwUBmEhRK6AqQUAXGTiVB7mEmUAAAAASUVORK5CYII="},gOyy:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV"));a("g9YV");var r=s(a("wCAj"));a("5Dmo");var i=s(a("3S7+"));a("+L6B");var o=s(a("2/Rp")),d=l(a("q1tI")),u=s(a("e6Ls")),c=s(a("QDog")),p=a("7DNP");class h extends d.PureComponent{render(){var e=this.props,t=e.title,a=e.onOk,l=e.onCancel,s=e.relyComponentList;e.loading;return d.default.createElement(n.default,{width:800,title:t,visible:!0,onOk:a,onCancel:l,className:u.default.TelescopicModal,footer:[d.default.createElement(o.default,{onClick:l}," \u5173\u95ed ")]},d.default.createElement(r.default,{pagination:!1,style:{marginBottom:"20px"},columns:[{title:"\u5b58\u50a8\u540d\u79f0",dataIndex:"volume_name",width:"50%",key:"volume_name"},{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"service_name",key:"service_name",width:"50%",render:(e,t)=>d.default.createElement(i.default,{title:e,key:e},d.default.createElement(p.Link,{to:"/team/".concat(c.default.getCurrTeamName(),"/region/").concat(c.default.getCurrRegionName(),"/components/").concat(t.service_alias,"/overview"),title:e},d.default.createElement("span",null,e)))}],dataSource:s}))}}var m=h;t.default=m},giye:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("giR+");var i=l(a("fyUT"));a("+L6B");var o=l(a("2/Rp"));a("OaEy");var d=l(a("2fM7"));a("y8nQ");var u,c,p,h=l(a("Vl3Y")),m=a("MuoO"),f=s(a("q1tI")),g=l(a("fyL3")),v=l(a("P5R6")),_=l(a("bLLg")),y=l(a("ioek")),E=h.default.Item,b=d.default.Option,C=(u=(0,m.connect)(e=>{var t=e.loading;return{changeScalingRules:t.effects["appControl/changeScalingRules"],addScalingRules:t.effects["appControl/addScalingRules"]}}),u((p=class extends f.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.onOk;this.props.form.validateFields((e,a)=>{e||t&&t(a)})}),this.setMetric_target_value=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=0;return e&&e.length>0&&e.map(e=>{var s=e.metric_name,n=e.metric_target_value,r=e.metric_target_type;if(t===s)return l=a?r:n,n}),void 0===l?0:l},this.checkContent=((e,t,a)=>{var l=1,s=Number(t);if(s||0===s){if(s<l)return void a("\u6700\u5c0f\u8f93\u5165\u503c".concat(l));if(s>65535)return void a("\u6700\u5927\u8f93\u5165\u503c65535")}a()}),this.state={selectMemoryList:[{value:"memoryaverage_value",name:"\u5185\u5b58\u4f7f\u7528\u91cf"},{value:"memoryutilization",name:"\u5185\u5b58\u4f7f\u7528\u7387"},{value:"cpuaverage_value",name:"CPU\u4f7f\u7528\u91cf"},{value:"cpuutilization",name:"CPU\u4f7f\u7528\u7387"}]}}render(){var e=this.props,t=e.isvisable,a=e.onClose,l=e.editRules,s=e.data,u=e.isaddindicators,c=e.memoryList,p=this.props.form,m=p.getFieldDecorator,C=p.getFieldValue,S=this.state.selectMemoryList,k=s||!1,w=C("minNum")||0,A=C("selectMemory"),x={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19}}};return f.default.createElement("div",null,f.default.createElement(n.default,{className:y.default.TelescopicModal,title:l?"\u6dfb\u52a0\u6307\u6807":"\u81ea\u52a8\u4f38\u7f29",visible:t,onOk:this.handleSubmit,onCancel:a,footer:[f.default.createElement(o.default,{type:"primary",onClick:this.handleSubmit},"\u786e\u5b9a")]},f.default.createElement(h.default,{layout:"horizontal",hideRequiredMark:!0,onSubmit:this.handleSubmit},!u&&f.default.createElement(E,(0,r.default)({className:y.default.clearConform,label:f.default.createElement("div",{className:y.default.clearConformMinTitle},f.default.createElement("img",{src:v.default,alt:""}),"\u6700\u5c0f\u6570\u91cf\xa0:")},x,{style:{textAlign:"left"}}),m("minNum",{initialValue:1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165\u6700\u5c0f\u6570\u91cf"},{validator:this.checkContent}]})(f.default.createElement(i.default,{style:{width:"100%"},placeholder:"\u8bf7\u8f93\u5165\u6700\u5c0f\u6570\u91cf"})),f.default.createElement("div",{className:y.default.conformDesc},"\u81ea\u52a8\u4f38\u7f29\u526f\u672c\u6570\u7684\u4e0b\u9650")),!u&&f.default.createElement(E,(0,r.default)({className:y.default.clearConform,label:f.default.createElement("div",{className:y.default.clearConformMinTitle},f.default.createElement("img",{src:_.default,alt:""}),"\u6700\u5927\u6570\u91cf\xa0:")},x,{style:{textAlign:"left"}}),m("maxNum",{initialValue:k?k.max_replicas:1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165\u6700\u5927\u6570\u91cf"},{validator:this.checkContent}]})(f.default.createElement(i.default,{placeholder:"\u8bf7\u8f93\u5165\u6700\u5927\u6570\u91cf",style:{width:"100%"},min:w})),f.default.createElement("div",{className:y.default.conformDesc},"\u81ea\u52a8\u4f38\u7f29\u526f\u672c\u6570\u7684\u4e0a\u9650")),f.default.createElement(E,(0,r.default)({className:y.default.clearConform},x,{label:f.default.createElement("div",{className:y.default.clearConformMinTitle},f.default.createElement("img",{src:g.default,alt:""}),"\u6307\u6807\xa0:"),style:{textAlign:"left"}}),m("selectMemory",{initialValue:u&&c&&c.length>0?c[0].value:"memoryaverage_value",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u9700\u8981\u7684\u6307\u6807"}]})(f.default.createElement(d.default,{getPopupContainer:e=>e.parentNode},(u&&c&&c.length>0?c:S).map(e=>{return f.default.createElement(b,{value:e.value,key:e.value},e.name)})))),f.default.createElement(E,(0,r.default)({className:y.default.clearConform,label:f.default.createElement("div",{className:y.default.clearConformMinTitle},f.default.createElement("img",{src:_.default,alt:""}),"\u76ee\u6807\u503c\xa0:")},x,{style:{textAlign:"left"}}),m("value",{initialValue:k?k.max_replicas:1,rules:[{pattern:new RegExp(/^[0-9]\d*$/,"g"),message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u5b57"},{validator:this.checkContent}]})(f.default.createElement(i.default,{placeholder:"\u8bf7\u8f93\u5165\u6570\u5b57",min:1,max:65535,style:{width:"100%"}})),f.default.createElement("div",{className:y.default.conformDesc},"\u5f53","memoryaverage_value"===A||"memoryutilization"===A?"\u5185\u5b58":"cpu","\u4f7f\u7528","memoryaverage_value"===A||"cpuaverage_value"===A?"\u91cf":"\u7387","\u8d85\u8fc7\u6216\u4f4e\u4e8e\u8be5\u76ee\u6807\u503c\u65f6, \u5b9e\u4f8b\u6570\u91cf\u4f1a\u589e\u52a0\u6216\u51cf\u5c11")))))}},c=p))||c),S=h.default.create()(C),k=S;t.default=k},hJQD:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fOrg");var n=l(a("+KLJ"));a("IzEo");var r=l(a("bx4M"));a("Pwec");var i=l(a("CtXQ"));a("qVdP");var o=l(a("jsC+"));a("lUTK");var d=l(a("BvKs"));a("g9YV");var u=l(a("wCAj"));a("2qtc");var c=l(a("kLXV"));a("5Dmo");var p=l(a("3S7+"));a("+L6B");var h=l(a("2/Rp"));a("/xke");var m,f,g,v=l(a("TeRw")),_=a("MuoO"),y=a("7DNP"),E=s(a("q1tI")),b=a("P5Jw"),C=l(a("QDog")),S=a("+n12"),k=l(a("YAxI")),w=(m=(0,_.connect)(e=>{var t=e.user,a=e.appControl;e.global;return{visitInfo:a.visitInfo,currUser:t.currentUser}}),m((g=class extends E.PureComponent{constructor(e){super(e),this.getHttpLinks=(e=>{var t=[];if(e.length>0)for(var a=0;a<e.length;a++)t=t.concat(e[a].access_urls||[]);return t}),this.showModal=(()=>{this.setState({showModal:!0})}),this.hiddenModal=(()=>{this.setState({showModal:!1})}),this.fetchVisitInfo=(()=>{if(this.mount){var e=this.props,t=e.app_alias,a=e.dispatch;a({type:"appControl/fetchVisitInfo",payload:{team_name:C.default.getCurrTeamName(),app_alias:t},callback:e=>{e&&200===e.status_code&&this.handleTimers("timer",()=>{this.fetchVisitInfo()},5e3)},handleError:e=>{this.handleError(e),this.handleTimers("timer",()=>{this.fetchVisitInfo()},1e4)}})}}),this.handleError=(e=>{var t=this.state.componentTimers;if(!t)return null;e&&e.data&&e.data.msg_show&&v.default.warning({message:"\u8bf7\u6c42\u9519\u8bef",description:e.data.msg_show})}),this.handleTimers=((e,t,a)=>{var l=this.state.componentTimers;if(!l)return null;this[e]=setTimeout(()=>{t()},a)}),this.closeTimer=(()=>{this.timer&&clearInterval(this.timer)}),this.handleClickLink=(e=>{(0,S.openInNewTab)(e.key)}),this.renderNoHttpOuterTitle=(e=>E.default.createElement("div",null,E.default.createElement("span",{style:{marginRight:16}},"\u8bbf\u95ee\u5730\u5740\uff1a",e.access_urls[0]),E.default.createElement("span",null,"\u8bbf\u95ee\u534f\u8bae\uff1a ",e.protocol))),this.renderNoPort=(e=>{var t=this.state.showModal,a=this.props.app_alias;return E.default.createElement(E.Fragment,null,E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740",placement:"topRight"},E.default.createElement(h.default,{type:this.props.btntype,onClick:this.showModal},"\u8bbf\u95ee")),t&&E.default.createElement(c.default,{title:"\u63d0\u793a",visible:!0,onCancel:this.hiddenModal,footer:[E.default.createElement(h.default,{onClick:this.hiddenModal}," \u5173\u95ed ")]},E.default.createElement("div",{style:{textAlign:"center",fontSize:16}},"\u5982\u9700\u8981\u63d0\u4f9b\u8bbf\u95ee\u670d\u52a1, \u8bf7",E.default.createElement(y.Link,{onClick:this.hiddenModal,to:"/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/components/").concat(a,"/port")},"\u914d\u7f6e\u7aef\u53e3"))))}),this.showConnectInfo=(e=>{return E.default.createElement(u.default,{rowKey:this.rowKey,className:k.default.tdPadding,bordered:!0,columns:[{title:"\u53d8\u91cf\u540d",dataIndex:"attr_name",key:"attr_name",align:"center"},{title:"\u53d8\u91cf\u503c",dataIndex:"attr_value",key:"attr_value",align:"center"},{title:"\u8bf4\u660e",dataIndex:"name",key:"name",align:"center"}],pagination:!1,dataSource:e,bordered:!1})}),this.renderHttpPort=(e=>{var t=this.state.showModal,a=e,l=this.props.app_alias,s=this.getHttpLinks(a.access_info||{});return 1===s.length?E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740"},E.default.createElement(h.default,{type:this.props.btntype,onClick:()=>{(0,S.openInNewTab)(s[0])}},"\u8bbf\u95ee")):0===s.length?E.default.createElement(E.Fragment,null,E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740",placement:"topRight"},E.default.createElement(h.default,{type:this.props.btntype,onClick:this.showModal},"\u8bbf\u95ee")),t&&E.default.createElement(c.default,{title:"\u63d0\u793a",visible:!0,onCancel:this.hiddenModal,footer:[E.default.createElement(h.default,{onClick:this.hiddenModal}," \u5173\u95ed ")]},E.default.createElement("div",{style:{textAlign:"center",fontSize:16}},"http\u534f\u8bae\u7aef\u53e3\u9700\u6253\u5f00\u5916\u90e8\u8bbf\u95ee\u670d\u52a1, \u53bb",E.default.createElement(y.Link,{onClick:this.hiddenModal,to:"/team/".concat(C.default.getCurrTeamName(),"/region/").concat(C.default.getCurrRegionName(),"/components/").concat(l,"/port")},"\u6253\u5f00")))):E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740",placement:"topRight"},E.default.createElement(o.default,{overlay:E.default.createElement(d.default,{onClick:this.handleClickLink},s.map(e=>E.default.createElement(d.default.Item,{key:e},e))),placement:"bottomRight"},E.default.createElement(h.default,{type:this.props.btntype},E.default.createElement("a",{href:s[0],target:"_blank"},"\u8bbf\u95ee"))))}),this.renderNofHttpOuter=(e=>{var t=this.state.showModal,a=e,l=(this.props.app_alias,a.access_info||[]),s=E.default.createElement(h.default,{onClick:this.hiddenModal},"\u5173\u95ed"),n=[s],o=this.props.currUser.teams[0].region,d=o.filter(e=>{return e.team_region_name==C.default.getCurrRegionName()});return E.default.createElement(E.Fragment,null,E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740",placement:"topRight"},E.default.createElement(h.default,{type:this.props.btntype,onClick:this.showModal},"\u8bbf\u95ee")),t&&E.default.createElement(c.default,{title:"\u8bbf\u95ee\u4fe1\u606f",width:"800px",visible:!0,onCancel:this.hiddenModal,footer:n},l.map((e,t)=>{var a=e.connect_info||[],l=e.access_urls&&e.access_urls.length>0&&e.access_urls[0];return E.default.createElement(r.default,{type:"inner",style:{marginBottom:24}},E.default.createElement(E.Fragment,null,E.default.createElement("ul",{className:k.default.ul},"tcp"==e.protocol||"udp"==e.protocol?E.default.createElement("li",{style:{fontWeight:"bold"}},"\u60a8\u5f53\u524d\u7684\u8bbf\u95ee\u534f\u8bae\u662f",e.protocol):E.default.createElement("li",{style:{fontWeight:"bold"}},"\u60a8\u5f53\u524d\u7684\u8bbf\u95ee\u534f\u8bae\u662f",e.protocol,",\u6253\u5f00MySQL\u5ba2\u6237\u7aef\u8bbf\u95ee"),E.default.createElement("li",null,"\u63a8\u8350\u8bbf\u95ee\u5730\u5740\xa0",E.default.createElement("a",{href:"javascript:void(0)",style:{marginRight:"10px"}},l&&l.indexOf("0.0.0.0")>-1&&d&&d.length>0?l&&l.replace(/0.0.0.0/g,d[0].tcpdomain):l&&l.replace(/\s+/g,"")),E.default.createElement(b.CopyToClipboard,{text:l&&l.indexOf("0.0.0.0")>-1&&d&&d.length>0?l&&l.replace(/0.0.0.0/g,d[0].tcpdomain):l&&l.replace(/\s+/g,""),onCopy:()=>{v.default.success({message:"\u590d\u5236\u6210\u529f"})}},E.default.createElement(h.default,{size:"small",type:"primary"},E.default.createElement(i.default,{type:"copy"}),"\u590d\u5236"))),this.showConnectInfo(a))))})))}),this.renderNotHttpInner=(e=>{var t=this.state.showModal,a=e,l=(this.props.app_alias,a.access_info||[]),s=E.default.createElement(h.default,{onClick:this.hiddenModal},"\u5173\u95ed"),i=[s];function o(e){return E.default.createElement("div",null,E.default.createElement("span",null,"\u8bbf\u95ee\u534f\u8bae\uff1a",e.protocol))}function d(e,t){var a=e.connect_info||[];return E.default.createElement(r.default,{type:"inner",style:{marginBottom:24},title:o(e)},e.connect_info.length?E.default.createElement(E.Fragment,null,E.default.createElement("table",{style:{width:"100%"}},E.default.createElement("thead",null,E.default.createElement("tr",null,E.default.createElement("th",{style:{width:"33%"}},"\u53d8\u91cf\u540d"),E.default.createElement("th",{style:{width:"33%"}},"\u53d8\u91cf\u503c"),E.default.createElement("th",null,"\u8bf4\u660e"))),E.default.createElement("tbody",null,a.map(e=>E.default.createElement("tr",null,E.default.createElement("td",{width:"150"},e.attr_name),E.default.createElement("td",null,e.attr_value),E.default.createElement("td",null,e.name))),a.length?null:E.default.createElement("tr",null,E.default.createElement("td",{colSpan:"3",style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))))):"-")}return E.default.createElement(E.Fragment,null,E.default.createElement(p.default,{title:"\u8df3\u8f6c\u5230\u7ec4\u4ef6\u5bf9\u5916\u8bbf\u95ee\u7aef\u53e3\u5bf9\u5e94\u7684\u57df\u540d\u5730\u5740",placement:"topRight"},E.default.createElement(h.default,{type:this.props.btntype,onClick:this.showModal},"\u8bbf\u95ee")),t&&E.default.createElement(c.default,{title:"\u8bbf\u95ee\u4fe1\u606f",width:"800px",visible:!0,onCancel:this.hiddenModal,footer:i},E.default.createElement(n.default,{style:{marginBottom:16},message:"\u5176\u4ed6\u7ec4\u4ef6\u4f9d\u8d56\u6b64\u7ec4\u4ef6\u540e\u6765\u8bbf\u95ee",type:"info"})," ",l.map((e,t)=>d(e,t))))}),this.state={showModal:!1,componentTimers:this.props.timers},this.mount=!1}componentDidMount(){this.mount=!0,this.fetchVisitInfo()}componentWillReceiveProps(e){var t=e.timers,a=this.props.timers;t!==a&&this.setState({componentTimers:t},()=>{t?this.fetchVisitInfo():this.closeTimer()})}componentWillUnmount(){this.closeTimer(),this.mount=!1,this.props.dispatch({type:"appControl/clearVisitInfo"})}render(){var e=this.props.visitInfo;return e?"no_port"==e.access_type?this.renderNoPort(e):"http_port"===e.access_type?this.renderHttpPort(e):"not_http_outer"===e.access_type?this.renderNofHttpOuter(e):"not_http_inner"===e.access_type||"http_inner"===e.access_type?this.renderNotHttpInner(e):null:null}},f=g))||f);t.default=w},iLo2:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=l(a("BMrR"));a("jCWc");var r=l(a("kPKH"));a("+L6B");var i=l(a("2/Rp")),o=l(a("jehZ"));a("y8nQ");var d=l(a("Vl3Y"));a("iQDF");var u,c,p,h,m=l(a("+eQT")),f=a("MuoO"),g=l(a("wd/R")),v=s(a("q1tI")),_=a("YJCA"),y=l(a("YUe+")),E=l(a("UTiu")),b=m.default.RangePicker,C=(u=(0,f.connect)(e=>{var t=e.user,a=e.appControl,l=e.loading;return{currUser:t.currentUser,appDetail:a.appDetail,baseInfo:a.baseInfo,editLoading:l.effects["monitor/editServiceMonitorFigure"]}}),c=d.default.create(),u(p=c((h=class extends v.PureComponent{constructor(e){super(e),this.disabledDate=(e=>{return e&&e>(0,g.default)().endOf("day")}),this.range=((e,t)=>{for(var a=[],l=e;l<t;l++)a.push(l);return a}),this.queryAll=(()=>{this.setState({isRender:!0},()=>{this.setState({isRender:!1})})}),this.onSortEnd=((e,t)=>{var a=e.oldIndex,l=e.newIndex;t.preventDefault();var s=this.props,n=s.handleSorting,r=s.RangeData,i=void 0===r?[]:r;if(a!==l&&i&&i.length>0){var o=(0,_.arrayMove)(i,a,l),d=[];o.map(e=>{d.push(e.graph_id)}),n(d)}}),this.handleChangeTimes=(e=>{var t="",a="";e&&e.length>1&&(t=(0,g.default)(e[0]).valueOf()/1e3,a=(0,g.default)(e[1]).valueOf()/1e3),this.setState({start:t,end:a},()=>{this.props.handleUpData&&this.props.handleUpData()})}),this.state={start:(new Date).getTime()/1e3-3600,end:(new Date).getTime()/1e3,isLoading:!0,isRender:!1}}shouldComponentUpdate(e,t){if(e.moduleName&&"CustomMonitor"===e.moduleName){if(e.isRender||t.isRender)return!0;if(e.RangeData.length==this.props.RangeData.length)return!1}return!0}render(){var e=this.props,t=e.appDetail,a=e.dispatch,l=e.moduleName,s=e.operation,d=e.onDelete,u=e.onEdit,c=e.upData,p=e.baseInfo,h=e.serviceId,m=void 0===h?"":h,f=e.RangeData,C=void 0===f?[]:f,S=e.appAlias,k=void 0===S?"":S,w=this.state,A=w.start,x=w.end,D=w.isLoading,T=w.isRender,P={moduleName:l,start:A,end:x,dispatch:a,appDetail:t,baseInfo:p,appAlias:k},M=(0,_.SortableElement)(e=>{var t=e.value,a=t.title,l=t.promql,s=t.sequence,n=t.ID;return v.default.createElement("div",{key:n,index:s,className:y.default.RangeChartBox},v.default.createElement(E.default,(0,o.default)({key:n,moduleName:"CustomMonitor",style:{cursor:"all-scroll"}},P,{upData:c,onCancelLoading:this.setState({isLoading:!1}),isLoading:D,serviceId:m,isRender:T,CustomMonitorInfo:t,title:a,type:l,onEdit:u,onDelete:d})))}),N={display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gridGap:"16px"},I=(0,_.SortableContainer)(e=>{var t=e.items;return v.default.createElement("div",{style:N},t.map(e=>{return v.default.createElement(M,{style:{zIndex:10},key:e.ID,index:e.sequence,value:e})}))});return v.default.createElement(v.Fragment,null,v.default.createElement(n.default,null,v.default.createElement(r.default,{span:24,className:y.default.customBox},v.default.createElement(b,{separator:"\u81f3",style:{width:"390px"},disabledDate:this.disabledDate,onChange:e=>{this.handleChangeTimes(e)},defaultValue:[(0,g.default)(new Date((new Date).getTime()-36e5),"HH:mm:ss"),(0,g.default)((0,g.default)(new Date),"HH:mm:ss")],showTime:{hideDisabledOptions:!0},format:"YYYY-MM-DD HH:mm:ss"}),v.default.createElement(i.default,{style:{marginLeft:"5px"},onClick:this.queryAll},"\u67e5\u8be2"),s)),"ResourceMonitoring"===l?v.default.createElement(n.default,{style:{padding:"-8px"}},C.map(e=>{return v.default.createElement(r.default,{span:12,key:e,style:{padding:"8px"}},v.default.createElement(E.default,(0,o.default)({},P,{type:e})))})):"CustomMonitor"===l?v.default.createElement("div",{style:{marginTop:"20px"}},v.default.createElement(I,{axis:"xy",distance:1,style:{zIndex:10},items:C,onSortEnd:this.onSortEnd})):C.map(e=>{return v.default.createElement("div",{style:{marginTop:"20px"}},v.default.createElement(E.default,(0,o.default)({key:e},P,{type:e})))}))}},p=h))||p)||p);t.default=C},ioek:function(e,t,a){e.exports={selectItem:"selectItem___2GuvK",conformDesc:"conformDesc___ztJtX",setSelect:"setSelect___2_bNW",clearConform:"clearConform___SiofZ",TelescopicModal:"TelescopicModal___3Jus_",clearConformMinTitle:"clearConformMinTitle___2EO54"}},k3y4:function(e,t,a){e.exports={cen:"cen___2Fxyu"}},ll25:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var n=s(a("2/Rp"));a("+BJd");var r=s(a("mr32")),i=l(a("q1tI")),o=r.default.CheckableTag;class d extends i.default.Component{constructor(e){super(e),this.handleSelectAll=(e=>{var t=this.getGroupPerm(e).map(e=>{return e.id}),a=this.props.onChange;t=t.filter(e=>{return-1===this.state.selected.indexOf(e)}),this.setState({selected:this.state.selected.concat(t)},()=>{a&&a(this.state.selected.join(","))})}),this.isInGroup=((e,t)=>{var a=this.props.datas.filter(e=>{return e.group_name===t})[0];return!!a&&(a=(a.perms_info||[]).map(e=>{return e.id}),a.indexOf(e)>-1)}),this.getGroupPerm=(e=>{var t=this.props.datas,a=t.filter(t=>{return t.group_name===e})[0];return a&&a.perms_info||[]}),this.handleUnSelectAll=(e=>{var t=this.state.selected.filter(t=>{return!this.isInGroup(t,e)}),a=this.props.onChange;this.setState({selected:t},()=>{a&&a(this.state.selected.join(","))})}),this.handleChange=((e,t)=>{var a=this.props.onChange,l=e.id;if(t)this.setState({selected:this.state.selected.concat([l])},()=>{a&&a(this.state.selected.join(","))});else{var s=this.state.selected.filter(e=>{return e!==l});this.setState({selected:s},()=>{a&&a(this.state.selected.join(","))})}});var t=this.props.value;this.state={selected:t||[]}}componentDidMount(){var e=this.props.onChange;e&&e(this.state.selected.join(","))}render(){var e=this.props,t=e.datas,a=(e.value,e.onChange,this.props.hides||[]);return i.default.createElement("div",null,t.map(e=>{return a.indexOf(e.group_name)>-1?null:e.perms_info.length?i.default.createElement("dl",null,i.default.createElement("dt",null,!1!==this.props.showGroupName?e.group_name:""," ",i.default.createElement(n.default,{style:{marginLeft:16},size:"small",onClick:()=>{this.handleSelectAll(e.group_name)},style:{marginRight:8}},"\u5168\u9009"),i.default.createElement(n.default,{onClick:()=>{this.handleUnSelectAll(e.group_name)},size:"small"},"\u53d6\u6d88\u5168\u9009")),i.default.createElement("dd",null,e.perms_info.map(e=>{return i.default.createElement(o,{key:e.id,checked:this.state.selected.indexOf(e.id)>-1,onChange:t=>{this.handleChange(e,t)}},e.info)}))):null}))}}var u=d;t.default=u},mKRI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={isStart(e){return 1===e.plugin_status||!0===e.plugin_status},isStop(e){return 0===e.plugin_status||!e.plugin_status}};t.default=l},nIwP:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("jehZ"));a("14J3");var r=l(a("BMrR"));a("qVdP");var i=l(a("jsC+"));a("Pwec");var o=l(a("CtXQ"));a("lUTK");var d=l(a("BvKs"));a("+L6B");var u=l(a("2/Rp"));a("/xke");var c,p,h,m=l(a("TeRw")),f=l(a("p0pE")),g=l(a("QDog")),v=l(a("2U5Y")),_=l(a("q76B")),y=l(a("iLo2")),E=l(a("Pp4N")),b=l(a("ALo4")),C=a("MuoO"),S=s(a("q1tI")),k=l(a("AFhn")),w=(c=(0,C.connect)(e=>{var t=e.appControl,a=e.loading;return{appDetail:t.appDetail,delServiceMonitorFigureLoading:a.effects["monitor/delServiceMonitorFigure"],addKeyImportLoading:a.effects["monitor/addKeyImport"],delLoading:a.effects["monitor/batchDeleteServiceMonitorFigure"]}}),c((h=class extends S.PureComponent{constructor(e){var t;super(e),t=this,this.onCancelCustomMonitoring=(()=>{this.setState({info:{},isCustomMonitoring:!1})}),this.onEdit=((e,t)=>{e.preventDefault(),this.setState({info:t,isCustomMonitoring:!0})}),this.onDelete=(e=>{this.setState({showDelete:e.graph_id})}),this.handleMonitoryPoint=(e=>{this.setState({isMonitoryPoint:e})}),this.handleCustomMonitoring=(()=>{this.setState({isCustomMonitoring:!0})}),this.fetchServiceMonitorFigure=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=t.props.dispatch,l=t.handleParameter();a({type:"monitor/fetchServiceMonitorFigure",payload:(0,f.default)({},l),callback:a=>{if(a&&200===a.status_code){var l=a.list&&a.list.length>0;t.setState({monitorFigureList:l?a.list:[],isMonitorFigure:!l}),e||t.handleUpData(),t.cancalBatchDelete()}}})},this.fetchKeyImport=(()=>{var e=this.props.dispatch,t=this.handleParameter();e({type:"monitor/fetchKeyImport",payload:(0,f.default)({},t),callback:e=>{e&&200===e.status_code&&this.setState({KeyImportLoading:!1,KeyImportList:e.list})}})}),this.addKeyImport=(e=>{var t=this.props.dispatch,a=this.handleParameter();t({type:"monitor/addKeyImport",payload:(0,f.default)({graph_name:e},a),callback:e=>{e&&200===e.status_code&&(this.fetchServiceMonitorFigure(),this.fetchKeyImport())}})}),this.handleSorting=(e=>{var t=this.props.dispatch,a=this.handleParameter();t({type:"monitor/sortMonitorFigure",payload:(0,f.default)({},a,{graph_ids:e}),callback:e=>{e&&200===e.status_code&&this.fetchServiceMonitorFigure(!1)}})}),this.handleUpData=(()=>{this.setState({isRender:!0},()=>{this.setState({isRender:!1})})}),this.handleSubmit=(e=>{var t=this.props.dispatch,a=this.state.info,l=this.handleParameter();a&&a.graph_id?t({type:"monitor/editServiceMonitorFigure",payload:(0,f.default)({},l,e,{graph_id:a.graph_id,sequence:a.sequence}),callback:e=>{e&&200===e.status_code&&(m.default.success({message:"\u4fdd\u5b58\u6210\u529f"}),this.fetchServiceMonitorFigure(!1),this.onCancelCustomMonitoring())}}):t({type:"monitor/addServiceMonitorFigure",payload:(0,f.default)({},l,e),callback:e=>{e&&200===e.status_code&&(m.default.success({message:"\u6dfb\u52a0\u6210\u529f"}),this.fetchServiceMonitorFigure(),this.onCancelCustomMonitoring())}})}),this.handleSubmitDelete=(()=>{var e=this.props.dispatch,t=this.state.showDelete,a=this.handleParameter();e({type:"monitor/delServiceMonitorFigure",payload:(0,f.default)({},a,{graph_id:t}),callback:e=>{e&&200===e.status_code&&(m.default.success({message:"\u5220\u9664\u6210\u529f"}),this.fetchServiceMonitorFigure(),this.cancalDelete())}})}),this.fetchServiceMonitor=(()=>{var e=this.props.dispatch,t=this.handleParameter();e({type:"monitor/fetchServiceMonitor",payload:t,callback:e=>{e&&200===e.status_code&&this.setState({isMonitorsLoading:!0,isMonitors:e.list.length>0})}})}),this.handleParameter=(()=>{var e=this.props.appDetail;return{team_name:g.default.getCurrTeamName(),app_alias:e.service.service_alias}}),this.cancalDelete=(()=>{this.setState({showDelete:!1})}),this.handleBatchDelete=(()=>{this.setState({BatchDelete:!0})}),this.cancalBatchDelete=(()=>{this.setState({BatchDelete:!1})}),this.state={isMonitorFigure:!1,monitorFigureList:[],isMonitoryPoint:!1,isCustomMonitoring:!1,showDelete:!1,info:{},KeyImportList:[],BatchDelete:!1,isMonitorsLoading:!1,isMonitors:!1,isRender:!1,KeyImportLoading:!0}}componentDidMount(){this.fetchServiceMonitorFigure(),this.fetchKeyImport(),this.fetchServiceMonitor()}render(){var e=this.props,t=e.appDetail,a=e.delServiceMonitorFigureLoading,l=e.addKeyImportLoading,s=e.delLoading,c=g.default.getCurrTeamName(),p=t.service.service_alias,h=t.service.service_id,m=this.state,f=m.isMonitoryPoint,C=m.isCustomMonitoring,w=m.isMonitorFigure,A=m.monitorFigureList,x=m.showDelete,D=m.info,T=m.KeyImportList,P=m.BatchDelete,M=m.isMonitors,N=m.isRender,I=m.KeyImportLoading,R=m.isMonitorsLoading;return S.default.createElement("div",null,C&&S.default.createElement(E.default,{serviceId:h,teamName:c,appAlias:p,info:D,onOk:this.handleSubmit,onCancel:this.onCancelCustomMonitoring}),!f&&!I&&S.default.createElement(r.default,null,S.default.createElement(y.default,{moduleName:"CustomMonitor",isRender:N,handleUpData:this.handleUpData,upData:this.fetchServiceMonitorFigure,handleSorting:this.handleSorting,onDelete:this.onDelete,onEdit:this.onEdit,appAlias:p,serviceId:h,RangeData:w?[]:A,operation:S.default.createElement("div",{style:{display:"inline-block",width:"calc(100% - 450px)",lineHeight:"40px"}},S.default.createElement(u.default,{style:{marginLeft:"5px"},onClick:this.handleCustomMonitoring},"\u6dfb\u52a0\u56fe\u8868"),T&&T.length>0&&S.default.createElement(i.default,{overlay:S.default.createElement(d.default,null,T.map(e=>{return S.default.createElement(d.default.Item,{style:{textAlign:"center"}},S.default.createElement("a",{onClick:()=>{this.addKeyImport(e)}},e))})),trigger:["click"],placement:"bottomCenter",disabled:l},S.default.createElement(u.default,{style:{marginLeft:"5px"}},"\u4e00\u952e\u5bfc\u5165 ",S.default.createElement(o.default,{type:"down"}))),A&&A.length>0&&S.default.createElement(u.default,{style:{marginLeft:"5px"},loading:s,onClick:this.handleBatchDelete},"\u6279\u91cf\u5220\u9664"),S.default.createElement(u.default,{style:{float:"right",marginTop:"4px"},onClick:()=>{this.handleMonitoryPoint(!0)}},"\u7ba1\u7406\u76d1\u63a7\u70b9"))})),!f&&!C&&w&&R&&S.default.createElement(b.default,{style:{background:"#fff",marginTop:"10px",padding:"20px"},type:"warning",description:S.default.createElement("div",null,"\u6682\u65e0\u4e1a\u52a1\u76d1\u63a7\u56fe\u3001\u8bf7\u5148\u6dfb\u52a0",S.default.createElement("a",{onClick:()=>{M?this.handleCustomMonitoring():this.handleMonitoryPoint(!0)}},M?" \u6dfb\u52a0\u56fe\u8868":"\u7ba1\u7406\u76d1\u63a7\u70b9"))}),x&&S.default.createElement(_.default,{loading:a,title:"\u5220\u9664\u76d1\u63a7\u89c6\u56fe",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u89c6\u56fe\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d",onOk:this.handleSubmitDelete,onCancel:this.cancalDelete}),P&&S.default.createElement(v.default,(0,n.default)({title:"\u6279\u91cf\u5220\u9664\u76d1\u63a7\u89c6\u56fe",loading:s,data:A},this.handleParameter(),{onOk:this.fetchServiceMonitorFigure,onCancel:this.cancalBatchDelete})),f&&S.default.createElement(k.default,(0,n.default)({},this.props,{onCancel:()=>{this.fetchServiceMonitorFigure(),this.handleMonitoryPoint(!1)}})))}},p=h))||p);t.default=w},"ot6+":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("/zsF");var r=l(a("PArb"));a("5NDa");var i=l(a("5rEg"));a("5Dmo");var o=l(a("3S7+"));a("Pwec");var d=l(a("CtXQ"));a("+L6B");var u=l(a("2/Rp"));a("/xke");var c=l(a("TeRw"));a("Znn+");var p=l(a("ZTPi"));a("y8nQ");var h,m,f,g,v=l(a("Vl3Y")),_=a("MuoO"),y=s(a("q1tI")),E=a("P5Jw"),b=l(a("+kNj")),C=l(a("QDog")),S=l(a("mWxT")),k=b.default.Description,w=v.default.Item,A=p.default.TabPane,x=(h=(0,_.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo}},null,null,{withRef:!0}),m=v.default.create(),h(f=m((g=class extends y.PureComponent{constructor(e){super(e),this.getInfo=(()=>{var e=this.state,t=e.status,a=e.deployment_way,l=e.tabLoading,s=e.setTabActiveKey;this.props.dispatch({type:"appControl/getAutoDeployStatus",payload:{team_name:C.default.getCurrTeamName(),app_alias:this.props.app.service.service_alias,deployment_way:a},callback:e=>{if(e){var a=t,n=l,r=s||(1==e.bean.support_type?0:2==e.bean.support_type?1:2);a.splice(r,1,e.bean.status||!1),n.splice(r,1,e.bean.status||!1),this.setState({display:e.bean.display,status:a,tabLoading:n,url:e.bean.url,secret_key:e.bean.secret_key,support_type:e.bean.support_type,tabActiveKey:r,deploy_keyword:e.bean.deploy_keyword,deploy_mirror:e.bean.trigger})}}})}),this.handleCancel=(()=>{this.props.dispatch({type:"appControl/cancelAutoDeploy",payload:{team_name:C.default.getCurrTeamName(),app_alias:this.props.app.service.service_alias,deployment_way:this.state.deployment_way},callback:()=>{this.getInfo("cancel")}})}),this.handleOpen=(()=>{this.props.dispatch({type:"appControl/openAutoDeploy",payload:{team_name:C.default.getCurrTeamName(),app_alias:this.props.app.service.service_alias,deployment_way:this.state.deployment_way},callback:()=>{this.getInfo()}})}),this.handleScretSubmit=(()=>{this.props.form.validateFields(["secret_key"],e=>{if(!e){var t=this.props.form.getFieldValue("secret_key");this.props.dispatch({type:"appControl/putAutoDeploySecret",payload:{team_name:C.default.getCurrTeamName(),service_alias:this.props.app.service.service_alias,secret_key:t},callback:()=>{c.default.success({message:"\u66f4\u65b0\u6210\u529f"})}})}})}),this.handleCommandSubmit=(()=>{this.props.form.validateFields(["deploy_keyword"],e=>{if(!e){var t=this.props.form.getFieldValue("deploy_keyword");this.props.dispatch({type:"appControl/putAutoDeployCommand",payload:{team_name:C.default.getCurrTeamName(),service_alias:this.props.app.service.service_alias,keyword:t},callback:e=>{e&&200===e.status_code&&(c.default.success({message:"\u66f4\u65b0\u6210\u529f"}),this.setState({deploy_keyword:e.bean.deploy_keyword}))}})}})}),this.handleMirrorSubmit=(()=>{this.props.form.validateFields(["deploy_mirror"],e=>{if(!e){var t=this.props.form.getFieldValue("deploy_mirror");this.props.dispatch({type:"appControl/putMirrorCommand",payload:{team_name:C.default.getCurrTeamName(),service_alias:this.props.app.service.service_alias,trigger:t},callback:e=>{e&&200===e.status_code&&(c.default.success({message:"\u66f4\u65b0\u6210\u529f"}),this.setState({deploy_mirror:e.bean.trigger,url:e.bean.url}))}})}})}),this.handleTabs=(e=>{this.setState({setTabActiveKey:e,tabActiveKey:e,deployment_way:0==e?"code_webhooks":1==e?"api_webhooks":"image_webhooks"},()=>{this.getInfo()})}),this.state={display:!1,status:[!1,!1,!1],support_type:0,url:"",secret_key:"",tabActiveKey:0,setTabActiveKey:!1,deployment_way:"\u955c\u50cf"===this.props.service_source?"api_webhooks":"code_webhooks",tabLoading:[!1,!1,!1],service_source:this.props.service_source,deploy_keyword:"deploy",deploy_mirror:""}}componentDidMount(){this.getInfo()}shouldComponentUpdate(){return!0}render(){if(!this.state.display)return null;var e=this.props.form.getFieldDecorator,t=this.props.rainbondInfo,a=this.state,l=a.tabActiveKey,s=a.status,h=a.tabLoading,m=a.support_type,f=a.url,g=a.service_source,_=f.replace("http://127.0.0.1:5000","".concat(window.location.protocol,"//").concat(window.location.host)),C=()=>y.default.createElement("svg",{viewBox:"0 0 30 50",version:"1.1",width:"20px",height:"20px"},y.default.createElement("path",{style:{fill:"#03A9F4"},d:"M 40 20 C 40.390625 18.265625 39.90625 16.21875 37.5 14 C 33.585938 17.542969 34.703125 21.226563 36 23 C 36 23 35.835938 24 32 24 C 28.164063 24 2 24 2 24 C 2 24 0.167969 40 18 40 C 33.59375 40 37.972656 27.996094 38.828125 24.925781 C 39.183594 24.972656 39.578125 25.003906 40 25 C 42.148438 24.984375 44.929688 23.828125 46 19.515625 C 43.160156 18.53125 41.339844 18.976563 40 20 Z "}),y.default.createElement("path",{style:{fill:"#0288D1"},d:"M 2.164063 28 C 2.898438 32.738281 5.984375 40 18 40 C 30.183594 40 35.523438 32.671875 37.683594 28 Z "}),y.default.createElement("path",{style:{fill:"#81D4FA"},d:"M 19.8125 39.9375 C 18.890625 39.617188 14.738281 38.847656 14 33 C 9.789063 34.863281 6.0625 34.375 4.421875 34.007813 C 6.582031 37.238281 10.589844 40 18 40 C 18.621094 40 19.222656 39.976563 19.8125 39.9375 Z "}),y.default.createElement("path",{style:{fill:"#FFFFFF"},d:"M 20 32 C 20 33.105469 19.105469 34 18 34 C 16.894531 34 16 33.105469 16 32 C 16 30.894531 16.894531 30 18 30 C 19.105469 30 20 30.894531 20 32 Z "}),y.default.createElement("path",{style:{fill:"#37474F"},d:"M 14.914063 33.597656 C 15.136719 34.101563 14.933594 34.757813 14.402344 34.914063 C 11.101563 35.886719 8.257813 36.015625 6.105469 36.015625 C 5.464844 35.398438 4.914063 34.738281 4.449219 34.054688 C 7.035156 34.054688 11.160156 33.933594 13.59375 33.089844 C 14.117188 32.90625 14.691406 33.089844 14.914063 33.597656 Z M 2 27 C 2 27 3.875 27.125 5 26 C 6.875 27.6875 10.941406 27.089844 12 26 C 13.0625 27.6875 18.9375 27.375 20 26 C 21.25 27.4375 26.625 27.75 28 26 C 28.480469 27.460938 34.820313 27.875 36 26 C 37.0625 27.089844 41.0625 27.9375 43.3125 26 C 43.875 27.1875 46 27 46 27 L 46 28 L 2 28 M 17 32 C 17 32.550781 17.449219 33 18 33 C 18.550781 33 19 32.550781 19 32 C 19 31.449219 18.550781 31 18 31 C 17.449219 31 17 31.449219 17 32 Z "}),y.default.createElement("path",{style:{fill:"#01579B"},d:"M 11 24 L 6 24 L 6 19 L 11 19 Z M 21 19 L 16 19 L 16 24 L 21 24 Z M 31 19 L 26 19 L 26 24 L 31 24 Z M 16 14 L 11 14 L 11 19 L 16 19 Z M 26 14 L 21 14 L 21 19 L 26 19 Z "}),y.default.createElement("path",{style:{fill:"#0288D1"},d:"M 16 24 L 11 24 L 11 19 L 16 19 Z M 26 19 L 21 19 L 21 24 L 26 24 Z M 26 9 L 21 9 L 21 14 L 26 14 Z M 21 14 L 16 14 L 16 19 L 21 19 Z "})),x=S.default.documentPlatform_url(t);return y.default.createElement(n.default,{style:{marginBottom:24},title:"\u81ea\u52a8\u6784\u5efa\u8bbe\u7f6e"},y.default.createElement(p.default,{onChange:e=>{this.handleTabs(e)},tabBarExtraContent:y.default.createElement("div",null,!1===s[l]?y.default.createElement(u.default,{type:"primary",onClick:this.handleOpen},"\u5f00\u542f\u81ea\u52a8\u6784\u5efa"):y.default.createElement(u.default,{type:"primary",onClick:this.handleCancel},"\u5173\u95ed\u81ea\u52a8\u6784\u5efa"))},1===m&&"\u6e90\u7801"==g&&y.default.createElement(A,{tab:y.default.createElement("span",null,y.default.createElement(d.default,{type:"github"}),"Git-Webhook",y.default.createElement(o.default,{title:x&&y.default.createElement("a",{href:"".concat(x,"docs/user-manual/component-dev/auto_build/#\u57fa\u4e8e\u6e90\u4ee3\u7801\u64cd\u4f5c\u6d41\u7a0b"),target:"_blank",style:{color:"#fff"}},"\u70b9\u51fb\u9605\u8bfb\u6587\u6863")||""}," ",y.default.createElement(d.default,{type:"question-circle-o"}))),key:"0"},h[0]?y.default.createElement("div",null,y.default.createElement(b.default,{size:"small",style:{borderLeft:"10px solid #38AA56",paddingLeft:"10px",marginBottom:16},title:"",col:"1"},y.default.createElement(k,{term:"\u652f\u6301\u7c7b\u578b"},y.default.createElement("div",{style:{marginLeft:"38px"}},"Gitlab,Github,Gitee,Gogs,Coding")),y.default.createElement(k,{term:"Webhook"},y.default.createElement("div",{style:{marginLeft:"34px"}},y.default.createElement("a",null,_," "),y.default.createElement(E.CopyToClipboard,{text:_,onCopy:()=>{c.default.success({message:"\u590d\u5236\u6210\u529f"})}},y.default.createElement(u.default,{size:"small"},"\u590d\u5236")))),y.default.createElement(k,{term:"\u89e6\u53d1\u5173\u952e\u5b57\xa0\xa0\xa0\xa0\xa0\xa0"},y.default.createElement("div",{style:{display:"flex"}},y.default.createElement("div",{style:{paddingTop:"10px",margin:"0 15px 0 -30px"}},y.default.createElement(o.default,{title:y.default.createElement("div",null,"\u5f53Commit\u4fe1\u606f\u5305\u542b\u201c@",this.state.deploy_keyword,"\u201d\u65f6\u5c06\u81ea\u52a8\u89e6\u53d1\u7ec4\u4ef6\u81ea\u52a8\u90e8\u7f72")},y.default.createElement(d.default,{type:"question-circle-o"}))),y.default.createElement(v.default,{onSubmit:this.handleCommandSubmit},y.default.createElement(w,null,e("deploy_keyword",{initialValue:this.state.deploy_keyword,rules:[{required:!0,message:"\u5173\u952e\u5b57\u4e0d\u80fd\u4e3a\u7a7a"}]})(y.default.createElement(i.default,{addonBefore:"@",style:{width:300}})),y.default.createElement(u.default,{onClick:()=>{this.handleCommandSubmit()},style:{marginLeft:10},size:"small"},"\u66f4\u65b0"),y.default.createElement("p",null,"\u6ce8\u610f\uff1a\u5f53Commit\u4fe1\u606f\u5305\u542b@",this.state.deploy_keyword,"\uff0c\u5219Webhook\u89e6\u53d1\u3002")))))),y.default.createElement(r.default,{style:{margin:"16px 0"}})):y.default.createElement("div",{style:{textAlign:"center",height:"80px",lineHeight:"80px"}},"\u6682\u672a\u5f00\u542f\u81ea\u52a8\u6784\u5efa")),y.default.createElement(A,{tab:y.default.createElement("span",null,y.default.createElement(d.default,{type:"api"}),"\u81ea\u5b9a\u4e49API",y.default.createElement(o.default,{title:x&&y.default.createElement("a",{href:"".concat(x,"docs/user-manual/component-dev/auto_build/#api-\u89e6\u53d1\u81ea\u52a8\u6784\u5efa"),target:"_blank",style:{color:"#fff"}},"\u70b9\u51fb\u9605\u8bfb\u6587\u6863")||""},y.default.createElement(d.default,{type:"question-circle-o"}))),key:"1"},h[1]?y.default.createElement("div",null,y.default.createElement(b.default,{size:"small",title:"",style:{borderLeft:"10px solid #38AA56",paddingLeft:"10px",marginBottom:16},col:"1"},y.default.createElement(k,{term:"API"},y.default.createElement("a",null,_," "),y.default.createElement(E.CopyToClipboard,{text:_,onCopy:()=>{c.default.success({message:"\u590d\u5236\u6210\u529f"})}},y.default.createElement(u.default,{size:"small"},"\u590d\u5236"))),y.default.createElement(k,{term:"\u79d8\u94a5"},y.default.createElement(v.default,{onSubmit:this.handleScretSubmit},y.default.createElement(w,{style:{marginTop:"-6px"}},e("secret_key",{initialValue:this.state.secret_key||"",rules:[{required:!0,min:8,message:"\u79d8\u94a5\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e8\u4f4d"}]})(y.default.createElement(i.default,{style:{width:300}})),y.default.createElement(u.default,{onClick:this.handleScretSubmit,style:{marginLeft:10},size:"small"},"\u66f4\u65b0")))))):y.default.createElement("div",{style:{textAlign:"center",height:"80px",lineHeight:"80px"}},"\u6682\u672a\u5f00\u542f\u81ea\u52a8\u6784\u5efa")),("\u955c\u50cf"==g||"DockerCompose"==g||"DockerRun"==g)&&y.default.createElement(A,{tab:y.default.createElement("span",null," ",y.default.createElement(d.default,{component:C}),"\u955c\u50cf\u4ed3\u5e93Webhook",x&&y.default.createElement(o.default,{title:"\u70b9\u51fb\u9605\u8bfb\u6587\u6863"},y.default.createElement("a",{href:"".concat(x,"docs/user-manual/component-dev/auto_build/#\u57fa\u4e8e\u955c\u50cf\u4ed3\u5e93\u64cd\u4f5c\u6d41\u7a0b"),target:"_blank"},y.default.createElement(d.default,{type:"question-circle-o"})))),key:"2"},h[2]?y.default.createElement("div",null,y.default.createElement(b.default,{size:"small",title:"",style:{borderLeft:"10px solid #38AA56",paddingLeft:"10px",marginBottom:16},col:"1"},y.default.createElement(k,{term:"Webhook"},y.default.createElement("a",null,_," "),y.default.createElement(E.CopyToClipboard,{text:_,onCopy:()=>{c.default.success({message:"\u590d\u5236\u6210\u529f"})}},y.default.createElement(u.default,{size:"small"},"\u590d\u5236"))),y.default.createElement(k,{term:"Tag\u89e6\u53d1\xa0\xa0\xa0\xa0\xa0\xa0"},y.default.createElement("div",{style:{display:"flex"}},y.default.createElement("div",{style:{paddingTop:"10px",margin:"0 15px 0 -30px"}},y.default.createElement(d.default,{type:"question-circle-o"})),y.default.createElement(v.default,{onSubmit:this.handleMirrorSubmit},y.default.createElement(w,null,e("deploy_mirror",{initialValue:this.state.deploy_mirror,rules:[{required:!0,message:"\u5173\u952e\u5b57\u4e0d\u80fd\u4e3a\u7a7a"}]})(y.default.createElement(i.default,{style:{width:300},placeholder:"\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f,\u5982:release-v.*"})),y.default.createElement(u.default,{onClick:()=>{this.handleMirrorSubmit()},style:{marginLeft:10},size:"small"},"\u66f4\u65b0"),y.default.createElement("p",null,"\u6ce8\u610f\uff1a\u8868\u8fbe\u5f0f\u4e3a\u7a7a\u65f6\u66f4\u65b0\u4e8b\u4ef6\u7684tag\u4e0e\u5f53\u524d\u7ec4\u4ef6\u955c\u50cftag\u4e00\u81f4\u65f6\u89e6\u53d1\uff0c\u4e0d\u4e3a\u7a7a\u65f6\u8868\u8fbe\u5f0f\u5339\u914d\u6b63\u786e\u89e6\u53d1"))))))):y.default.createElement("div",{style:{textAlign:"center",height:"80px",lineHeight:"80px"}},"\u6682\u672a\u5f00\u542f\u81ea\u52a8\u6784\u5efa"))))}},f=g))||f)||f);t.default=x},"p3+A":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("jehZ"));a("5Dmo");var r=l(a("3S7+"));a("IzEo");var i=l(a("bx4M"));a("g9YV");var o=l(a("wCAj"));a("+L6B");var d=l(a("2/Rp"));a("Pwec");var u=l(a("CtXQ"));a("14J3");var c=l(a("BMrR"));a("jCWc");var p=l(a("kPKH"));a("fOrg");var h=l(a("+KLJ")),m=l(a("p0pE"));a("/xke");var f=l(a("TeRw"));a("y8nQ");var g,v,_,y,E=l(a("Vl3Y")),b=a("MuoO"),C=a("7DNP"),S=s(a("q1tI")),k=l(a("agpv")),w=l(a("z1Ga")),A=l(a("q76B")),x=l(a("MXRY")),D=l(a("cUW5")),T=l(a("puxM")),P=a("xpXo"),M=l(a("QDog")),N=l(a("YTVB")),I=(g=(0,b.connect)(e=>{var t=e.user,a=e.appControl,l=e.teamControl;return{currUser:t.currentUser,innerEnvs:a.innerEnvs,startProbe:a.startProbe,runningProbe:a.runningProbe,ports:a.ports,baseInfo:a.baseInfo,appDetail:a.appDetail,teamControl:l,appControl:a,volumes:a.volumes,appBaseInfo:a.baseInfo}},null,null,{withRef:!0}),v=E.default.create(),g(_=v((y=class extends S.default.Component{constructor(e){super(e),this.onDeleteVar=(e=>{this.setState({deleteVar:e})}),this.onCancelDeleteVolume=(()=>{this.setState({toDeleteVolume:null})}),this.onEditVolume=(e=>{this.setState({showAddVars:e,editor:e})}),this.onDeleteMnt=(e=>{this.setState({toDeleteMnt:e})}),this.onDeleteVolume=(e=>{this.setState({toDeleteVolume:e})}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchInnerEnvs()})}),this.onEditVar=(e=>{this.setState({showEditVar:e})}),this.onTransfer=(e=>{this.setState({transfer:e})}),this.cancelEditVar=(()=>{this.setState({showEditVar:null})}),this.handleSearch=(e=>{this.setState({page:1,env_name:e},()=>{this.fetchInnerEnvs()})}),this.fetchInnerEnvs=(()=>{var e=this.state,t=e.page,a=e.page_size,l=e.env_name;this.props.dispatch({type:"appControl/fetchInnerEnvs",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,page:t,page_size:a,env_name:l},callback:e=>{if(e&&200===e.status_code){var t=[];e.list&&e.list.length>0&&e.list.map(e=>{var a=M.default.confirmEnding("".concat(e.attr_name),"PASS");a&&t.push(e.ID)}),this.setState({isAttrNameList:t})}}})}),this.handleAddVar=(()=>{this.setState({showAddVar:!0})}),this.handleCancelAddVar=(()=>{this.setState({showAddVar:!1})}),this.handleSubmitAddVar=(e=>{this.props.dispatch({type:"appControl/addInnerEnvs",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,attr_name:e.attr_name,attr_value:e.attr_value,name:e.name},callback:e=>{e&&200===e.status_code&&(f.default.success({message:"\u6dfb\u52a0\u6210\u529f"}),this.fetchInnerEnvs(),this.handleCancelAddVar())}})}),this.cancelDeleteVar=(()=>{this.setState({deleteVar:null})}),this.cancelTransfer=(()=>{this.setState({transfer:null})}),this.handleDeleteVar=(()=>{this.props.dispatch({type:"appControl/deleteEnvs",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:this.state.deleteVar.ID},callback:e=>{e&&200===e.status_code&&(f.default.success({message:"\u5220\u9664\u6210\u529f"}),this.fetchInnerEnvs()),this.cancelDeleteVar(),this.props.onshowRestartTips(!0)}})}),this.handleTransfer=(()=>{var e=this.state.transfer;this.props.dispatch({type:"appControl/putTransfer",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:e.ID,scope:"inner"==e.scope?"outer":"inner"},callback:e=>{e&&200===e.status_code&&(f.default.success({message:"\u8f6c\u79fb\u6210\u529f"}),this.fetchInnerEnvs(),this.cancelTransfer())}})}),this.handleEditVar=(e=>{var t=this.state.showEditVar;this.props.dispatch({type:"appControl/editEvns",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,ID:t.ID,attr_value:e.attr_value,name:e.name},callback:e=>{e&&200===e.status_code&&(f.default.success({message:"\u7f16\u8f91\u6210\u529f"}),this.cancelEditVar(),this.fetchInnerEnvs())}})}),this.fetchVolumes=(()=>{this.props.dispatch({type:"appControl/fetchVolumes",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,is_config:!0}})}),this.fetchBaseInfo=(()=>{var e=this.props.dispatch;e({type:"appControl/fetchBaseInfo",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias}})}),this.loadMntList=(()=>{(0,P.getMnt)({team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,page:1,page_size:1e3,volume_type:["config-file"]}).then(e=>{e&&this.setState({mntList:e.list||[]})})}),this.handleAddVars=(()=>{this.setState({showAddVars:{new:!0}})}),this.handleCancelAddVars=(()=>{this.setState({showAddVars:null,editor:null})}),this.handleSubmitAddVars=(e=>{var t=this.state.editor;t?this.props.dispatch({type:"appControl/editorVolume",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,new_volume_path:e.volume_path,new_file_content:e.file_content,mode:e.mode,ID:t.ID},callback:e=>{e&&200===e.status_code&&(this.fetchVolumes(),this.handleCancelAddVars(),f.default.success({message:"\u7f16\u8f91\u6210\u529f"}),this.props.onshowRestartTips(!0))}}):this.props.dispatch({type:"appControl/addVolume",payload:(0,m.default)({team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias},e),callback:e=>{e&&200===e.status_code&&(this.fetchVolumes(),this.handleCancelAddVars(),f.default.success({message:"\u6dfb\u52a0\u6210\u529f"}),this.props.onshowRestartTips(!0))}})}),this.showAddRelation=(()=>{this.setState({showAddRelation:!0})}),this.handleCancelAddRelation=(()=>{this.setState({showAddRelation:!1})}),this.handleSubmitAddMnt=(e=>{(0,P.addMnt)({team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,body:e}).then(e=>{e&&(this.handleCancelAddRelation(),this.loadMntList(),f.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0))})}),this.handleDeleteVolume=(()=>{this.props.dispatch({type:"appControl/deleteVolume",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,volume_id:this.state.toDeleteVolume.ID},callback:e=>{e&&200===e.status_code&&(f.default.success({message:"\u5220\u9664\u6210\u529f"}),this.onCancelDeleteVolume(),this.fetchVolumes(),this.props.onshowRestartTips(!0))}})}),this.handleDeleteMnt=(()=>{this.props.dispatch({type:"appControl/deleteMnt",payload:{team_name:M.default.getCurrTeamName(),app_alias:this.props.appAlias,dep_vol_id:this.state.toDeleteMnt.dep_vol_id},callback:()=>{this.cancelDeleteMnt(),this.loadMntList(),f.default.success({message:"\u64cd\u4f5c\u6210\u529f"}),this.props.onshowRestartTips(!0)}})}),this.cancelDeleteMnt=(()=>{this.setState({toDeleteMnt:null})}),this.AfterPassword=((e,t)=>{var a=M.default.fetchSvg("passwordShow"),l=M.default.fetchSvg("passwordHidden");return S.default.createElement("span",{onClick:()=>{this.handlePassword(e,t)}},e?l:a)}),this.handlePassword=((e,t)=>{var a=this.state.isAttrNameList,l=a;if(e){var s=l.indexOf(t);l.splice(s,1)}else l.push(t);this.setState({isAttrNameList:l})}),this.state={showAddVar:!1,showEditVar:null,deleteVar:null,page:1,page_size:5,env_name:"",showAddVars:null,showAddRelation:!1,mntList:[],toDeleteMnt:null,toDeleteVolume:null,editor:null,isAttrNameList:[]}}componentDidMount(){this.props.dispatch({type:"teamControl/fetchAllPerm"}),this.fetchInnerEnvs(),this.loadMntList(),this.fetchVolumes(),this.fetchBaseInfo()}componentWillUnmount(){var e=this.props.dispatch;e({type:"appControl/clearTags"}),e({type:"appControl/clearPorts"}),e({type:"appControl/clearInnerEnvs"}),e({type:"appControl/clearStartProbe"}),e({type:"appControl/clearRunningProbe"}),e({type:"appControl/clearMembers"})}canView(){var e=this.props.componentPermissions.isEnv;return e}render(){if(!this.canView())return S.default.createElement(D.default,null);var e=this.state.mntList,t=this.props,a=t.baseInfo,l=t.volumes,s={wordBreak:"break-all",wordWrap:"break-word"};return"boolean"!==typeof a.build_upgrade?null:S.default.createElement(S.Fragment,null,S.default.createElement(c.default,null,S.default.createElement(p.default,{span:12},S.default.createElement(h.default,{showIcon:!0,message:"\u7ec4\u4ef6\u73af\u5883\u914d\u7f6e\u53d8\u66f4\u540e\u9700\u8981\u66f4\u65b0\u6216\u91cd\u542f\u7ec4\u4ef6\u751f\u6548",type:"info",style:{marginBottom:24}}))),S.default.createElement(c.default,null,S.default.createElement(x.default,{title:"\u81ea\u5b9a\u4e49\u73af\u5883\u53d8\u91cf",type:"Inner",appAlias:this.props.appAlias}),S.default.createElement(p.default,{span:12},S.default.createElement(h.default,{showIcon:!0,message:"\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u652f\u6301\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u52a8\u6001\u6e32\u67d3\uff0c\u65b9\u5f0f\u4e3a\uff1a${ENV_NAME}",type:"info",style:{marginBottom:24}}))),S.default.createElement(i.default,{style:{marginBottom:24},title:S.default.createElement("span",null," \u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e "),extra:S.default.createElement(d.default,{onClick:this.handleAddVars},S.default.createElement(u.default,{type:"plus"}),"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6")},S.default.createElement(T.default,{sm:650},S.default.createElement(o.default,{pagination:!1,columns:[{title:"\u914d\u7f6e\u6587\u4ef6\u540d\u79f0",dataIndex:"volume_name"},{title:"\u914d\u7f6e\u6587\u4ef6\u6302\u8f7d\u8def\u5f84",dataIndex:"volume_path"},{title:"\u6743\u9650",dataIndex:"mode"},{title:"\u64cd\u4f5c",dataIndex:"action",render:(e,t)=>S.default.createElement("div",null,S.default.createElement("a",{onClick:()=>{this.onDeleteVolume(t)},href:"javascript:;"},"\u5220\u9664"),S.default.createElement("a",{onClick:()=>{this.onEditVolume(t)},href:"javascript:;"},"\u7f16\u8f91"))}],dataSource:l}))),S.default.createElement(i.default,{title:S.default.createElement("span",null," \u5171\u4eab\u914d\u7f6e\u6587\u4ef6 "),extra:S.default.createElement(d.default,{onClick:this.showAddRelation},S.default.createElement(u.default,{type:"plus"}),"\u6302\u8f7d\u5171\u4eab\u914d\u7f6e\u6587\u4ef6")},S.default.createElement(T.default,{sm:850},S.default.createElement(o.default,{pagination:!1,columns:[{title:"\u672c\u5730\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",dataIndex:"local_vol_path",key:"1",width:"20%",render:e=>S.default.createElement(r.default,{title:e},S.default.createElement("span",{style:s},e))},{title:"\u914d\u7f6e\u6587\u4ef6\u540d\u79f0",dataIndex:"dep_vol_name",key:"2",width:"15%",render:e=>S.default.createElement(r.default,{title:e},S.default.createElement("span",{style:s},e))},{title:"\u76ee\u6807\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",dataIndex:"dep_vol_path",key:"3",width:"20%",render:e=>S.default.createElement(r.default,{title:e},S.default.createElement("span",{style:s},e))},{title:"\u6240\u5c5e\u7ec4\u4ef6",dataIndex:"dep_app_name",key:"4",width:"15%",render:(e,t)=>S.default.createElement(C.Link,{to:"/team/".concat(M.default.getCurrTeamName(),"/region/").concat(M.default.getCurrRegionName(),"/components/").concat(t.dep_app_alias,"/overview")},e)},{title:"\u7ec4\u4ef6\u6240\u5c5e\u5e94\u7528",dataIndex:"dep_app_group",key:"5",width:"15%",render:(e,t)=>S.default.createElement(C.Link,{to:"/team/".concat(M.default.getCurrTeamName(),"/region/").concat(M.default.getCurrRegionName(),"/apps/").concat(t.dep_group_id)},e)},{title:"\u64cd\u4f5c",dataIndex:"action",key:"6",width:"15%",render:(e,t)=>S.default.createElement("a",{onClick:()=>{this.onDeleteMnt(t)},href:"javascript:;"},"\u53d6\u6d88\u6302\u8f7d")}],dataSource:e}))),this.state.showAddVars&&S.default.createElement(k.default,(0,n.default)({appBaseInfo:this.props.appBaseInfo,onCancel:this.handleCancelAddVars,onSubmit:this.handleSubmitAddVars,data:this.state.showAddVars,editor:this.state.editor},this.props)),this.state.showAddRelation&&S.default.createElement(w.default,{appAlias:this.props.appAlias,onCancel:this.handleCancelAddRelation,onSubmit:this.handleSubmitAddMnt,volume_type:["config-file"]}),this.state.toDeleteMnt&&S.default.createElement(A.default,{title:"\u53d6\u6d88\u6302\u8f7d\u5171\u4eab\u914d\u7f6e\u6587\u4ef6",desc:"\u786e\u5b9a\u8981\u53d6\u6d88\u6b64\u6302\u8f7d\u5171\u4eab\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u5417?",onCancel:this.cancelDeleteMnt,onOk:this.handleDeleteMnt}),this.state.toDeleteVolume&&S.default.createElement(A.default,{title:"\u5220\u9664\u914d\u7f6e\u6587\u4ef6",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u914d\u7f6e\u6587\u4ef6\u5417?",onCancel:this.onCancelDeleteVolume,onOk:this.handleDeleteVolume}),this.state.showAddVar&&S.default.createElement(N.default,{onCancel:this.handleCancelAddVar,onSubmit:this.handleSubmitAddVar,isShowRestartTips:e=>{this.props.onshowRestartTips(e)}}),this.state.transfer&&S.default.createElement(A.default,{onOk:this.handleTransfer,onCancel:this.cancelTransfer,title:"\u8f6c\u79fb\u73af\u5883\u53d8\u91cf",desc:"\u786e\u5b9a\u8981\u5c06\u6b64\u73af\u5883\u53d8\u91cf\u8f6c\u6362\u4e3a\u7ec4\u4ef6\u8fde\u63a5\u4fe1\u606f\u53d8\u91cf\u5417?",subDesc:""}),this.state.showEditVar&&S.default.createElement(N.default,{onCancel:this.cancelEditVar,onSubmit:this.handleEditVar,data:this.state.showEditVar,isShowRestartTips:e=>{this.props.onshowRestartTips(e)}}),this.state.deleteVar&&S.default.createElement(A.default,{onOk:this.handleDeleteVar,onCancel:this.cancelDeleteVar,title:"\u5220\u9664\u53d8\u91cf",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u53d8\u91cf\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d"}))}},_=y))||_)||_);t.default=I},pkKe:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV")),r=l(a("jehZ"));a("/xke");var i=l(a("TeRw"));a("5NDa");var o=l(a("5rEg"));a("OaEy");var d=l(a("2fM7"));a("y8nQ");var u,c,p,h=l(a("Vl3Y")),m=s(a("q1tI")),f=h.default.Item,g=d.default.Option,v=(o.default.TextArea,u=h.default.create(),u((p=class extends m.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault(),this.props.form.validateFields({force:!0},(e,t)=>{if(!e){if("\u8bf7\u9009\u62e9\u7aef\u53e3"==t.port)return void i.default.info({message:"\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u7aef\u53e3\uff0c\u8bf7\u5148\u9009\u62e9\u7aef\u53e3\uff01"});this.props.onOk&&this.props.onOk(t)}})}),this.handleCancel=(()=>{this.props.onCancel&&this.props.onCancel()}),this.state={}}render(){var e=this.props.form,t=e.getFieldDecorator,a=(e.getFieldValue,{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}}),l=this.props.postList;l[0].lb_mpping_port;return m.default.createElement(n.default,{title:"\u7ed1\u5b9a\u57df\u540d",onOk:this.handleSubmit,visible:!0,onCancel:this.props.onCancel},m.default.createElement(h.default,{onSubmit:this.handleSubmit},m.default.createElement(f,(0,r.default)({},a,{label:"\u8bf7\u9009\u62e9\u7aef\u53e3"}),t("port",{initialValue:"\u8bf7\u9009\u62e9\u7aef\u53e3",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7aef\u53e3"}]})(m.default.createElement(d.default,{getPopupContainer:e=>e.parentNode},l.map(e=>{return m.default.createElement(g,{value:e.service_id+"||"+e.lb_mpping_port},e.lb_mpping_port)}))))))}},c=p))||c);t.default=v},pybC:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(a("q1tI")),r=l(a("iLo2"));class i extends n.PureComponent{render(){var e=this.props.appAlias;return n.default.createElement(n.Fragment,null,n.default.createElement(r.default,{moduleName:"PerformanceAnalysis",RangeData:["responseTime","throughput","numberOnline"],appAlias:e}))}}t.default=i},qPtA:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV")),r=s(a("jehZ"));a("+L6B");var i=s(a("2/Rp"));a("y8nQ");var o=s(a("Vl3Y")),d=l(a("q1tI")),u=s(a("CQXj")),c=o.default.Item;class p extends d.PureComponent{render(){var e=this.props,t=e.title,a=e.onCancel,l=this.props.data||{},s={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};return d.default.createElement(n.default,{title:t,visible:!0,onCancel:a,footer:[d.default.createElement(i.default,{onClick:a}," \u5173\u95ed ")]},d.default.createElement(o.default,null,d.default.createElement(c,(0,r.default)({},s,{label:"\u76d1\u6d4b\u7aef\u53e3"}),d.default.createElement("span",null,u.default.getPort(l))),d.default.createElement(c,(0,r.default)({},s,{label:"\u63a2\u9488\u4f7f\u7528\u534f\u8bae"}),d.default.createElement("span",null,u.default.getProtocol(l))),"http"===l.scheme?d.default.createElement(d.Fragment,null,d.default.createElement(c,(0,r.default)({},s,{label:"http\u8bf7\u6c42\u5934"}),d.default.createElement("span",null,u.default.getHeaders(l))),d.default.createElement(c,(0,r.default)({},s,{label:"\u8def\u5f84"}),d.default.createElement("span",null,u.default.getPath(l)))):null,d.default.createElement(c,(0,r.default)({},s,{label:"\u521d\u59cb\u5316\u7b49\u5019\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getInitWaitTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u68c0\u6d4b\u76d1\u6d4b\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getIntervalTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4"}),d.default.createElement("span",null,u.default.getTimeoutTime(l),d.default.createElement("span",{style:{marginLeft:8}},"\u79d2"))),d.default.createElement(c,(0,r.default)({},s,{label:"\u8fde\u7eed\u9519\u8bef\u6b21\u6570"}),d.default.createElement("span",null,u.default.getFailTimes(l)))))}}t.default=p},sC1O:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("y8nQ");var n=l(a("Vl3Y"));a("5NDa");var r=l(a("5rEg"));a("OaEy");var i,o,d,u=l(a("2fM7")),c=s(a("q1tI")),p=a("MuoO"),h=(a("7DNP"),a("P5Jw"),l(a("p3+A"))),m=(u.default.Option,r.default.Search,i=(0,p.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,baseInfo:a.baseInfo,extendInfo:a.extendInfo,instances:a.pods}},null,null,{pure:!1,withRef:!0}),o=n.default.create(),i(d=o(d=class extends c.PureComponent{constructor(e){super(e),this.state={}}render(){return c.default.createElement("div",null,c.default.createElement(h.default,this.props))}})||d)||d);t.default=m},vX3j:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var n=l(a("wCAj"));a("IzEo");var r=l(a("bx4M"));a("14J3");var i=l(a("BMrR"));a("jCWc");var o=l(a("kPKH"));a("+L6B");var d=l(a("2/Rp")),u=l(a("jehZ"));a("5NDa");var c=l(a("5rEg"));a("/xke");var p=l(a("TeRw")),h=l(a("p0pE"));a("2qtc");var m=l(a("kLXV"));a("y8nQ");var f=l(a("Vl3Y"));a("7Kak");var g,v,_,y,E=l(a("9yH6")),b=a("MuoO"),C=a("7DNP"),S=s(a("q1tI")),k=a("P5Jw"),w=l(a("q76B")),A=l(a("QDog")),x=(E.default.Group,f.default.Item),D=m.default.confirm,T=/^(?=^.{3,255}$)(http(s)?:\/\/)?(www\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:\d+)*(\/\w+\.\w+)*$/,P=/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/,M=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,N=(g=(0,b.connect)(e=>{var t=e.user,a=e.appControl;return{currUser:t.currentUser,appRequest:a.appRequest,appRequestRange:a.appRequestRange,requestTime:a.requestTime,requestTimeRange:a.requestTimeRange,appDisk:a.appDisk,appMemory:a.appMemory,appDetail:a.appDetail}},null,null,{withRef:!0}),v=f.default.create(),g(_=v((y=class extends S.PureComponent{constructor(e){super(e),this.fetchParameter=(()=>{var e=this.props.appAlias;return{team_name:A.default.getCurrTeamName(),region_name:A.default.getCurrRegionName(),app_alias:e}}),this.showConfirm=(()=>{var e=this.props.dispatch,t=this.fetchParameter(),a=t.team_name,l=t.region_name,s=t.app_alias;D({title:"\u7aef\u53e3\u672a\u5f00\u542f",content:"\u4e0a\u7ebf\u524d\u5fc5\u987b\u5f00\u542f\u7aef\u53e3\u5bf9\u5185\u6216\u5bf9\u5916\u5c5e\u6027",okText:"\u53bb\u914d\u7f6e",onOk(){e(C.routerRedux.push("/team/".concat(a,"/region/").concat(l,"/components/").concat(s,"/port")))},onCancel(){console.log("Cancel")}})}),this.handleGetList=(()=>{var e=this.props.dispatch;e({type:"appControl/getInstanceList",payload:this.fetchParameter(),callback:e=>{e&&200===e.status_code&&this.setState({endpoint_num:e.bean.endpoint_num>0?e.bean.endpoint_num:"",list:e.list})}})}),this.openDeleteVar=(e=>{this.setState({deleteVar:!0,ep_id:e})}),this.cancelDeleteVar=(()=>{this.setState({deleteVar:null})}),this.handleDeleteVar=(()=>{var e=this.state.ep_id;this.props.dispatch({type:"appControl/deleteInstanceList",payload:(0,h.default)({},this.fetchParameter(),{ep_id:e}),callback:e=>{e&&200===e.status_code&&(this.handleGetList(),this.cancelDeleteVar(),setTimeout(()=>{this.handleGetList()},5e4),p.default.info({message:"\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}))}})}),this.handleModify=(e=>{this.props.dispatch({type:"appControl/modifyInstanceList",payload:(0,h.default)({},this.fetchParameter(),{ep_id:e.ep_id}),callback:e=>{e&&200===e.status_code&&(e.bean&&e.bean.port_closed?this.showConfirm():(this.handleGetList(),this.cancelDeleteVar()))}})}),this.addInstance=(()=>{this.setState({visible:!0})}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.dispatch;a.validateFields((e,t)=>{e||l({type:"appControl/addInstanceList",payload:(0,h.default)({},this.fetchParameter(),{ip:t.ip}),callback:e=>{e&&200===e.status_code&&(this.setState({visible:!1}),this.handleGetList(),p.default.info({message:"\u9700\u8981\u66f4\u65b0\u624d\u80fd\u751f\u6548"}))}})})}),this.handleCancel=(()=>{this.setState({visible:!1})}),this.validAttrName=((e,t,a)=>{t&&""!==t?("1.1.1.1"===t&&a("\u4e0d\u652f\u63011.1.1.1\u5730\u5740"),T.test(t||"")||P.test(t||"")||M.test(t||"")?a():a("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5730\u5740")):a("\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740")}),this.handleUpDatekey=(()=>{var e=this.props.dispatch;e({type:"appControl/editUpDatekey",payload:this.fetchParameter(),callback:e=>{e&&200===e.status_code&&this.setState({api_service_key:e.bean&&e.bean.api_service_key})}})}),this.state={endpoint_num:"",list:[],deleteVar:!1,visible:!1,ep_id:"",api_service_key:""}}componentDidMount(){this.handleGetList()}render(){var e=this.state,t=e.list,a=e.endpoint_num,l=e.api_service_key,s=e.visible,h=e.deleteVar,f=this.props,g=f.groupDetail,v=f.appDetail,_=f.form,y=_.getFieldDecorator,E=g&&g.app_type&&"helm"===g.app_type,b={labelCol:{span:5},wrapperCol:{span:19}},C=[{title:"\u5b9e\u4f8b\u5730\u5740",dataIndex:"ip",key:"1"},{title:"\u5065\u5eb7\u72b6\u6001",dataIndex:"status",align:"center",key:"2",render:e=>{var t={healthy:"\u5065\u5eb7",unhealthy:"\u4e0d\u5065\u5eb7",notready:"\u672a\u5c31\u7eea",unknown:"\u672a\u77e5"};return S.default.createElement("span",{style:{color:"healthy"==e?"green":"unhealthy"==e?"red":""}},t[e]||"\u672a\u4e0a\u7ebf")}}];E||C.push({title:"\u64cd\u4f5c",dataIndex:"ep_id",key:"3",render:e=>S.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.openDeleteVar(e)}},"\u5220\u9664")});var A=l||(v.api_service_key?v.api_service_key:"");return S.default.createElement(S.Fragment,null,S.default.createElement(i.default,{gutter:24},s&&S.default.createElement(m.default,{title:"\u65b0\u589e\u5b9e\u4f8b",visible:!0,onOk:this.handleSubmit,onCancel:this.handleCancel},S.default.createElement(x,(0,u.default)({},b,{label:"\u5b9e\u4f8b\u5730\u5740"}),y("ip",{rules:[{required:!0,validator:this.validAttrName}],initialValue:void 0})(S.default.createElement(c.default,{placeholder:"\u8bf7\u8f93\u5165\u5b9e\u4f8b\u5730\u5740"})))),"third_party"===v.service.service_source&&S.default.createElement(r.default,{title:"\u670d\u52a1\u5b9e\u4f8b",extra:E?null:S.default.createElement("div",null,"kubernetes"!==v.register_way&&S.default.createElement(d.default,{style:{marginRight:"5px"},onClick:()=>{this.addInstance()}},"\u65b0\u589e"),S.default.createElement(d.default,{onClick:()=>{this.handleGetList()}},"\u5237\u65b0"))},S.default.createElement(i.default,null,S.default.createElement(o.default,{span:12},S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"\u6ce8\u518c\u65b9\u5f0f:"),v.register_way?v.register_way:""),v.api_url&&S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"API\u5730\u5740:"),v.api_url?v.api_url:"",S.default.createElement("div",{style:{margin:"5px 0"}},S.default.createElement("span",null,"\u79d8\u94a5\uff1a ",S.default.createElement("a",null,A),S.default.createElement(k.CopyToClipboard,{text:A,onCopy:()=>{p.default.success({message:"\u590d\u5236\u6210\u529f"})}},S.default.createElement(d.default,{size:"small",style:{margin:"0 10px"}},"\u590d\u5236"))),S.default.createElement(d.default,{size:"small",onClick:()=>{this.handleUpDatekey()}},"\u91cd\u7f6e\u5bc6\u94a5"))),a&&S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"\u5f53\u524d\u5b9e\u4f8b\u6570:"),a>0?a:""),"kubernetes"===v.endpoints_type&&S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"Service:"),v.kubernetes.namespace,"/",v.kubernetes.serviceName),v.discovery_type&&S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"\u52a8\u6001\u7c7b\u578b:"),v.discovery_type),v.discovery_key&&S.default.createElement("p",null,S.default.createElement("b",{style:{marginRight:16}},"\u52a8\u6001key:"),v.discovery_key)),v.api_url&&S.default.createElement(o.default,{span:12},S.default.createElement("span",null,"API \u8c03\u7528\u53c2\u8003\uff08\u5c06\u5176\u4e2d\u7684192.168.1.1\u4fee\u6539\u4e3a\u4f60\u7684\u771f\u5b9eIP\u5730\u5740\u5373\u53ef\uff09\uff1a"),S.default.createElement("div",{style:{background:"#000",color:"#fff",padding:"16px"}},"curl -X PUT --url ".concat(v.api_url,' -H "Content-Type: application/json" -d \'{"secret_key":"').concat(A,'","ip":"192.168.1.1","is_online":true}\'')))))),S.default.createElement(i.default,null,S.default.createElement(n.default,{dataSource:t,columns:C,style:{background:"#fff",margin:"12px -12px 0 -12px"}})),h&&S.default.createElement(w.default,{onOk:this.handleDeleteVar,onCancel:this.cancelDeleteVar,title:"\u5220\u9664\u53d8\u91cf",desc:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d"}))}},_=y))||_)||_);t.default=N},ye39:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=l(a("BMrR"));a("jCWc");var r=l(a("kPKH"));a("IzEo");var i=l(a("bx4M"));a("DjyN");var o=l(a("NUBc"));a("P2fV");var d=l(a("NJEC"));a("/zsF");var u=l(a("PArb"));a("5Dmo");var c=l(a("3S7+"));a("y8nQ");var p,h,m,f,g=l(a("Vl3Y")),v=a("MuoO"),_=l(a("wd/R")),y=s(a("q1tI")),E=l(a("QDog")),b=l(a("LrcT")),C=l(a("Sw8b")),S=(p=(0,v.connect)(),h=g.default.create(),p(m=h((f=class extends y.PureComponent{constructor(e){super(e),this.showModal=(e=>{this.setState({EventID:e,logVisible:!0})}),this.handleOk=(()=>{this.setState({logVisible:!1})}),this.handleCancel=(()=>{this.setState({logVisible:!1})}),this.handleRolback=(e=>{var t=this.props.onRollback;t&&t(e)}),this.handleDel=(e=>{var t=this.props.handleDel;t&&t(e)}),this.showStatus=(e=>{switch(e){case"":return"\u6784\u5efa\u4e2d";case"success":return"\u6784\u5efa\u6210\u529f";case"failure":return"\u6784\u5efa\u5931\u8d25";default:return"\u672a\u77e5"}}),this.state={logVisible:!1,EventID:""}}componentDidMount(){}render(){var e=this.props,t=e.dataList,a=e.current_version,l=e.componentPermissions,s=l.isRollback,p=l.isDelete,h=e.pages,m=e.pageSize,f=e.total,g=e.onPageChange,v=e.onShowSizeChange,S=this.state,k=S.EventID,w=S.logVisible;return y.default.createElement(n.default,{gutter:24},w&&y.default.createElement(C.default,{title:"\u6784\u5efa\u65e5\u5fd7",EventID:k,onOk:this.handleOk,onCancel:this.handleCancel,width:"1200px"}),y.default.createElement(r.default,{xs:24,xm:24,md:24,lg:24,xl:24},y.default.createElement(i.default,{bordered:!1,title:"\u6784\u5efa\u7248\u672c\u5386\u53f2",style:{margin:"20px 0"}},y.default.createElement("div",{className:b.default.buildHistoryBox},y.default.createElement("ul",{className:b.default.buildHistoryList},t&&t.length>0&&t.map(e=>{var t=e.code_commit_msg,l=e.image_domain,n=e.build_user,r=e.code_version,i=e.status,o=e.create_time,h=e.build_version,m=e.finish_time,f=e.upgrade_or_rollback,g=e.event_id,v=e.image_repo,C=e.code_branch,S=e.image_tag,k=e.kind;return y.default.createElement("li",{key:h,className:"".concat(b.default.rowLi," ").concat(b.default.prRow," ").concat("success"===i?b.default.passed:"failure"===i?b.default.failed:b.default.canceled," ")},y.default.createElement("div",{className:"".concat(b.default.lineone," ").concat(b.default.fadeOute)},y.default.createElement("div",{className:"".concat(b.default.rowRtem," ").concat(b.default.buildInfo)},y.default.createElement("div",{className:" ".concat(b.default.alcen,"  ").concat(b.default.rowBranch)},y.default.createElement("span",{className:"".concat(b.default.statusIcon," ")},"success"===i?E.default.fetchSvg("success"):"failure"===i?y.default.createElement("span",{className:b.default.icon,style:{textAlign:"center",color:"#db4545",display:"inline-block",lineHeight:1}},"!"):E.default.fetchSvg("close")),y.default.createElement("a",{className:" ".concat(b.default.alcen," ").concat(b.default.passeda," ")},y.default.createElement("font",{className:b.default.nowarpCorolText,style:{width:"100%",color:"success"===i?"#39aa56":"failure"===i?"#db4545":"#9d9d9d"}},h,h&&a&&h===a&&"(\u5f53\u524d\u7248\u672c)"))),y.default.createElement("div",{className:" ".concat(b.default.alcen," ").concat(b.default.rowMessage," ")},y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?"\u63d0\u4ea4\u4fe1\u606f":"\u6e90\u955c\u50cf\u4ed3\u5e93\u5730\u5740")},k&&("\u6e90\u7801\u6784\u5efa"===k?E.default.fetchSvg("basicInfo"):E.default.fetchSvg("warehouse"))),y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?t&&t:l&&l)},y.default.createElement("span",{className:b.default.nowarpCorolText,style:{width:"90%"}},k&&("\u6e90\u7801\u6784\u5efa"===k?t&&t:l&&l))))),y.default.createElement("div",{className:"".concat(b.default.rowRtem," ").concat(b.default.buildCommitter," ").concat(b.default.alcen)},y.default.createElement("div",{style:{width:"210px"}},y.default.createElement("a",{style:{width:"100%",cursor:"auto"}},y.default.createElement("font",{className:b.default.nowarpCorolText,style:{width:"90%"}},n&&" @&nbsp;".concat(n)))),y.default.createElement("div",{className:" ".concat(b.default.alcen," ").concat(b.default.calcwd," ")},y.default.createElement("a",{className:"".concat(b.default.alcen),style:{width:"50%",cursor:"auto"}},y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?"\u4ee3\u7801\u5206\u652f":"\u6e90\u955c\u50cf\u540d\u79f0")},k&&("\u6e90\u7801\u6784\u5efa"===k?E.default.fetchSvg("branch"):E.default.fetchSvg("basicInfo"))),y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?C&&C:v&&v)},y.default.createElement("span",{className:b.default.nowarpCorolText,style:{width:"90%"}},k&&("\u6e90\u7801\u6784\u5efa"===k?C&&C:v&&v)))),y.default.createElement("a",{className:" ".concat(b.default.alcen," "),style:{width:"50%",cursor:"auto"}},y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?"\u4ee3\u7801\u7248\u672c":"\u6e90\u955c\u50cfTAG")},y.default.createElement("span",{className:" ".concat(b.default.alcen," ").concat(b.default.buildwidth," "),style:{color:"rgba(0, 0, 0, 0.65)"}},k&&("\u6e90\u7801\u6784\u5efa"===k?E.default.fetchSvg("warehouse"):E.default.fetchSvg("branch")))),y.default.createElement(c.default,{title:k&&("\u6e90\u7801\u6784\u5efa"===k?r&&"":S&&S)},y.default.createElement("font",{className:b.default.nowarpCorolText,style:{width:"90%"}},k&&("\u6e90\u7801\u6784\u5efa"===k?r&&r.substr(0,8):S||""))))))),y.default.createElement("div",{className:"".concat(b.default.linetwo)},y.default.createElement("div",{className:"".concat(b.default.rowRtem," ").concat(b.default.alcen)},y.default.createElement("a",{className:"success"===i?b.default.passeda:"failure"===i?b.default.faileda:b.default.canceleda},E.default.fetchSvg("logState","failure"===i?"#39AA56#db4545":"#39AA56"),y.default.createElement("font",{style:{fontSize:"14px",color:"failure"===i?"#39AA56#db4545":"#39AA56"}},this.showStatus(i)))),y.default.createElement("div",{className:"".concat(b.default.rowRtem," ")})),y.default.createElement("div",{className:"".concat(b.default.linestree)},y.default.createElement("div",{className:"".concat(b.default.rowRtem," ").concat(b.default.rowDuration)},y.default.createElement("div",{className:b.default.alcen},y.default.createElement(c.default,{title:"\u8fd0\u884c\u65f6\u95f4"},E.default.fetchSvg("runTime")),y.default.createElement("time",{className:b.default.labelAlign},y.default.createElement("font",{style:{display:"inline-block",color:"rgba(0,0,0,0.45)"}},E.default.fetchTime(m?new Date(m).getTime()-new Date(o).getTime():Date.parse(new Date)-new Date(o).getTime()))))),y.default.createElement("div",{className:"".concat(b.default.rowRtem," ").concat(b.default.rowCalendar," ").concat(b.default.alcen)},y.default.createElement("div",{className:b.default.alcen},y.default.createElement(c.default,{title:"\u521b\u5efa\u65f6\u95f4"},E.default.fetchSvg("createTime")),y.default.createElement("time",{className:b.default.labelAlign},y.default.createElement("font",{style:{display:"inline-block",color:"rgba(0,0,0,0.45)"}},o&&(0,_.default)(o).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss")))))),y.default.createElement("div",{className:"".concat(b.default.linefour)},y.default.createElement("span",null,y.default.createElement("a",{style:{fontSize:"12px"},onClick:()=>{this.showModal(g)}},"\u65e5\u5fd7")),1==f&&s?y.default.createElement(d.default,{title:"\u786e\u5b9a\u8981\u5347\u7ea7\u5230\u6b64\u7248\u672c\u5417?",onConfirm:()=>{this.handleRolback(e)}},y.default.createElement("span",null,y.default.createElement(u.default,{type:"vertical"}),y.default.createElement("a",{style:{fontSize:"12px"}},"\u5347\u7ea7"))):-1==f&&"success"==i&&h!=a&&s&&a?y.default.createElement(d.default,{title:"\u786e\u5b9a\u8981\u56de\u6eda\u5230\u6b64\u7248\u672c\u5417?",onConfirm:()=>{this.handleRolback(e)}},y.default.createElement("span",null,y.default.createElement(u.default,{type:"vertical"}),y.default.createElement("a",{style:{fontSize:"12px"}},"\u56de\u6eda"))):"",y.default.createElement(d.default,{title:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u7248\u672c\u5417?",onConfirm:()=>{this.handleDel(e)}},h!==a&&p&&a&&y.default.createElement("span",null,y.default.createElement(u.default,{type:"vertical"}),y.default.createElement("a",{style:{fontSize:"12px"}},"\u5220\u9664")))))}))),y.default.createElement("div",{style:{textAlign:"right",marginTop:"24px"}},y.default.createElement(o.default,{current:h,pageSize:m,showSizeChanger:!0,total:Number(f),defaultCurrent:1,onChange:g,pageSizeOptions:["5","10","20","50"],onShowSizeChange:v})))))}},m=f))||m)||m),k=S;t.default=k},z1Ga:function(e,t,a){"use strict";var l=a("tAuX"),s=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=s(a("kLXV"));a("g9YV");var r=s(a("wCAj"));a("5Dmo");var i=s(a("3S7+"));a("5NDa");var o=s(a("5rEg"));a("/xke");var d=s(a("TeRw")),u=a("7DNP"),c=l(a("q1tI")),p=a("xpXo"),h=s(a("QDog"));class m extends c.PureComponent{constructor(e){super(e),this.handleSubmit=(()=>{if(this.state.selectedRowKeys.length){var e=[];e=this.state.selectedRowKeys.map(e=>{var t=this.state.list[e];return{id:t.dep_vol_id,path:this.state.localpaths[t.dep_vol_id]}}),e=e.filter(e=>!!e.path),e.length?this.props.onSubmit&&this.props.onSubmit(e):d.default.warning({message:"\u8bf7\u68c0\u67e5\u672c\u5730\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u662f\u5426\u586b\u5199"})}else d.default.warning({message:"\u8bf7\u9009\u62e9\u8981\u6302\u8f7d\u5171\u4eab\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55"})}),this.handleTableChange=((e,t)=>{this.setState({current:e,pageSize:t},()=>{this.loadUnMntList()})}),this.loadUnMntList=(()=>{(0,p.getMnt)({team_name:h.default.getCurrTeamName(),app_alias:this.props.appAlias,page:this.state.current,page_size:this.state.pageSize,type:"unmnt",volume_type:this.props.volume_type?this.props.volume_type:["share-file","memoryfs","local"]}).then(e=>{e&&this.setState({list:e.list||[],total:e.total})})}),this.handleCancel=(()=>{this.props.onCancel&&this.props.onCancel()}),this.isDisabled=((e,t)=>-1===this.state.selectedRowKeys.indexOf(t)),this.handleChange=((e,t,a)=>{var l=this.state.localpaths;l[t.dep_vol_id]=e,this.setState({localpaths:l})}),this.state={selectedRowKeys:[],list:[],total:0,current:1,pageSize:6,localpaths:{}}}componentDidMount(){this.loadUnMntList()}render(){var e={onChange:(e,t)=>{this.setState({selectedRowKeys:e})}},t=this.state,a=t.total,l=t.current,s=t.pageSize,d={onChange:this.handleTableChange,total:a,pageSize:s,current:l};return c.default.createElement(n.default,{title:"\u6302\u8f7d\u5171\u4eab\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55",width:1150,visible:!0,onOk:this.handleSubmit,onCancel:this.handleCancel},c.default.createElement(r.default,{pagination:d,dataSource:this.state.list,rowSelection:e,style:{width:"100%",overflowX:"auto"},columns:[{title:"\u672c\u5730\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",dataIndex:"localpath",key:"1",width:"20%",render:(e,t,a)=>c.default.createElement(o.default,{onChange:e=>{this.handleChange(e.target.value,t,a)},disabled:this.isDisabled(t,a)})},{title:"\u914d\u7f6e\u6587\u4ef6\u540d\u79f0",dataIndex:"dep_vol_name",key:"2",width:"20%",render:(e,t)=>c.default.createElement(i.default,{title:e},c.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e))},{title:"\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\u8def\u5f84",dataIndex:"dep_vol_path",key:"3",width:"20%",render:(e,t)=>c.default.createElement(i.default,{title:e},c.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e))},{title:"\u6240\u5c5e\u7ec4\u4ef6",dataIndex:"dep_app_name",key:"5",width:"20%",render:(e,t)=>{return c.default.createElement(i.default,{title:e},c.default.createElement(u.Link,{to:"/team/".concat(h.default.getCurrTeamName(),"/region/").concat(h.default.getCurrRegionName(),"/components/").concat(t.dep_app_alias,"/overview")},c.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e)))}},{title:"\u7ec4\u4ef6\u6240\u5c5e\u5e94\u7528",dataIndex:"dep_app_group",key:"6",width:"15%",render:(e,t)=>{return c.default.createElement(i.default,{title:e},c.default.createElement(u.Link,{to:"/team/".concat(h.default.getCurrTeamName(),"/region/").concat(h.default.getCurrRegionName(),"/apps/").concat(t.dep_group_id)},c.default.createElement("span",{style:{wordBreak:"break-all",wordWrap:"break-word"}},e)))}}]}))}}t.default=m},zMIy:function(e,t,a){e.exports={logsss:"logsss___2W4kX",podCascader:"podCascader___3Aq0a",logModal:"logModal___24kgh",History1000Log:"History1000Log___2tNcS"}},zQST:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l={haveFeature(e,t){return!(!e||0===e.length)&&e.filter(e=>e.code===t).length>0}};t.default=l}}]);