(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[70],{"+ygn":function(e,t,s){"use strict";var n=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("2qtc");var r,o,l,i=n(s("kLXV")),d=n(s("PWDA")),c=s("MuoO"),u=a(s("q1tI")),g=(s("xpXo"),n(s("QDog")),n(s("1Pi2"))),h=s("LLXN"),f=(r=(0,c.connect)(null,null,null,{withRef:!0}),r((l=class extends u.PureComponent{constructor(e){super(e),this.fetchClusterLogInfoSingle=(()=>{var e=this.props,t=(e.dispatch,e.region),s=e.podName,n="/sse/console/sse/v2/proxy-pass/system/logs?region_name=".concat(t,"&ns=","rbd-system","&name=").concat(s,"&lines=",1e3);this.eventSources=new EventSource(n,{withCredentials:!0});var a=[];this.eventSources.onmessage=(e=>{var t=e.data;a.push(t),a.length>=10&&(this.setState(e=>({loading:!1,list:[...e.list,...a]})),a.length=0)}),this.eventSources.onerror=(e=>{console.error("SSE error:",e),this.eventSources.close()})}),this.state={list:[],loading:!0,showHighlighted:""}}componentDidMount(){this.fetchClusterLogInfoSingle()}componentWillUnmount(){this.eventSources&&this.eventSources.close()}render(){var e=this.state,t=(e.loading,e.list),s=e.showHighlighted;return u.default.createElement(i.default,{title:u.default.createElement(h.FormattedMessage,{id:"componentOverview.body.tab.log.History1000Log.title"}),visible:!0,width:1024,bodyStyle:{background:"#222222",color:"#fff"},className:g.default.logModal,onCancel:this.props.onCancel,footer:null},u.default.createElement("div",{style:{padding:"20px 0",maxHeight:500,overflowY:"auto",background:"#212121"}},t.length>0?u.default.createElement("div",{className:g.default.History1000Log},t.map((e,n)=>{return u.default.createElement("div",{key:n},u.default.createElement("span",{style:{color:s===e.substring(0,e.indexOf(":"))?"#FFFF91":"#666666"}},u.default.createElement("b",null),u.default.createElement("span",null,""===e?"":"".concat(n+1))),u.default.createElement("span",{ref:"texts",style:{color:s==e.substring(0,e.indexOf(":"))?"#FFFF91":"#FFF"}},u.default.createElement(d.default,null,e)),1===t.length?u.default.createElement("span",{style:{color:s===e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:s==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},u.default.createElement(d.default,null,e.substring(0,e.indexOf(":")))," "):t.length>1&&n>=1&&e.substring(0,e.indexOf(":"))==t[n<=0?n+1:n-1].substring(0,t[n<=0?n+1:n-1].indexOf(":"))?"":u.default.createElement("span",{style:{color:s==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==n&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==t[n<=0?n+1:n-1].substring(0,t[n<=0?n+1:n-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:s==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},u.default.createElement(d.default,null,e.substring(0,e.indexOf(":")))," "))})):u.default.createElement("p",{style:{textAlign:"center",marginBottom:0,color:"#999"}},u.default.createElement(h.FormattedMessage,{id:"componentOverview.body.tab.log.History1000Log.null"}))))}},o=l))||o);t.default=f},"1Pi2":function(e,t,s){e.exports={logStyle:"logStyle___25wV8",podCascader:"podCascader___2o1Lt",logModal:"logModal___3dS4J",History1000Log:"History1000Log___2Ptr_"}},"6Qhi":function(e,t,s){"use strict";var n=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("Znn+");var r,o,l,i=n(s("ZTPi")),d=(n(s("DPVJ")),s("MuoO")),c=s("7DNP"),u=(n(s("i8i4")),a(s("q1tI"))),g=s("LLXN"),h=n(s("XZXw")),f=n(s("yUTz")),p=(n(s("+iC2")),n(s("J5jb")),n(s("QDog"))),m=n(s("2lxJ")),b=n(s("pKpl")),v=n(s("K6oN")),y=n(s("dnMv")),E=i.default.TabPane,L=(r=(0,d.connect)(e=>{var t=e.user,s=e.list,n=e.loading,a=e.global,r=e.index;return{user:t.currentUser,list:s,loading:n.models.list,rainbondInfo:a.rainbondInfo,enterprise:a.enterprise,isRegist:a.isRegist,oauthLongin:n.effects["global/creatOauth"],certificateLongin:n.effects["global/putCertificateType"],overviewInfo:r.overviewInfo}}),r((l=class extends u.PureComponent{constructor(e){super(e),this.onChange=(e=>{var t=this.props.dispatch,s=this.state.ClustersList;this.setState({activeKey:e}),"Operation"!=e&&"login"!=e||t(c.routerRedux.push("/enterprise/".concat(p.default.getCurrEnterpriseId(),"/logs?regionName=").concat(s[0].region_name)))}),this.handleLoadEnterpriseClusters=(()=>{var e=this.props.dispatch,t=p.default.getCurrEnterpriseId();e({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:t},callback:e=>{200==e.status_code&&this.setState({ClustersList:e.list})}})}),this.state={activeKey:"consoleLog",ClustersList:[],regionActiveKey:"0",showEnterprisePlugin:!("false"===window.localStorage.getItem("showEnterprisePlugin"))},this.socket=null}componentDidMount(){this.handleLoadEnterpriseClusters();var e=this.props.location,t=new URLSearchParams(e.search),s=t.get("type"),n=t.get("region"),a=t.get("action");"consoleLog"==s?this.setState({activeKey:"consoleLog"}):"consoleLog"!==s&&n&&this.setState({activeKey:n}),a&&this.setState({regionActiveKey:a})}render(){var e=this.state,t=(e.adminer,e.activeKey),s=e.ClustersList,n=e.regionActiveKey,a=e.showEnterprisePlugin,r=p.default.getCurrEnterpriseId();return u.default.createElement(h.default,{title:(0,g.formatMessage)({id:"LogEnterprise.title"}),content:(0,g.formatMessage)({id:"LogEnterprise.desc"}),titleSvg:m.default.getPageHeaderSvg("logs",18),isContent:!0},u.default.createElement(i.default,{onChange:this.onChange,activeKey:t,destroyInactiveTabPane:!0,className:y.default.setTabs,type:"card"},u.default.createElement(E,{tab:(0,g.formatMessage)({id:"LogEnterprise.console"}),key:"consoleLog"},u.default.createElement(b.default,{type:!0})),s.map((e,t)=>{var s=e.region_alias,a=e.region_name,o=(e.url,e.region_id);return u.default.createElement(E,{tab:"".concat(s," ").concat((0,g.formatMessage)({id:"LogEnterprise.title"})),key:a,className:y.default.logInfoStyle},u.default.createElement(f.default,{region:a,regionId:o,regionAlias:s,eid:r,regionActiveKey:n}))}),a&&u.default.createElement(E,{tab:u.default.createElement("div",null,"\u64cd\u4f5c\u65e5\u5fd7"),key:"Operation"},u.default.createElement(v.default,{key:"Operation",type:"Operation",componentData:{eid:r}})),a&&u.default.createElement(E,{tab:u.default.createElement("div",null,"\u767b\u5f55\u65e5\u5fd7"),key:"login"},u.default.createElement(v.default,{key:"login",type:"login",componentData:{eid:r}}))))}},o=l))||o);t.default=L},dnMv:function(e,t,s){e.exports={logInfoStyle:"logInfoStyle___3UgtI",setTabs:"setTabs___1t27B",tabsStyle:"tabsStyle___KltxB",setFrom:"setFrom___3xm6c"}},pKpl:function(e,t,s){"use strict";var n=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("IzEo");var r=n(s("bx4M"));s("y8nQ");var o=n(s("Vl3Y"));s("+L6B");var l=n(s("2/Rp"));s("OaEy");var i,d,c,u=n(s("2fM7")),g=s("MuoO"),h=a(s("q1tI")),f=n(s("wd/R")),p=n(s("PWDA")),m=(n(s("cUW5")),s("xpXo"),n(s("lpA0"))),b=n(s("mJtp")),v=n(s("nyIC")),y=n(s("+ygn")),E=n(s("puxM")),L=n(s("1Pi2")),x=s("LLXN"),C=u.default.Option,S=(i=(0,g.connect)(),i((c=class extends h.PureComponent{constructor(e){super(e),this.fetchConsoleLogs=(()=>{var e=this.props,t=e.dispatch;e.region;t({type:"region/fetchConsoleLogs",callback:e=>{e&&this.setState({logs:e.bean||[]},()=>{this.hanleConsoTimer()})}})}),this.setLogs=(e=>{var t=this.state,s=t.filter,n=t.pod_name,a=e;a=e.filter(e=>{return""==s||-1!=e.indexOf(s)}),a=a.map(e=>{if(-1!=e.indexOf(s)){var t=e.replace(s,"\x1b[33m".concat(s,"\x1b[0m"));return t}return e}),a.length>5e3&&(a=a.slice(e.length-5e3,e.length));var r=n?{containerLog:a}:{logs:a};this.setState(r)}),this.hanleTimer=(()=>{var e=this.state.refreshValue;if(this.closeTimer(),!e)return null;var t=setTimeout(()=>{this.fetchContainerLog()},1e3*e);this.setState({time:t})}),this.hanleConsoTimer=(()=>{this.closeTimer();var e=setTimeout(()=>{this.fetchConsoleLogs()},2e3);this.setState({time:e})}),this.handleTimers=((e,t,s)=>{var n=this.state.componentTimer;if(!n)return null;this[e]=setTimeout(()=>{t()},s)}),this.closeTimer=(()=>{var e=this.state.time;e&&clearInterval(e)}),this.fetchContainerLog=(()=>{var e=this.state,t=e.pod_name,s=(e.container_name,this.props),n=s.region,a=(s.dispatch,"/console/sse/v2/proxy-pass/system/logs?region_name=".concat(n,"&ns=","rbd-system","&name=").concat(t,"&lines=",100));this.eventSourceLogs=new EventSource(a,{withCredentials:!0});var r=[];this.eventSourceLogs.onmessage=(e=>{var t=e.data;r.push(t),r.length>=10&&(this.setState(e=>({loading:!1,containerLog:[...e.containerLog,...r]})),r.length=0)}),this.eventSourceLogs.onerror=(e=>{console.error("SSE error:",e),this.eventSourceLogs.close()})}),this.handleStop=(()=>{this.setState({started:!1}),this.eventSourceLogs&&this.eventSourceLogs.close()}),this.handleStart=(()=>{this.setState({started:!0}),this.fetchContainerLog()}),this.showDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!0})}),this.hideDownHistory1000Log=(()=>{this.setState({showHistory1000Log:!1})}),this.onChangeCascader=(e=>{this.setState({pod_name:e,container_name:e[1].slice(3)},()=>{this.fetchContainerLog()})}),this.handleChange=(e=>{this.setState({refreshValue:e},()=>{this.hanleTimer()}),e||this.closeTimer()}),this.downloadLogs=(()=>{var e=Date.parse(new Date),t=(0,f.default)(e).locale("zh-cn").format("YYYY-MM-DD");(0,b.default)("".concat(v.default.baseUrl,"/console/enterprise/download/goodrain_log"),"".concat(t))});var t=this.props.instances;this.state={containerLog:[],logs:[],instances:[],started:!0,showHistory1000Log:!1,showHighlighted:"",filter:"",pod_name:t&&t.length>0&&t[0].pod_name,container_name:"",refreshValue:5}}componentDidMount(){var e=this.props.type;e?this.fetchConsoleLogs():this.fetchContainerLog()}componentDidUpdate(e,t){this.refs.box&&t.logs.length!==this.state.logs.length&&""===this.state.showHighlighted&&(this.refs.box.scrollTop=this.refs.box.scrollHeight)}componentWillUnmount(){this.closeTimer(),this.eventSourceLogs&&this.eventSourceLogs.close()}canView(){return m.default.canManageAppLog(this.props.appDetail)}render(){var e=this.state,t=e.logs,s=e.pod_name,n=e.containerLog,a=e.showHighlighted,i=e.started,d=(e.refreshValue,e.showHistory1000Log),c=(e.time,this.props),g=c.instances,f=c.type,m=(c.RbdName,c.region);return h.default.createElement(E.default,{sm:840},h.default.createElement(r.default,{style:{borderBottomLeftRadius:5,borderBottomRightRadius:5,marginTop:24},title:!f&&h.default.createElement(h.Fragment,null,i?h.default.createElement(l.default,{onClick:this.handleStop},h.default.createElement(x.FormattedMessage,{id:"componentOverview.body.tab.log.push"})):h.default.createElement(l.default,{onClick:this.handleStart},h.default.createElement(x.FormattedMessage,{id:"componentOverview.body.tab.log.startPushing"}))),extra:h.default.createElement(h.Fragment,null,f?h.default.createElement(l.default,{onClick:this.downloadLogs,icon:"download",type:"primary"},(0,x.formatMessage)({id:"LogEnterprise.download"})):h.default.createElement(h.default.Fragment,null)),bodyStyle:{borderBottomLeftRadius:5,borderBottomRightRadius:5}},h.default.createElement(o.default,{layout:"inline",name:"logFilter",style:{marginBottom:"16px",display:f?"flex":"block",justifyContent:"space-between"}},!f&&h.default.createElement(o.default.Item,{name:"container",label:(0,x.formatMessage)({id:"LogEnterprise.node"}),style:{marginRight:"10px"},className:L.default.podCascader},h.default.createElement(u.default,{defaultValue:g&&g.length>0&&g[0].pod_name,placeholder:(0,x.formatMessage)({id:"LogEnterprise.find"}),style:{width:340},onChange:this.onChangeCascader},g&&g.length>0&&g.map(e=>{var t=e.node_name,s=e.pod_name;return h.default.createElement(C,{value:s},s,"\uff08",t,"\uff09")})))),h.default.createElement("div",{className:L.default.logStyle,ref:"box"},n&&n.length>0&&n.map((e,t)=>{return h.default.createElement("div",{key:t},h.default.createElement("span",{style:{color:"#666666"}},h.default.createElement("span",null,t+1)),h.default.createElement("span",{ref:"texts",style:{width:"100%",color:"#FFF"}},h.default.createElement(p.default,null,e)))})||t&&t.length>0&&t.map((e,s)=>{return h.default.createElement("div",{key:s},h.default.createElement("span",{style:{color:a==e.substring(0,e.indexOf(":"))?f?"#FFF":"#FFFF91":"#666666"}},h.default.createElement("span",null,""==e?"":"".concat(s+1))),h.default.createElement("span",{ref:"texts",style:{color:a==e.substring(0,e.indexOf(":"))?f?"#FFF":"#FFFF91":"#FFF"}},h.default.createElement(p.default,null,e)),1==t.length?h.default.createElement("span",{style:{color:a==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:e.substring(0,e.indexOf(":"))?"#666":""},onClick:()=>{this.setState({showHighlighted:a==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},h.default.createElement(p.default,null,e.substring(0,e.indexOf(":")))):t.length>1&&s>=1&&e.substring(0,e.indexOf(":"))==t[s<=0?s+1:s-1].substring(0,t[s<=0?s+1:s-1].indexOf(":"))?"":f?"":h.default.createElement("span",{style:{color:a==e.substring(0,e.indexOf(":"))?"#FFFF91":"#bbb",cursor:"pointer",backgroundColor:0==s&&e.substring(0,e.indexOf(":"))?"#666":e.substring(0,e.indexOf(":"))==t[s<=0?s+1:s-1].substring(0,t[s<=0?s+1:s-1].indexOf(":"))?"":"#666"},onClick:()=>{this.setState({showHighlighted:a==e.substring(0,e.indexOf(":"))?"":e.substring(0,e.indexOf(":"))})}},h.default.createElement(p.default,null,e.substring(0,e.indexOf(":")))))})),d&&h.default.createElement(y.default,{onCancel:this.hideDownHistory1000Log,podName:s,region:m})))}},d=c))||d);t.default=S},yUTz:function(e,t,s){"use strict";var n=s("g09b"),a=s("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s("IzEo");var r=n(s("bx4M"));s("Znn+");var o,l,i,d=n(s("ZTPi")),c=s("MuoO"),u=(s("7DNP"),a(s("q1tI"))),g=s("LLXN"),h=n(s("puxM")),f=n(s("pKpl")),p=n(s("dnMv")),m=d.default.TabPane,b=(o=(0,c.connect)(null,null,null,{withRef:!0}),o((i=class extends u.PureComponent{constructor(e){super(e),this.fetchUpClusters=(()=>{var e=this.props,t=e.dispatch,s=e.eid,n=e.regionId;t({type:"region/fetchEnterpriseCluster",payload:{region_id:n,enterprise_id:s},callback:e=>{e&&200===e.status_code&&this.setState({wsurl:e.bean.wsurl})}})}),this.fetchInstanceInfo=(()=>{var e=this.props,t=e.dispatch,s=e.region,n=this.state.regionActiveKey;t({type:"region/fetchClusterLogInfo",payload:{region_name:s},callback:e=>{var t=[];if(e&&e.bean){var s=e.bean.list&&e.bean.list.length&&e.bean.list||[];t=[...s]}this.setState({list:t},()=>{this.callback(n)})}})}),this.callback=(e=>{var t=this.state,s=t.list,n=t.enClusterArr,a=[];s.filter(t=>{if(-1!=t.rbd_name.indexOf(n[e]))return a.push(t)}),this.setState({instances:a,regionActiveKey:e})}),this.state={ClusterArr:["".concat((0,g.formatMessage)({id:"LogEnterprise.getway"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.api"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.chaos"})),"".concat((0,g.formatMessage)({id:"LogEnterprise.worker"}))],enClusterArr:["rbd-gateway","rbd-api","rbd-chaos","rbd-worker"],list:[],instances:[],logs:[],wsurl:null,regionActiveKey:"0"}}componentDidMount(){var e=this.props.regionActiveKey,t=this.state.enClusterArr,s=t.findIndex(t=>t===e);this.setState({regionActiveKey:-1!==s?"".concat(s):"0"},()=>{this.fetchInstanceInfo(),this.fetchUpClusters()})}render(){var e=this.props,t=e.region,s=(e.tcpUrl,this.state),n=s.ClusterArr,a=s.instances,o=s.enClusterArr,l=s.wsurl;return u.default.createElement(h.default,{sm:840},u.default.createElement(r.default,{style:{padding:"24px 0px"},bodyStyle:{padding:0}},u.default.createElement(d.default,{tabPosition:"left",activeKey:this.state.regionActiveKey,onChange:this.callback,destroyInactiveTabPane:!0,className:p.default.tabsStyle},n&&n.length>0&&null!=l&&n.map((e,s)=>{return u.default.createElement(m,{tab:e,key:s},u.default.createElement(f.default,{region:t,instances:a,RbdName:o[s],tcpUrl:l,key:a&&a.length>0&&a[0].pod_name}))}))))}},l=i))||l),v=b;t.default=v}}]);