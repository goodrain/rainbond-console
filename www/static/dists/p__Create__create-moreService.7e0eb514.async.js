(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[28],{"+zy9":function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5Dmo");var s=l(a("3S7+"));a("7Kak");var i=l(a("9yH6"));a("+L6B");var r=l(a("2/Rp"));a("/xke");var d,o,u,p=l(a("TeRw")),c=a("MuoO"),h=a("7DNP"),m=n(a("q1tI")),f=l(a("exCG")),v=l(a("q76B")),_=a("xpXo"),g=l(a("QDog")),y=l(a("hMqj")),E=(d=(0,c.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}},null,null,{withRef:!0}),d((u=class extends m.PureComponent{constructor(e){super(e),this.getMultipleModulesInfo=(()=>{this.props.dispatch({type:"appControl/getMultipleModulesInfo",payload:{team_name:g.default.getCurrTeamName(),check_uuid:this.getCheck_uuid()},callback:e=>{e&&200===e.status_code&&this.setState({data:e.list})}})}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return y.default.querySpecifiedPermissionsInfo(t,e)}),this.handleBuild=(()=>{this.setState({buildState:!0});var e=this.state,t=e.JavaMavenData,a=e.is_deploy;if(t.length>0){var l=this.fetchParameter(),n=l.team_name,s=l.app_alias;this.props.dispatch({type:"appControl/createService",payload:{team_name:n,app_alias:s,service_infos:t},callback:e=>{if(e&&200===e.status_code){var t=e.bean&&e.bean.group_id,l=e.bean&&e.bean.service_ids;a?this.BuildShape(t,l):this.fetchGroups(t)}}})}else this.setState({buildState:!1}),p.default.warning({message:"\u8bf7\u9009\u62e9\u9700\u8981\u6784\u5efa\u7684\u6a21\u5757"})}),this.BuildShape=((e,t)=>{(0,_.batchOperation)({action:"deploy",team_name:g.default.getCurrTeamName(),serviceIds:t&&t.length>0&&t.join(",")}).then(()=>{this.fetchGroups(e)})}),this.fetchGroups=(e=>{var t=this.fetchParameter(),a=t.team_name,l=t.region_name,n=this.props.dispatch;n({type:"global/fetchGroups",payload:{team_name:a,region_name:l},callback:()=>{p.default.success({message:"\u6210\u529f\u521b\u5efa\u591a\u7ec4\u4ef6",duration:"3"}),this.setState({buildState:!1}),this.handleJump("apps/".concat(e))}})}),this.handleDelete=(()=>{var e=this.fetchParameter(),t=e.team_name,a=e.app_alias,l=this.props.dispatch;this.handleDeleteLoading(!0),l({type:"appControl/deleteApp",payload:{team_name:t,app_alias:a,is_force:!0},callback:()=>{this.handleDeleteLoading(!1),this.handleJump("index")}})}),this.handleDeleteLoading=(e=>{this.setState({deleteLoading:e})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.fetchParameter=(()=>{return{team_name:g.default.getCurrTeamName(),region_name:g.default.getCurrRegionName(),app_alias:this.getAppAlias()}}),this.handleJump=(e=>{var t=this.props.dispatch,a=this.fetchParameter(),l=a.team_name,n=a.region_name;t(h.routerRedux.replace("/team/".concat(l,"/region/").concat(n,"/").concat(e)))}),this.renderSuccessOnChange=(()=>{this.setState({is_deploy:!this.state.is_deploy})}),this.state={appPermissions:this.handlePermissions("queryAppInfo"),data:null,JavaMavenData:[],is_deploy:!0,deleteLoading:!1,buildState:!1}}componentDidMount(){this.getMultipleModulesInfo()}componentWillUnmount(){this.props.dispatch({type:"appControl/clearDetail"})}getCheck_uuid(){return this.props.match.params.check_uuid}getAppAlias(){return this.props.match.params.appAlias}render(){var e=this.state,t=e.data,a=e.is_deploy,l=e.buildState,n=e.showDelete,d=e.deleteLoading,o=e.appPermissions.isDelete,u=t;return u&&u.length>0&&u.map((e,t)=>{u[t].index=t}),m.default.createElement("div",null,m.default.createElement("h2",{style:{textAlign:"center"}},"JavaMaven\u591a\u6a21\u5757\u8bbe\u7f6e"),m.default.createElement("div",{style:{overflow:"hidden"}},t&&t.length>0&&m.default.createElement(f.default,{data:u,onSubmit:e=>{this.setState({JavaMavenData:e})}}),m.default.createElement("div",{style:{background:"#fff",padding:"20px",textAlign:"right",position:"fixed",bottom:0,left:0,right:0,zIndex:2,borderTop:"1px solid #e8e8e8"}},m.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"}},m.default.createElement(r.default,{style:{marginRight:8},onClick:this.handleBuild,loading:l,type:"primary"},"\u786e\u8ba4\u521b\u5efa"),m.default.createElement("div",null,m.default.createElement(s.default,{placement:"topLeft",title:m.default.createElement("p",null,"\u53d6\u6d88\u672c\u9009\u9879,\u4e0d\u6784\u5efa\u542f\u52a8\u3002")},m.default.createElement(i.default,{size:"small",onClick:this.renderSuccessOnChange,checked:a},"\u5e76\u6784\u5efa\u542f\u52a8"))),o&&m.default.createElement(r.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u521b\u5efa"))),n&&m.default.createElement(v.default,{onOk:this.handleDelete,loading:d,title:"\u653e\u5f03\u521b\u5efa",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d",desc:"\u786e\u5b9a\u8981\u653e\u5f03\u521b\u5efa\u6b64\u7ec4\u4ef6\u5417\uff1f",onCancel:()=>{this.setState({showDelete:!1})}})))}},o=u))||o);t.default=E},FRTm:function(e,t,a){e.exports={typeBtnWrap:"typeBtnWrap___1asGj",typeBtn:"typeBtn___1uRh_",active:"active___1sarO",content:"content___C0tD4",ant_radio_disabled:"ant_radio_disabled___2AquS"}},exCG:function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fOrg");var s=l(a("+KLJ"));a("g9YV");var i=l(a("wCAj")),r=l(a("jehZ"));a("+L6B");var d=l(a("2/Rp"));a("/xke");var o=l(a("TeRw"));a("y8nQ");var u=l(a("Vl3Y"));a("2qtc");var p=l(a("kLXV"));a("5NDa");var c=l(a("5rEg"));a("Znn+");var h=l(a("ZTPi"));a("7Kak");var m,f,v,_,g,y,E=l(a("9yH6")),C=n(a("q1tI")),S=a("MuoO"),b=(a("7DNP"),l(a("QDog")),l(a("n9hB")),l(a("FRTm"))),w=(E.default.Button,E.default.Group,h.default.TabPane,c.default.TextArea),x=(p.default.confirm,m=(0,S.connect)(e=>{var t=e.user;e.appControl,e.teamControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),f=u.default.create(),m(v=f((_=class extends C.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{var t=this.props.form;t.validateFields((e,t)=>{e||this.props.onSubmit&&this.props.onSubmit(t)})}),this.handleEdit=(e=>{var t="",a="";e&&e.envs&&e.envs.length>0&&e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(t=e.value),"BUILD_PROCFILE"==e.name&&(a=e.value)}),this.setState({isEdit:!0,editData:e,buildValue:t,startValue:a})}),this.handleOk=(()=>{var e=this.state,t=e.memoryList,a=e.editData,l=this.props.form,n=t;l.validateFields((e,t)=>{e||(n.map(e=>{e.id==a.id&&(e.cname=t.cname,e.envs.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(e.value=t.BUILD_MAVEN_CUSTOM_OPTS),"BUILD_PROCFILE"==e.name&&(e.value=t.PROCFILE)}))}),this.setState({memoryList:n},()=>{o.default.destroy(),o.default.success({message:"\u7f16\u8f91\u6210\u529f"}),this.handleCancel()}))})}),this.handleCancel=(()=>{this.setState({isEdit:!1,isIndex:!1})}),this.state={isShow:[!0,!0],memoryList:this.props.data,isEdit:!1,isIndex:!1,editData:!1,buildValue:"",startValue:"",activeselectedRows:[],activeselectedRowKeys:""}}render(){var e=[{title:"\u6a21\u5757\u540d\u79f0",dataIndex:"name",rowKey:"name",width:"15%"},{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"cname",rowKey:"cname",width:"15%"},{title:"\u5305\u7c7b\u578b",dataIndex:"packaging",rowKey:"packaging",width:"8%"},{title:"\u7aef\u53e3",dataIndex:"index",rowKey:"index",width:"10%",render:(e,t)=>{return C.default.createElement("span",{key:e},t.ports&&t.ports.length>0?t.ports[0].container_port:e+5e3)}},{title:"\u6784\u5efa\u53d8\u91cf\u4fe1\u606f",dataIndex:"envs",rowKey:"envs",width:"45%",render:(e,t)=>{var a="",l="",n="";return e&&e.length>0&&e.map(e=>{"BUILD_MAVEN_CUSTOM_OPTS"==e.name&&(a=e.value),"BUILD_MAVEN_CUSTOM_GOALS"==e.name&&(l=e.value),"BUILD_PROCFILE"==e.name&&(n=e.value)}),C.default.createElement("div",{key:t},C.default.createElement("div",{style:{display:"flex"}},C.default.createElement("p",{style:{width:"30%"}},"Maven\u6784\u5efa\u53c2\u6570:"),C.default.createElement("div",{style:{width:"70%"}},a)),C.default.createElement("div",{style:{display:"flex"}},C.default.createElement("p",{style:{width:"30%"}},"Maven\u6784\u5efa\u547d\u4ee4:"),C.default.createElement("div",{style:{width:"70%"}},l)),C.default.createElement("div",{style:{display:"flex"}},C.default.createElement("p",{style:{width:"30%"}},"\u542f\u52a8\u547d\u4ee4:"),C.default.createElement("div",{style:{width:"70%"}},n)))}},{title:"\u64cd\u4f5c",dataIndex:"id",rowKey:"id",width:"7%",render:(e,t)=>{return C.default.createElement(d.default,{onClick:()=>{this.handleEdit(t)}},"\u4fee\u6539")}}],t={onChange:(e,t)=>{this.props.onSubmit(t)},getCheckboxProps:e=>({disabled:e.operation,operation:e.operation})},a=this.props.form,l=a.getFieldDecorator,n=(a.getFieldValue,{labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:18},sm:{span:18}}}),s=this.state,o=s.memoryList,h=s.isEdit,m=s.editData,f=s.buildValue,v=s.startValue;return C.default.createElement("div",null,h&&C.default.createElement(p.default,{title:"\u4fee\u6539",visible:h,onOk:this.handleOk,onCancel:this.handleCancel},C.default.createElement(u.default.Item,(0,r.default)({},n,{label:"\u7ec4\u4ef6\u540d\u79f0"}),l("cname",{initialValue:m&&m.cname,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ec4\u4ef6\u547d\u4ee4"}]})(C.default.createElement(c.default,{placeholder:""}))),C.default.createElement(u.default.Item,(0,r.default)({},n,{label:"\u6784\u5efa\u547d\u4ee4"}),l("BUILD_MAVEN_CUSTOM_OPTS",{initialValue:f&&f,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6784\u5efa\u547d\u4ee4"}]})(C.default.createElement(w,{placeholder:""}))),C.default.createElement(u.default.Item,(0,r.default)({},n,{label:"\u542f\u52a8\u547d\u4ee4"}),l("PROCFILE",{initialValue:v&&v,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u542f\u52a8\u547d\u4ee4"}]})(C.default.createElement(w,{placeholder:""})))),C.default.createElement(i.default,{rowSelection:t,dataSource:o,columns:e,pagination:!1,style:{background:"#fff",marginTop:"20px"}}))}},v=_))||v)||v),D=(g=(0,S.connect)(e=>{var t=e.user;e.appControl;return{currUser:t.currentUser}},null,null,{withRef:!0}),g(y=class extends C.PureComponent{constructor(e){super(e),this.state={}}render(){var e=this.props.data;return C.default.createElement("div",null,C.default.createElement("div",{style:{overflow:"hidden"}},C.default.createElement("div",{className:b.default.content,style:{overflow:"hidden",marginBottom:90}},C.default.createElement(s.default,{message:"\u4ee5\u4e0b\u4e3a\u68c0\u6d4b\u51fa\u7684Maven\u591a\u6a21\u5757\u9879\u76ee\u7684\u6a21\u5757\u4fe1\u606f, \u8bf7\u9009\u62e9\u9700\u8981\u6784\u5efa\u7684\u6a21\u5757, \u5e76\u786e\u8ba4\u6784\u5efa\u4fe1\u606f",type:"success"}),C.default.createElement(x,{data:e,onSubmit:this.props.onSubmit}))))}})||y);t.default=D}}]);