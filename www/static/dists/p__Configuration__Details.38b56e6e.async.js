(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{"9rEN":function(e,a,t){e.exports={nameID:"nameID___3v4bh",icon:"icon___12R0A",iconm:"iconm___1aCCk",setCheckbox:"setCheckbox___326jc",over:"over___3ReWB"}},ZEeq:function(e,a,t){"use strict";var i=t("g09b"),n=t("tAuX");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,t("IzEo");var s=i(t("bx4M"));t("sRBo");var o=i(t("kaz8"));t("14J3");var r=i(t("BMrR"));t("BoS7");var l=i(t("Sdc0"));t("5NDa");var d=i(t("5rEg"));t("+L6B");var c=i(t("2/Rp"));t("/xke");var m=i(t("TeRw")),u=i(t("p0pE"));t("2qtc");var f=i(t("kLXV"));t("y8nQ");var h,p,g,_,v=i(t("Vl3Y")),C=i(t("YABy")),b=t("xpXo"),k=t("vSx2"),M=(i(t("QDog")),i(t("hMqj"))),E=t("MuoO"),y=t("7DNP"),x=n(t("q1tI")),I=t("LLXN"),N=i(t("nckk")),D=i(t("9rEN")),P=v.default.Item,w=f.default.confirm,S=(h=(0,E.connect)(e=>{var a=e.loading,t=e.teamControl,i=e.enterprise;return{AddConfigurationLoading:a.effects["global/AddConfiguration"],EditConfigurationLoading:a.effects["global/EditConfiguration"],currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:i.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}}),p=v.default.create(),h(g=p((_=class extends x.PureComponent{constructor(e){super(e),this.onChangeGroup=(e=>{this.setState({allChecked:this.state.apps.length===e.length})}),this.onOk=(e=>{e.preventDefault();var a=this.props.form,t=this.handleParameter();t.id;a.validateFields({force:!0},(e,a)=>{if(!e){void 0===a.enable&&(a.enable=!1),a.config_items&&1===a.config_items.length&&""===a.config_items[0].item_key&&(""===a.config_items[0].item_value||a.config_items[0].item_value)&&(a.config_items=[]);var t=Object.assign({},a,{deploy_type:"env"});this.handleHelpfulVisable(t)}})}),this.onCancel=(()=>{var e=this.props.dispatch,a=this.handleParameter(),t=a.regionName,i=a.teamName,n=a.appID;e(y.routerRedux.push("/team/".concat(i,"/region/").concat(t,"/apps/").concat(n,"/configgroups")))}),this.handlePermissions=(e=>{var a=this.props.currentTeamPermissionsInfo;return M.default.querySpecifiedPermissionsInfo(a,e)}),this.handleConfiguration=(e=>{var a=this.props.dispatch,t=this.state.info,i=this.handleParameter(),n=i.teamName,s=i.regionName,o=i.appID,r=i.id,l=(0,u.default)({region_name:s,team_name:n,group_id:o},e),d=e.service_ids,c=e.enable;"add"==="".concat(r)?a({type:"global/AddConfiguration",payload:(0,u.default)({},l),callback:e=>{e&&(this.handleClose(),m.default.success({message:(0,I.formatMessage)({id:"notification.success.add"})}),d&&d.length>0&&c?this.showRemind(d):this.onCancel())}}):a({type:"global/EditConfiguration",payload:(0,u.default)({name:r},l),callback:e=>{if(e){var a=[],i=[];t&&t.services&&t.services.length>0&&t.services.map(e=>{e.service_id&&a.push(e.service_id)}),(d&&d.length>0||a.length>0)&&(i=Array.from(new Set([...d,...a]))),m.default.success({message:(0,I.formatMessage)({id:"notification.success.save"})}),this.handleClose(),i.length>0?this.showRemind(i):this.onCancel()}}})}),this.showRemind=(e=>{var a=this;w({title:(0,I.formatMessage)({id:"notification.hint.confiuration.update.title"}),content:(0,I.formatMessage)({id:"notification.hint.confiuration.update.content"}),okText:(0,I.formatMessage)({id:"button.update"}),cancelText:(0,I.formatMessage)({id:"button.cancel"}),onOk(){return a.handleBatchOperation(e),new Promise((e,a)=>{setTimeout(Math.random()>.5?e:a,2e3)}).catch(()=>console.log("Oops errors!"))},onCancel(){a.onCancel()}})}),this.handleBatchOperation=(e=>{var a=this.handleParameter(),t=a.teamName;(0,b.batchOperation)({action:"upgrade",team_name:t,serviceIds:e&&e.length>0?e.join(","):""}).then(e=>{e&&this.onCancel()})}),this.loadComponents=(()=>{var e=this.props.dispatch,a=this.state.info,t=this.handleParameter(),i=t.teamName,n=t.regionName,s=t.appID,o=t.id;e({type:"application/fetchApps",payload:{team_name:i,region_name:n,group_id:s,page:1,page_size:999},callback:e=>{if(e&&200===e.status_code){if(e.list&&e.list.length>0){var t=e.list.filter(e=>"third_party"!==e.service_source);this.setState({apps:t}),a&&a.services&&a.services.length>0&&this.setState({allChecked:t.length===a.services.length})}"add"===o&&this.setState({loading:!1})}}})}),this.loadConfigurationDetails=(()=>{var e=this.props.dispatch,a=this.handleParameter(),t=a.teamName,i=a.appID,n=a.id;"add"!==n?e({type:"global/fetchConfigurationDetails",payload:{team_name:t,group_id:i,name:n},callback:e=>{e&&200===e.status_code&&this.setState({info:e.bean,loading:!1},()=>{this.loadComponents()})}}):this.loadComponents()}),this.checkConfiguration=((e,a,t)=>{if(a&&a.length>0){var i=a.filter(e=>""===e.item_key);if(""===a[0].item_key&&""===a[0].item_value)t();else if(i&&i.length>0)t((0,I.formatMessage)({id:"placeholder.contiguration.msg.not_null"}));else{var n=!1,s=!1;if(a.map(e=>{var a=e.item_key,t=e.item_value;/^[-._a-zA-Z][-._a-zA-Z0-9]*$/.test(a)||(n=!0),(a.length>65535||t.length>65535)&&(s=!0)}),n)return void t((0,I.formatMessage)({id:"placeholder.contiguration.msg.rule"}));if(s)return void t((0,I.formatMessage)({id:"placeholder.max65535"}));t()}}t()}),this.handleHelpfulVisable=(e=>{this.setState({helpfulVisable:e})}),this.handleClose=(()=>{this.setState({helpfulVisable:!1})}),this.handleParameter=(()=>{var e=this.props.match,a=e.params,t=a.teamName,i=a.regionName,n=a.appID,s=a.id;return{regionName:i,teamName:t,appID:n,id:s}}),this.handleIsAll=(()=>{var e=this.props.form.setFieldsValue,a=this.state,t=a.apps,i=a.allChecked,n=i?[]:t.map(e=>e.service_id);e({service_ids:n}),this.setState({allChecked:!i})}),this.state={apps:[],info:{},loading:!0,helpfulVisable:!1,allChecked:!1}}componentWillMount(){this.props.dispatch}componentDidMount(){this.loadConfigurationDetails()}render(){var e=this.props,a=e.form,t=e.AddConfigurationLoading,i=e.EditConfigurationLoading,n=e.currentEnterprise,m=e.currentTeam,u=e.currentRegionName,h=this.state,p=h.apps,g=h.info,_=h.loading,b=h.helpfulVisable,M=h.allChecked,E=a.getFieldDecorator,y=[];g&&g.services&&g.services.length>0&&g.services.map(e=>{y.push(e.service_id)});var w=this.handleParameter(),S=w.id,R="add"===S,A=[];return A=(0,k.createTeam)((0,k.createEnterprise)(A,n),m,u),x.default.createElement(N.default,{breadcrumbList:A},b&&x.default.createElement(f.default,{visible:!0,title:(0,I.formatMessage)({id:"appConfiguration.table.title"}),confirmLoading:t||i,onOk:()=>{this.handleConfiguration(b)},onCancel:this.handleClose},x.default.createElement("p",null,(0,I.formatMessage)({id:"appConfiguration.table.save"}))),x.default.createElement(s.default,{loading:_,style:{minHeight:"600px"},title:R?(0,I.formatMessage)({id:"appConfiguration.btn.add"}):(0,I.formatMessage)({id:"appConfiguration.btn.edit"}),extra:[x.default.createElement(c.default,{onClick:this.onCancel,style:{marginRight:"20px"}},(0,I.formatMessage)({id:"button.cancel"})),x.default.createElement(c.default,{type:"primary",onClick:this.onOk,loading:t||i},R?(0,I.formatMessage)({id:"button.confirm"}):(0,I.formatMessage)({id:"button.save"}))]},x.default.createElement(v.default,{onSubmit:this.onOk,style:{margin:"0 auto",width:"820px"}},x.default.createElement(r.default,{style:{display:"flex",alignItems:"center"}},x.default.createElement(P,{style:{width:"370px"},label:(0,I.formatMessage)({id:"appConfiguration.table.name"})},E("config_group_name",{initialValue:g&&g.config_group_name||"",rules:[{required:!0,message:(0,I.formatMessage)({id:"placeholder.contiguration.msg.config_group_name"})},{min:2,message:(0,I.formatMessage)({id:"placeholder.contiguration.msg.min2"})},{max:64,message:(0,I.formatMessage)({id:"placeholder.appShare.max64"})},{pattern:/^[a-z0-9]([-a-z0-9]*[a-z0-9])?$/,message:(0,I.formatMessage)({id:"placeholder.k8s_service_name.msg"})}]})(x.default.createElement(d.default,{style:{width:"370px"},disabled:g&&g.config_group_name,placeholder:(0,I.formatMessage)({id:"placeholder.contiguration.msg.config_group_name"})}))),x.default.createElement(v.default.Item,{style:{width:"370px",marginLeft:"24px"},label:(0,I.formatMessage)({id:"appConfiguration.table.enable"})},E("enable",{initialValue:g&&g.enable,rules:[{required:!1}]})(x.default.createElement(l.default,{defaultChecked:g&&g.enable})))),x.default.createElement(P,{label:(0,I.formatMessage)({id:"appConfiguration.table.config_items"})},E("config_items",{initialValue:g&&g.config_items||[],rules:[{required:!1,message:(0,I.formatMessage)({id:"placeholder.contiguration.msg.config_items"})},{validator:this.checkConfiguration}]})(x.default.createElement(C.default,{editInfo:g&&g.config_items||""}))),p.length>0&&x.default.createElement(P,{label:(0,I.formatMessage)({id:"appConfiguration.table.service_ids"})},x.default.createElement(o.default,{checked:M,onChange:this.handleIsAll},(0,I.formatMessage)({id:"appConfiguration.table.btn.all"})),E("service_ids",{initialValue:y,rules:[{required:!1,message:(0,I.formatMessage)({id:"placeholder.contiguration.msg.service_ids"})}]})(x.default.createElement(o.default.Group,{className:D.default.setCheckbox,onChange:this.onChangeGroup},x.default.createElement(r.default,{span:24},p.map(e=>{var a=e.service_cname,t=e.service_id;return x.default.createElement(o.default,{key:S,value:t},x.default.createElement("div",{title:a},a))}))))))))}},g=_))||g)||g);a.default=S}}]);