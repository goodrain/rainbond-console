(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[56],{cfGD:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("MXD1");var i=s(a("CFYs"));a("+L6B");var n=s(a("2/Rp"));a("/xke");var l=s(a("TeRw"));a("IzEo");var h=s(a("bx4M"));a("Mwp2");var c=s(a("VXEj"));a("Pwec");var o,d,u,p,m,f,S=s(a("CtXQ")),g=a("MuoO"),v=a("7DNP"),E=r(a("q1tI")),b=a("LLXN"),k=s(a("q76B")),y=s(a("ALo4")),_=s(a("XZXw")),I=s(a("AklW")),C=s(a("QDog")),w=s(a("rIpq")),M=s(a("+iC2")),P=a("+n12"),D=s(a("Sw8b")),N=s(a("puIC")),L=(o=(0,g.connect)(e=>{var t=e.user,a=e.loading;return{currUser:t.currentUser,loading:a}}),o((u=class extends E.default.Component{constructor(e){super(e),this.componentDidMount=(()=>{this.mount=!0,this.checkStatus()}),this.checkStatus=(()=>{var e=this.props.receiveStartShare,t=this.state.status;"not_start"===t&&e&&e(this.startShareEvent),this.handleStatus()}),this.componentWillUnmount=(()=>{this.mount=!1}),this.reStart=(()=>{this.setState({eventId:""}),this.startShareEvent()}),this.fetchParams=(()=>{var e=this.props.shareId,t=this.state.data;return{team_name:C.default.getCurrTeamName(),share_id:e,event_id:t&&t.ID}}),this.getShareStatus=(()=>{var e=this.props.dispatch,t=this.state,a=t.status,s=t.data;if("start"===a&&this.mount){var r="application/getShareStatus";s&&"plugin"===s.type&&(r="application/getPluginShareEventInShareApp"),e({type:r,payload:this.fetchParams(),callback:e=>{e&&e.bean&&this.setState({status:e.bean.event_status},()=>{this.handleSendStatus(),setTimeout(()=>{this.getShareStatus()},5e3)})}})}}),this.handleStatus=(()=>{var e=this.state.status;"start"===e?this.getShareStatus():this.handleSendStatus()}),this.handleSendStatus=(()=>{var e=this.state.status,t=this.props,a=t.onSuccess,s=t.onFail;"success"===e&&a&&a(),"failure"===e&&s&&s(this)}),this.startShareEvent=(()=>{var e=this.props,t=e.data,a=e.dispatch,s=e.onStartSuccess,r="application/startShareEvent";"plugin"===t.type&&(r="application/startPluginShareEventInShareApp"),a({type:r,payload:this.fetchParams(),callback:e=>{e&&e.bean&&this.setState({eventId:e.bean.event_id,status:e.bean.event_status},()=>{this.getShareStatus(),s&&s()})}})}),this.renderStatus=(()=>{var e=this.state.status;return"success"===e?E.default.createElement(S.default,{type:"check-circle",style:{color:"#52c41a"}}):"failure"===e?E.default.createElement(S.default,{type:"close-circle",style:{color:"red"}}):E.default.createElement(S.default,{type:"sync",className:"roundloading"})}),this.handleOpenedEventId=(e=>{this.setState({openedEventId:e})}),this.handleCancel=(()=>{this.setState({openedEventId:!1})});var t=this.props,a=t.data,s=t.currUser;this.state={data:a||{},eventId:a&&a.event_id||"",status:a&&a.event_status||"not_start",openedEventId:!1},this.mount=!1;var r=C.default.getCurrTeamName(),i=C.default.getCurrRegionName(),n=M.default.hasTeamAndRegion(s,r,i);n&&(this.socketUrl=w.default.getEventWebSocketUrl(n))}render(){var e=this.state,t=e.openedEventId,a=e.data,s=e.status,r=e.eventId,i=a||{},n=s&&"success"===s,l=!n,o=!n&&r;return E.default.createElement("div",null,E.default.createElement(c.default.Item,null,E.default.createElement(h.default,{style:{width:"100%"},hoverable:!0},E.default.createElement(c.default.Item.Meta,{title:E.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},E.default.createElement("div",null,E.default.createElement("span",{style:{marginRight:"10px"}},this.renderStatus()),"plugin"===i.type?"".concat((0,b.formatMessage)({id:"appPublish.btn.record.makert.publish.pulgin"})," ").concat(i.plugin_name):"".concat((0,b.formatMessage)({id:"appPublish.btn.record.makert.publish.component"})," ").concat(i.service_name)),E.default.createElement("div",null,o&&[E.default.createElement("a",{onClick:()=>{this.handleOpenedEventId(r)}},(0,b.formatMessage)({id:"appPublish.btn.record.makert.publish.log"}))]))}))),t&&E.default.createElement(D.default,{title:(0,b.formatMessage)({id:"appPublish.btn.record.makert.publish.log"}),width:"1000px",onOk:this.handleCancel,onCancel:this.handleCancel,showSocket:l,EventID:t,socketUrl:this.socketUrl,socket:this.props.socket}))}},d=u))||d),x=(p=(0,g.connect)(e=>{var t=e.loading;return{loading:t}}),p((f=class extends E.PureComponent{constructor(e){var t;super(e),t=this,this.receiveStartShare=(e=>{this.state.startShareCallback.push(e),this.state.isStart||(this.state.isStart=!0,e())}),this.handleStartShareSuccess=(()=>{this.state.startShareCallback.shift(),this.state.startShareCallback[0]&&this.state.startShareCallback[0]()}),this.getShareEventInfo=(()=>{this.props.dispatch({type:"application/getShareEventInfo",payload:this.getParams(),callback:e=>{e&&e.bean&&this.setState({shareEventList:e.bean.event_list||[],status:e.bean.is_compelte?"success":"checking"})}})}),this.getParams=(()=>({is_plugin:this.props.location.query.isAppPlugin,team_name:C.default.getCurrTeamName(),share_id:this.props.match.params.shareId,appID:this.props.match.params.appID})),this.handleSuccess=(()=>{this.state.successNum++;var e=this.state,t=e.successNum,a=e.shareEventList;t===a.length&&this.setState({status:"success"})}),this.handleFail=(e=>{this.fails.push(e),this.setState({status:"failure"})}),this.handleReStart=(()=>{this.fails.length&&(this.fails.forEach(e=>{e.reStart()}),this.fails=[],this.setState({status:"checking"}))}),this.handleError=(e=>{404===e.data.code?(l.default.warning({message:e.data.msg_show}),this.handJump("/publish")):I.default.handleCloudAPIError(e)}),this.handleCompleteShare=(()=>{this.setState({completeLoading:!0});var e=this.props.dispatch;e({type:"application/completeShare",payload:this.getParams(),callback:e=>{e&&e.app_market_url&&(0,P.openInNewTab)(e.app_market_url),this.handJump("/publish")},handleError:e=>{this.handleError(e)}})}),this.handleGiveUp=(()=>{var e=this.props.dispatch;e({type:"application/giveupShare",payload:this.getParams(),callback:()=>{this.hideShowDelete(),this.handJump()},handleError:e=>{this.handleError(e)}})}),this.handJump=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=t.props.dispatch,s=t.getParams();a(v.routerRedux.replace("/team/".concat(s.team_name,"/region/").concat(C.default.getCurrRegionName(),"/apps/").concat(s.appID).concat(e)))},this.GetPercent=((e,t)=>{var a=parseFloat(e),s=parseFloat(t);return t<=0?0:"".concat(Math.round(a/s*1e4)/100)}),this.renderBody=(()=>{var e=this.getParams(),t=this.state,a=t.shareEventList,s=t.status,r=t.completeLoading,l=t.successNum,h=a&&a.length||0,o=E.default.createElement("div",null,E.default.createElement(c.default,{grid:{gutter:16,column:3},bordered:!1,loading:!1,itemLayout:"horizontal",dataSource:a||[],renderItem:t=>E.default.createElement(L,{receiveStartShare:this.receiveStartShare,onStartSuccess:this.handleStartShareSuccess,onFail:this.handleFail,onSuccess:this.handleSuccess,shareId:e.share_id,data:t})})),d="",u="",p="",m=[];return"success"===s&&(d="success",u=(0,b.formatMessage)({id:"confirmModal.check.appShare.title.loading"}),p="",m=[E.default.createElement(n.default,{onClick:this.showDelete,type:"default"},(0,b.formatMessage)({id:"button.give_up_release"})),E.default.createElement(n.default,{loading:r,onClick:this.handleCompleteShare,type:"primary"},(0,b.formatMessage)({id:"button.affirm_publish"}))]),"checking"===s&&(d="ing",u=(0,b.formatMessage)({id:"confirmModal.check.appShare.title.loading"}),p=(0,b.formatMessage)({id:"confirmModal.component.check.appShare.desc"}),m=[E.default.createElement(n.default,{onClick:this.showDelete,type:"default"},(0,b.formatMessage)({id:"button.give_up_release"}))]),"failure"===s&&(d="error",p=(0,b.formatMessage)({id:"confirmModal.check.appShare.title.error"}),m=[E.default.createElement(n.default,{onClick:this.handleReStart,type:"primary"},(0,b.formatMessage)({id:"button.retry"})),E.default.createElement(n.default,{onClick:this.showDelete,type:"default"},(0,b.formatMessage)({id:"button.give_up_release"}))]),E.default.createElement(y.default,{className:N.default.lists,type:d,title:u,extra:o,actions:m,description:E.default.createElement("div",null,p,"success"!==s&&E.default.createElement(i.default,{style:{padding:"24px 40px"},percent:l===h?100:this.GetPercent(l,h),status:"failure"===s?"exception":"line"}))})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.hideShowDelete=(()=>{this.setState({showDelete:!1})}),this.state={status:"checking",shareEventList:[],successNum:0,startShareCallback:[],showDelete:!1,completeLoading:!1},this.fails=[],this.mount=!1}componentDidMount(){this.mount=!0,this.getShareEventInfo()}componentWillUnmount(){this.mount=!1}render(){var e=this.props.loading,t=this.state,a=t.shareEventList,s=t.showDelete;return a.length?E.default.createElement(_.default,null,E.default.createElement(h.default,{bordered:!1},this.renderBody()),s&&E.default.createElement(k.default,{disabled:e.effects["application/giveupShare"],onOk:this.handleGiveUp,onCancel:this.hideShowDelete,title:(0,b.formatMessage)({id:"button.give_up_release"}),desc:(0,b.formatMessage)({id:"confirmModal.component.abandon.publish.title"})})):null}},m=f))||m);t.default=x}}]);