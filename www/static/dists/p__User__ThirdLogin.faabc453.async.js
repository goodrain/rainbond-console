(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[68],{"7KHJ":function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var o=s(a("BMrR"));a("jCWc");var u=s(a("kPKH"));a("fOrg");var n=s(a("+KLJ"));a("miYZ");var i,d,l,c=s(a("tsqr")),f=s(a("p0pE")),p=s(a("aqBw")),h=a("MuoO"),m=a("7DNP"),g=r(a("q1tI")),_=s(a("8+Sn")),b=s(a("mWxT")),v=s(a("w2qy")),w=s(a("CTfg")),y=b.default.OauthParameter("code"),k=b.default.OauthParameter("service_id"),E=b.default.OauthParameter("oauth_user_id"),x=(i=(0,h.connect)(e=>{var t=e.loading,a=e.global;return{login:{},isRegist:a.isRegist,rainbondInfo:a.rainbondInfo,submitting:t.effects["user/login"]}}),i((l=class extends g.Component{constructor(){super(...arguments),this.state={user_info:null},this.handleSubmit=(e=>{e.password=p.default.encode(e.password);var t=this.props.dispatch;y&&k&&E&&t({type:"user/thirdLogin",payload:(0,f.default)({},e),callback:e=>{e&&200===e.status_code&&(_.default.set("token",e.bean.token),t({type:"user/fetchThirdBinding",payload:{service_id:k,oauth_user_id:E},callback:e=>{e&&e.status&&400===e.status?c.default.warning("\u8ba4\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1",1,()=>{t(m.routerRedux.replace("/user/login?disable_auto_login=true"))}):e&&200===e.status_code&&c.default.success("\u8ba4\u8bc1\u6210\u529f",1,()=>{var e=window.localStorage.getItem("redirect");e&&""!=e||(e="/"),e.startsWith("/")?t(m.routerRedux.push(e)):window.location.href=e,window.localStorage.setItem("redirect","")})}}))}})})}componentDidMount(){this.props.dispatch({type:"user/fetchThirdInfo",payload:{code:y,service_id:k},callback:e=>{e&&200===e.status_code&&this.setState({user_info:e.bean.user_info})}})}render(){var e=this.props,t=e.rainbondInfo,a=e.isRegist,s=this.state.user_info,r=!b.default.fetchIsFirstRegist(t),i=null;b.default.OauthbEnable(t)&&t.oauth_services&&t.oauth_services.value&&t.oauth_services.value.map(e=>{e.service_id==k&&(i=e)});var d=i&&i.name||"",l=s&&s.oauth_user_name||"",c=d&&"\u6765\u81ea".concat(d,"\u767b\u5f55\u7684"),f=e=>{return"/user/third/".concat(e,"?code=").concat(y,"&service_id=").concat(k,"&oauth_user_id=").concat(E)};return g.default.createElement("div",{className:v.default.main},g.default.createElement(n.default,{style:{margin:"24px 0"},message:"".concat(c).concat(l,"\u60a8\u597d\uff01\u4f60\u9700\u8981\u8865\u5145\u5b8c\u6574\u5e73\u53f0\u8d26\u53f7\u4fe1\u606f"),type:"info"}),g.default.createElement(o.default,{style:{marginBottom:"24px"}},g.default.createElement(u.default,{span:10,className:v.default.boxJump,style:{background:"#CDE2FF"}},!r&&g.default.createElement(m.Link,{to:f("login")},"\u5df2\u6709\u8d26\u53f7\uff0c\u9a6c\u4e0a\u7ed1\u5b9a")),a&&g.default.createElement(u.default,{span:10,className:v.default.boxJump,offset:4},g.default.createElement(m.Link,{to:f("register")},"\u672a\u6709\u8d26\u53f7\uff0c\u521b\u5efa\u8d26\u53f7"))),g.default.createElement(w.default,{onSubmit:this.handleSubmit,type:"thirdLogin"}))}},d=l))||d);t.default=x}}]);