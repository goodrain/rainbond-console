(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[51],{"6Qhi":function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Znn+");var i,r,s,o=n(a("ZTPi")),d=a("MuoO"),u=a("7DNP"),m=l(a("q1tI")),g=n(a("XZXw")),h=n(a("+iC2")),c=n(a("nD+r")),f=n(a("8oHU")),p=o.default.TabPane,v=(i=(0,d.connect)(e=>{var t=e.user,a=e.list,n=e.loading,l=e.global,i=e.index;return{user:t.currentUser,list:a,loading:n.models.list,rainbondInfo:l.rainbondInfo,enterprise:l.enterprise,isRegist:l.isRegist,oauthLongin:n.effects["global/creatOauth"],certificateLongin:n.effects["global/putCertificateType"],overviewInfo:i.overviewInfo}}),i((s=class extends m.PureComponent{constructor(e){super(e),this.onChange=(e=>{this.setState({activeKey:e})});var t=this.props.user,a=h.default.isCompanyAdmin(t);this.state={adminer:a,activeKey:"operationLog"}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(u.routerRedux.push("/"))}render(){var e=this.state,t=e.adminer,a=e.activeKey;return m.default.createElement(g.default,{title:"\u65e5\u5fd7\u7ba1\u7406",content:"\u8ddf\u8e2a\u8d26\u53f7\u64cd\u4f5c\u8bb0\u5f55\u7684\u67e5\u8be2\uff0c\u53ef\u7528\u4e8e\u5b89\u5168\u5206\u6790\u3001\u8d44\u6e90\u53d8\u66f4\u8ffd\u8e2a\u4ee5\u53ca\u5408\u89c4\u6027\u5ba1\u8ba1\u7b49\u573a\u666f\u3002"},m.default.createElement(o.default,{onChange:this.onChange,activeKey:a},m.default.createElement(p,{tab:m.default.createElement("div",null,"\u64cd\u4f5c\u65e5\u5fd7"),key:"operationLog"},m.default.createElement(f.default,this.props)),t&&m.default.createElement(p,{tab:m.default.createElement("div",null,"\u767b\u5f55\u65e5\u5fd7"),key:"loginLog"},m.default.createElement(c.default,this.props))))}},r=s))||r);t.default=v},"8oHU":function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=l(a("q1tI")),r=n(a("fhrV"));class s extends i.PureComponent{render(){var e=this.props.match.params.eid;return i.default.createElement(i.Fragment,null,i.default.createElement(r.default,{eid:e,views:"enterprise"}))}}t.default=s},dnMv:function(e,t,a){e.exports={tables:"tables___1AU5T"}},"nD+r":function(e,t,a){"use strict";var n=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("DjyN");var i=n(a("NUBc"));a("g9YV");var r=n(a("wCAj"));a("5Dmo");var s=n(a("3S7+"));a("14J3");var o=n(a("BMrR"));a("+L6B");var d=n(a("2/Rp"));a("5NDa");var u=n(a("5rEg"));a("iQDF");var m=n(a("+eQT"));a("OaEy");var g=n(a("2fM7"));a("y8nQ");var h,c,f,p,v=n(a("Vl3Y")),b=l(a("q1tI")),E=a("MuoO"),S=n(a("wd/R")),y=n(a("dnMv")),w=n(a("Nv36"));a("XDpg"),S.default.locale("zh-cn");var C=v.default.Item,L=g.default.Option,_=m.default.RangePicker,D=(u.default.Search,h=v.default.create(),c=(0,E.connect)(e=>{var t=e.user,a=e.list,n=e.loading,l=e.global,i=e.index;return{user:t.currentUser,list:a,loading:n.models.list,rainbondInfo:l.rainbondInfo,enterprise:l.enterprise,isRegist:l.isRegist,overviewInfo:i.overviewInfo}}),h(f=c((p=class extends b.PureComponent{constructor(e){super(e),this.handleSearch=(e=>{this.setState({name:e,page:1},()=>{this.loadUser()})}),this.handleChange=(e=>{this.setState({username:e,logsPage:1},()=>{this.loadLoginLog()})}),this.loadLoginLog=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid,n=this.state,l=n.logsPage,i=n.logsPageSize,r=n.username,s=n.startTime,o=n.endTime;t({type:"global/fetchLoginLogs",payload:{enterprise_id:a,page:l,page_size:i,username:r,start_time:s,end_time:o},callback:e=>{e&&200===e._code&&this.setState({loading:!1,logList:e.list,logsTotal:e.total||1})}})}),this.loadUser=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid,n=this.state,l=n.page,i=n.page_size,r=n.name;t({type:"global/fetchEnterpriseUsers",payload:{enterprise_id:a,page:l,page_size:i,name:r},callback:e=>{e&&this.setState({adminList:e.list})}})}),this.disabledDate=(e=>{return e&&((0,S.default)(new Date).subtract(1,"years")>e||e>(0,S.default)().endOf("day"))}),this.range=((e,t)=>{for(var a=[],n=e;n<t;n++)a.push(n);return a}),this.onPageChange=(e=>{this.setState({logsPage:e,loading:!0},()=>{this.loadLoginLog()})}),this.onShowSizeChange=((e,t)=>{this.setState({logsPage:e,logsPageSize:t,loading:!0},()=>{this.loadLoginLog()})}),this.handleSubmit=(()=>{var e=this.props.form;e.validateFields((e,t)=>{if(!e){var a="",n="";t.times&&t.times.length>1&&(a=(0,S.default)(t.times[0]).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"),n=(0,S.default)(t.times[1]).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"));var l=t.user_name||"";this.setState({loading:!0,logsPage:1,startTime:a,endTime:n,username:l},()=>{this.loadLoginLog()})}})}),this.handleChangeTimes=(e=>{var t="",a="";e&&e.length>1&&(t=(0,S.default)(e[0]).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"),a=(0,S.default)(e[1]).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss")),this.setState({loading:!0,logsPage:1,startTime:t,endTime:a},()=>{this.loadLoginLog()})});this.props.user;this.state={username:"",page:1,page_size:999,loading:!0,logList:[],logsPage:1,logsPageSize:10,logsTotal:1,adminList:[],startTime:"",endTime:""}}componentDidMount(){this.loadUser(),this.loadLoginLog()}render(){var e=this.props.form.getFieldDecorator,t=this.state,a=t.loading,n=t.adminList,l=t.logList,u=t.logsPage,m=t.logsPageSize,h=t.logsTotal,c={labelCol:{xs:{span:0},sm:{span:0}},wrapperCol:{xs:{span:24},sm:{span:24}}};return b.default.createElement(b.Fragment,null,b.default.createElement(v.default,{onSubmit:this.handleSubmit},b.default.createElement(o.default,{type:"flex",align:"middle"},b.default.createElement(C,c,e("user_name",{rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u7528\u6237"}]})(b.default.createElement(g.default,{showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u7528\u6237",style:{width:"178px",marginRight:"20px"},defaultActiveFirstOption:!1,filterOption:!1,notFoundContent:null,onSearch:this.handleSearch,onChange:this.handleChange},b.default.createElement(L,{key:0,value:""},"\u6240\u6709\u7528\u6237"),n&&n.length>0&&n.map(e=>{var t=e.nick_name,a=e.real_name,n=e.user_id;return b.default.createElement(L,{key:n,value:t},a)})))),b.default.createElement(C,c,e("times",{initialValue:""})(b.default.createElement(_,{locale:w.default,separator:"\u81f3",style:{width:"400px",marginRight:"20px"},disabledDate:this.disabledDate,onChange:e=>{this.handleChangeTimes(e)},showTime:{hideDisabledOptions:!0,defaultValue:[(0,S.default)("00:00:00","HH:mm:ss"),(0,S.default)("23:59:59","HH:mm:ss")]},format:"YYYY-MM-DD HH:mm:ss"}))),b.default.createElement(d.default,{onClick:this.handleSubmit,type:"primary",htmlType:"submit",style:{marginBottom:"24px"}},"\u67e5\u8be2"))),b.default.createElement(r.default,{loading:a,size:"middle",className:y.default.tables,pagination:!1,dataSource:l||[],columns:[{title:"\u7528\u6237",align:"center",dataIndex:"real_name",width:130,render:(e,t)=>{return b.default.createElement(s.default,{placement:"top",title:b.default.createElement("div",null,b.default.createElement("div",null,"\u8d26\u6237\uff1a",t.username),b.default.createElement("div",null,"\u90ae\u7bb1\uff1a",t.email))},e)}},{title:"\u5ba2\u6237\u7aef IP",align:"center",width:130,dataIndex:"client_ip",render:e=>{return b.default.createElement("div",null,e||"-")}},{title:"\u767b\u5f55\u65f6\u95f4",dataIndex:"login_time",rowKey:"login_time",align:"center",width:180,render:e=>{return b.default.createElement("span",null,(0,S.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u767b\u5f55\u8bbe\u5907",dataIndex:"user_agent",render:e=>{return b.default.createElement("div",null,e||"-")}},{title:"\u6d3b\u8dc3\u65f6\u957f",dataIndex:"duration",rowKey:"duration",align:"center",width:140,render:e=>{if(!e)return"-";var t=S.default.duration(e,"seconds"),a=Math.floor(t.asHours()),n=Math.floor(t.asMinutes())-60*a,l=e-60*a*60-60*n;return b.default.createElement("span",null,a?"".concat(a,"\u5c0f\u65f6"):"",n?"".concat(n,"\u5206\u949f"):"",l?"".concat(l,"\u79d2"):"")}}]}),b.default.createElement(i.default,{style:{margin:"20px 0",float:"right"},size:"default",current:u,pageSize:m,showSizeChanger:!0,total:Number(h),defaultCurrent:1,onChange:this.onPageChange,pageSizeOptions:["5","10","20","50"],onShowSizeChange:this.onShowSizeChange}))}},f=p))||f)||f);t.default=D}}]);