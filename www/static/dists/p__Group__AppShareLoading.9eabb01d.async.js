(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[56],{cfGD:function(t,e,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("MXD1");var n=s(a("CFYs"));a("+L6B");var i=s(a("2/Rp"));a("/xke");var l=s(a("TeRw"));a("IzEo");var h=s(a("bx4M"));a("Mwp2");var c=s(a("VXEj"));a("Pwec");var u,d,o,p,m,S,f=s(a("CtXQ")),v=a("MuoO"),g=a("7DNP"),E=r(a("q1tI")),k=s(a("q76B")),y=s(a("ALo4")),b=s(a("XZXw")),I=s(a("AklW")),C=s(a("QDog")),w=s(a("rIpq")),_=s(a("+iC2")),D=a("+n12"),P=s(a("Sw8b")),N=s(a("puIC")),x=(u=(0,v.connect)(t=>{var e=t.user,a=t.loading;return{currUser:e.currentUser,loading:a}}),u((o=class extends E.default.Component{constructor(t){super(t),this.componentDidMount=(()=>{this.mount=!0,this.checkStatus()}),this.checkStatus=(()=>{var t=this.props.receiveStartShare,e=this.state.status;"not_start"===e&&t&&t(this.startShareEvent),this.handleStatus()}),this.componentWillUnmount=(()=>{this.mount=!1}),this.reStart=(()=>{this.setState({eventId:""}),this.startShareEvent()}),this.fetchParams=(()=>{var t=this.props.shareId,e=this.state.data;return{team_name:C.default.getCurrTeamName(),share_id:t,event_id:e&&e.ID}}),this.getShareStatus=(()=>{var t=this.props.dispatch,e=this.state,a=e.status,s=e.data;if("start"===a&&this.mount){var r="application/getShareStatus";s&&"plugin"===s.type&&(r="application/getPluginShareEventInShareApp"),t({type:r,payload:this.fetchParams(),callback:t=>{t&&t.bean&&this.setState({status:t.bean.event_status},()=>{this.handleSendStatus(),setTimeout(()=>{this.getShareStatus()},5e3)})}})}}),this.handleStatus=(()=>{var t=this.state.status;"start"===t?this.getShareStatus():this.handleSendStatus()}),this.handleSendStatus=(()=>{var t=this.state.status,e=this.props,a=e.onSuccess,s=e.onFail;"success"===t&&a&&a(),"failure"===t&&s&&s(this)}),this.startShareEvent=(()=>{var t=this.props,e=t.data,a=t.dispatch,s=t.onStartSuccess,r="application/startShareEvent";"plugin"===e.type&&(r="application/startPluginShareEventInShareApp"),a({type:r,payload:this.fetchParams(),callback:t=>{t&&t.bean&&this.setState({eventId:t.bean.event_id,status:t.bean.event_status},()=>{this.getShareStatus(),s&&s()})}})}),this.renderStatus=(()=>{var t=this.state.status;return"success"===t?E.default.createElement(f.default,{type:"check-circle",style:{color:"#52c41a"}}):"failure"===t?E.default.createElement(f.default,{type:"close-circle",style:{color:"red"}}):E.default.createElement(f.default,{type:"sync",className:"roundloading"})}),this.handleOpenedEventId=(t=>{this.setState({openedEventId:t})}),this.handleCancel=(()=>{this.setState({openedEventId:!1})});var e=this.props,a=e.data,s=e.currUser;this.state={data:a||{},eventId:a&&a.event_id||"",status:a&&a.event_status||"not_start",openedEventId:!1},this.mount=!1;var r=C.default.getCurrTeamName(),n=C.default.getCurrRegionName(),i=_.default.hasTeamAndRegion(s,r,n);i&&(this.socketUrl=w.default.getEventWebSocketUrl(i))}render(){var t=this.state,e=t.openedEventId,a=t.data,s=t.status,r=t.eventId,n=a||{},i=s&&"success"===s,l=!i,u=!i&&r;return E.default.createElement("div",null,E.default.createElement(c.default.Item,null,E.default.createElement(h.default,{style:{width:"100%"},hoverable:!0},E.default.createElement(c.default.Item.Meta,{title:E.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},E.default.createElement("div",null,E.default.createElement("span",{style:{marginRight:"10px"}},this.renderStatus()),"plugin"===n.type?"\u63d2\u4ef6: ".concat(n.plugin_name):"\u7ec4\u4ef6: ".concat(n.service_name)),E.default.createElement("div",null,u&&[E.default.createElement("a",{onClick:()=>{this.handleOpenedEventId(r)}},"\u65e5\u5fd7")]))}))),e&&E.default.createElement(P.default,{title:"\u65e5\u5fd7",width:"1000px",onOk:this.handleCancel,onCancel:this.handleCancel,showSocket:l,EventID:e,socketUrl:this.socketUrl,socket:this.props.socket}))}},d=o))||d),L=(p=(0,v.connect)(t=>{var e=t.loading;return{loading:e}}),p((S=class extends E.PureComponent{constructor(t){var e;super(t),e=this,this.receiveStartShare=(t=>{this.state.startShareCallback.push(t),this.state.isStart||(this.state.isStart=!0,t())}),this.handleStartShareSuccess=(()=>{this.state.startShareCallback.shift(),this.state.startShareCallback[0]&&this.state.startShareCallback[0]()}),this.getShareEventInfo=(()=>{this.props.dispatch({type:"application/getShareEventInfo",payload:this.getParams(),callback:t=>{t&&t.bean&&this.setState({shareEventList:t.bean.event_list||[],status:t.bean.is_compelte?"success":"checking"})}})}),this.getParams=(()=>({is_plugin:this.props.location.query.isAppPlugin,team_name:C.default.getCurrTeamName(),share_id:this.props.match.params.shareId,appID:this.props.match.params.appID})),this.handleSuccess=(()=>{this.state.successNum++;var t=this.state,e=t.successNum,a=t.shareEventList;e===a.length&&this.setState({status:"success"})}),this.handleFail=(t=>{this.fails.push(t),this.setState({status:"failure"})}),this.handleReStart=(()=>{this.fails.length&&(this.fails.forEach(t=>{t.reStart()}),this.fails=[],this.setState({status:"checking"}))}),this.handleError=(t=>{404===t.data.code?(l.default.warning({message:t.data.msg_show}),this.handJump("/publish")):I.default.handleCloudAPIError(t)}),this.handleCompleteShare=(()=>{this.setState({completeLoading:!0});var t=this.props.dispatch;t({type:"application/completeShare",payload:this.getParams(),callback:t=>{t&&t.app_market_url&&(0,D.openInNewTab)(t.app_market_url),this.handJump("/publish")},handleError:t=>{this.handleError(t)}})}),this.handleGiveUp=(()=>{var t=this.props.dispatch;t({type:"application/giveupShare",payload:this.getParams(),callback:()=>{this.hideShowDelete(),this.handJump()},handleError:t=>{this.handleError(t)}})}),this.handJump=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=e.props.dispatch,s=e.getParams();a(g.routerRedux.replace("/team/".concat(s.team_name,"/region/").concat(C.default.getCurrRegionName(),"/apps/").concat(s.appID).concat(t)))},this.GetPercent=((t,e)=>{var a=parseFloat(t),s=parseFloat(e);return e<=0?0:"".concat(Math.round(a/s*1e4)/100)}),this.renderBody=(()=>{var t=this.getParams(),e=this.state,a=e.shareEventList,s=e.status,r=e.completeLoading,l=e.successNum,h=a&&a.length||0,u=E.default.createElement("div",null,E.default.createElement(c.default,{grid:{gutter:16,column:3},bordered:!1,loading:!1,itemLayout:"horizontal",dataSource:a||[],renderItem:e=>E.default.createElement(x,{receiveStartShare:this.receiveStartShare,onStartSuccess:this.handleStartShareSuccess,onFail:this.handleFail,onSuccess:this.handleSuccess,shareId:t.share_id,data:e})})),d="",o="",p="",m=[];return"success"===s&&(d="success",o="\u5e94\u7528\u540c\u6b65\u6210\u529f",p="",m=[E.default.createElement(i.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03"),E.default.createElement(i.default,{loading:r,onClick:this.handleCompleteShare,type:"primary"},"\u786e\u8ba4\u53d1\u5e03")]),"checking"===s&&(d="ing",o="\u5e94\u7528\u540c\u6b65\u4e2d",p="\u6b64\u8fc7\u7a0b\u53ef\u80fd\u6bd4\u8f83\u8017\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",m=[E.default.createElement(i.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),"failure"===s&&(d="error",p="\u8bf7\u67e5\u770b\u4ee5\u4e0b\u65e5\u5fd7\u786e\u8ba4\u95ee\u9898\u540e\u91cd\u8bd5",m=[E.default.createElement(i.default,{onClick:this.handleReStart,type:"primary"},"\u91cd\u8bd5"),E.default.createElement(i.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),E.default.createElement(y.default,{className:N.default.lists,type:d,title:o,extra:u,actions:m,description:E.default.createElement("div",null,p,"success"!==s&&E.default.createElement(n.default,{style:{padding:"24px 40px"},percent:l===h?100:this.GetPercent(l,h),status:"failure"===s?"exception":"line"}))})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.hideShowDelete=(()=>{this.setState({showDelete:!1})}),this.state={status:"checking",shareEventList:[],successNum:0,startShareCallback:[],showDelete:!1,completeLoading:!1},this.fails=[],this.mount=!1}componentDidMount(){this.mount=!0,this.getShareEventInfo()}componentWillUnmount(){this.mount=!1}render(){var t=this.props.loading,e=this.state,a=e.shareEventList,s=e.showDelete;return a.length?E.default.createElement(b.default,null,E.default.createElement(h.default,{bordered:!1},this.renderBody()),s&&E.default.createElement(k.default,{disabled:t.effects["application/giveupShare"],onOk:this.handleGiveUp,onCancel:this.hideShowDelete,title:"\u653e\u5f03\u53d1\u5e03",desc:"\u786e\u5b9a\u8981\u653e\u5f03\u6b64\u6b21\u53d1\u5e03\u5417?"})):null}},m=S))||m);e.default=L}}]);