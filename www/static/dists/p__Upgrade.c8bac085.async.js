(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[84],{NkCp:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("IzEo");var n=r(a("bx4M"));a("+L6B");var i=r(a("2/Rp"));a("y8nQ");var o,d,p,c,u=r(a("Vl3Y")),m=r(a("e6Ls")),g=a("MuoO"),h=l(a("q1tI")),f=a("xpXo"),_=r(a("4W9V")),v=r(a("VZuE")),b=(o=(0,g.connect)(),d=u.default.create(),o(p=d((c=class extends h.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordDetails=(()=>{var e=this.props,t=e.team_name,a=e.group_id,r=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordDetails)({team_name:t,group_id:a,record_id:r.ID,noModels:!0}).then(e=>{var t=e.bean||{};this.setState({list:t.service_record||[],textState:t.status,recordLoading:!1},()=>{4===t.status&&setTimeout(()=>{this.fetchRollsBackRecordDetails()},3e3)})}).catch(e=>{(0,_.default)(e)})}),this.handleRetry=(()=>{var e=this.props,t=e.form,a=e.dispatch,r=e.team_name,l=e.group_id,s=e.info,n=this.state.upgradeLoading;t.validateFields(e=>{e||n||this.setState({upgradeLoading:!0},()=>{a({type:"global/fetchAppRedeploy",payload:{team_name:r,group_id:l,record_id:s.ID},callback:e=>{e&&200===e.status_code&&this.setState({upgradeLoading:!1},()=>{this.fetchRollsBackRecordDetails()})},handleError:e=>{(0,_.default)(e),this.fetchRollsBackRecordDetails()}})})})}),this.state={list:[],textState:"",upgradeLoading:!1,recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordDetails()}render(){var e=this.props,t=e.onCancel,a=e.loading,r=void 0!==a&&a,l=this.state,o=l.recordLoading,d=l.list,p=l.textState,c=l.upgradeLoading,u={width:d&&1===d.length?"100%":"50%",textAlign:"center"},g=[7,10].includes(p);return h.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u8be6\u60c5",width:1e3,confirmLoading:r,className:m.default.TelescopicModal,onCancel:t,footer:[h.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},h.default.createElement(n.default,{title:"\u7ec4\u4ef6\u5217\u8868",loading:o,extra:h.default.createElement(i.default,{type:"primary",loading:c,onClick:g?this.handleRetry:t},g?"\u91cd\u8bd5":v.default.getStatusCNS(p))},d&&d.length>0&&d.map(e=>{var t=e.ID,a=e.status,r=e.service_cname;return h.default.createElement(n.default.Grid,{key:t,style:u},r," \u72b6\u6001\uff1a",h.default.createElement("span",{style:{color:v.default.getStatusColor(a)}},v.default.getStatusCNS(a)))})))}},p=c))||p)||p);t.default=b},T40H:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV")),n=r(a("jehZ"));a("g9YV");var i=r(a("wCAj"));a("Mwp2");var o=r(a("VXEj"));a("T2oS");var d=r(a("W9HT"));a("+L6B");var p=r(a("2/Rp"));a("+BJd");var c=r(a("mr32"));a("5Dmo");var u=r(a("3S7+")),m=r(a("p0pE"));a("y8nQ");var g=r(a("Vl3Y"));a("Znn+");var h,f,_,v,b=r(a("ZTPi")),k=r(a("x9lC")),E=a("MuoO"),y=a("7DNP"),L=r(a("wd/R")),C=l(a("q1tI")),R=a("LLXN"),I=r(a("iPMB")),M=r(a("XZXw")),w=a("xpXo"),U=a("vSx2"),A=r(a("4W9V")),D=r(a("QDog")),x=r(a("9Qkj")),S=r(a("Utb7")),N=r(a("2lxJ")),P=r(a("NkCp")),z=r(a("ZBNA")),T=r(a("VZuE")),V=b.default.TabPane,B=(h=g.default.create(),f=(0,E.connect)(e=>{var t=e.user,a=e.global,r=e.application,l=e.teamControl,s=e.enterprise;return{groupDetail:r.groupDetail||{},currUser:t.pageUser,groups:a.groups||[],currentTeam:l.currentTeam,currentRegionName:l.currentRegionName,currentEnterprise:s.currentEnterprise,currentTeamPermissionsInfo:l.currentTeamPermissionsInfo}}),h(_=f((v=class extends C.PureComponent{constructor(e){super(e),this.getHelmvs=((e,t)=>{var a=this.props.dispatch,r=e.source.substr(e.source.indexOf(":")+1);a({type:"createApp/getHelmVersion",payload:{repo_name:r,chart_name:e.app_model_name||1,highest:!0,team_name:D.default.getCurrTeamName(),app_id:D.default.getAppID()},callback:e=>{if(e&&e.bean){var a=(0,m.default)({},e.bean.chart_information),r={};r[t]=a.Version,this.setState({versionArr:(0,m.default)({},this.state.versionArr,r)})}}})}),this.compareVersion=((e,t)=>{if(!e||!t)return!1;e=e.split("."),t=t.split(".");var a=Math.max(e.length,t.length);while(e.length<a)e.push("0");while(t.length<a)t.push("0");for(var r=0;r<a;r++){var l=parseInt(e[r]),s=parseInt(t[r]);if(l>s)return!0;if(l<s)return!1}}),this.onUpgrade=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,w.getAppModelLastRecord)({appID:r,team_name:a,upgrade_group_id:e.upgrade_group_id}).then(t=>{var a=t.bean&&t.bean.status;if(a){if([6,10].includes(a))return void this.setState({isDeploymentFailure:10===a,isPartiallyCompleted:6===a,showLastUpgradeRecord:!0,upgradeItem:e});if([3,8].includes(a))return void this.createNewRecord(e);this.openInfoPage(t.bean)}else this.createNewRecord(e)})}),this.getApplication=(()=>{var e=this.props.dispatch;e({type:"global/application",payload:{team_name:D.default.getCurrTeamName(),group_id:this.getGroupId()},callback:e=>{e&&200===e.status_code&&this.setState({dataList:e.list||[]},()=>{var e=this.state,t=e.dataList;e.versionArr;t.map((e,t)=>{if(e.source.includes("helm"))this.getHelmvs(e,t);else{var a={};a[t]="",this.setState({versionArr:(0,m.default)({},this.state.versionArr,a)})}})}),this.handleCancelLoading()}})}),this.getParameter=(()=>{var e=this.props.match.params,t=e.teamName,a=e.regionName,r=e.appID;return{team_name:t,region_name:a,group_id:r}}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.getUpgradeRecordsList=(()=>{var e=this.state,t=e.page,a=e.pageSize,r=this.getParameter(),l=r.team_name,s=r.group_id;this.props.dispatch({type:"global/CloudAppUpdateRecordsList",payload:{team_name:l,group_id:s,page:t,pageSize:a,status__gt:1},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list||[],total:e.bean&&e.bean.total}),this.handleCancelLoading()}})}),this.getVersionChangeShow=(e=>{return e.market_name?C.default.createElement("div",null,(0,R.formatMessage)({id:"helmAppInstall.Upgrade.store"}),e.market_name,(0,R.formatMessage)({id:"helmAppInstall.Upgrade.from"}),C.default.createElement("span",{className:S.default.versions},e.old_version),(0,R.formatMessage)({id:"helmAppInstall.Upgrade.to"}),C.default.createElement("span",{className:S.default.versions},e.version)):C.default.createElement("div",null,(0,R.formatMessage)({id:"helmAppInstall.Upgrade.form_version"}),C.default.createElement("span",{className:S.default.versions},e.old_version),(0,R.formatMessage)({id:"helmAppInstall.Upgrade.to"}),C.default.createElement("span",{className:S.default.versions},e.version))}),this.fetchAppLastUpgradeRecord=(()=>{var e=this.getParameter(),t=e.team_name,a=e.group_id;(0,w.getAppModelLastRecord)({team_name:t,appID:a,noModels:!0}).then(e=>{var t=e.bean;t&&"{}"!==JSON.stringify(t)&&this.setState({lastRecord:t,showLastUpgradeRecord:[2].includes(t.status)})}).catch(e=>{(0,A.default)(e)})}),this.fetchAppLastRollbackRecord=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,w.getAppModelLastRecord)({team_name:a,appID:r,record_type:"rollback",noModels:!0}).then(t=>{var a=t.bean;if(a&&"{}"!==JSON.stringify(a)){var r=[4].includes(a.status);r?this.setState({lastRecord:a,showLastRollbackRecord:r}):this.onUpgrade(e)}else this.onUpgrade(e)}).catch(e=>{(0,A.default)(e)})}),this.getUpgradeRecordsHelmList=(()=>{var e=this.state,t=e.page,a=e.pageSize;this.props.dispatch({type:"global/fetchUpgradeRecordsHelmList",payload:{team_name:D.default.getCurrTeamName(),group_id:this.getGroupId(),page:t,pageSize:a},callback:e=>{this.handleLoading(),e&&200===e.status_code&&this.setState({list:e.list||[]}),this.handleCancelLoading()}})}),this.handleLoading=(()=>{this.setState({loadingList:!1,recordLoading:!1,upgradeLoading:!1})}),this.createNewRecord=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id;(0,w.postUpgradeRecord)({team_name:a,appID:r,upgrade_group_id:e.upgrade_group_id,noModels:!0}).then(e=>{this.openInfoPage(e.bean)}).catch(e=>{(0,A.default)(e)})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:this.getParameter(),callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1},()=>{e.bean&&e.bean.app_type&&"helm"===e.bean.app_type?this.handleTabs("2"):this.getApplication()})},handleError:t=>{t&&404===t.code&&e(y.routerRedux.push("/team/".concat(D.default.getCurrTeamName(),"/region/").concat(D.default.getCurrRegionName(),"/index")))}})}),this.openInfoPage=(e=>{var t=this.getParameter(),a=t.team_name,r=t.group_id,l=this.props.dispatch;l(y.routerRedux.push("/team/".concat(a,"/region/").concat(D.default.getCurrRegionName(),"/apps/").concat(r,"/upgrade/").concat(e.upgrade_group_id,"/record/").concat(e.ID,"?app_id=").concat(e.group_key)))}),this.showMarketAppDetail=(e=>{this.setState({showApp:e,showMarketAppDetail:!0})}),this.showRollback=(e=>{this.setState({showRollbackConfirm:e,rollbackRecord:e})}),this.showRollbackList=(e=>{this.setState({rollbackRecords:e})}),this.showRollbackDetails=(e=>{this.setState({rollbackRecordDetails:e})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.handleTabs=(e=>{var t=this.state.appDetail;this.setState({upgradeLoading:!0,recordLoading:!0,activeKey:e},()=>{"helm"===t.app_type?this.getUpgradeRecordsHelmList():"2"===e?this.getUpgradeRecordsList():this.getApplication()})}),this.handleTableChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.getUpgradeRecordsList()})}),this.rollbackUpgrade=(()=>{this.handleBackUpgradeLoading(!0);var e=this.state.rollbackRecord,t=this.getParameter(),a=t.team_name,r=t.group_id;(0,w.rollbackUpgrade)({team_name:a,appID:r,record_id:e.ID}).then(e=>{this.handleBackUpgradeLoading(!1),this.showRollback(!1),this.showRollbackDetails(e&&e.bean)}).catch(e=>{this.handleBackUpgradeLoading(!1),(0,A.default)(e)})}),this.handleBackUpgradeLoading=(e=>{this.setState({backUpgradeLoading:e})}),this.showComponentVersion=(e=>{this.setState({isComponent:e})}),this.handleCancelComponent=(()=>{this.setState({isComponent:!1})}),this.handleCancelLoading=(()=>{this.setState({loadingList:!1,upgradeLoading:!1,recordLoading:!1})}),this.jump=((e,t,a)=>{var r=this.props.dispatch,l=t.source.substr(t.source.indexOf(":")+1),s={app_store_name:l,app_model_id:t.app_model_id,app_template_name:t.app_model_name,version:t.current_version};window.sessionStorage.setItem("appinfo",JSON.stringify(s)),window.sessionStorage.setItem("updataInfo",JSON.stringify(t)),r(y.routerRedux.push("/team/".concat(D.default.getCurrTeamName(),"/region/").concat(D.default.getCurrRegionName(),"/apps/").concat(D.default.getAppID(),"/helminstall?type=").concat(e,"&upgrade=").concat(a)))}),this.state={loadingDetail:!0,loadingList:!0,isDeploymentFailure:!1,isPartiallyCompleted:!1,upgradeLoading:!0,recordLoading:!0,isComponent:!1,showApp:{},showMarketAppDetail:!1,list:[],activeKey:"1",page:1,pageSize:10,total:0,dataList:[],appDetail:{},backUpgradeLoading:!1,showLastUpgradeRecord:!1,showLastRollbackRecord:!1,rollbackRecords:!1,rollbackRecordDetails:!1,versionArr:{},upgradePermission:x.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_upgrade","app_".concat(D.default.getAppID()))}}componentDidMount(){this.fetchAppDetail(),this.getApplication(),this.fetchAppLastUpgradeRecord()}render(){var e=this.props,t=e.currentEnterprise,r=e.currentTeam,l=e.currentRegionName,m=this.state,g=m.loadingList,h=m.recordLoading,f=m.upgradeLoading,_=m.list,v=m.showMarketAppDetail,E=m.showApp,w=(m.activeKey,m.page),A=m.total,B=m.pageSize,O=m.dataList,H=m.appDetail,X=m.isComponent,j=m.loadingDetail,Y=m.lastRecord,q=m.showLastUpgradeRecord,F=m.showLastRollbackRecord,Z=m.upgradeItem,G=m.isDeploymentFailure,K=m.isPartiallyCompleted,J=m.showRollbackConfirm,Q=m.rollbackRecords,W=m.rollbackRecordDetails,$=m.backUpgradeLoading,ee=(m.upgradePermission,m.upgradePermission),te=ee.isAppModelList,ae=ee.isUpgradeRecord,re=ee.isUpgrade,le=ee.isRollback;if(!te&&!ae)return x.default.noPermission();var se={onChange:this.handleTableChange,pageSize:B,total:A,page:w},ne=e=>{var t=e.data,a=t.upgrade_versions,r=t.current_version;return C.default.createElement("div",{className:S.default.listContent},C.default.createElement("div",{className:S.default.listContentItem},C.default.createElement(u.default,{title:(0,R.formatMessage)({id:"appUpgrade.current_version.tooltip"})},C.default.createElement("span",null,(0,R.formatMessage)({id:"appUpgrade.current_version"}))),C.default.createElement("p",null,C.default.createElement(c.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},r))),C.default.createElement("div",{className:S.default.listContentItem},C.default.createElement(u.default,{title:(0,R.formatMessage)({id:"appUpgrade.Upgradable_version.tooltip"})},C.default.createElement("span",null,(0,R.formatMessage)({id:"appUpgrade.Upgradable_version"}))),C.default.createElement("p",null,a&&a.length>0?a.map(e=>{return C.default.createElement(c.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small",key:e},e)}):(0,R.formatMessage)({id:"helmAppInstall.Upgrade.no"}))))},ie=e=>{var t=e.data,a=e.index;return C.default.createElement("div",{className:S.default.listContent},C.default.createElement("div",{className:S.default.listContentItem},C.default.createElement(u.default,{title:(0,R.formatMessage)({id:"appUpgrade.current_version.tooltip"})},C.default.createElement("span",null,(0,R.formatMessage)({id:"appUpgrade.current_version"}))),C.default.createElement("p",null,C.default.createElement(c.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},t.current_version))),C.default.createElement("div",{className:S.default.listContentItem},C.default.createElement(u.default,{title:(0,R.formatMessage)({id:"appUpgrade.Upgradable_version.tooltip"})},C.default.createElement("span",null,(0,R.formatMessage)({id:"appUpgrade.Upgradable_version"}))),C.default.createElement("p",null,this.state.versionArr&&Object.keys(this.state.versionArr).length>0&&t.current_version&&this.compareVersion(this.state.versionArr[a],t.current_version)?C.default.createElement(c.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},this.state.versionArr[a]):(0,R.formatMessage)({id:"helmAppInstall.Upgrade.no"}))))},oe=[{title:(0,R.formatMessage)({id:"appUpgrade.table.createTime"}),dataIndex:"create_time",key:"1",width:"20%",render:e=>C.default.createElement("span",null,(0,L.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,R.formatMessage)({id:"appUpgrade.table.app"}),dataIndex:"group_name",key:"2",width:"20%",render:e=>C.default.createElement("span",null,e)},{title:(0,R.formatMessage)({id:"appUpgrade.table.versions"}),dataIndex:"version",key:"3",width:"30%",render:(e,t)=>this.getVersionChangeShow(t)},{title:(0,R.formatMessage)({id:"appUpgrade.table.status"}),dataIndex:"status",key:"4",width:"15%",render:e=>C.default.createElement("span",null,T.default.getStatusText(e))},{title:(0,R.formatMessage)({id:"appUpgrade.table.operate"}),dataIndex:"tenant_id",key:"5",width:"15%",render:(e,t)=>t.can_rollback&&C.default.createElement("div",null,le&&C.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollback(t)}},(0,R.formatMessage)({id:"appUpgrade.table.operate.roll_back"})),C.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollbackList(t)}},(0,R.formatMessage)({id:"appUpgrade.table.operate.roll_back_record"})))}],de=[{title:(0,R.formatMessage)({id:"appUpgrade.table.createTime"}),dataIndex:"updated",key:"1",render:e=>C.default.createElement("span",null,(0,L.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,R.formatMessage)({id:"appUpgrade.table.chart"}),dataIndex:"chart",key:"2",render:e=>C.default.createElement("span",null,e)},{title:(0,R.formatMessage)({id:"appUpgrade.table.versions"}),dataIndex:"app_version",key:"3",render:e=>C.default.createElement("span",null,e)},{title:(0,R.formatMessage)({id:"appUpgrade.table.status"}),dataIndex:"status",key:"4",render:e=>C.default.createElement("span",null,T.default.getHelmStatus(e))}],pe=[];pe=(0,U.createApp)((0,U.createTeam)((0,U.createEnterprise)(pe,t),r,l),r,l,{appName:H.group_name,appID:H.group_id});var ce=H&&H.app_type&&"helm"===H.app_type,ue="upgrade",me="install";return C.default.createElement(M.default,{breadcrumbList:pe,loading:j,title:(0,R.formatMessage)({id:"appUpgrade.title"}),content:(0,R.formatMessage)({id:"appUpgrade.desc"}),titleSvg:N.default.getPageHeaderSvg("upgrade",18),extraContent:C.default.createElement(p.default,{onClick:()=>{var e=this.props.dispatch;e(y.routerRedux.push("/team/".concat(D.default.getCurrTeamName(),"/region/").concat(D.default.getCurrRegionName(),"/apps/").concat(D.default.getAppID(),"/overview")))},icon:"home"},(0,R.formatMessage)({id:"menu.app.dashboard"}))},C.default.createElement("div",{style:j?{}:{borderRadius:5,overflow:"hidden"}},j?C.default.createElement(d.default,null):C.default.createElement(b.default,{defaultActiveKey:"1",onChange:this.handleTabs,className:S.default.tabss},te&&C.default.createElement(V,{tab:(0,R.formatMessage)({id:"appUpgrade.tabs.list"}),key:"1"},C.default.createElement("div",{className:S.default.cardList},C.default.createElement(o.default,{rowKey:"id",size:"large",loading:g,dataSource:[...O],renderItem:(e,t)=>C.default.createElement(o.default.Item,{actions:-1!=e.source.indexOf("helm")?re?[C.default.createElement("a",{style:{display:this.state.versionArr&&Object.keys(this.state.versionArr).length>0&&e.current_version&&this.compareVersion(this.state.versionArr[t],e.current_version)?"block":"none"},onClick:a=>{a.preventDefault(),this.jump(ue,e,this.state.versionArr[t])}},(0,R.formatMessage)({id:"appUpgrade.btn.upgrade"})),C.default.createElement("a",{onClick:()=>{this.jump(me,e)}},(0,R.formatMessage)({id:"helmAppInstall.Upgrade.reinstall"}))]:[C.default.createElement("a",{onClick:()=>{this.jump(me,e)}},(0,R.formatMessage)({id:"helmAppInstall.Upgrade.reinstall"}))]:re?[C.default.createElement("a",{onClick:t=>{t.preventDefault(),this.fetchAppLastRollbackRecord(e)}},(0,R.formatMessage)({id:"appUpgrade.btn.upgrade"})),C.default.createElement("a",{onClick:()=>{this.showComponentVersion(e)}},(0,R.formatMessage)({id:"appUpgrade.btn.addon"}))]:[C.default.createElement("a",{onClick:()=>{this.showComponentVersion(e)}},(0,R.formatMessage)({id:"appUpgrade.btn.addon"}))]},C.default.createElement(o.default.Item.Meta,{avatar:C.default.createElement("getApplication",{src:e.pic||a("Vkwn"),shape:"square",size:"large"}),title:C.default.createElement("a",{onClick:()=>{this.showMarketAppDetail(e)}},e.group_name),description:e.describe}),e.source.includes("helm")?C.default.createElement(ie,{data:e,index:t}):C.default.createElement(ne,{data:e}))}))),ae&&C.default.createElement(V,{tab:(0,R.formatMessage)({id:"appUpgrade.tabs.record"}),key:"2"},C.default.createElement(i.default,{style:{padding:"24px"},rowKey:(e,t)=>t,loading:h||f,columns:ce?de:oe,dataSource:_,pagination:A>B&&se})))),X&&C.default.createElement(k.default,(0,n.default)({onCancel:this.handleCancelComponent,data:X,ok:this.getApplication},this.getParameter())),v&&C.default.createElement(I.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:E}),q&&(Y||Z)&&C.default.createElement(s.default,{visible:!0,title:(0,R.formatMessage)({id:"helmAppInstall.Upgrade.updat_info"}),onCancel:()=>{this.setState({showLastUpgradeRecord:!1}),Z&&this.createNewRecord(Z)},okText:(0,R.formatMessage)({id:"helmAppInstall.Upgrade.Continue"}),cancelText:Z?(0,R.formatMessage)({id:"helmAppInstall.Upgrade.new"}):(0,R.formatMessage)({id:"helmAppInstall.Upgrade.cancel"}),onOk:()=>{this.openInfoPage(Y||Z)}},C.default.createElement("span",null,(0,R.formatMessage)({id:"helmAppInstall.Upgrade.model"}),C.default.createElement("span",{style:{color:"4d73b1"}},Y&&Y.group_name||Z&&Z.group_name),K?(0,R.formatMessage)({id:"helmAppInstall.Upgrade.again"}):G?(0,R.formatMessage)({id:"helmAppInstall.Upgrade.failure"}):(0,R.formatMessage)({id:"helmAppInstall.Upgrade.unfinished"}))),F&&C.default.createElement(s.default,{visible:!0,title:(0,R.formatMessage)({id:"helmAppInstall.Upgrade.back_info"}),onCancel:()=>{this.setState({showLastRollbackRecord:!1})},footer:[C.default.createElement(p.default,{style:{marginTop:"20px"},onClick:()=>{this.setState({showLastRollbackRecord:!1})}},(0,R.formatMessage)({id:"helmAppInstall.Upgrade.down"}))]},C.default.createElement("span",null,(0,R.formatMessage)({id:"helmAppInstall.Upgrade.model"}),C.default.createElement("span",{style:{color:"4d73b1"}},Y&&Y.group_name),(0,R.formatMessage)({id:"helmAppInstall.Upgrade.unfinished"}))),Q&&C.default.createElement(z.default,(0,n.default)({},this.getParameter(),{info:Q,showRollbackDetails:e=>{this.showRollbackDetails(e)},onCancel:()=>{this.showRollbackList(!1)}})),W&&C.default.createElement(P.default,(0,n.default)({},this.getParameter(),{info:W,onCancel:()=>{this.showRollbackDetails(!1)}})),J&&C.default.createElement(s.default,{visible:!0,confirmLoading:$,title:(0,R.formatMessage)({id:"helmAppInstall.Upgrade.Rollback_confirm"}),onCancel:()=>{this.showRollback(!1)},onOk:()=>{this.rollbackUpgrade()}},C.default.createElement("span",{style:{color:"red"}},(0,R.formatMessage)({id:"helmAppInstall.Upgrade.rollback_confirm"})),C.default.createElement("span",{style:{display:"block",marginTop:"16px"}},(0,R.formatMessage)({id:"helmAppInstall.Upgrade.not_add"}))))}},_=v))||_)||_);t.default=B},Utb7:function(e,t,a){e.exports={nameID:"nameID___MNSNW",icon:"icon___2AsL9",iconm:"iconm___qqaow",customBtn:"customBtn___SyQT6",versions:"versions___1Z8uj",cardList:"cardList___Yf-MH",card:"card___3ovxG",item:"item___1Ils1",tabss:"tabss___uEiMM",textzt:"textzt___3pFoJ",zsldis:"zsldis___1GahJ",zslbor:"zslbor___2ZXVM",zsllbor:"zsllbor___3pSS2",extraImg:"extraImg___2CzFB",newButton:"newButton___2YSwX",cardAvatar:"cardAvatar___1xUfe",cardDescription:"cardDescription___2vI9s",pageHeaderContent:"pageHeaderContent___1B8bR",contentLink:"contentLink___1LQb0",zslcheck:"zslcheck___115pt",zslIcon:"zslIcon___3tP6k",zslGroup:"zslGroup___ahs1r",zslMt:"zslMt___3-U0F",active:"active___17Zw6",zslcen:"zslcen___2982Y",zslborl:"zslborl___XdlyT",zslborr:"zslborr___10Zhw",zslh:"zslh___3CELq",listContent:"listContent___3FKvX",listContentItem:"listContentItem___3GH5D",standardList:"standardList___lVj3g",headerInfo:"headerInfo___2zfaG",extraContentSearch:"extraContentSearch___bx9rK",listCard:"listCard___IhqPy",standardListForm:"standardListForm___2itqX",formResult:"formResult___1LmUn"}},ZBNA:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("g9YV");var n=r(a("wCAj"));a("+L6B");var i=r(a("2/Rp"));a("y8nQ");var o,d,p,c,u=r(a("Vl3Y")),m=r(a("e6Ls")),g=a("MuoO"),h=l(a("q1tI")),f=a("xpXo"),_=r(a("4W9V")),v=r(a("Utb7")),b=r(a("VZuE")),k=(o=(0,g.connect)(),d=u.default.create(),o(p=d((c=class extends h.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordList=(()=>{var e=this.props,t=e.team_name,a=e.group_id,r=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordList)({team_name:t,group_id:a,record_id:r.ID,noModels:!0}).then(e=>{this.setState({list:e.list||[],recordLoading:!1})}).catch(e=>{(0,_.default)(e)})}),this.state={list:[],recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordList()}render(){var e=this.props,t=e.onCancel,a=e.loading,r=void 0!==a&&a,l=e.showRollbackDetails,o=this.state,d=o.recordLoading,p=o.list,c=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:200,render:e=>h.default.createElement("span",null,e)},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>h.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>h.default.createElement("div",null,"\u56de\u6eda\u5230",h.default.createElement("span",{className:v.default.versions},t.version))},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>h.default.createElement("span",null,b.default.getStatusText(e))},{title:"\u8be6\u60c5",dataIndex:"ID",key:"45",render:(e,t)=>h.default.createElement("a",{onClick:()=>{l(t)}},"\u8be6\u60c5")}];return h.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u8bb0\u5f55",width:1e3,confirmLoading:r,className:m.default.TelescopicModal,onCancel:t,footer:[h.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},h.default.createElement(n.default,{loading:d,rowKey:(e,t)=>t,columns:c,dataSource:p,pagination:!1}))}},p=c))||p)||p);t.default=k},x9lC:function(e,t,a){"use strict";var r=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=r(a("kLXV"));a("g9YV");var n=r(a("wCAj"));a("+L6B");var i=r(a("2/Rp"));a("5Dmo");var o=r(a("3S7+"));a("/xke");var d=r(a("TeRw"));a("y8nQ");var p=r(a("Vl3Y"));a("OaEy");var c,u,m,g,h=r(a("2fM7")),f=a("MuoO"),_=a("LLXN"),v=a("7DNP"),b=l(a("q1tI")),k=r(a("4W9V")),E=r(a("e6Ls")),y=h.default.Option,L=p.default.Item,C=(c=p.default.create(),u=(0,f.connect)(),c(m=u((g=class extends b.PureComponent{constructor(e){super(e),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,r=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&r&&r(t)})}),this.fetchComponentVersion=(()=>{var e=this.props,t=e.dispatch,a=e.form,r=e.data,l=void 0===r?{}:r,s=e.team_name,n=e.group_id;a.setFieldsValue;t({type:"application/fetchComponentVersion",payload:{team_name:s,app_model_key:l.group_key,upgrade_group_id:l.upgrade_group_id,group_id:n},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list}),this.handleCancel()},handleError:e=>{this.handleError(e)}})}),this.handleDeploy=(e=>{var t=this.props,a=t.team_name,r=t.dispatch,l=t.ok,s=this.props.form,n=e.service_alias;s.validateFields(["".concat(n)],(e,t)=>{e||(this.setState({loading:!0}),r({type:"appControl/putUpgrade",payload:{team_name:a,app_alias:n,group_version:t[n]},callback:e=>{e&&200===e.status_code&&(this.fetchComponentVersion(),l&&l(),d.default.success({message:(0,_.formatMessage)({id:"notification.success.upgrade_successfully"})}))},handleError:e=>{this.handleError(e)}}))})}),this.handleError=(e=>{(0,k.default)(e),this.handleCancel()}),this.handleCancel=(()=>{this.setState({loading:!1})}),this.state={loading:!0,list:[]}}componentDidMount(){this.fetchComponentVersion()}render(){var e=this.props,t=e.title,a=e.onCancel,r=e.form,l=(e.data,e.team_name),d=e.region_name,c=this.state,u=c.list,m=c.loading,g=r.getFieldDecorator,f=[{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"service_cname",key:"service_cname",width:180,render:(e,t)=>{return b.default.createElement(v.Link,{to:"/team/".concat(l,"/region/").concat(d,"/components/").concat(t.service_alias,"/overview")},e)}},{title:"\u5f53\u524d\u7248\u672c",dataIndex:"current_version",key:"current_version",width:180,render:e=>{return b.default.createElement(o.default,{title:e},b.default.createElement("div",{className:E.default.over},e))}},{title:"\u53ef\u5347\u7ea7\u7248\u672c",dataIndex:"upgradable_versions",key:"upgradable_versions",render:(e,t)=>{var a=e&&e.length>0&&e[0];return b.default.createElement(p.default,null,b.default.createElement(L,{style:{margin:0}},g("".concat(t.service_alias),{initialValue:a||"\u65e0",rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(b.default.createElement(h.default,{disabled:!a,onChange:this.handleChange},e.map(e=>{return b.default.createElement(y,{key:e,value:e},e)})))))}},{title:"\u64cd\u4f5c",dataIndex:"component_id",rowKey:"component_id",align:"center",width:150,render:(e,t)=>{return t.upgradable_versions&&t.upgradable_versions.length>0?b.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{this.handleDeploy(t)}},"\u5347\u7ea7"):b.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.45)"}},"\u65e0\u53ef\u5347\u7ea7\u7684\u7248\u672c")}}];return b.default.createElement(s.default,{title:t||"\u7ec4\u4ef6\u5217\u8868",visible:!0,width:800,confirmLoading:m,className:E.default.TelescopicModal,onCancel:a,onOk:this.onOk,footer:[b.default.createElement(i.default,{style:{marginTop:"20px"},onClick:a},"\u5173\u95ed")]},b.default.createElement(n.default,{rowKey:(e,t)=>t,dataSource:u,columns:f,loading:m,pagination:!1}))}},m=g))||m)||m);t.default=C}}]);