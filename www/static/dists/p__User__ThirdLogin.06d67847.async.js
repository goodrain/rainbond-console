(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[73],{"7KHJ":function(e,t,a){"use strict";var r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var n=r(a("BMrR"));a("jCWc");var o=r(a("kPKH"));a("fOrg");var u=r(a("+KLJ"));a("miYZ");var s,i,l=r(a("tsqr")),c=r(a("p0pE")),d=a("MuoO"),f=a("7DNP"),p=_(a("q1tI")),h=r(a("8+Sn")),m=r(a("mWxT")),g=r(a("w2qy")),b=r(a("CTfg"));function v(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(v=function(e){return e?a:t})(e)}function _(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=v(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var u=n?Object.getOwnPropertyDescriptor(e,o):null;u&&(u.get||u.set)?Object.defineProperty(r,o,u):r[o]=e[o]}return r.default=e,a&&a.set(e,r),r}var y=m.default.OauthParameter("code"),w=m.default.OauthParameter("service_id"),O=m.default.OauthParameter("oauth_user_id"),k=(s=(0,d.connect)(e=>{var t=e.loading,a=e.global;return{login:{},isRegist:a.isRegist,rainbondInfo:a.rainbondInfo,submitting:t.effects["user/login"]}}),s(i=class extends p.Component{constructor(){super(...arguments),this.state={user_info:null},this.handleSubmit=(e=>{var t=this.props.dispatch;y&&w&&O&&t({type:"user/thirdLogin",payload:(0,c.default)({},e),callback:e=>{e&&200===e.status_code&&(h.default.set("token",e.bean.token),t({type:"user/fetchThirdBinding",payload:{service_id:w,oauth_user_id:O},callback:e=>{e&&e.status&&400===e.status?l.default.warning("\u8ba4\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1",1,()=>{t(f.routerRedux.replace("/user/login?disable_auto_login=true"))}):e&&200===e.status_code&&l.default.success("\u8ba4\u8bc1\u6210\u529f",1,()=>{var e=window.localStorage.getItem("redirect");e&&""!=e||(e="/"),e.startsWith("/")?t(f.routerRedux.push(e)):window.location.href=e,window.localStorage.setItem("redirect","")})}}))}})})}componentDidMount(){this.props.dispatch({type:"user/fetchThirdInfo",payload:{code:y,service_id:w},callback:e=>{e&&200===e.status_code&&this.setState({user_info:e.bean.user_info})}})}render(){var e=this.props,t=e.rainbondInfo,a=e.isRegist,r=this.state.user_info,s=!m.default.fetchIsFirstRegist(t),i=null;m.default.OauthbEnable(t)&&t.oauth_services&&t.oauth_services.value&&t.oauth_services.value.map(e=>{e.service_id==w&&(i=e)});var l=i&&i.name||"",c=r&&r.oauth_user_name||"",d=l&&"\u6765\u81ea".concat(l,"\u767b\u5f55\u7684"),h=e=>{return"/user/third/".concat(e,"?code=").concat(y,"&service_id=").concat(w,"&oauth_user_id=").concat(O)};return p.default.createElement("div",{className:g.default.main},p.default.createElement(u.default,{style:{margin:"24px 0"},message:"".concat(d).concat(c,"\u60a8\u597d\uff01\u4f60\u9700\u8981\u8865\u5145\u5b8c\u6574\u5e73\u53f0\u8d26\u53f7\u4fe1\u606f"),type:"info"}),p.default.createElement(n.default,{style:{marginBottom:"24px"}},p.default.createElement(o.default,{span:10,className:g.default.boxJump,style:{background:"#CDE2FF"}},!s&&p.default.createElement(f.Link,{to:h("login")},"\u5df2\u6709\u8d26\u53f7\uff0c\u9a6c\u4e0a\u7ed1\u5b9a")),a&&p.default.createElement(o.default,{span:10,className:g.default.boxJump,offset:4},p.default.createElement(f.Link,{to:h("register")},"\u672a\u6709\u8d26\u53f7\uff0c\u521b\u5efa\u8d26\u53f7"))),p.default.createElement(b.default,{onSubmit:this.handleSubmit,type:"thirdLogin"}))}})||i);t.default=k}}]);