(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[51],{cfGD:function(t,e,a){"use strict";var s=a("g09b");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("MXD1");var r=s(a("CFYs"));a("+L6B");var n=s(a("2/Rp"));a("/xke");var i=s(a("TeRw"));a("IzEo");var l=s(a("bx4M"));a("Mwp2");var h=s(a("VXEj"));a("Pwec");var c,u,d,o,p=s(a("CtXQ")),f=a("MuoO"),m=a("7DNP"),S=P(a("q1tI")),v=s(a("q76B")),g=s(a("ALo4")),E=s(a("XZXw")),y=s(a("AklW")),k=s(a("QDog")),b=s(a("rIpq")),w=s(a("+iC2")),I=a("+n12"),C=s(a("Sw8b")),_=s(a("puIC"));function D(t){if("function"!==typeof WeakMap)return null;var e=new WeakMap,a=new WeakMap;return(D=function(t){return t?a:e})(t)}function P(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var a=D(e);if(a&&a.has(t))return a.get(t);var s={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var i=r?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(s,n,i):s[n]=t[n]}return s.default=t,a&&a.set(t,s),s}var O=(c=(0,f.connect)(t=>{var e=t.user,a=t.loading;return{currUser:e.currentUser,loading:a}}),c(u=class extends S.default.Component{constructor(t){super(t),this.componentDidMount=(()=>{this.mount=!0,this.checkStatus()}),this.checkStatus=(()=>{var t=this.props.receiveStartShare,e=this.state.status;"not_start"===e&&t&&t(this.startShareEvent),this.handleStatus()}),this.componentWillUnmount=(()=>{this.mount=!1}),this.reStart=(()=>{this.setState({eventId:""}),this.startShareEvent()}),this.fetchParams=(()=>{var t=this.props.shareId,e=this.state.data;return{team_name:k.default.getCurrTeamName(),share_id:t,event_id:e&&e.ID}}),this.getShareStatus=(()=>{var t=this.props.dispatch,e=this.state,a=e.status,s=e.data;if("start"===a&&this.mount){var r="application/getShareStatus";s&&"plugin"===s.type&&(r="application/getPluginShareEventInShareApp"),t({type:r,payload:this.fetchParams(),callback:t=>{t&&t.bean&&this.setState({status:t.bean.event_status},()=>{this.handleSendStatus(),setTimeout(()=>{this.getShareStatus()},5e3)})}})}}),this.handleStatus=(()=>{var t=this.state.status;"start"===t?this.getShareStatus():this.handleSendStatus()}),this.handleSendStatus=(()=>{var t=this.state.status,e=this.props,a=e.onSuccess,s=e.onFail;"success"===t&&a&&a(),"failure"===t&&s&&s(this)}),this.startShareEvent=(()=>{var t=this.props,e=t.data,a=t.dispatch,s=t.onStartSuccess,r="application/startShareEvent";"plugin"===e.type&&(r="application/startPluginShareEventInShareApp"),a({type:r,payload:this.fetchParams(),callback:t=>{t&&t.bean&&this.setState({eventId:t.bean.event_id,status:t.bean.event_status},()=>{this.getShareStatus(),s&&s()})}})}),this.renderStatus=(()=>{var t=this.state.status;return"success"===t?S.default.createElement(p.default,{type:"check-circle",style:{color:"#52c41a"}}):"failure"===t?S.default.createElement(p.default,{type:"close-circle",style:{color:"red"}}):S.default.createElement(p.default,{type:"sync",className:"roundloading"})}),this.handleOpenedEventId=(t=>{this.setState({openedEventId:t})}),this.handleCancel=(()=>{this.setState({openedEventId:!1})});var e=this.props,a=e.data,s=e.currUser;this.state={data:a||{},eventId:a&&a.event_id||"",status:a&&a.event_status||"not_start",openedEventId:!1},this.mount=!1;var r=k.default.getCurrTeamName(),n=k.default.getCurrRegionName(),i=w.default.hasTeamAndRegion(s,r,n);i&&(this.socketUrl=b.default.getEventWebSocketUrl(i))}render(){var t=this.state,e=t.openedEventId,a=t.data,s=t.status,r=t.eventId,n=a||{},i=s&&"success"===s,c=!i,u=!i&&r;return S.default.createElement("div",null,S.default.createElement(h.default.Item,null,S.default.createElement(l.default,{style:{width:"100%"},hoverable:!0},S.default.createElement(h.default.Item.Meta,{title:S.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},S.default.createElement("div",null,S.default.createElement("span",{style:{marginRight:"10px"}},this.renderStatus()),"plugin"===n.type?"\u63d2\u4ef6: ".concat(n.plugin_name):"\u7ec4\u4ef6: ".concat(n.service_name)),S.default.createElement("div",null,u&&[S.default.createElement("a",{onClick:()=>{this.handleOpenedEventId(r)}},"\u65e5\u5fd7")]))}))),e&&S.default.createElement(C.default,{title:"\u65e5\u5fd7",width:"1000px",onOk:this.handleCancel,onCancel:this.handleCancel,showSocket:c,EventID:e,socketUrl:this.socketUrl,socket:this.props.socket}))}})||u),M=(d=(0,f.connect)(t=>{var e=t.loading;return{loading:e}}),d(o=class extends S.PureComponent{constructor(t){var e;super(t),e=this,this.receiveStartShare=(t=>{this.state.startShareCallback.push(t),this.state.isStart||(this.state.isStart=!0,t())}),this.handleStartShareSuccess=(()=>{this.state.startShareCallback.shift(),this.state.startShareCallback[0]&&this.state.startShareCallback[0]()}),this.getShareEventInfo=(()=>{this.props.dispatch({type:"application/getShareEventInfo",payload:this.getParams(),callback:t=>{t&&t.bean&&this.setState({shareEventList:t.bean.event_list||[],status:t.bean.is_compelte?"success":"checking"})}})}),this.getParams=(()=>({is_plugin:this.props.location.query.isAppPlugin,team_name:k.default.getCurrTeamName(),share_id:this.props.match.params.shareId,appID:this.props.match.params.appID})),this.handleSuccess=(()=>{this.state.successNum++;var t=this.state,e=t.successNum,a=t.shareEventList;e===a.length&&this.setState({status:"success"})}),this.handleFail=(t=>{this.fails.push(t),this.setState({status:"failure"})}),this.handleReStart=(()=>{this.fails.length&&(this.fails.forEach(t=>{t.reStart()}),this.fails=[],this.setState({status:"checking"}))}),this.handleError=(t=>{404===t.data.code?(i.default.warning({message:t.data.msg_show}),this.handJump("/publish")):y.default.handleCloudAPIError(t)}),this.handleCompleteShare=(()=>{this.setState({completeLoading:!0});var t=this.props.dispatch;t({type:"application/completeShare",payload:this.getParams(),callback:t=>{t&&t.app_market_url&&(0,I.openInNewTab)(t.app_market_url),this.handJump("/publish")},handleError:t=>{this.handleError(t)}})}),this.handleGiveUp=(()=>{var t=this.props.dispatch;t({type:"application/giveupShare",payload:this.getParams(),callback:()=>{this.hideShowDelete(),this.handJump()},handleError:t=>{this.handleError(t)}})}),this.handJump=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=e.props.dispatch,s=e.getParams();a(m.routerRedux.replace("/team/".concat(s.team_name,"/region/").concat(k.default.getCurrRegionName(),"/apps/").concat(s.appID).concat(t)))},this.GetPercent=((t,e)=>{var a=parseFloat(t),s=parseFloat(e);return e<=0?0:"".concat(Math.round(a/s*1e4)/100)}),this.renderBody=(()=>{var t=this.getParams(),e=this.state,a=e.shareEventList,s=e.status,i=e.completeLoading,l=e.successNum,c=a&&a.length||0,u=S.default.createElement("div",null,S.default.createElement(h.default,{grid:{gutter:16,column:3},bordered:!1,loading:!1,itemLayout:"horizontal",dataSource:a||[],renderItem:e=>S.default.createElement(O,{receiveStartShare:this.receiveStartShare,onStartSuccess:this.handleStartShareSuccess,onFail:this.handleFail,onSuccess:this.handleSuccess,shareId:t.share_id,data:e})})),d="",o="",p="",f=[];return"success"===s&&(d="success",o="\u5e94\u7528\u540c\u6b65\u6210\u529f",p="",f=[S.default.createElement(n.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03"),S.default.createElement(n.default,{loading:i,onClick:this.handleCompleteShare,type:"primary"},"\u786e\u8ba4\u53d1\u5e03")]),"checking"===s&&(d="ing",o="\u5e94\u7528\u540c\u6b65\u4e2d",p="\u6b64\u8fc7\u7a0b\u53ef\u80fd\u6bd4\u8f83\u8017\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",f=[S.default.createElement(n.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),"failure"===s&&(d="error",p="\u8bf7\u67e5\u770b\u4ee5\u4e0b\u65e5\u5fd7\u786e\u8ba4\u95ee\u9898\u540e\u91cd\u8bd5",f=[S.default.createElement(n.default,{onClick:this.handleReStart,type:"primary"},"\u91cd\u8bd5"),S.default.createElement(n.default,{onClick:this.showDelete,type:"default"},"\u653e\u5f03\u53d1\u5e03")]),S.default.createElement(g.default,{className:_.default.lists,type:d,title:o,extra:u,actions:f,description:S.default.createElement("div",null,p,"success"!==s&&S.default.createElement(r.default,{style:{padding:"24px 40px"},percent:l===c?100:this.GetPercent(l,c),status:"failure"===s?"exception":"line"}))})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.hideShowDelete=(()=>{this.setState({showDelete:!1})}),this.state={status:"checking",shareEventList:[],successNum:0,startShareCallback:[],showDelete:!1,completeLoading:!1},this.fails=[],this.mount=!1}componentDidMount(){this.mount=!0,this.getShareEventInfo()}componentWillUnmount(){this.mount=!1}render(){var t=this.props.loading,e=this.state,a=e.shareEventList,s=e.showDelete;return a.length?S.default.createElement(E.default,null,S.default.createElement(l.default,{bordered:!1},this.renderBody()),s&&S.default.createElement(v.default,{disabled:t.effects["application/giveupShare"],onOk:this.handleGiveUp,onCancel:this.hideShowDelete,title:"\u653e\u5f03\u53d1\u5e03",desc:"\u786e\u5b9a\u8981\u653e\u5f03\u6b64\u6b21\u53d1\u5e03\u5417?"})):null}})||o);e.default=M}}]);