(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{"9rEN":function(e,t,a){e.exports={nameID:"nameID___3v4bh",icon:"icon___12R0A",iconm:"iconm___1aCCk",setCheckbox:"setCheckbox___326jc",over:"over___3ReWB"}},ZEeq:function(e,t,a){"use strict";var i=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var s=i(a("bx4M"));a("5Dmo");var l=i(a("3S7+"));a("sRBo");var r=i(a("kaz8"));a("14J3");var o=i(a("BMrR"));a("BoS7");var d=i(a("Sdc0"));a("5NDa");var c=i(a("5rEg"));a("+L6B");var h=i(a("2/Rp"));a("/xke");var u=i(a("TeRw")),m=i(a("p0pE"));a("2qtc");var p=i(a("kLXV"));a("y8nQ");var f,g,v,_,C=i(a("Vl3Y")),b=i(a("YABy")),k=a("xpXo"),E=a("vSx2"),y=i(a("QDog")),x=i(a("hMqj")),I=a("MuoO"),P=a("7DNP"),N=n(a("q1tI")),D=i(a("nckk")),w=i(a("9rEN")),S=C.default.Item,A=p.default.confirm,R=(f=(0,I.connect)(e=>{var t=e.loading,a=e.teamControl,i=e.enterprise;return{AddConfigurationLoading:t.effects["global/AddConfiguration"],EditConfigurationLoading:t.effects["global/EditConfiguration"],currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:i.currentEnterprise,currentTeamPermissionsInfo:a.currentTeamPermissionsInfo}}),g=C.default.create(),f(v=g((_=class extends N.PureComponent{constructor(e){super(e),this.onChangeGroup=(e=>{this.setState({allChecked:this.state.apps.length===e.length})}),this.onOk=(e=>{e.preventDefault();var t=this.props.form,a=this.handleParameter();a.id;t.validateFields({force:!0},(e,t)=>{if(!e){void 0===t.enable&&(t.enable=!1),t.config_items&&1===t.config_items.length&&""===t.config_items[0].item_key&&(""===t.config_items[0].item_value||t.config_items[0].item_value)&&(t.config_items=[]);var a=Object.assign({},t,{deploy_type:"env"});this.handleHelpfulVisable(a)}})}),this.onCancel=(()=>{var e=this.props.dispatch,t=this.handleParameter(),a=t.regionName,i=t.teamName,n=t.appID;e(P.routerRedux.push("/team/".concat(i,"/region/").concat(a,"/apps/").concat(n,"/configgroups")))}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return x.default.querySpecifiedPermissionsInfo(t,e)}),this.handleConfiguration=(e=>{var t=this.props.dispatch,a=this.state.info,i=this.handleParameter(),n=i.teamName,s=i.regionName,l=i.appID,r=i.id,o=(0,m.default)({region_name:s,team_name:n,group_id:l},e),d=e.service_ids,c=e.enable;"add"==="".concat(r)?t({type:"global/AddConfiguration",payload:(0,m.default)({},o),callback:e=>{e&&(this.handleClose(),u.default.success({message:"\u6dfb\u52a0\u6210\u529f"}),d&&d.length>0&&c?this.showRemind(d):this.onCancel())}}):t({type:"global/EditConfiguration",payload:(0,m.default)({name:r},o),callback:e=>{if(e){var t=[],i=[];a&&a.services&&a.services.length>0&&a.services.map(e=>{e.service_id&&t.push(e.service_id)}),(d&&d.length>0||t.length>0)&&(i=Array.from(new Set([...d,...t]))),u.default.success({message:"\u4fdd\u5b58\u6210\u529f"}),this.handleClose(),i.length>0?this.showRemind(i):this.onCancel()}}})}),this.showRemind=(e=>{var t=this;A({title:"\u9700\u66f4\u65b0\u7ec4\u4ef6\u7acb\u5373\u751f\u6548",content:"\u662f\u5426\u7acb\u5373\u66f4\u65b0\u7ec4\u4ef6",okText:"\u66f4\u65b0",cancelText:"\u53d6\u6d88",onOk(){return t.handleBatchOperation(e),new Promise((e,t)=>{setTimeout(Math.random()>.5?e:t,2e3)}).catch(()=>console.log("Oops errors!"))},onCancel(){t.onCancel()}})}),this.handleBatchOperation=(e=>{var t=this.handleParameter(),a=t.teamName;(0,k.batchOperation)({action:"upgrade",team_name:a,serviceIds:e&&e.length>0?e.join(","):""}).then(e=>{e&&this.onCancel()})}),this.loadComponents=(()=>{var e=this.props.dispatch,t=this.state.info,a=this.handleParameter(),i=a.teamName,n=a.regionName,s=a.appID,l=a.id;e({type:"application/fetchApps",payload:{team_name:i,region_name:n,group_id:s,page:1,page_size:999},callback:e=>{if(e&&200===e.status_code){if(e.list&&e.list.length>0){var a=e.list.filter(e=>"third_party"!==e.service_source);this.setState({apps:a}),t&&t.services&&t.services.length>0&&this.setState({allChecked:a.length===t.services.length})}"add"===l&&this.setState({loading:!1})}}})}),this.loadConfigurationDetails=(()=>{var e=this.props.dispatch,t=this.handleParameter(),a=t.teamName,i=t.appID,n=t.id;"add"!==n?e({type:"global/fetchConfigurationDetails",payload:{team_name:a,group_id:i,name:n},callback:e=>{e&&200===e.status_code&&this.setState({info:e.bean,loading:!1},()=>{this.loadComponents()})}}):this.loadComponents()}),this.checkConfiguration=((e,t,a)=>{if(t&&t.length>0){var i=t.filter(e=>""===e.item_key);if(""===t[0].item_key&&""===t[0].item_value)a();else if(i&&i.length>0)a("\u914d\u7f6e\u9879key\u503c\u4e0d\u80fd\u4e3a\u7a7a");else{var n=!1,s=!1;if(t.map(e=>{var t=e.item_key,a=e.item_value;/^[-._a-zA-Z][-._a-zA-Z0-9]*$/.test(t)||(n=!0),(t.length>65535||a.length>65535)&&(s=!0)}),n)return void a(" \u5fc5\u987b\u7531\u5b57\u6bcd\u3001\u6570\u5b57\u548c - . _ \u7ec4\u6210\uff0c\u4e0d\u652f\u6301\u6570\u5b57\u5f00\u5934");if(s)return void a("\u6700\u5927\u957f\u5ea665535");a()}}a()}),this.handleHelpfulVisable=(e=>{this.setState({helpfulVisable:e})}),this.handleClose=(()=>{this.setState({helpfulVisable:!1})}),this.handleParameter=(()=>{var e=this.props.match,t=e.params,a=t.teamName,i=t.regionName,n=t.appID,s=t.id;return{regionName:i,teamName:a,appID:n,id:s}}),this.handleIsAll=(()=>{var e=this.props.form.setFieldsValue,t=this.state,a=t.apps,i=t.allChecked,n=i?[]:a.map(e=>e.service_id);e({service_ids:n}),this.setState({allChecked:!i})}),this.state={apps:[],info:{},loading:!0,helpfulVisable:!1,appConfigGroupPermissions:this.handlePermissions("queryAppConfigGroupInfo"),allChecked:!1}}componentWillMount(){var e=this.props.dispatch,t=this.state.appConfigGroupPermissions,a=t.isCreate,i=t.isEdit;a||i||y.default.withoutPermission(e)}componentDidMount(){this.loadConfigurationDetails()}render(){var e=this.props,t=e.form,a=e.AddConfigurationLoading,i=e.EditConfigurationLoading,n=e.currentEnterprise,u=e.currentTeam,m=e.currentRegionName,f=this.state,g=f.apps,v=f.info,_=f.loading,k=f.helpfulVisable,y=f.allChecked,x=t.getFieldDecorator,I=[];v&&v.services&&v.services.length>0&&v.services.map(e=>{I.push(e.service_id)});var P=this.handleParameter(),A=P.id,R="add"===A,V=[];return V=(0,E.createTeam)((0,E.createEnterprise)(V,n),u,m),N.default.createElement(D.default,{breadcrumbList:V},k&&N.default.createElement(p.default,{visible:!0,title:"\u53cb\u60c5\u63d0\u793a",confirmLoading:a||i,onOk:()=>{this.handleConfiguration(k)},onCancel:this.handleClose},N.default.createElement("p",null,"\u662f\u5426\u4fdd\u5b58\u5df2\u4fee\u6539\u7684\u914d\u7f6e\u7ec4")),N.default.createElement(s.default,{loading:_,style:{minHeight:"600px"},title:R?"\u6dfb\u52a0\u914d\u7f6e\u7ec4":"\u4fee\u6539\u914d\u7f6e\u7ec4",extra:[N.default.createElement(h.default,{onClick:this.onCancel,style:{marginRight:"20px"}},"\u53d6\u6d88"),N.default.createElement(h.default,{type:"primary",onClick:this.onOk,loading:a||i},R?"\u786e\u5b9a":"\u4fdd\u5b58")]},N.default.createElement(C.default,{onSubmit:this.onOk,style:{margin:"0 auto",width:"820px"}},N.default.createElement(o.default,{style:{display:"flex",alignItems:"center"}},N.default.createElement(S,{style:{width:"370px"},label:"\u914d\u7f6e\u7ec4\u540d\u79f0"},x("config_group_name",{initialValue:v&&v.config_group_name||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u914d\u7f6e\u7ec4\u540d\u79f0"},{min:2,message:"\u6700\u5c0f\u957f\u5ea62\u4f4d"},{max:64,message:"\u6700\u5927\u957f\u5ea664\u4f4d"},{pattern:/^[a-z0-9]([-a-z0-9]*[a-z0-9])?$/,message:"\u5fc5\u987b\u7531\u5c0f\u5199\u7684\u5b57\u6bcd\u3001\u6570\u5b57\u548c-\u7ec4\u6210\uff0c\u5e76\u4e14\u5fc5\u987b\u4ee5\u5b57\u6bcd\u6570\u5b57\u5f00\u59cb\u548c\u7ed3\u675f"}]})(N.default.createElement(c.default,{style:{width:"370px"},disabled:v&&v.config_group_name,placeholder:"\u8bf7\u586b\u5199\u914d\u7f6e\u7ec4\u540d\u79f0"}))),N.default.createElement(C.default.Item,{style:{width:"370px",marginLeft:"24px"},label:"\u751f\u6548\u72b6\u6001"},x("enable",{initialValue:v&&v.enable,rules:[{required:!1}]})(N.default.createElement(d.default,{defaultChecked:v&&v.enable})))),N.default.createElement(S,{label:"\u914d\u7f6e\u9879"},x("config_items",{initialValue:v&&v.config_items||[],rules:[{required:!1,message:"\u8bf7\u586b\u5199\u914d\u7f6e\u9879"},{validator:this.checkConfiguration}]})(N.default.createElement(b.default,{editInfo:v&&v.config_items||""}))),g.length>0&&N.default.createElement(S,{label:"\u751f\u6548\u7ec4\u4ef6"},N.default.createElement(r.default,{checked:y,onChange:this.handleIsAll,style:{marginBottom:"16px"}},"\u5168\u9009"),x("service_ids",{initialValue:I,rules:[{required:!1,message:"\u8bf7\u9009\u62e9\u751f\u6548\u7ec4\u4ef6"}]})(N.default.createElement(r.default.Group,{className:w.default.setCheckbox,onChange:this.onChangeGroup},N.default.createElement(o.default,{span:24},g.map(e=>{var t=e.service_cname,a=e.service_id;return N.default.createElement(l.default,{title:t},N.default.createElement(r.default,{key:A,value:a},N.default.createElement("div",null,t)))}))))))))}},v=_))||v)||v);t.default=R}}]);