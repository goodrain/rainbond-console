(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[23],{"s+T3":function(e,t,a){"use strict";var n=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,s,o,l=n(a("q1tI")),c=a("MuoO"),u=r(a("QDog")),d=r(a("hMqj")),p=r(a("nckk")),m=r(a("zmNr")),h=a("vSx2"),f=(i=(0,c.connect)(e=>{var t=e.teamControl,a=e.enterprise;return{currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:a.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}}),i((o=class extends l.PureComponent{constructor(e){super(e),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return d.default.querySpecifiedPermissionsInfo(t,e)}),this.state={appConfigGroupPermissions:this.handlePermissions("queryAppConfigGroupInfo")}}componentWillMount(){var e=this.props.dispatch,t=this.state.appConfigGroupPermissions.isAccess;t||u.default.withoutPermission(e)}render(){var e=this.props,t=e.currentEnterprise,a=e.currentTeam,n=e.currentRegionName,r=e.match,i=this.state.appConfigGroupPermissions,s=r.params,o=s.teamName,c=s.regionName,u=s.appID,d={regionName:c,teamName:o,appID:u,appConfigGroupPermissions:i},f=[];return f=(0,h.createTeam)((0,h.createEnterprise)(f,t),a,n),l.default.createElement(p.default,{breadcrumbList:f},l.default.createElement(m.default,d))}},s=o))||s);t.default=f},zmNr:function(e,t,a){"use strict";var n=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=n(a("bx4M"));a("g9YV");var s=n(a("wCAj"));a("Awhp");var o=n(a("KrTs"));a("Q9mQ");var l=n(a("diRs"));a("14J3");var c=n(a("BMrR"));a("+L6B");var u=n(a("2/Rp"));a("5NDa");var d=n(a("5rEg"));a("/xke");var p=n(a("TeRw"));a("y8nQ");var m=n(a("Vl3Y"));a("2qtc");var h,f,g,v=n(a("kLXV")),C=n(a("q76B")),E=a("xpXo"),I=a("MuoO"),y=a("7DNP"),_=n(a("wd/R")),b=r(a("q1tI")),D=v.default.confirm,P=m.default.Item,N=(h=(0,I.connect)(e=>{var t=e.loading,a=e.teamControl,n=e.enterprise;return{deleteConfigurationLoading:t.effects["global/DeleteConfiguration"],currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:n.currentEnterprise,currentTeamPermissionsInfo:a.currentTeamPermissionsInfo}}),h((g=class extends b.PureComponent{constructor(e){var t;super(e),t=this,this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchConfigurationList()})}),this.fetchConfigurationList=(()=>{var e=this.props,t=e.dispatch,a=e.teamName,n=e.regionName,r=e.appID,i=this.state,s=i.page,o=i.pageSize,l=i.query;t({type:"global/fetchConfigurationList",payload:{team_name:a,group_id:r,region:n,query:l,page:s,page_size:o},callback:e=>{e&&200===e.status_code&&this.setState({loading:!1,apps:e.list,total:e.total})}})}),this.handleConfigurationOperation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=t.props,n=a.dispatch,r=a.regionName,i=a.teamName,s=a.appID,o=e?e.config_group_name:"add";n(y.routerRedux.push("/team/".concat(i,"/region/").concat(r,"/apps/").concat(s,"/configgroups/details/").concat(o)))},this.handleSearch=(()=>{this.fetchConfigurationList()}),this.handelChange=(e=>{this.setState({query:e.target.value})}),this.handleEnter=(()=>{this.handleSearch()}),this.handleDelete=(e=>{this.setState({deleteVar:!0,info:e})}),this.cancelDeleteVariabl=(()=>{this.setState({deleteVar:!1})}),this.handleResetInfo=(()=>{this.setState({info:{}})}),this.handleDeleteVariabl=(()=>{var e=this.props,t=e.dispatch,a=e.regionName,n=e.teamName,r=e.appID,i=this.state,s=i.page,o=i.pageSize,l=i.query,c=i.info,u=[];c&&c.services&&c.services.length>0&&c.services.map(e=>{u.push(e.service_id)}),t({type:"global/DeleteConfiguration",payload:{region_name:a,team_name:n,group_id:r,name:c.config_group_name,query:l,page:s,page_size:o},callback:e=>{e&&200===e.status_code&&(this.fetchConfigurationList(),this.cancelDeleteVariabl(),u.length>0?this.showRemind(u):this.handleResetInfo(),p.default.success({message:"\u5220\u9664\u6210\u529f"}))}})}),this.showRemind=(e=>{var t=this;D({title:"\u9700\u66f4\u65b0\u7ec4\u4ef6\u7acb\u5373\u751f\u6548",content:"\u662f\u5426\u7acb\u5373\u66f4\u65b0\u7ec4\u4ef6",okText:"\u66f4\u65b0",cancelText:"\u53d6\u6d88",onOk(){return t.handleBatchOperation(e),new Promise((e,t)=>{setTimeout(Math.random()>.5?e:t,2e3)}).catch(()=>console.log("Oops errors!"))},onCancel(){t.handleResetInfo()}})}),this.handleBatchOperation=(e=>{var t=this.props.teamName;(0,E.batchOperation)({action:"upgrade",team_name:t,serviceIds:e&&e.length>0?e.join(","):""}).then(e=>{e&&(p.default.success({message:"\u66f4\u65b0\u6210\u529f",duration:"3"}),this.handleResetInfo())})}),this.state={apps:[],loading:!0,page:1,query:"",pageSize:10,info:{},deleteVar:!1}}componentDidMount(){this.fetchConfigurationList()}render(){var e=this.props,t=e.deleteConfigurationLoading,a=e.appConfigGroupPermissions,n=a.isCreate,r=a.isDelete,p=a.isEdit,h=e.regionName,f=e.teamName,g=(e.appID,this.state),v=g.apps,E=g.loading,I=g.page,D=g.pageSize,N=g.total,k=g.deleteVar;return b.default.createElement("div",null,b.default.createElement(c.default,null,b.default.createElement(m.default,{layout:"inline",style:{display:"inline-block"}},b.default.createElement(P,null,b.default.createElement(d.default,{placeholder:"\u641c\u7d22\u914d\u7f6e\u7ec4\u540d\u79f0",onChange:this.handelChange,onPressEnter:this.handleEnter,style:{width:250}})),b.default.createElement(P,null,b.default.createElement(u.default,{type:"primary",onClick:this.handleSearch,icon:"search"},"\u641c\u7d22"))),n&&b.default.createElement(u.default,{type:"primary",icon:"plus",style:{float:"right",marginBottom:"20px"},onClick:()=>{this.handleConfigurationOperation()}},"\u6dfb\u52a0\u914d\u7f6e\u7ec4")),k&&b.default.createElement(C.default,{onOk:this.handleDeleteVariabl,onCancel:this.cancelDeleteVariabl,loading:t,title:"\u5220\u9664\u914d\u7f6e\u7ec4",desc:"\u786e\u5b9a\u8981\u5220\u9664\u6b64\u914d\u7f6e\u7ec4\u5417\uff1f",subDesc:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d"}),b.default.createElement(i.default,{loading:E},b.default.createElement(s.default,{size:"default",pagination:{size:"default",current:I,pageSize:D,total:N,onChange:this.onPageChange},dataSource:v||[],columns:[{title:"\u914d\u7f6e\u7ec4\u540d\u79f0",dataIndex:"config_group_name"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",align:"center",render:e=>{return"".concat((0,_.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u751f\u6548\u7ec4\u4ef6\u6570",dataIndex:"services_num",align:"center",render:(e,t)=>{return b.default.createElement("div",null,e?b.default.createElement(l.default,{placement:"top",title:"\u751f\u6548\u7ec4\u4ef6",content:b.default.createElement("div",null,t.services.map(e=>{var t=e.service_cname,a=e.service_alias;return b.default.createElement(y.Link,{key:a,to:"/team/".concat(f,"/region/").concat(h,"/components/").concat(a,"/overview")},t)})),trigger:"click"},b.default.createElement("a",null,e)):0)}},{title:"\u751f\u6548\u72b6\u6001",dataIndex:"enable",align:"center",render:e=>{return b.default.createElement("div",null,b.default.createElement(o.default,{status:e?"success":"error",text:b.default.createElement("span",null,e?"\u751f\u6548\u4e2d":"\u4e0d\u751f\u6548")}))}},{title:"\u64cd\u4f5c",dataIndex:"action",align:"center",render:(e,t)=>{return b.default.createElement("div",null,p&&b.default.createElement("a",{onClick:()=>{this.handleConfigurationOperation(t)}},"\u7f16\u8f91"),r&&b.default.createElement("a",{onClick:()=>{this.handleDelete(t)}},"\u5220\u9664"))}}]})))}},f=g))||f);t.default=N}}]);