(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[40],{cdBT:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(a("jehZ"));a("+L6B");var i=r(a("2/Rp"));a("Pwec");var n=r(a("CtXQ"));a("/xke");var d,u,l,p=r(a("TeRw")),c=s(a("q1tI")),m=a("MuoO"),h=a("LLXN"),g=a("7DNP"),f=r(a("XZXw")),b=r(a("CNGZ")),_=(r(a("sXRX")),r(a("g9JJ"))),v=r(a("DEih")),y=r(a("9Qkj")),C=r(a("2lxJ")),I=r(a("QDog")),k=r(a("HIKV")),A=r(a("Zvdz")),N=r(a("mWxT")),E=(a("vSx2"),d=(0,m.connect)(e=>{var t=e.teamControl,a=e.enterprise,r=e.global,s=e.region,o=e.user;return{rainbondInfo:r.rainbondInfo,currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:a.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo,cluster_info:s.cluster_info,currentUser:o.currentUser}},null,null,{pure:!1}),d((l=class extends c.PureComponent{constructor(e){super(e),this.handleArchCpuInfo=(()=>{var e=this.props.dispatch;e({type:"index/fetchArchOverview",payload:{region_name:I.default.getCurrRegionName(),team_name:I.default.getCurrTeamName()},callback:e=>{e&&e.bean&&this.setState({archInfo:e.list})}})}),this.getImageHub=(()=>{var e=this.props.dispatch;e({type:"global/fetchPlatformImageHub",callback:e=>{e&&this.setState({imageList:e.list})}})}),this.loadClusters=(()=>{var e=this.props,t=e.dispatch,a=e.currentUser;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:null===a||void 0===a?void 0:a.enterprise_id},callback:e=>{if(e&&e.list){var t=[];e.list.map((e,a)=>{return e.key="cluster".concat(a),t.push(e),e}),this.setState({clusters:t})}else this.setState({clusters:[]})}})}),this.handleTabChange=(e=>{if("add"===e)this.setState({visible:!0});else{var t=this.props.dispatch,a=I.default.getAppID();t(g.routerRedux.push("/team/".concat(I.default.getCurrTeamName(),"/region/").concat(I.default.getCurrRegionName(),"/create/image/").concat(e,"?group_id=").concat(a)))}}),this.handleAddImageHub=(e=>{var t=this.props.dispatch;t({type:"global/addPlatformImageHub",payload:{secret_id:e.secret_id,domain:e.domain,username:e.username,password:e.password,hub_type:e.hub_type},callback:e=>{e&&e.response_data&&200==e.response_data.code&&(p.default.success({message:(0,h.formatMessage)({id:"notification.success.add"})}),this.getImageHub()),this.setState({imageHubLoading:!1,visible:!1})}})}),this.handelClone=(()=>{this.setState({visible:!1})}),this.state={archInfo:[],teamAppCreatePermission:y.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"team_app_create"),imageList:[],clusters:[],imageHubLoading:!1}}componentWillMount(){this.handleArchCpuInfo(),this.getImageHub(),this.loadClusters()}render(){var e,t,a=this.props,r=(a.currentEnterprise,a.currentTeam,a.currentRegionName,a.match),s=a.rainbondInfo,d=this.state,u=d.imageList,l=d.clusters,p=d.imageHubLoading,m={custom:b.default,Dockercompose:_.default,ImageNameDemo:v.default},E=[{key:"custom",tab:(0,h.formatMessage)({id:"teamAdd.create.image.tabImage"})},{key:"Dockercompose",tab:"Docker Compose"}];u&&u.length>0&&u.forEach(e=>{m[e.secret_id]=k.default,E.push({key:e.secret_id,tab:"".concat(e.hub_type," (").concat(e.secret_id,")")})}),N.default.officialDemoEnable(s)&&E.push({key:"ImageNameDemo",tab:(0,h.formatMessage)({id:"teamAdd.create.code.demo"})}),E.push({key:"add",tab:c.default.createElement(n.default,{type:"plus",style:{display:"flex",padding:"12px 0px 5px",marginRight:"0 !important"}})});var T=this.state,S=T.archInfo,P=T.teamAppCreatePermission.isAccess;if(!P)return y.default.noPermission();var R=r.params.type;R=R.split("?")[0],R||(R="custom");var x=m[R],w=I.default.getAppID()||"",D=(null===(e=this.props.location)||void 0===e?void 0:null===(t=e.query)||void 0===t?void 0:t.type)||"";return c.default.createElement(f.default,{title:(0,h.formatMessage)({id:"versionUpdata_6_1.createComponent"}),onTabChange:this.handleTabChange,content:(0,h.formatMessage)({id:"versionUpdata_6_1.createComponent.content"}),tabActiveKey:R,tabList:E,titleSvg:C.default.getSvg("dockerSvg",18),extraContent:c.default.createElement(i.default,{onClick:()=>{var e=this.props.dispatch;e(g.routerRedux.push("/team/".concat(I.default.getCurrTeamName(),"/region/").concat(I.default.getCurrRegionName(),"/create/wizard?group_id=").concat(w,"&type=").concat(D)))},type:"default"},c.default.createElement(n.default,{type:"rollback"}),(0,h.formatMessage)({id:"button.return"}))},x?c.default.createElement(x,(0,o.default)({archInfo:S,imgRepostoryList:u},this.props,{key:R})):c.default.createElement(h.FormattedMessage,{id:"teamAdd.create.error"}),this.state.visible&&c.default.createElement(A.default,{loading:p,imageList:u,clusters:l,onOk:this.handleAddImageHub,onCancel:this.handelClone}))}},u=l))||u);t.default=E},g9JJ:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var o,i,n,d=r(a("bx4M")),u=r(a("jehZ")),l=r(a("p0pE")),p=a("MuoO"),c=a("7DNP"),m=s(a("q1tI")),h=r(a("P7dd")),g=r(a("/BFj")),f=r(a("QDog")),b=r(a("9Qkj")),_=r(a("51sS")),v=(o=(0,p.connect)(e=>{var t=e.user,a=e.global;return{currUser:t.currentUser,groups:a.groups}}),o((n=class extends m.PureComponent{constructor(e){super(e),this.onAddGroup=(()=>{this.setState({addGroup:!0})}),this.cancelAddGroup=(()=>{this.setState({addGroup:!1})}),this.handleAddGroup=(e=>{var t=this.props.form.setFieldsValue;this.props.dispatch({type:"application/addGroup",payload:(0,l.default)({team_name:f.default.getCurrTeamName()},e),callback:e=>{e&&this.props.dispatch({type:"global/fetchGroups",payload:{team_name:f.default.getCurrTeamName(),region_name:f.default.getCurrRegionName()},callback:()=>{t({group_id:e.group_id}),this.cancelAddGroup()}})}})}),this.hideShowKey=(()=>{this.setState({showKey:!1})}),this.handleSubmit=(e=>{var t=f.default.getCurrTeamName();this.props.dispatch({type:"createApp/createAppByCompose",payload:(0,l.default)({team_name:t,image_type:"docker_compose"},e),callback:e=>{var t=e.bean.group_id,a=e.bean,r=a.compose_id,s=a.app_name;this.props.dispatch(c.routerRedux.push("/team/".concat(f.default.getCurrTeamName(),"/region/").concat(f.default.getCurrRegionName(),"/create/create-compose-check/").concat(t,"/").concat(r,"?app_name=").concat(s)))}})}),this.installApp=(e=>{var t=this.props.dispatch,a=f.default.getCurrTeamName(),r=f.default.getCurrRegionName();t({type:"application/addGroup",payload:{region_name:r,team_name:a,group_name:e.group_name,k8s_app:e.k8s_app,note:""},callback:t=>{t&&t.group_id&&(b.default.refreshPermissionsInfo(),e.group_id=t.group_id,this.handleSubmit(e))},handleError:()=>{}})}),this.handleInstallApp=(e=>{e.group_id?this.handleSubmit(e):this.installApp(e)}),this.state={}}render(){return m.default.createElement(d.default,null,m.default.createElement(g.default,null),m.default.createElement("div",{className:_.default.formWrap},m.default.createElement(h.default,(0,u.default)({},this.props,{onSubmit:this.handleInstallApp}))))}},i=n))||i);t.default=v}}]);