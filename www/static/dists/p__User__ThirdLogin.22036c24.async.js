(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[79],{"7KHJ":function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var u=s(a("BMrR"));a("jCWc");var n=s(a("kPKH"));a("fOrg");var o=s(a("+KLJ"));a("miYZ");var i,l,d,c=s(a("tsqr")),f=s(a("p0pE")),p=a("MuoO"),h=a("7DNP"),m=r(a("q1tI")),g=s(a("8+Sn")),_=s(a("mWxT")),b=s(a("w2qy")),v=s(a("CTfg")),w=_.default.OauthParameter("code"),y=_.default.OauthParameter("service_id"),k=_.default.OauthParameter("oauth_user_id"),E=(i=(0,p.connect)(e=>{var t=e.loading,a=e.global;return{login:{},isRegist:a.isRegist,rainbondInfo:a.rainbondInfo,submitting:t.effects["user/login"]}}),i((d=class extends m.Component{constructor(){super(...arguments),this.state={user_info:null},this.handleSubmit=(e=>{var t=this.props.dispatch;w&&y&&k&&t({type:"user/thirdLogin",payload:(0,f.default)({},e),callback:e=>{e&&200===e.status_code&&(g.default.set("token",e.bean.token),t({type:"user/fetchThirdBinding",payload:{service_id:y,oauth_user_id:k},callback:e=>{e&&e.status&&400===e.status?c.default.warning("\u8ba4\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1",1,()=>{t(h.routerRedux.replace("/user/login?disable_auto_login=true"))}):e&&200===e.status_code&&c.default.success("\u8ba4\u8bc1\u6210\u529f",1,()=>{var e=window.localStorage.getItem("redirect");e&&""!=e||(e="/"),e.startsWith("/")?t(h.routerRedux.push(e)):window.location.href=e,window.localStorage.setItem("redirect","")})}}))}})})}componentDidMount(){this.props.dispatch({type:"user/fetchThirdInfo",payload:{code:w,service_id:y},callback:e=>{e&&200===e.status_code&&this.setState({user_info:e.bean.user_info})}})}render(){var e=this.props,t=e.rainbondInfo,a=e.isRegist,s=this.state.user_info,r=!_.default.fetchIsFirstRegist(t),i=null;_.default.OauthbEnable(t)&&t.oauth_services&&t.oauth_services.value&&t.oauth_services.value.map(e=>{e.service_id==y&&(i=e)});var l=i&&i.name||"",d=s&&s.oauth_user_name||"",c=l&&"\u6765\u81ea".concat(l,"\u767b\u5f55\u7684"),f=e=>{return"/user/third/".concat(e,"?code=").concat(w,"&service_id=").concat(y,"&oauth_user_id=").concat(k)};return m.default.createElement("div",{className:b.default.main},m.default.createElement(o.default,{style:{margin:"24px 0"},message:"".concat(c).concat(d,"\u60a8\u597d\uff01\u4f60\u9700\u8981\u8865\u5145\u5b8c\u6574\u5e73\u53f0\u8d26\u53f7\u4fe1\u606f"),type:"info"}),m.default.createElement(u.default,{style:{marginBottom:"24px"}},m.default.createElement(n.default,{span:10,className:b.default.boxJump,style:{background:"#CDE2FF"}},!r&&m.default.createElement(h.Link,{to:f("login")},"\u5df2\u6709\u8d26\u53f7\uff0c\u9a6c\u4e0a\u7ed1\u5b9a")),a&&m.default.createElement(n.default,{span:10,className:b.default.boxJump,offset:4},m.default.createElement(h.Link,{to:f("register")},"\u672a\u6709\u8d26\u53f7\uff0c\u521b\u5efa\u8d26\u53f7"))),m.default.createElement(v.default,{onSubmit:this.handleSubmit,type:"thirdLogin"}))}},l=d))||l);t.default=E}}]);