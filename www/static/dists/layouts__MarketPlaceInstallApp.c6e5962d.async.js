(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"6MZE":function(e,a,t){"use strict";var r=t("g09b"),i=t("tAuX");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,t("2qtc");var s=r(t("kLXV"));t("5NDa");var o=r(t("5rEg"));t("7Kak");var l=r(t("9yH6")),n=r(t("jehZ"));t("+L6B");var p=r(t("2/Rp"));t("OaEy");var d=r(t("2fM7"));t("y8nQ");var u,m,c,v,h=r(t("Vl3Y")),f=t("MuoO"),g=t("7DNP"),_=i(t("q1tI")),y=t("LLXN"),E=(r(t("qCJ4")),r(t("9uC9")),r(t("QDog")),t("IcNB")),M=(r(t("8+Sn")),r(t("e6Ls"))),b=h.default.Item,S=d.default.Option,w=(u=h.default.create(),m=(0,f.connect)(e=>{var a=e.user,t=e.global,r=e.teamControl;return{user:a.currentUser,rainbondInfo:t.rainbondInfo,currentTeam:r.currentTeam,allAppNames:r.allAppNames}}),u(c=m((v=class extends _.PureComponent{constructor(e){super(e),this.fetchPrices=(()=>{var e=this.props,a=e.dispatch,t=e.regionName;a({type:"global/getPricingConfig",payload:{region_name:t},callback:e=>{var a,t;200==e.status_code&&this.setState({cpuPrice:(null===(a=e.response_data)||void 0===a?void 0:a.cpu_price_per_core)/1e6||0,memoryPrice:(null===(t=e.response_data)||void 0===t?void 0:t.memory_price_per_gb)/1e6||0})}})}),this.onAddGroup=(()=>{var e=this.props.form,a=e.validateFields;a(["team_name","region_name"],e=>{e||this.setState({addGroup:!0})})}),this.handleSubmit=(()=>{var e=this.props,a=e.form,t=(e.appInfo,e.onOk),r=this.state,i=r.region_name;r.installType;a.validateFields((e,a)=>{e||("new"===a.install_type&&(a.k8s_app=this.generateEnglishName(a.group_name)),t(a,i))})}),this.handleTeamChange=(e=>{var a=this.props,t=a.form,r=(a.appInfo,t.setFieldsValue,t.getFieldValue,this.state.userTeamList);r.forEach(a=>{a.team_name===e&&(this.fetchGroup(e,a.region),this.setState({region_name:a.region}))})}),this.fetchGroup=(()=>{var e=this.props.form.setFieldsValue,a=this.props,t=a.dispatch,r=a.teamName,i=a.regionName;t({type:"global/fetchGroups",payload:{team_name:r,region_name:i},callback:a=>{e({group_id:a&&a.length>0?a[0].group_id:""}),this.setState({groups:a,group_id:a&&a.length>0?a[0].group_id:""})}})}),this.handleAddGroup=((e,a)=>{var t=this.props.form,r=t.setFieldsValue;this.setState({groups:a||[]}),r({group_id:e})}),this.handleValiateNameSpace=((e,a,t)=>{if(!a)return t(new Error((0,y.formatMessage)({id:"placeholder.appEngName"})));if(a&&a.length<=32){var r=/^[a-z]([-a-z0-9]*[a-z0-9])?$/;if(!r.test(a))return t(new Error((0,y.formatMessage)({id:"placeholder.nameSpaceReg"})));t()}return a.length>32?t(new Error((0,y.formatMessage)({id:"placeholder.max32"}))):void 0}),this.generateEnglishName=(e=>{if(void 0!=e&&""!=e){var a=this.props.allAppNames,t=(0,E.pinyin)(e,{toneType:"none"}).replace(/\s/g,""),r=t.toLowerCase();if(a&&a.length>0){var i=a.some(e=>e===r);if(i){var s=Math.floor(1e4*Math.random());return"".concat(r).concat(s)}return r}return r}return""}),this.handleBackHome=(()=>{var e=this.props.dispatch;e(g.routerRedux.push("/"))}),this.onChangeVersion=(e=>{var a=this.props.appInfo;if(a){var t=a.versions_info||a.versions,r=t.find(a=>a.version===e||a.app_version===e)||{};this.setState({currentVersionInfo:r})}});var a=this.props.appInfo;this.state={userTeamList:[],groups:[],addGroup:!1,showAddTeam:!1,region_name:"",installType:"new",currentVersionInfo:(null===a||void 0===a?void 0:a.versions)&&(null===a||void 0===a?void 0:a.versions[0])||{}}}componentDidMount(){var e=this.props,a=e.regionName,t=e.teamName,r=e.rainbondInfo,i=r&&r.is_saas||!1;i&&this.fetchPrices(),t&&a&&this.fetchGroup(t,a)}render(){var e,a,t,r,i,u,m=this.props,c=(m.eid,m.title),v=m.appInfo,f=m.form,g=(m.teaName,m.regionName,m.isShare),E=m.appName,w=m.rainbondInfo,I=f.getFieldDecorator,k=(f.getFieldValue,this.state),A=k.userTeamList,N=k.groups,C=(k.addGroup,k.showAddTeam,k.region_name,k.installType),V=(k.currentVersionInfo,k.cpuPrice),x=k.memoryPrice,O=k.group_id,T=(A&&A.length,w&&w.is_saas||!1),U={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19}}};return _.default.createElement("div",null,_.default.createElement(s.default,{centered:!0,title:c,maskClosable:!1,visible:!0,width:480,className:M.default.TelescopicModal,footer:_.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-evenly"}},T&&_.default.createElement("div",null,_.default.createElement("span",{style:{color:"#8C8C8C",fontSize:"14px"}},(0,y.formatMessage)({id:"teamOverview.estimate"}),_.default.createElement("span",{style:{color:"#F5A623",fontSize:"16px",fontWeight:500,marginLeft:"4px"}},"\xa5",(((null===(e=this.state.currentVersionInfo)||void 0===e?void 0:e.cpu)||0)/1e3*V*24+((null===(a=this.state.currentVersionInfo)||void 0===a?void 0:a.memory)||0)/1024*x*24).toFixed(2)))),_.default.createElement("div",{style:{display:"flex",gap:"8px"}},_.default.createElement(p.default,{onClick:()=>{this.handleBackHome()}},(0,y.formatMessage)({id:"teamOverview.backHome"})),_.default.createElement(p.default,{loading:g,type:"primary",onClick:this.handleSubmit},(0,y.formatMessage)({id:"teamOverview.install"}))))},(null===v||void 0===v?void 0:v.describe)&&_.default.createElement("p",{style:{background:"rgba(22, 184, 248, 0.1)",padding:"8px"}},v.describe),_.default.createElement(h.default,{onSubmit:this.handleSubmit,layout:"horizontal"},_.default.createElement(b,(0,n.default)({},U,{label:(0,y.formatMessage)({id:"teamOverview.version"})}),I("version",{initialValue:(null===v||void 0===v?void 0:v.versions)&&(null===v||void 0===v?void 0:null===(t=v.versions[0])||void 0===t?void 0:t.app_version)||"",rules:[{required:!0,message:(0,y.formatMessage)({id:"teamOverview.selectVersion"})}]})(_.default.createElement(d.default,{onChange:this.onChangeVersion,placeholder:(0,y.formatMessage)({id:"teamOverview.selectVersion"})},null===v||void 0===v?void 0:null===(r=v.versions)||void 0===r?void 0:r.map(e=>{return _.default.createElement(S,{value:e.app_version},e.app_version)}))),_.default.createElement("div",{style:{fontSize:"14px",color:"#8C8C8C",marginBottom:"-10px"}},"".concat((0,y.formatMessage)({id:"teamOverview.resourceOccupied"}),":  CPU ").concat(null===(i=this.state.currentVersionInfo)||void 0===i?void 0:i.cpu,"m / ").concat((0,y.formatMessage)({id:"teamOverview.memory"})," ").concat(null===(u=this.state.currentVersionInfo)||void 0===u?void 0:u.memory,"MB"))),_.default.createElement(b,(0,n.default)({},U,{label:(0,y.formatMessage)({id:"teamOverview.type"})}),I("install_type",{initialValue:"new",rules:[{required:!0,message:(0,y.formatMessage)({id:"teamOverview.selectType"})}]})(_.default.createElement(l.default.Group,{onChange:e=>this.setState({installType:e.target.value}),buttonStyle:"solid"},_.default.createElement(l.default.Button,{value:"new"},(0,y.formatMessage)({id:"teamOverview.createApp"})),_.default.createElement(l.default.Button,{value:"existing"},(0,y.formatMessage)({id:"teamOverview.hasApp"}))))),"new"===C&&_.default.createElement(b,(0,n.default)({},U,{label:(0,y.formatMessage)({id:"popover.newApp.appName"})}),I("group_name",{initialValue:E||"",rules:[{required:!0,message:(0,y.formatMessage)({id:"popover.newApp.appName.placeholder"})},{max:24,message:(0,y.formatMessage)({id:"placeholder.max24"})}]})(_.default.createElement(o.default,{placeholder:(0,y.formatMessage)({id:"popover.newApp.appName.placeholder"})}))),"existing"===C&&_.default.createElement(h.default.Item,(0,n.default)({},U,{label:_.default.createElement(y.FormattedMessage,{id:"applicationMarket.CreateHelmAppModels.select_app"})}),I("group_id",{initialValue:Number(O)||"",rules:[{required:!0,message:(0,y.formatMessage)({id:"applicationMarket.CreateHelmAppModels.input_app"})}]})(_.default.createElement(d.default,{placeholder:(0,y.formatMessage)({id:"applicationMarket.CreateHelmAppModels.input_name"}),style:{display:"inline-block"}},(N||[]).map(e=>_.default.createElement(S,{key:e.group_id,value:e.group_id},e.group_name)))),_.default.createElement("div",{className:M.default.conformDesc},_.default.createElement(y.FormattedMessage,{id:"applicationMarket.CreateHelmAppModels.input_install"}))))))}},c=v))||c)||c),I=w;a.default=I},L7I3:function(e,a,t){"use strict";var r=t("g09b"),i=t("tAuX");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,t("+L6B");var s=r(t("2/Rp"));t("T2oS");var o,l,n,p=r(t("W9HT")),d=i(t("q1tI")),u=t("MuoO"),m=t("7DNP"),c=r(t("6MZE")),v=r(t("luV/")),h=r(t("9Qkj")),f=r(t("8+Sn")),g=(o=(0,u.connect)(e=>{var a=e.user;return{currUser:a.currentUser}}),o((n=class extends d.Component{constructor(e){super(e),this.getAppNames=(()=>{var e,a,t,r=this.props,i=r.dispatch,s=r.currUser,o=null===(e=s.teams[0])||void 0===e?void 0:e.team_name;i({type:"teamControl/fetchAppNames",payload:{team_name:o,region_name:null===(a=s.teams[0])||void 0===a?void 0:null===(t=a.region[0])||void 0===t?void 0:t.team_region_name}})}),this.handleAppStoreTabs=(e=>{var a,t,r=this.props.dispatch;r({type:"market/fetchMarketsTab",payload:{enterprise_id:null===(a=this.props)||void 0===a?void 0:null===(t=a.currUser)||void 0===t?void 0:t.enterprise_id},callback:e=>{var a;this.fetchAppInfo(null===(a=e.list[0])||void 0===a?void 0:a.name)}})}),this.fetchAppInfo=(e=>{var a,t,r,i,s,o=this.props.dispatch;o({type:"market/fetchMarkets",payload:{enterprise_id:null===(a=this.props)||void 0===a?void 0:null===(t=a.currUser)||void 0===t?void 0:t.enterprise_id,pageSize:999,page:1,name:e||"RainbondMarket",query:null===(r=this.props)||void 0===r?void 0:null===(i=r.location)||void 0===i?void 0:null===(s=i.query)||void 0===s?void 0:s.app_name,is_plugin:!1,arch:"amd64"},callback:e=>{if(e&&e.list&&e.list.length>0){var a=e.list.find(e=>{var a,t,r;return e.app_id===(null===(a=this.props)||void 0===a?void 0:null===(t=a.match)||void 0===t?void 0:null===(r=t.params)||void 0===r?void 0:r.appId)});this.setState({appInfo:a,loading:!1})}},handleError:()=>{this.setState({loading:!1})}})}),this.installApp=((e,a,t)=>{this.state.appInfo;var r=this.props,i=r.dispatch;r.currUser;f.default.set("team_name",t.team_name),f.default.set("region_name",a),i({type:"application/addGroup",payload:{region_name:a,team_name:e,group_name:t.group_name,k8s_app:t.k8s_app,note:""},callback:r=>{r&&r.group_id&&(h.default.refreshPermissionsInfo(),this.installShareApp(e,a,t,r.group_id))},handleError:()=>{this.setState({isShare:!1})}})}),this.installShareApp=((e,a,t,r)=>{var i=this.state.appInfo,s=this.props,o=s.dispatch;s.currUser;o({type:"createApp/installApp",payload:{region_name:a,team_name:e,group_id:r,app_id:i.app_id,is_deploy:!0,app_version:t.version,install_from_cloud:!0,marketName:"RainbondMarket"},callback:()=>{this.setState({isShare:!1}),o(m.routerRedux.push("/team/".concat(e,"/region/").concat(a,"/apps/").concat(r,"/overview")))},handleError:()=>{this.setState({isShare:!1})}})}),this.handleInstallApp=(e=>{this.state.appInfo;var a,t,r,i=this.props,s=(i.dispatch,i.currUser,null===(a=this.props.currUser.teams[0])||void 0===a?void 0:a.team_name),o=null===(t=this.props.currUser.teams[0])||void 0===t?void 0:null===(r=t.region[0])||void 0===r?void 0:r.team_region_name;this.setState({isShare:!0}),"new"===e.install_type?this.installApp(s,o,e):this.installShareApp(s,o,e,e.group_id)}),this.state={appInfo:!1,isShare:!1,loading:!0}}componentDidMount(){this.handleAppStoreTabs(),this.getAppNames()}render(){var e,a,t,r,i,o,l=this.props.currUser,n=this.state,u=n.appInfo,h=n.isShare,f=n.loading,g=l.enterprise_id,_=(l.teams,null===(e=this.props.currUser.teams[0])||void 0===e?void 0:e.team_name),y=null===(a=this.props.currUser.teams[0])||void 0===a?void 0:null===(t=a.region[0])||void 0===t?void 0:t.team_region_name,E=null===(r=this.props)||void 0===r?void 0:null===(i=r.location)||void 0===i?void 0:null===(o=i.query)||void 0===o?void 0:o.app_name;return f?d.default.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},d.default.createElement(p.default,null)):u?d.default.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},d.default.createElement(c.default,{eid:g,appInfo:u,isShare:h,teamName:_,appName:E,regionName:y,onOk:this.handleInstallApp})):d.default.createElement(v.default,{type:"404",title:"\u672a\u627e\u5230\u5e94\u7528",desc:d.default.createElement("p",{style:{color:"#666"}},'\u62b1\u6b49\uff0c\u672a\u627e\u5230\u4e0e"',E,'"\u76f8\u5173\u7684\u5e94\u7528\u4fe1\u606f'),actions:d.default.createElement(m.Link,{to:"/"},d.default.createElement(s.default,{type:"primary"},"\u8fd4\u56de\u9996\u9875"))})}},l=n))||l);a.default=g}}]);