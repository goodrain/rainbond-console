(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[47],{"EAv/":function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("OaEy");var l,n,i,d=s(a("2fM7")),o=a("MuoO"),c=r(a("q1tI")),u=s(a("8+Sn")),m=d.default.Option,h=(l=(0,o.connect)(),l((i=class extends c.Component{constructor(e){super(e),this.handleSearch=(e=>{var t=this.props,a=t.eid,s=t.dispatch;s({type:"global/searchTenant",payload:{eid:a,tenant:e},callback:e=>{e&&200===e.status_code&&e.bean&&this.setState({data:e.bean.list||[]})}})}),this.handleChange=(e=>{var t=this.props.onChange;this.setState({tenant:e},()=>{t&&t(e)})}),this.handleSelect=(e=>{var t=this.props.onSelect,a=this.state.data;if(t){var s=a.filter(t=>t.team_name===e);s&&s.length>0&&(u.default.set("region_name",s[0].region),u.default.set("team_name",e)),t(e)}}),this.state={data:[],tenant:void 0}}componentDidMount(){this.handleSearch()}componentWillUnmount(){this.setState({data:[],tenant:""})}render(){var e=this.props,t=e.placeholder,a=e.style,s=this.state,r=s.data,l=s.tenant;return c.default.createElement(d.default,{allowClear:!0,getPopupContainer:e=>e.parentNode,showSearch:!0,placeholder:t,value:l,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onChange:this.handleChange,notFoundContent:null,onSearch:this.handleSearch,style:a,onSelect:this.handleSelect},r.map(e=>c.default.createElement(m,{value:e.team_name,key:e.team_alias},e.team_alias)))}},n=i))||n),p=h;t.default=p},L24g:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var l=s(a("kLXV")),n=s(a("jehZ"));a("5NDa");var i=s(a("5rEg"));a("OaEy");var d=s(a("2fM7"));a("y8nQ");var o,c,u,m=s(a("Vl3Y")),h=a("MuoO"),p=r(a("q1tI")),f=a("LLXN"),g=s(a("EAv/")),b=s(a("8+Sn")),E=s(a("e6Ls")),M=m.default.Item,_=d.default.Option,v=(o=(0,h.connect)(),o((u=class extends p.PureComponent{constructor(e){super(e),this.handleSelect=(e=>{var t=this.props,a=t.dispatch,s=t.form,r=s.setFieldsValue;a({type:"teamControl/fetchTeamRoles",payload:{team_name:e},callback:e=>{e&&this.setState({authorityList:e.list},()=>{r({role_ids:[]})})}})}),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.onOk;t.validateFields((e,t)=>{!e&&a&&a(t)})}),this.checkAccountPass=((e,t,a)=>{var s=this.props.userInfo;s&&!t?a():t?t&&t.length<8?a("\u5bc6\u7801\u957f\u5ea6\u81f3\u5c11\u4e3a8\u4f4d"):t&&t.length>16?a("\u6700\u5927\u957f\u5ea616\u4f4d"):a():a("\u8bf7\u586b\u5199\u5bc6\u7801")}),this.state={authorityList:[],language:"zh-CN"===b.default.get("language")}}render(){var e=this.props,t=e.eid,a=e.onCancel,s=e.title,r=e.userInfo,o=e.form,c=e.loading,u=void 0!==c&&c,h=o.getFieldDecorator,b=this.state,v=b.authorityList,U=b.language,y={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},C={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:17}}},w=U?y:C;return p.default.createElement(l.default,{visible:!0,maskClosable:!1,title:s||(0,f.formatMessage)({id:"enterpriseUser.button.adduser"}),className:E.default.TelescopicModal,onOk:this.handleSubmit,onCancel:a,confirmLoading:u},p.default.createElement(m.default,{onSubmit:this.handleSubmit},!r&&p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.user_name"})}),h("user_name",{initialValue:r?r.nick_name:"",rules:[{required:!0,message:(0,f.formatMessage)({id:"placeholder.createUser.user_name"})},{min:3,message:(0,f.formatMessage)({id:"placeholder.createUser.min3"})},{max:24,message:(0,f.formatMessage)({id:"placeholder.max24"})},{pattern:/^[a-zA-Z0-9_\-]+$/,message:(0,f.formatMessage)({id:"placeholder.createUser.real_nameMsg"})}]})(p.default.createElement(i.default,{autoComplete:"off",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.user_name"})}))),p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.real_name"})}),h("real_name",{initialValue:r&&r.real_name||"",rules:[{required:!0,message:(0,f.formatMessage)({id:"placeholder.createUser.real_name"})},{max:24,message:(0,f.formatMessage)({id:"placeholder.max24"})},{pattern:/^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/,message:(0,f.formatMessage)({id:"placeholder.createUser.real_nameMsg"})}]})(p.default.createElement(i.default,{autoComplete:"off",type:"text",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.real_name"})}))),!r&&p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.password"})}),h("password",{initialValue:r&&r.password||"",rules:[{required:!0,validator:this.checkAccountPass}]})(p.default.createElement(i.default.Password,{autoComplete:"new-password",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.password"})}))),!r&&p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.email"})}),h("email",{initialValue:r&&r.email||"",rules:[{required:!0,message:(0,f.formatMessage)({id:"placeholder.createUser.email"})},{type:"email",message:(0,f.formatMessage)({id:"placeholder.createUser.emailMsg"})}]})(p.default.createElement(i.default,{type:"text",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.email"}),autoComplete:"off"}))),p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.phone"})}),h("phone",{initialValue:r&&r.phone||"",rules:[{pattern:/^[0-9]{11}$/,message:(0,f.formatMessage)({id:"placeholder.createUser.phoneMsg"})}]})(p.default.createElement(i.default,{type:"text",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.phone"}),autoComplete:"off"}))),r&&p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.new_password"})}),h("password",{initialValue:r&&r.password||"",rules:[{validator:this.checkAccountPass}]})(p.default.createElement(i.default.Password,{autoComplete:"new-password",placeholder:(0,f.formatMessage)({id:"placeholder.createUser.new_password"}),style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}}))),!r&&p.default.createElement("div",null,p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.tenant_name"})}),h("tenant_name",{rules:[{required:!1,message:(0,f.formatMessage)({id:"placeholder.createUser.selectTeam"})}]})(p.default.createElement(g.default,{placeholder:(0,f.formatMessage)({id:"placeholder.createUser.tenant_name"}),eid:t,onSelect:this.handleSelect}))),p.default.createElement(M,(0,n.default)({},w,{label:(0,f.formatMessage)({id:"enterpriseUser.form.label.role_ids"})}),h("role_ids",{initialValue:[],rules:[{required:!1,message:(0,f.formatMessage)({id:"placeholder.createUser.role_ids"})}]})(p.default.createElement(d.default,{getPopupContainer:e=>e.parentNode,mode:"multiple",style:{width:"100%"},placeholder:(0,f.formatMessage)({id:"placeholder.createUser.role_ids"})},v.map(e=>{var t=e.ID,a=e.name;return p.default.createElement(_,{key:t,value:t},a)})))))))}},c=u))||c),U=m.default.create()(v),y=U;t.default=y},TWBS:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var l=s(a("kLXV"));a("g9YV");var n=s(a("wCAj"));a("+L6B");var i=s(a("2/Rp"));a("/xke");var d,o,c,u=s(a("TeRw")),m=a("MuoO"),h=r(a("q1tI")),p=a("LLXN"),f=s(a("hMqj")),g=s(a("GFvx")),b=s(a("e6Ls")),E=(d=(0,m.connect)(e=>{var t=e.user;return{user:t.currentUser}}),d((c=class extends h.PureComponent{constructor(e){super(e),this.getEnterpriseTeams=(()=>{var e=this.props,t=e.dispatch,a=e.eid,s=e.userInfo;t({type:"global/fetchUserTeams",payload:{user_id:s&&s.user_id,enterprise_id:a},callback:e=>{e&&200===e.status_code&&this.setState({list:e&&e.list||[],Loading:!1})}})}),this.handleRole=(e=>{this.setState({toEditAction:e,editRoleLoading:!1})}),this.handleEditRole=(e=>{this.setState({editRoleLoading:!0});var t=this.props,a=t.dispatch,s=t.eid,r=t.userInfo,l=this.state.toEditAction,n="user/editUserRoles";l.roles&&l.roles.length>0&&(n="teamControl/editMember"),a({type:n,payload:{enterprise_id:s,team_name:l.team_name,user_id:r&&r.user_id,role_ids:e.role_ids},callback:()=>{this.getEnterpriseTeams(),u.default.success({message:(0,p.formatMessage)({id:"notification.success.setting_successfully"})}),this.handleRole(!1)}})}),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.onOk;t.validateFields((e,t)=>{!e&&a&&a(t)})}),this.state={list:[],toEditAction:!1,editRoleLoading:!0,Loading:!0}}componentDidMount(){this.getEnterpriseTeams()}render(){var e=this.props,t=e.onCancel,a=e.title,s=e.userInfo,r=e.eid,d=this.state,o=d.list,c=d.Loading,u=d.toEditAction,m=d.editRoleLoading,p=this,E=[{title:"\u56e2\u961f\u540d\u79f0",dataIndex:"team_alias",rowKey:"team_alias"},{title:"\u89d2\u8272",dataIndex:"roles",render(e){return h.default.createElement("span",null,e&&e.length>0?e.map(e=>{return h.default.createElement("span",{style:{marginRight:"8px"},key:"role".concat(e)},f.default.actionMap(e))}):h.default.createElement("span",{style:{color:"rgba(0,0,0,.45)"}},"\u5c1a\u672a\u52a0\u5165"))}},{title:"\u64cd\u4f5c",dataIndex:"action",align:"center",width:100,render(e,t){return h.default.createElement("a",{onClick:()=>{p.handleRole(t)}},"\u8bbe\u7f6e\u89d2\u8272")}}];return h.default.createElement(h.Fragment,null,h.default.createElement(l.default,{visible:!0,width:800,title:a||"\u56e2\u961f\u5217\u8868",className:b.default.TelescopicModal,maskClosable:!1,footer:[h.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")],onCancel:t},h.default.createElement(n.default,{loading:c,scroll:{y:300},pagination:!1,dataSource:o,columns:E})),u&&h.default.createElement(g.default,{viewName:"enterprise",title:"\u8bbe\u7f6e\u89d2\u8272",eid:r,loading:m,data:u,userId:s&&s.user_id,teamName:u&&u.team_name,nickName:s&&s.nick_name,onOk:this.handleEditRole,onCancel:()=>{this.handleRole(!1)}}))}},o=c))||o),M=E;t.default=M},iOcZ:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l=s(a("bx4M"));a("g9YV");var n=s(a("wCAj"));a("14J3");var i=s(a("BMrR"));a("jCWc");var d=s(a("kPKH"));a("5NDa");var o=s(a("5rEg"));a("+L6B");var c=s(a("2/Rp"));a("/xke");var u=s(a("TeRw")),m=s(a("p0pE"));a("y8nQ");var h,p,f,g=s(a("Vl3Y")),b=a("MuoO"),E=a("7DNP"),M=s(a("wd/R")),_=r(a("q1tI")),v=s(a("q76B")),U=s(a("L24g")),y=s(a("TWBS")),C=s(a("XZXw")),w=s(a("AklW")),S=s(a("+iC2")),I=a("LLXN"),k=g.default.Item,x=(h=(0,b.connect)(e=>{var t=e.user,a=e.list,s=e.loading,r=e.global,l=e.index;return{user:t.currentUser,list:a,loading:s.models.list,rainbondInfo:r.rainbondInfo,enterprise:r.enterprise,isRegist:r.isRegist,oauthLongin:s.effects["global/creatOauth"],overviewInfo:l.overviewInfo}}),h((f=class extends _.PureComponent{constructor(e){super(e),this.onPageChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.loadUser()})}),this.handleUser=(e=>{this.setState({Loading:!0});var t=this.props,a=t.dispatch,s=t.match.params.eid,r=this.state.userInfo,l=e,n="global/creatUser",i=(0,I.formatMessage)({id:"notification.success.add_success"});r&&(l=Object.assign({},r,l),n="global/upEnterpriseUsers",i=(0,I.formatMessage)({id:"notification.success.edit"})),a({type:n,payload:(0,m.default)({enterprise_id:s},l),callback:e=>{e&&200===e._condition&&(this.canceUser(),this.loadUser(),u.default.success({message:i})),this.handleCloseLoading()},handleError:e=>{e&&e.data&&e.data.code&&e.data.code<600&&e.data.msg_show?u.default.warning({message:e.data.msg_show}):w.default.handleCloudAPIError(e),this.handleCloseLoading()}})}),this.handleCloseLoading=(()=>{this.setState({Loading:!1})}),this.handleDelete=(()=>{var e=this.state.userInfo,t=this.props,a=t.dispatch,s=t.match.params.eid;a({type:"global/deleteEnterpriseUsers",payload:{user_id:e.user_id,enterprise_id:s},callback:e=>{e&&200===e._condition&&(this.loadUser(),this.cancelDelUser(),u.default.success({message:(0,I.formatMessage)({id:"notification.success.delete"})}))}})}),this.loadUser=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid,s=this.state,r=s.page,l=s.pageSize,n=s.name;t({type:"global/fetchEnterpriseUsers",payload:{enterprise_id:a,page:r,page_size:l,name:n},callback:e=>{e&&this.setState({adminList:e.list,total:e.total})}})}),this.addUser=(()=>{this.setState({userVisible:!0,text:(0,I.formatMessage)({id:"enterpriseUser.button.adduser"})})}),this.canceUser=(()=>{this.setState({userVisible:!1,text:"",userInfo:!1,Loading:!1})}),this.handleEdit=(e=>{this.setState({userInfo:e,userVisible:!0,text:(0,I.formatMessage)({id:"enterpriseUser.button.edituser"})})}),this.delUser=(e=>{this.setState({delVisible:!0,userInfo:e})}),this.cancelDelUser=(()=>{this.setState({delVisible:!1,userInfo:!1})}),this.handleSearch=(()=>{this.setState({page:1},()=>{this.loadUser()})}),this.handelChange=(e=>{this.setState({name:e&&e.trim()})}),this.handleCurrentUserId=(e=>{this.setState({currentUserInfo:e})});var t=this.props.user,a=S.default.isCompanyAdmin(t);this.state={page:1,pageSize:10,adminer:a,adminList:[],total:0,currentUserInfo:!1,userVisible:!1,userInfo:!1,text:"",delVisible:!1,name:"",Loading:!1}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(E.routerRedux.push("/"))}componentDidMount(){this.loadUser()}render(){var e=this.state,t=e.adminList,a=e.adminer,s=e.text,r=e.userInfo,u=e.delVisible,m=e.userVisible,h=e.page,p=e.pageSize,f=e.total,b=e.Loading,E=e.currentUserInfo,w=this.props.match.params.eid,S=[{title:(0,I.formatMessage)({id:"enterpriseUser.table.userName"}),dataIndex:"nick_name",rowKey:"nick_name",align:"center",render:(e,t)=>_.default.createElement(c.default,{type:"link",onClick:()=>{this.handleCurrentUserId(t)}},e)},{title:(0,I.formatMessage)({id:"enterpriseUser.table.name"}),dataIndex:"real_name",rowKey:"real_name",align:"center"},{title:(0,I.formatMessage)({id:"enterpriseUser.table.phone"}),dataIndex:"phone",rowKey:"phone",align:"center"},{title:(0,I.formatMessage)({id:"enterpriseUser.table.email"}),dataIndex:"email",rowKey:"email",align:"center"},{title:(0,I.formatMessage)({id:"enterpriseUser.table.time"}),dataIndex:"create_time",rowKey:"create_time",align:"center",render:e=>{return _.default.createElement("span",null,(0,M.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:(0,I.formatMessage)({id:"enterpriseUser.table.handle"}),dataIndex:"user_id",align:"center",rowKey:"user_id",render:(e,t)=>{return[_.default.createElement("a",{onClick:()=>{this.delUser(t)}},_.default.createElement(I.FormattedMessage,{id:"button.delete"})),_.default.createElement("a",{onClick:()=>{this.handleEdit(t)}},_.default.createElement(I.FormattedMessage,{id:"button.edit"}))]}}];return _.default.createElement(C.default,{title:_.default.createElement(I.FormattedMessage,{id:"enterpriseUser.PageHeaderLayout.title"}),content:_.default.createElement(I.FormattedMessage,{id:"enterpriseUser.PageHeaderLayout.content"})},_.default.createElement(i.default,{style:{marginBottom:"20px",display:"flex",alignItems:"center"}},_.default.createElement(d.default,{span:12},_.default.createElement(g.default,{layout:"inline",style:{display:"inline-block"}},_.default.createElement(k,null,_.default.createElement(o.default,{placeholder:(0,I.formatMessage)({id:"placeholder.searchUser.user"}),onChange:e=>this.handelChange(e.target.value),onPressEnter:this.handleSearch,style:{width:250}})),_.default.createElement(k,null,_.default.createElement(c.default,{type:"primary",onClick:this.handleSearch,icon:"search"},_.default.createElement(I.FormattedMessage,{id:"button.search"}))))),_.default.createElement(d.default,{span:12,style:{textAlign:"right"}},a&&_.default.createElement(c.default,{type:"primary",icon:"plus",style:{float:"right"},onClick:this.addUser},_.default.createElement(I.FormattedMessage,{id:"enterpriseUser.button.adduser"})))),_.default.createElement(l.default,null,u&&_.default.createElement(v.default,{onOk:this.handleDelete,title:(0,I.formatMessage)({id:"confirmModal.user.delete.title"}),subDesc:(0,I.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),desc:(0,I.formatMessage)({id:"confirmModal.delete.user.desc"}),onCancel:this.cancelDelUser}),m&&_.default.createElement(U.default,{eid:w,loading:b,userInfo:r,title:s,onOk:this.handleUser,onCancel:this.canceUser}),E&&_.default.createElement(y.default,{eid:w,userInfo:E,onCancel:()=>{this.handleCurrentUserId(!1)}}),_.default.createElement(n.default,{pagination:{current:h,pageSize:p,total:f,onChange:this.onPageChange},dataSource:t,columns:S})))}},p=f))||p);t.default=x}}]);