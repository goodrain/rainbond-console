(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[65],{"4fJY":function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("T2oS");var i=s(a("W9HT"));a("+L6B");var n,o,p,c=s(a("2/Rp")),h=a("MuoO"),m=a("7DNP"),u=r(a("q1tI")),d=a("LLXN"),l=s(a("P91h")),g=s(a("01Mf")),f=s(a("8Gb5")),y=s(a("kNHq")),w=s(a("W6Xd")),b=s(a("XZXw")),v=s(a("2lxJ")),P=a("vSx2"),G=s(a("QDog")),I=s(a("9Qkj")),S=(n=(0,h.connect)(e=>{var t=e.teamControl,a=e.enterprise,s=e.user;return{currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:a.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo,currUser:s.currentUser}}),n((p=class extends u.PureComponent{constructor(e){var t;super(e),t=this,this.fetchPipePipeline=(e=>{var t=this.props,a=t.dispatch,s=t.currUser;a({type:"teamControl/fetchPluginUrl",payload:{enterprise_id:s.enterprise_id,region_name:G.default.getCurrRegionName()},callback:e=>{this.setState({gatewayLoading:!0}),e&&e.list&&e.list.map(e=>{"rainbond-gateway-base"==e.name?this.setState({gatewayShow:!0,gatewayLoading:!0}):this.setState({gatewayLoading:!0})})},handleError:e=>{this.setState({gatewayLoading:!0})}})}),this.handleBatchGateWay=(()=>{var e=this.props,t=e.dispatch,a=e.currUser,s=G.default.getCurrRegionName();t({type:"gateWay/getBatchGateWay",payload:{enterprise_id:a.enterprise_id,region_name:s},callback:e=>{this.setState({batchGatewayLoading:!0}),e&&e.list&&(e.list.length>0?this.setState({batchGateway:!0,batchGatewayLoading:!0}):this.setState({batchGatewayLoading:!0}))},handleError:e=>{this.setState({batchGatewayLoading:!0})}})}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.handlePermissions=(e=>{var t=this.props.currentTeamPermissionsInfo;return I.default.querySpecifiedPermissionsInfo(t,e)}),this.fetchAppDetail=(()=>{var e=this.props,t=e.dispatch,a=e.match,s=a.params,r=s.teamName,i=s.regionName,n=s.appID;t({type:"application/fetchGroupDetail",payload:{team_name:r,region_name:i,group_id:n},callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean})},handleError:e=>{e&&404===e.code&&this.props.dispatch(m.routerRedux.push("/team/".concat(G.default.getCurrTeamName(),"/region/").concat(G.default.getCurrRegionName(),"/index")))}})}),this.handleTabChange=function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=t.state,r=s.batchGateway,i=s.gatewayShow;r&&i?t.setState({tabKeys:e,open:a}):t.setState({tabKey:e,open:a})},this.renderContent=(()=>{var e=this.props.match.params.appID,t=this.state,a=t.open,s=t.tabKey,r=(t.operationPermissions,t.tabKeys),i=t.batchGateway,n=t.gatewayShow,o=t.routePermission,p=t.argetServicesPermission,c=t.certificatePermission;return i&&n?"default"===r?u.default.createElement(l.default,{open:a,tabKey:s,appID:e}):u.default.createElement(g.default,{appID:e}):"certificate"===s?u.default.createElement(f.default,{open:a,appID:e,permission:c}):"route"===s?u.default.createElement(y.default,{open:a,onTabChange:this.handleTabChange,appID:e,permission:o}):"service"===s?u.default.createElement(w.default,{open:a,appID:e,permission:p}):void 0}),this.handleTabList=(e=>{var t=this.state,a=t.routePermission,s=t.argetServicesPermission,r=t.certificatePermission,i=[];return a.isAccess&&i.push({key:"route",tab:(0,d.formatMessage)({id:"teamNewGateway.NewGateway.index.management"})}),s.isAccess&&i.push({key:"service",tab:(0,d.formatMessage)({id:"teamNewGateway.NewGateway.index.Services"})}),r.isAccess&&i.push({key:"certificate",tab:(0,d.formatMessage)({id:"teamNewGateway.NewGateway.index.certificate"})}),e?[{key:"default",tab:(0,d.formatMessage)({id:"teamGateway.control.table.default"})},{key:"GatewayApi",tab:(0,d.formatMessage)({id:"teamGateway.control.table.GatewayApi"})}]:i}),this.state={appDetail:{},tabKey:"route",open:!!(this.props.match&&this.props.match.params&&this.props.match.params.types&&this.props.match.params.types)&&this.props.match.params.types,tabKeys:"default",gatewayShow:!1,batchGateway:!1,batchGatewayLoading:!1,gatewayLoading:!1,routePermission:I.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_route_manage","app_".concat(this.getGroupId())),argetServicesPermission:I.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_target_services","app_".concat(this.getGroupId())),certificatePermission:I.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_certificate","app_".concat(this.getGroupId()))}}componentWillMount(){this.fetchPipePipeline(),this.handleBatchGateWay();var e=this.state,t=e.routePermission,a=e.argetServicesPermission,s=e.certificatePermission;this.setState({tabKey:t.isAccess?"route":a.isAccess?"service":s.isAccess?"certificate":"route"})}componentDidMount(){this.fetchAppDetail()}render(){var e=this.props,t=e.currentTeam,a=e.currentEnterprise,s=e.currentRegionName,r=this.state,n=r.appDetail,o=r.batchGateway,p=r.gatewayShow,h=r.gatewayLoading,l=r.batchGatewayLoading,g=[];g=(0,P.createApp)((0,P.createTeam)((0,P.createEnterprise)(g,a),t,s),t,s,{appName:n.group_name,appID:n.group_id});var f=o&&p;return u.default.createElement(u.default.Fragment,null,h&&l?u.default.createElement(b.default,{breadcrumbList:g,title:(0,d.formatMessage)({id:"appGateway.title"}),content:(0,d.formatMessage)({id:"appGateway.desc"}),titleSvg:v.default.getSvg("gatewaySvg",18),tabActiveKey:f?this.state.tabKeys:this.state.tabKey,tabList:this.handleTabList(f),onTabChange:this.handleTabChange,extraContent:u.default.createElement(c.default,{onClick:()=>{var e=this.props.dispatch;e(m.routerRedux.push("/team/".concat(G.default.getCurrTeamName(),"/region/").concat(G.default.getCurrRegionName(),"/apps/").concat(G.default.getAppID(),"/overview")))},icon:"home"},(0,d.formatMessage)({id:"menu.app.dashboard"}))},this.renderContent()):u.default.createElement("div",{style:{width:"calc( 100vw - 68px)",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}},u.default.createElement(i.default,{size:"large"})))}},o=p))||o);t.default=S}}]);