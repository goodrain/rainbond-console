(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[78],{FcSy:function(e,t,a){e.exports={action:"action___3Fw7O",tooltip_style:"tooltip_style___2qLqq",loadingStyle:"loadingStyle___3yZ-k",CardStyle:"CardStyle___1_GJU"}},"Fw1+":function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("bbsP");var n=s(a("/wGt"));a("IzEo");var i=s(a("bx4M"));a("g9YV");var o=s(a("wCAj"));a("T2oS");var r=s(a("W9HT"));a("+L6B");var d=s(a("2/Rp"));a("Q9mQ");var c=s(a("diRs"));a("/xke");var u=s(a("TeRw"));a("y8nQ");var m,g,f,h,p=s(a("Vl3Y")),b=s(a("XZXw")),y=l(a("q1tI")),C=a("MuoO"),S=a("7DNP"),w=a("LLXN"),v=s(a("QDog")),_=s(a("9Qkj")),M=s(a("4sH1")),D=s(a("ZNrE")),P=a("CC/n"),E=s(a("q76B")),R=s(a("2lxJ")),K=s(a("FcSy")),k=(m=(0,C.connect)(e=>{var t=e.teamControl;return{currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}}),g=p.default.create(),m(f=g((h=class extends y.PureComponent{constructor(e){super(e),this.getPageContent=(()=>{var e=v.default.getCurrTeamName(),t=v.default.getAppID();(0,P.getKubernetesVal)({team_name:e,app_id:t}).then(e=>{e&&e.response_data&&200==e.response_data.code&&this.setState({content:e.list,localContent:" ",loadingSwitch:!1})})}),this.onClose=(()=>{this.setState({visible:!1,isSubmit:!0,type:"add"})}),this.handleConfigurationOperation=(()=>{this.setState({visible:!0,title:(0,w.formatMessage)({id:"addKubenetesResource.btn.add"}),type:"add",localContent:!1})}),this.handleSubmit=(()=>{var e=this.props.form;e.validateFields((e,t)=>{var a={yaml:t.yaml},s=this.handYamlValidation(t.yaml);s&&(t.yaml?this.handelAddOrEdit(a):u.default.error({message:(0,w.formatMessage)({id:"notification.hint.resource.msg"})}))})}),this.editButton=((e,t)=>{var a=v.default.getCurrTeamName(),s=v.default.getAppID();(0,P.getSingleKubernetesVal)({team_name:a,app_id:s,list_name:t.name,id:t.ID}).then(a=>{a&&a.response_data&&200==a.response_data.code?this.setState({type:e,visible:!0,editName:t.name,localContent:a.list.content,editId:t.ID,title:(0,w.formatMessage)({id:"addKubenetesResource.table.btn.edit"})}):this.setState({type:e,visible:!0,editName:t.name,localContent:t.content,editId:t.ID,title:(0,w.formatMessage)({id:"addKubenetesResource.table.btn.edit"})})})}),this.editErrButton=((e,t)=>{this.setState({title:"yaml",visible:!0,localContent:t.content,isSubmit:!1})}),this.deleteButton=(e=>{e?(this.setState({showDeletePort:!this.state.showDeletePort}),this.setState({deleteVal:e})):this.setState({showDeletePort:!this.state.showDeletePort})}),this.handleDel=(()=>{var e=this.state.deleteVal,t=v.default.getCurrTeamName(),a=v.default.getAppID();(0,P.delSingleKubernetesVal)({team_name:t,app_id:a,yaml:e.content,list_name:e.name,List_id:e.ID}).then(e=>{e&&e.response_data&&200==e.response_data.code&&(u.default.success({message:(0,w.formatMessage)({id:"notification.success.delete"})}),this.getPageContent())}),this.setState({showDeletePort:!this.state.showDeletePort,visible:!1})}),this.cancalDeletePort=(()=>{this.setState({showDeletePort:!this.state.showDeletePort})}),this.handelAddOrEdit=(e=>{var t=v.default.getCurrTeamName(),a=v.default.getAppID(),s=this.state,l=(s.selectval,s.type),n=s.editId;"add"==l?(0,P.addSingleKubernetesVal)({team_name:t,app_id:a,yaml:e.yaml}).then(e=>{e&&e.response_data&&200==e.response_data.code?(u.default.success({message:(0,w.formatMessage)({id:"notification.success.add"})}),this.getPageContent()):(u.default.error({message:(0,w.formatMessage)({id:"notification.error.add"})}),this.getPageContent())}):"edit"==l&&(0,P.editSingleKubernetesVal)({team_name:t,app_id:a,list_name:this.state.editName,yaml:e.yaml,List_id:n}).then(e=>{e&&e.response_data&&200==e.response_data.code?(u.default.success({message:(0,w.formatMessage)({id:"notification.success.change"})}),this.getPageContent()):(u.default.error({message:(0,w.formatMessage)({id:"notification.error.change"})}),this.getPageContent())}),this.setState({visible:!1})}),this.handYamlValidation=(e=>{try{if(e){var t=M.default.loadAll(e);return t}}catch(e){var a=e.message.indexOf("\n"),s=e.message.substring(0,a);u.default.error({message:s,duration:30,top:10})}}),this.onSelectChange=(e=>{this.setState({selectedRowKeys:e})}),this.batchDeletion=(()=>{var e=this.state.selectedRowKeys,t=this.props.dispatch,a=v.default.getCurrTeamName(),s=v.default.getAppID();this.setState({handelType:"multiple"}),t({type:"application/batchDelSingleKubernetesVal",payload:{List_id:e,team_name:a,app_id:s},callback:e=>{u.default.success({message:(0,w.formatMessage)({id:"notification.success.delete"})}),this.setState({showDeletePort:!this.state.showDeletePort,selectedRowKeys:[]},()=>{this.getPageContent()})},handleError:e=>{u.default.error({message:(0,w.formatMessage)({id:"notification.error.delete"})}),this.setState({showDeletePort:!this.state.showDeletePort,selectedRowKeys:[]},()=>{this.getPageContent()})}})}),this.onPageChange=((e,t)=>{this.setState({page:e,pageSize:t})}),this.state={visible:!1,content:[],localContent:"",type:"add",title:(0,w.formatMessage)({id:"addKubenetesResource.btn.add"}),showDeletePort:!1,deleteVal:{},editName:"",editId:0,isSubmit:!0,loadingSwitch:!0,resourcePermission:_.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_resources","app_".concat(v.default.getAppID())),page:1,pageSize:10,total:0}}componentDidMount(){this.getPageContent()}render(){var e=this.props.form,t=e.getFieldDecorator,a=e.setFieldsValue,s=this.state,l=s.content,u=s.localContent,m=s.title,g=s.isSubmit,f=s.loadingSwitch,h=(s.TooltipValue,s.type,s.selectedRowKeys),C=s.handelType,M=(s.resourcePermission,s.resourcePermission),P=M.isAccess,k=M.isDelete,I=M.isCreate,x=M.isEdit,N=s.page,T=s.pageSize;s.total;if(!P)return _.default.noPermission();var V={pageSize:T,total:l.length,page:N,current:N,onChange:this.onPageChange,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>"\u5171 ".concat(e," \u6761"),onShowSizeChange:this.onPageChange,hideOnSinglePage:l.length<=10},A={selectedRowKeys:h,onChange:this.onSelectChange},F={labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:20},sm:{span:20}}},O={labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},B=[{title:(0,w.formatMessage)({id:"addKubenetesResource.table.name"}),dataIndex:"name",key:"name",align:"center",width:300},{title:(0,w.formatMessage)({id:"addKubenetesResource.table.type"}),dataIndex:"kind",key:"kind",align:"center",width:200},{title:(0,w.formatMessage)({id:"addKubenetesResource.table.status"}),dataIndex:"state",key:"state",align:"center",width:200,render:(e,t)=>{return y.default.createElement("div",null,1==e&&y.default.createElement("span",{style:{color:"green"}},(0,w.formatMessage)({id:"addKubenetesResource.table.success"})),2==e&&y.default.createElement("span",{style:{color:"green"}},(0,w.formatMessage)({id:"addKubenetesResource.table.update_success"})),3==e&&y.default.createElement(y.default.Fragment,null,y.default.createElement("span",{style:{color:"red"}},(0,w.formatMessage)({id:"addKubenetesResource.table.error"})),y.default.createElement(c.default,{overlayClassName:K.default.tooltip_style,placement:"bottom",title:(0,w.formatMessage)({id:"addKubenetesResource.table.errorDetail"}),content:t.error_overview,trigger:"click"},y.default.createElement("span",{style:{marginLeft:"20px",color:"#5672ac",cursor:"pointer"}},(0,w.formatMessage)({id:"addKubenetesResource.table.checkDetail"})))),4==e&&y.default.createElement("div",null,y.default.createElement("span",{style:{color:"red"}},(0,w.formatMessage)({id:"addKubenetesResource.table.update_error"})),y.default.createElement(c.default,{overlayClassName:K.default.tooltip_style,placement:"bottom",title:(0,w.formatMessage)({id:"addKubenetesResource.table.errorDetail"}),content:t.error_overview,trigger:"click"},y.default.createElement("span",{style:{marginLeft:"20px",color:"#5672ac",cursor:"pointer"}},(0,w.formatMessage)({id:"addKubenetesResource.table.checkDetail"})))))}},{title:(0,w.formatMessage)({id:"addKubenetesResource.table.operate"}),dataIndex:"content",key:"content",align:"center",width:200,render:(e,t)=>{return y.default.createElement(y.default.Fragment,null,x&&y.default.createElement(y.default.Fragment,null,3===t.state?y.default.createElement("span",{className:K.default.action,onClick:()=>this.editErrButton("edit",t),style:{marginRight:"10px"}},(0,w.formatMessage)({id:"addKubenetesResource.table.btn.check"})):y.default.createElement("span",{className:K.default.action,onClick:()=>this.editButton("edit",t),style:{marginRight:"10px"}},(0,w.formatMessage)({id:"addKubenetesResource.table.btn.edit"}))),k&&y.default.createElement("span",{className:K.default.action,onClick:()=>{this.setState({handelType:"single"}),this.deleteButton(t)}},(0,w.formatMessage)({id:"addKubenetesResource.table.btn.delete"})))}}];return y.default.createElement(b.default,{title:(0,w.formatMessage)({id:"addKubenetesResource.title"}),content:(0,w.formatMessage)({id:"addKubenetesResource.desc"}),titleSvg:R.default.getPageHeaderSvg("kubenetes",18),extraContent:y.default.createElement(d.default,{onClick:()=>{var e=this.props.dispatch;e(S.routerRedux.push("/team/".concat(v.default.getCurrTeamName(),"/region/").concat(v.default.getCurrRegionName(),"/apps/").concat(v.default.getAppID(),"/overview")))},icon:"home"},(0,w.formatMessage)({id:"menu.app.dashboard"}))},y.default.createElement(i.default,{className:K.default.CardStyle,style:{borderRadius:5},extra:y.default.createElement("div",{style:{width:"100%",display:"flex",justifyContent:k&&h&&h.length>0?"space-between":"end"}},k&&h&&h.length>0&&y.default.createElement(d.default,{type:"primary",onClick:()=>{this.deleteButton(),this.setState({handelType:"multiple"})},icon:"delete"},y.default.createElement(w.FormattedMessage,{id:"componentOverview.body.tab.monitor.CustomMonitor.delete"})),I&&y.default.createElement(d.default,{type:"primary",icon:"plus",onClick:()=>{this.handleConfigurationOperation()}},(0,w.formatMessage)({id:"addKubenetesResource.btn.add"})))},f?y.default.createElement("div",{className:K.default.loadingStyle},y.default.createElement(r.default,{size:"large"})):y.default.createElement(o.default,{dataSource:l,columns:B,rowSelection:A,rowKey:e=>e.ID,pagination:V})),y.default.createElement(n.default,{title:m,placement:"right",width:"400",onClose:this.onClose,visible:this.state.visible},y.default.createElement(p.default,F,y.default.createElement(D.default,{setFieldsValue:a,Form:p.default,style:{marginBottom:"20px"},getFieldDecorator:t,formItemLayout:O,name:"yaml",message:(0,w.formatMessage)({id:"notification.hint.confiuration.editContent"}),data:u||"",mode:"yaml",isAuto:!0})),y.default.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},y.default.createElement(d.default,{onClick:this.onClose,style:{marginRight:8}},(0,w.formatMessage)({id:"button.cancel"})),g&&y.default.createElement(d.default,{onClick:this.handleSubmit,type:"primary"},(0,w.formatMessage)({id:"button.confirm"})))),this.state.showDeletePort&&y.default.createElement(E.default,{title:(0,w.formatMessage)({id:"confirmModal.delete.resource.title"}),desc:(0,w.formatMessage)({id:"confirmModal.delete.resource.desc"}),subDesc:(0,w.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),onOk:"multiple"==C?this.batchDeletion:this.handleDel,onCancel:this.cancalDeletePort}))}},f=h))||f)||f),I=k;t.default=I}}]);