(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[34],{Puuj:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var i=l(a("kLXV"));a("sRBo");var d=l(a("kaz8")),r=l(a("jehZ"));a("5NDa");var n=l(a("5rEg"));a("y8nQ");var p,o,u,c=l(a("Vl3Y")),m=s(a("q1tI")),f=l(a("e6Ls")),h=c.default.Item,g=n.default.TextArea,v=(p=c.default.create(),p((u=class extends m.PureComponent{constructor(e){super(e),this.onChangeCheckbox=(()=>{this.setState({Checkboxvalue:!this.state.Checkboxvalue})}),this.handleSubmit=(e=>{e.preventDefault();var t=this.props.form;t.validateFields({force:!0},(e,t)=>{var a=this.props.onOk;!e&&a&&(t.dev_status=t.dev_status?"release":"",a(t))})}),this.state={Checkboxvalue:!(!e.appInfo||!e.appInfo.dev_status)}}render(){var e=this.props,t=e.onCancel,a=e.form,l=e.appInfo,s=e.loading,p=this.state.Checkboxvalue,o=a.getFieldDecorator,u={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}};return m.default.createElement(i.default,{title:"\u7f16\u8f91\u7248\u672c",visible:!0,onOk:this.handleSubmit,onCancel:t,confirmLoading:s},m.default.createElement(c.default,{onSubmit:this.handleSubmit},m.default.createElement(h,(0,r.default)({},u,{label:"\u7248\u672c\u522b\u540d"}),o("version_alias",{initialValue:l&&l.version_alias||"",rules:[{required:!0,message:"\u8bf7\u586b\u5199\u7248\u672c\u522b\u540d"},{max:32,message:"\u6700\u5927\u957f\u5ea632\u4f4d"}]})(m.default.createElement(n.default,{placeholder:"\u8bf7\u586b\u5199\u7248\u672c\u522b\u540d"}))),m.default.createElement(h,(0,r.default)({},u,{label:"\u72b6\u6001"}),o("dev_status",{initialValue:!(!l||!l.dev_status)||""})(m.default.createElement(d.default,{onChange:this.onChangeCheckbox,checked:p},"Release")),m.default.createElement("div",{className:f.default.conformDesc},"release\u4ee3\u8868\u7248\u672c\u6d4b\u8bd5\u5b8c\u6210\uff0c\u53ef\u4ee5\u8fdb\u884c\u4ea4\u4ed8\u3002")),m.default.createElement(h,(0,r.default)({},u,{label:"\u7248\u672c\u7b80\u4ecb"}),o("app_version_info",{initialValue:l&&l.app_version_info||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u7248\u672c\u7b80\u4ecb"},{max:255,message:"\u6700\u5927\u957f\u5ea6255\u4f4d"}]})(m.default.createElement(g,{placeholder:"\u8bf7\u8f93\u5165\u7248\u672c\u7b80\u4ecb"})))))}},o=u))||o);t.default=v},gdCl:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var i=l(a("wCAj"));a("IzEo");var d=l(a("bx4M"));a("+L6B");var r=l(a("2/Rp"));a("14J3");var n=l(a("BMrR"));a("DZo9");var p=l(a("8z0m"));a("T2oS");var o=l(a("W9HT"));a("/zsF");var u=l(a("PArb"));a("jCWc");var c=l(a("kPKH")),m=l(a("jehZ"));a("Pwec");var f=l(a("CtXQ"));a("/xke");var h=l(a("TeRw")),g=l(a("p0pE"));a("2qtc");var v=l(a("kLXV"));a("5NDa");var E=l(a("5rEg"));a("OaEy");var b=l(a("2fM7"));a("y8nQ");var _=l(a("Vl3Y")),y=l(a("yEr3"));a("Lzxq");var x,A,k,D,C=a("MuoO"),I=a("7DNP"),S=l(a("wd/R")),L=s(a("q1tI")),V=l(a("nyIC")),T=l(a("q76B")),w=l(a("e6Ls")),R=l(a("Puuj")),M=l(a("edcK")),P=l(a("XZXw")),O=l(a("8+Sn")),z=l(a("QDog")),N=l(a("+iC2")),B=l(a("UR3D")),q=_.default.Item,U=b.default.Option,j=E.default.TextArea,H=v.default.confirm,F=(x=(0,C.connect)(e=>{var t=e.user,a=e.application,l=e.enterprise,s=e.teamControl,i=e.loading;return{currUser:t.currentUser,apps:a.apps,currentTeam:s.currentTeam,currentRegionName:s.currentRegionName,currentEnterprise:l.currentEnterprise,groupDetail:a.groupDetail||{},loading:i}}),A=_.default.create(),x(k=A((D=class extends L.PureComponent{constructor(e){super(e),this.onPageChange=(e=>{this.setState({versionPag:e},()=>{this.getAppModelsDetails()})}),this.getLogoBase64=((e,t)=>{var a=new FileReader;a.addEventListener("load",()=>t(a.result)),a.readAsDataURL(e)}),this.getEnterpriseTeams=(e=>{var t=this.props,a=t.dispatch,l=t.match.params.eid,s=this.state,i=s.page,d=s.page_size;a({type:"global/fetchEnterpriseTeams",payload:{name:e,page:i,page_size:d,enterprise_id:l},callback:e=>{if(e&&200===e.status_code&&e.bean&&e.bean.list){var t=e.bean&&e.bean.total_count||0,a=!!(t&&t>d);this.setState({teamList:e.bean.list,isAddLicense:a,enterpriseTeamsLoading:!1})}}})}),this.getTags=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/fetchAppModelsTags",payload:{enterprise_id:a},callback:e=>{e&&200===e.status_code&&this.setState({tagList:e.list})}})}),this.getAppModelsDetails=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,s=a.appId,i=e.form,d=this.state,r=d.versionPag,n=d.versionPageSize,p=d.total;t({type:"market/fetchAppModelsDetails",payload:{enterprise_id:l,appId:s,page:r,page_size:n,total:p},callback:e=>{if(e&&200===e.status_code){var t=e.bean&&e.bean.details,a=i.getFieldValue("details");a&&i.setFieldsValue({details:y.default.createEditorState(t)}),this.setState({imageUrl:e.bean.pic,appInfo:e.bean,appList:e.list,total:e.total})}}})}),this.upDataAppVersionInfo=(e=>{var t=this.props,a=t.dispatch,l=t.match.params,s=l.eid,i=l.appId,d=this.state.editAppVersion;a({type:"market/upDataAppVersionInfo",payload:(0,g.default)({enterprise_id:s,appId:i,version:d.version},e),callback:e=>{e&&200===e.status_code&&(this.handleCloseEditAppVersion(),this.getAppModelsDetails(),h.default.success({message:"\u7f16\u8f91\u6210\u529f"}))}})}),this.handleRelease=(e=>{var t=this.props,a=t.dispatch,l=t.match.params,s=l.eid,i=l.appId;Object.assign(e,{dev_status:e.dev_status?"":"release"});a({type:"market/upDataAppVersionInfo",payload:(0,g.default)({enterprise_id:s,appId:i},e),callback:e=>{e&&200===e.status_code&&(this.handleCloseEditAppVersion(),this.getAppModelsDetails())}})}),this.handleLogoChange=(e=>{"uploading"!==e.file.status?"done"===e.file.status&&(this.setState({imageUrl:e.file&&e.file.response&&e.file.response.data&&e.file.response.data.bean&&e.file.response.data.bean.file_url,loading:!1}),this.getLogoBase64(e.file.originFileObj,e=>this.setState({imageBase64:e}))):this.setState({loading:!0})}),this.handleLogoRemove=(()=>{this.setState({imageUrl:"",imageBase64:""})}),this.handleToDelete=(e=>{this.setState({toDelete:e})}),this.handleCancelDelete=(()=>{this.setState({toDelete:!1})}),this.handleCloseEditAppVersion=(()=>{this.setState({editAppVersion:!1})}),this.handleEditAppVersionInfo=(e=>{this.setState({editAppVersion:e})}),this.handleDeleteVersion=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,s=a.appId,i=this.state.toDelete;t({type:"market/deleteAppVersion",payload:{enterprise_id:l,appId:s,version:i.version},callback:e=>{e&&200===e.status_code&&(h.default.success({message:"\u5220\u9664\u6210\u529f"}),this.handleCancelDelete(),this.getAppModelsDetails())}})}),this.addTeams=(()=>{this.setState({enterpriseTeamsLoading:!0,page_size:this.state.page_size+10},()=>{this.getEnterpriseTeams()})}),this.upAppModel=((e,t,a)=>{var l=this.props,s=l.dispatch,i=l.match.params,d=i.eid,r=i.appId,n=l.form,p=this.state,o=p.imageUrl,u=p.tagList,c=p.isEdit,m=p.isAppDetails;n.validateFields((l,i)=>{if(!l){var n=[];i.tag_ids&&i.tag_ids.length>0&&u&&u.length>0&&i.tag_ids.map(e=>{u.map(t=>{e===t.name&&n.push(parseFloat(t.tag_id))})});var p={enterprise_id:d,name:e?e.app_name:i.name,pic:o,tag_ids:t||n,app_id:r,describe:e?e.describe:i.describe,details:a||i.details&&i.details.toHTML(),scope:e?e.scope:i.scope};"enterprise"!==p.scope&&(p.create_team=p.scope,p.scope="team"),s({type:"market/upAppModel",payload:p,callback:t=>{t&&200===t.status_code&&(h.default.success({message:"\u4fdd\u5b58\u6210\u529f"}),e?this.handleAppDetails(!m):this.handleIsEdit(!c),this.getAppModelsDetails())}})}})}),this.handleIsEdit=(e=>{this.setState({isEdit:e})}),this.handleAppDetails=(e=>{var t=this.state.appInfo,a=this.props.form,l=t&&t.details;this.setState({isAppDetails:e},()=>{e&&a.setFieldsValue({details:y.default.createEditorState(l)})})}),this.handleCancel=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t(I.routerRedux.push("/enterprise/".concat(a,"/shared/local")))}),this.handleIsRelease=(e=>{var t=this;H({title:e.dev_status?"\u786e\u5b9a\u53d6\u6d88Release\u72b6\u6001?":"\u786e\u5b9a\u8bbe\u4e3aRelease\u72b6\u6001?",content:"",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk(){t.handleRelease(e)}})}),this.handleOnSelect=(e=>{var t=this.state.tagList;if(e&&t.length>0){var a=!0;t.map(t=>{t.name===e&&(a=!1)}),a&&this.createTag(e)}else t&&0===t.length&&this.createTag(e)}),this.createTag=(e=>{var t=this.props,a=t.dispatch,l=t.match.params.eid;a({type:"market/createTag",payload:{enterprise_id:l,name:e},callback:e=>{e&&200===e.status_code&&this.getTags()}})});var t=this.props.currUser,a=N.default.isPermissions(t,"app_store");this.state={appStoreAdmin:a,appInfo:{},isShared:window.location.href.indexOf("shared")>-1,isAddLicense:!1,tagList:[],teamList:[],imageUrl:"",enterpriseTeamsLoading:!0,imageBase64:"",page:1,page_size:10,appList:[],versionPag:1,versionPageSize:10,total:0,toDelete:!1,editAppVersion:!1,isEdit:!1,isAppDetails:!1}}componentWillMount(){this.getTags(),this.getEnterpriseTeams(),this.getAppModelsDetails()}render(){var e=this.props,t=e.loading,a=e.form,l=this.state,s=l.appInfo,h=l.isAddLicense,g=l.tagList,v=l.imageUrl,x=l.enterpriseTeamsLoading,A=l.teamList,k=l.imageBase64,D=l.appList,C=l.toDelete,I=l.editAppVersion,N=l.isEdit,H=l.isAppDetails,F=l.versionPag,Y=l.versionPageSize,X=l.total,W=l.appStoreAdmin,G=W.isEditApp,J=W.isEditVersionApp,Q=W.isDeleteAppVersion,Z=a.getFieldDecorator,K={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19}}},$=O.default.get("token"),ee=["bold","italic","underline","text-color","separator","link","separator"],te={},ae=[],le=[];s&&s.tags&&s.tags.length>0&&g&&g.length>0&&s.tags.map(e=>{ae.push(e.name),le.push(e.tag_id)}),$&&(te.Authorization="GRJWT ".concat($));var se=L.default.createElement("div",null,L.default.createElement(f.default,{type:"plus"}),L.default.createElement("div",{className:"ant-upload-text"},"\u4e0a\u4f20\u56fe\u6807")),ie=z.default.fetchSvg("defaulAppImg");return L.default.createElement("div",null,C&&L.default.createElement(T.default,{title:"\u5220\u9664\u5e94\u7528\u7248\u672c",desc:"\u786e\u5b9a\u8981\u5220\u9664\u5e94\u7528\u7248\u672c?",loading:t.effects["market/deleteAppVersion"],onCancel:this.handleCancelDelete,onOk:this.handleDeleteVersion}),I&&L.default.createElement(R.default,{loading:t.effects["market/upDataAppVersionInfo"],appInfo:I,onOk:this.upDataAppVersionInfo,onCancel:this.handleCloseEditAppVersion}),L.default.createElement(P.default,{title:"\u5e94\u7528\u5e02\u573a\u7ba1\u7406",content:"\u5e94\u7528\u5e02\u573a\u652f\u6301Rainstore\u5e94\u7528\u5546\u5e97\u548cHelm\u5e94\u7528\u5546\u5e97\u7684\u5bf9\u63a5\u548c\u7ba1\u7406"},L.default.createElement(_.default,{onSubmit:this.handleSubmit,layout:"horizontal"},L.default.createElement(d.default,{style:{marginBottom:24},bordered:!1,bodyStyle:{padding:0}},L.default.createElement("div",{style:{padding:"24px"}},L.default.createElement("div",{style:{textAlign:"right",margin:"-14px 0 10px 0"}}),N&&L.default.createElement(n.default,{gutter:24},L.default.createElement(c.default,{span:"12"},L.default.createElement(q,(0,m.default)({},K,{label:"\u540d\u79f0"}),L.default.createElement("div",null,Z("name",{initialValue:s&&s.app_name||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0"},{max:32,message:"\u6700\u5927\u957f\u5ea632\u4f4d"}]})(L.default.createElement(E.default,{placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0"})),L.default.createElement("div",{className:w.default.conformDesc},"\u8bf7\u8f93\u5165\u5e94\u7528\u6a21\u7248\u540d\u79f0\uff0c\u6700\u5927\u957f\u5ea632\u4f4d.")))),L.default.createElement(c.default,{span:"12"},L.default.createElement(q,(0,m.default)({},K,{label:"\u53d1\u5e03\u8303\u56f4"}),Z("scope",{initialValue:s&&s.scope&&"team"===s.scope&&s.create_team||"enterprise",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0"}]})(L.default.createElement(b.default,{getPopupContainer:e=>e.parentNode,placeholder:"\u8bf7\u9009\u62e9\u53d1\u5e03\u8303\u56f4",dropdownRender:e=>L.default.createElement("div",null,e,h&&L.default.createElement("div",null,L.default.createElement(u.default,{style:{margin:"4px 0"}}),x?L.default.createElement(o.default,{size:"small"}):L.default.createElement("div",{style:{padding:"4px 8px",cursor:"pointer"},onMouseDown:e=>e.preventDefault(),onClick:()=>{this.addTeams()}},L.default.createElement(f.default,{type:"plus"})," \u52a0\u8f7d\u66f4\u591a")))},L.default.createElement(U,{value:"enterprise",key:"enterprise"},L.default.createElement("div",{style:{borderBottom:"1px solid #ccc"}},"\u5f53\u524d\u4f01\u4e1a")),A&&A.map(e=>{return L.default.createElement(U,{key:e.team_name,value:e.team_name},e.team_alias)}))),L.default.createElement("div",{className:w.default.conformDesc},"\u53d1\u5e03\u6a21\u578b\u7684\u53ef\u89c6\u8303\u56f4"))),L.default.createElement(c.default,{span:"12"},L.default.createElement(_.default.Item,(0,m.default)({},K,{label:"\u5206\u7c7b\u6807\u7b7e"}),Z("tag_ids",{initialValue:ae,rules:[{required:!1,message:"\u8bf7\u6dfb\u52a0\u6807\u7b7e"}]})(L.default.createElement(b.default,{getPopupContainer:e=>e.parentNode,mode:"tags",style:{width:"100%"},onSelect:this.handleOnSelect,tokenSeparators:[","],placeholder:"\u8bf7\u9009\u62e9\u5206\u7c7b\u6807\u7b7e"},g.map(e=>{var t=e.tag_id,a=e.name;return L.default.createElement(U,{key:t,value:a,label:a},a)}))),L.default.createElement("div",{className:w.default.conformDesc},"\u8bf7\u9009\u62e9\u5206\u7c7b\u6807\u7b7e"))),L.default.createElement(c.default,{span:"12"},L.default.createElement(q,(0,m.default)({},K,{label:"\u7b80\u4ecb"}),Z("describe",{initialValue:s&&s.describe||"",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u7b80\u4ecb"},{max:255,message:"\u6700\u5927\u957f\u5ea6255\u4f4d"}]})(L.default.createElement(j,{placeholder:"\u8bf7\u8f93\u5165\u7b80\u4ecb"})),L.default.createElement("div",{className:w.default.conformDesc},"\u8bf7\u8f93\u5165\u5e94\u7528\u6a21\u7248\u7b80\u4ecb"))),L.default.createElement(c.default,{span:"12"},L.default.createElement(_.default.Item,(0,m.default)({},K,{label:"LOGO"}),Z("pic",{initialValue:s&&s.pic||"",rules:[{required:!1,message:"\u8bf7\u4e0a\u4f20\u56fe\u6807"}]})(L.default.createElement(p.default,{className:"logo-uploader",name:"file",accept:"image/jpg,image/jpeg,image/png",action:V.default.imageUploadUrl,listType:"picture-card",headers:te,showUploadList:!1,onChange:this.handleLogoChange,onRemove:this.handleLogoRemove},v?L.default.createElement("img",{src:k||v,alt:"LOGO",style:{width:"100%"}}):se))))),N&&L.default.createElement("div",{style:{textAlign:"center"}},L.default.createElement(r.default,{type:"primary",htmlType:"submit",loading:!1,disabled:t.effects["market/upAppModel"],style:{marginRight:"20px"},onClick:()=>{this.upAppModel(!1,!1,s&&s.details)}},"\u4fdd\u5b58"),L.default.createElement(r.default,{onClick:()=>{this.handleIsEdit(!N)}},"\u53d6\u6d88")),s&&!N&&L.default.createElement("div",{className:B.default.appBoxs},L.default.createElement("div",null,L.default.createElement(f.default,{type:"arrow-left",onClick:this.handleCancel})),L.default.createElement("div",null,k||v?L.default.createElement("img",{src:k||v,alt:"LOGO",style:{margin:"0 auto",maxWidth:"60px",maxHeight:"60px"}}):s&&s.app_name&&L.default.createElement("div",{style:{margin:"0 auto",maxWidth:"60px",maxHeight:"60px"}},ie)),L.default.createElement("div",null,L.default.createElement("h3",{title:s.app_name},s.app_name),L.default.createElement("div",null,s.describe)),L.default.createElement("div",null,ae.map(e=>{return L.default.createElement("div",{className:B.default.appVersion},e)})),!N&&G&&L.default.createElement("a",{onClick:()=>{this.handleIsEdit(!N)}},"\u7f16\u8f91")))),L.default.createElement(d.default,{style:{marginBottom:24},title:"\u7248\u672c\u7ba1\u7406",bordered:!1,bodyStyle:{padding:0}},L.default.createElement("div",{style:{padding:"24px"}},L.default.createElement(i.default,{dataSource:D,scroll:{x:1200},style:{width:"100%",overflowX:"auto"},columns:[{title:"\u7248\u672c\u53f7",dataIndex:"version",width:220,fixed:"left",render:(e,t)=>{return L.default.createElement("span",null,e,"(",t.version_alias,")")}},{title:"\u72b6\u6001",dataIndex:"dev_status",align:"center",width:100,fixed:"left",render:e=>{return L.default.createElement("div",null,e?L.default.createElement("span",{className:B.default.devStatus},"Release"):"-")}},{title:"\u53d1\u5e03\u4eba",dataIndex:"share_user",align:"center",width:150},{title:"\u7248\u672c\u7b80\u4ecb",dataIndex:"app_version_info"},{title:"\u53d1\u5e03\u65f6\u95f4",dataIndex:"create_time",width:190,align:"center",render:e=>{return L.default.createElement("span",null,(0,S.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"update_time",width:190,align:"center",render:e=>{return L.default.createElement("span",null,(0,S.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u64cd\u4f5c",dataIndex:"action",width:230,fixed:"right",align:"center",render:(e,t)=>L.default.createElement("div",null,L.default.createElement("div",null,J&&L.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.handleEditAppVersionInfo(t)}},"\u7f16\u8f91"),J&&L.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.handleIsRelease(t)}},t.dev_status?"\u53d6\u6d88Release\u72b6\u6001":"\u8bbe\u4e3aRelease\u72b6\u6001"),Q&&L.default.createElement("a",{onClick:()=>{this.handleToDelete(t)}},"\u5220\u9664")))}],pagination:{current:F,pageSize:Y,total:X,onChange:this.onPageChange}}))),L.default.createElement(d.default,{style:{marginBottom:24},title:"\u8be6\u60c5\u4ecb\u7ecd",bordered:!1,extra:L.default.createElement("div",null,!H&&G&&L.default.createElement("a",{onClick:()=>this.handleAppDetails(!H)},"\u7f16\u8f91")),bodyStyle:{padding:0}},L.default.createElement("div",{style:{padding:"36px"}},L.default.createElement(n.default,{gutter:24},H?L.default.createElement(q,{labelCol:{span:0},wrapperCol:{span:24},label:""},Z("details",{validateTrigger:"onBlur",rules:[{required:!0,validator:(e,t,a)=>{t.isEmpty()?a("\u8bf7\u8f93\u5165\u8be6\u60c5"):a()}}]})(L.default.createElement(y.default,{className:"my-editor",controls:ee,placeholder:"\u8bf7\u8f93\u5165\u8be6\u60c5"}))):L.default.createElement("div",{className:M.default.markdown,style:{minHeight:"490px"},dangerouslySetInnerHTML:{__html:s&&s.details}}),H&&L.default.createElement("div",{style:{textAlign:"center"}},L.default.createElement(r.default,{type:"primary",htmlType:"submit",loading:!1,disabled:t.effects["market/upAppModel"],style:{marginRight:"20px"},onClick:()=>{this.upAppModel(s,le)}},"\u4fdd\u5b58"),L.default.createElement(r.default,{onClick:()=>{this.handleAppDetails(!H)}},"\u53d6\u6d88"))))))))}},k=D))||k)||k);t.default=F}}]);