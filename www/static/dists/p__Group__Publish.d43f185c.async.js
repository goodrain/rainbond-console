(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[68],{Kq3J:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=s(a("bx4M"));a("g9YV");var l=s(a("wCAj"));a("P2fV");var o=s(a("NJEC"));a("Q9mQ");var n=s(a("diRs"));a("+L6B");var p=s(a("2/Rp"));a("5Dmo");var d=s(a("3S7+"));a("/xke");var c,u,h,m=s(a("TeRw")),g=a("MuoO"),f=a("7DNP"),b=s(a("wd/R")),v=r(a("q1tI")),P=a("LLXN"),S=s(a("puxM")),_=s(a("nvum")),E=s(a("XZXw")),M=s(a("Qwvg")),x=s(a("/VoG")),y=a("vSx2"),k=s(a("QDog")),C=s(a("9Qkj")),w=s(a("2lxJ")),N=s(a("v10I")),L=s(a("8+Sn")),D=a("34ay"),R=s(a("TNXg")),I=(c=(0,g.connect)(e=>{var t=e.list,a=e.loading,s=e.teamControl,r=e.enterprise,i=e.rbdPlugin,l=e.user;return{list:t,loading:a.models.list,currentTeam:s.currentTeam,currentRegionName:s.currentRegionName,currentEnterprise:r.currentEnterprise,currentTeamPermissionsInfo:s.currentTeamPermissionsInfo,pluginList:i.pluginList,currentUser:l.currentUser}}),c((h=class extends v.PureComponent{constructor(e){var t;super(e),this.onPublishStore=(()=>{this.getStoreList()}),this.onPublishLocal=(()=>{this.handleShare("",{})}),this.getStoreList=(()=>{this.setState({loading:!0});var e=this.props,t=e.dispatch,a=e.currentEnterprise;t({type:"enterprise/fetchEnterpriseStoreList",payload:{enterprise_id:a.enterprise_id},callback:e=>{if(e){var t=e.list,a=void 0===t?[]:t,s=[];a.length>0&&a[0].access_key?(s=a.filter(e=>1===e.status&&(0,D.fetchMarketAuthority)(e,"Write")),this.setState({selectStoreShow:!0,isAuthCompany:!1})):this.setState({storeName:a[0].name,isAuthCompany:!0}),this.setState({storeList:s,loading:!1})}else this.setState({loading:!1})}})}),this.onPageChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.fetchPublishRecoder()})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,s=t.regionName,r=t.appID;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:s,group_id:r},callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1})},handleError:e=>{e&&404===e.code&&this.props.dispatch(f.routerRedux.push("/team/".concat(k.default.getCurrTeamName(),"/region/").concat(k.default.getCurrRegionName(),"/index")))}})}),this.fetchPublishRecoder=(()=>{this.setState({loading:!0});var e=this.props.match.params,t=e.teamName,a=e.appID,s=this.props.dispatch,r=this.state,i=r.page,l=r.pageSize;s({type:"application/fetchShareRecords",payload:{team_name:t,app_id:a,page:i,page_size:l},callback:e=>{e&&this.setState({recoders:e.list,total:e.bean.total,loading:!1})}})}),this.handleShare=((e,t)=>{var a=this.props.match.params,s=a.teamName,r=a.appID,i=this.props.dispatch;i({type:"application/ShareGroup",payload:{team_name:s,group_id:r,scope:e,target:t},callback:e=>{this.continuePublish(e.bean.ID,e.bean.step)}})}),this.hideSelectStoreShow=(()=>{this.setState({selectStoreShow:!1})}),this.handleStoreLoading=(e=>{this.setState({storeLoading:e})}),this.handleSelectStore=(e=>{this.handleStoreLoading(!0);var t=e.store_id;this.handleShare("goodrain",{store_id:t})}),this.deleteRecord=(e=>{var t=this.props.match.params,a=t.teamName,s=t.appID,r=this.props.dispatch;r({type:"application/deleteShareRecord",payload:{team_name:a,app_id:s,record_id:e},callback:()=>{this.fetchPublishRecoder()}})}),this.cancelPublish=(e=>{if(void 0!==e&&""!==e){var t=this.props.match.params.teamName,a=this.props.dispatch;a({type:"application/giveupShare",payload:{team_name:t,share_id:e},callback:()=>{this.fetchPublishRecoder()}})}else m.default.warning({message:(0,P.formatMessage)({id:"notification.warn.parameter_error"})})}),this.continuePublish=((e,t)=>{var a=this.props.dispatch,s=this.props.match.params,r=s.teamName,i=s.regionName,l=s.appID;1===t&&a(f.routerRedux.push("/team/".concat(r,"/region/").concat(i,"/apps/").concat(l,"/share/").concat(e,"/one"))),2===t&&a(f.routerRedux.push("/team/".concat(r,"/region/").concat(i,"/apps/").concat(l,"/share/").concat(e,"/two"))),this.handleStoreLoading(!1)}),this.handleBox=(e=>{return v.default.createElement("div",{className:R.default.version},v.default.createElement(d.default,{placement:"topLeft",title:e},e))}),this.setIsExporting=(e=>{this.setState({is_exporting:e})}),this.hideAppExport=(()=>{this.setState({showExporterApp:!1})}),this.showAppExport=(e=>{Array.isArray(e.version)||(e.version=Array.of(e.version)),e.app_id=e.app_model_id,this.setState({showExporterApp:!0,appData:e})}),this.state={loading:!0,appDetail:{},page:1,pageSize:10,total:0,storeLoading:!1,selectStoreShow:!1,language:"zh-CN"===L.default.get("language"),showExporterApp:!1,is_exporting:!1,appData:null,publishPermission:C.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_release","app_".concat(k.default.getAppID())),showPublish:N.default.isInstallPlugin(null===(t=this.props)||void 0===t?void 0:t.pluginList,"rainbond-bill"),storeList:[],publishBtn:!1,isAuthCompany:!1}}componentWillMount(){}componentDidMount(){this.fetchAppDetail(),this.fetchPublishRecoder()}render(){var e=[],t=this.state,a=t.appDetail,s=t.loading,r=t.loadingDetail,d=t.page,c=t.pageSize,u=t.total,h=t.selectStoreShow,m=t.recoders,g=t.storeLoading,N=t.language,L=t.showExporterApp,D=t.is_exporting,I=t.appData,A=t.publishPermission,T=A.isAccess,z=A.isShare,O=A.isExport,X=A.isDelete,B=(t.showPublish,t.storeList),q=t.storeName,Q=t.isAuthCompany;if(!T)return C.default.noPermission();var J=this.props,V=(J.currentUser,J.currentEnterprise),Y=J.currentTeam,j=J.currentRegionName,H=J.dispatch,U=J.match.params,G=U.teamName,W=U.regionName;return e=(0,y.createApp)((0,y.createTeam)((0,y.createEnterprise)(e,V),Y,j),Y,j,{appName:a.group_name,appID:a.group_id}),v.default.createElement(E.default,{breadcrumbList:e,loading:r,title:(0,P.formatMessage)({id:"appPublish.title"}),content:(0,P.formatMessage)({id:"appPublish.desc"}),titleSvg:w.default.getPageHeaderSvg("publish",18),extraContent:v.default.createElement(p.default,{onClick:()=>{var e=this.props.dispatch;e(f.routerRedux.push("/team/".concat(k.default.getCurrTeamName(),"/region/").concat(k.default.getCurrRegionName(),"/apps/").concat(k.default.getAppID(),"/overview")))},icon:"home"},(0,P.formatMessage)({id:"menu.app.dashboard"}))},v.default.createElement(i.default,{loading:s,extra:z&&v.default.createElement("div",{style:N?{}:{display:"flex"}},v.default.createElement(p.default,{style:N?{marginRight:8}:{marginRight:8,padding:5},onClick:this.onPublishLocal,icon:"appstore"},(0,P.formatMessage)({id:"appPublish.btn.local"})),v.default.createElement(p.default,{onClick:this.onPublishStore,style:N?{marginRight:8}:{marginRight:8,padding:5},icon:"cloud-upload",type:"primary"},(0,P.formatMessage)({id:"appPublish.btn.market"}))),style:{borderRadius:5}},v.default.createElement(S.default,{sm:800},v.default.createElement(l.default,{rowKey:(e,t)=>t,pagination:{current:d,pageSize:c,total:u,onChange:this.onPageChange,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>"\u5171 ".concat(e," \u6761"),onShowSizeChange:this.onPageChange,hideOnSinglePage:u<=10},dataSource:m||[],columns:[{title:(0,P.formatMessage)({id:"appPublish.table.publishName"}),dataIndex:"app_model_name",render:(e,t)=>{return e||v.default.createElement("span",{style:{color:k.default.getPublicColor("rbd-content-color")}},0===t.status?(0,P.formatMessage)({id:"appPublish.table.versions.notSpecified"}):"-")}},{title:(0,P.formatMessage)({id:"appPublish.table.versions"}),dataIndex:"version",align:"left",render:(e,t)=>{var a=t.version_alias&&"(".concat(t.version_alias,")")||"";if(e){var s=t.app_version_info;return v.default.createElement(n.default,{style:{marginBottom:0},content:s?this.handleBox(s):(0,P.formatMessage)({id:"appPublish.table.versions.null"}),title:this.handleBox("".concat(e).concat(a))},v.default.createElement("div",{className:R.default.version},e,a))}return v.default.createElement("span",{style:{color:k.default.getPublicColor("rbd-content-color")}},(0,P.formatMessage)({id:"appPublish.table.versions.notSpecified"}))}},{title:(0,P.formatMessage)({id:"appPublish.table.scope"}),dataIndex:"scope",align:"center",render:(e,t)=>{var a=this.props.currentUser,s=a.is_enterprise_admin,r=t&&t.scope_target&&t.scope_target.store_name,i="/enterprise/".concat(V.enterprise_id,"/shared/local");switch(e){case"":return s?v.default.createElement(f.Link,{to:i},(0,P.formatMessage)({id:"appPublish.table.scope.market"})):v.default.createElement("span",null,(0,P.formatMessage)({id:"appPublish.table.scope.market"}));case"team":return s?v.default.createElement(f.Link,{to:i},(0,P.formatMessage)({id:"appPublish.table.scope.team_market"})):v.default.createElement("span",null,(0,P.formatMessage)({id:"appPublish.table.scope.team_market"}));case"enterprise":return s?v.default.createElement(f.Link,{to:i},(0,P.formatMessage)({id:"appPublish.table.scope.enterprise_market"})):v.default.createElement("span",null,(0,P.formatMessage)({id:"appPublish.table.scope.enterprise_market"}));default:return v.default.createElement("p",{style:{marginBottom:0}},r||(0,P.formatMessage)({id:"appPublish.table.scope.app_shop"}))}}},{title:(0,P.formatMessage)({id:"appPublish.table.publishTime"}),align:"center",dataIndex:"create_time",render:e=>v.default.createElement("span",null,(0,b.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:(0,P.formatMessage)({id:"appPublish.table.status"}),align:"center",dataIndex:"status",render:e=>{switch(e){case 0:return(0,P.formatMessage)({id:"appPublish.table.status.release"});case 1:return v.default.createElement("span",{style:{color:k.default.getPublicColor("rbd-success-status")}},(0,P.formatMessage)({id:"appPublish.table.status.release_finish"}));case 2:return v.default.createElement("span",{style:{color:k.default.getPublicColor("rbd-content-color")}},(0,P.formatMessage)({id:"appPublish.table.status.canceled"}))}return""}},{title:(0,P.formatMessage)({id:"appPublish.table.operate"}),width:"200px",dataIndex:"dataIndex",render:(e,t)=>{return v.default.createElement("div",null,0===t.status?z&&v.default.createElement("div",null,v.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.continuePublish(t.record_id,t.step)}},(0,P.formatMessage)({id:"appPublish.table.btn.continue"})),X&&v.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.cancelPublish(t.record_id)}},(0,P.formatMessage)({id:"appPublish.table.btn.release_cancel"}))):v.default.createElement("div",null,("team"==t.scope||"enterprise"==t.scope)&&O&&v.default.createElement("a",{onClick:()=>this.showAppExport(t)},(0,P.formatMessage)({id:"applicationMarket.localMarket.export_app"}),D?"".concat((0,P.formatMessage)({id:"applicationMarket.localMarket.in_export"})):""),X&&v.default.createElement(o.default,{title:(0,P.formatMessage)({id:"appPublish.table.btn.confirm_delete"}),onConfirm:()=>{this.deleteRecord(t.record_id)},okText:(0,P.formatMessage)({id:"appPublish.table.btn.confirm"}),cancelText:(0,P.formatMessage)({id:"appPublish.table.btn.cancel"})},v.default.createElement("a",{href:"#"},(0,P.formatMessage)({id:"appPublish.table.btn.delete"})))))}}]}))),L&&v.default.createElement(M.default,{eid:V.enterprise_id,setIsExporting:this.setIsExporting,app:I,onOk:this.hideAppExport,onCancel:this.hideAppExport,team_name:G,regionName:W}),v.default.createElement(_.default,{loading:g,dispatch:H,storeList:B,enterprise_id:V.enterprise_id,visible:h,onCancel:this.hideSelectStoreShow,onOk:this.handleSelectStore}),Q&&v.default.createElement(x.default,{eid:V.enterprise_id,marketName:q,currStep:2,onCancel:()=>{this.setState({isAuthCompany:!1})}}))}},u=h))||u);t.default=I},TNXg:function(e,t,a){e.exports={version:"version___3lOXo"}},nvum:function(e,t,a){"use strict";var s=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var i=s(a("kLXV"));a("T2oS");var l=s(a("W9HT")),o=s(a("jehZ"));a("+L6B");var n=s(a("2/Rp"));a("OaEy");var p=s(a("2fM7"));a("y8nQ");var d,c,u,h=s(a("Vl3Y")),m=r(a("q1tI")),g=a("LLXN"),f=s(a("e6Ls")),b=h.default.Item,v=p.default.Option,P=(d=h.default.create(),d((u=class extends m.PureComponent{constructor(e){super(e),this.handleSubmit=(()=>{var e=this.props,t=e.onOk,a=e.form,s=a.validateFields;s((e,a)=>{!e&&t&&t(a)})}),this.state={loading:!0}}componentDidMount(){}render(){var e=this.props,t=e.onCancel,a=e.visible,s=e.form,r=e.loading,d=void 0!==r&&r,c=e.storeList,u=s.getFieldDecorator,P=this.state.loading,S=c&&c.length>0&&c,_={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}};return m.default.createElement(i.default,{title:(0,g.formatMessage)({id:"appPublish.btn.record.makert.select.title"}),visible:a,className:f.default.TelescopicModal,onOk:this.handleSubmit,onCancel:t,footer:[m.default.createElement(n.default,{onClick:t}," ",(0,g.formatMessage)({id:"popover.cancel"})," "),S&&m.default.createElement(n.default,{type:"primary",onClick:this.handleSubmit,loading:d},(0,g.formatMessage)({id:"popover.confirm"}))]},S?m.default.createElement(h.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},m.default.createElement(b,(0,o.default)({},_,{label:(0,g.formatMessage)({id:"appPublish.btn.record.makert.select.store_id"})}),u("store_id",{initialValue:S[0].name||"",rules:[{required:!0,message:(0,g.formatMessage)({id:"placeholder.appShare.select.shop"})}]})(m.default.createElement(p.default,{getPopupContainer:e=>e.parentNode,placeholder:(0,g.formatMessage)({id:"placeholder.appShare.select.shop"})},S.map(e=>{var t=e.name,a=e.alias;return m.default.createElement(v,{key:"store".concat(t),value:t},a||t)}))),m.default.createElement("div",{className:f.default.conformDesc},(0,g.formatMessage)({id:"appPublish.btn.record.makert.select.store_id.desc"})))):P?m.default.createElement("div",{style:{textAlign:"center",marginBottom:"16px"}},m.default.createElement(l.default,{tip:(0,g.formatMessage)({id:"appPublish.btn.record.makert.select.loading"})})):m.default.createElement("p",{style:{textAlign:"center"}},(0,g.formatMessage)({id:"appPublish.btn.record.makert.select.desc"})))}},c=u))||c),S=P;t.default=S}}]);