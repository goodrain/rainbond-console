(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{"51PC":function(e,t,n){"use strict";var s=n("/POA"),a=n("R9As"),r=n("0fl0"),o=n("QIth");Object.defineProperty(t,"__esModule",{value:!0});var i=n("q1tI"),c=n("TSYQ");class l extends i.Component{constructor(e,t){super(e,t),this.onInput=(e=>{this.props.onInput&&this.props.onInput(e)}),this.state={isFocused:!1}}componentDidMount(){this.xterm=new s.Terminal(this.props.options);var e=new a.FitAddon;this.xterm.loadAddon(e),this.xterm.loadAddon(new r.SearchAddon),this.xterm.loadAddon(new o.WebLinksAddon),this.xterm.setOption("fontSize",16),this.xterm.setOption("fontFamily",'"DejaVu Sans Mono", "Everson Mono", FreeMono, Menlo, Terminal, monospace, "Apple Symbols"'),this.xterm.open(this.refs.container),e.fit(),this.props.onContextMenu&&this.xterm.element.addEventListener("contextmenu",this.onContextMenu.bind(this)),this.props.onInput&&this.xterm.onData(this.onInput),this.props.value&&this.xterm.write(this.props.value)}componentWillUnmount(){this.xterm&&(this.xterm.dispose(),this.xterm=null)}getTerminal(){return this.xterm}write(e){this.xterm.write(e)}writeln(e){this.xterm.writeln(e)}focus(){this.xterm&&this.xterm.focus()}resize(e,t){this.xterm.resize(Math.round(e),Math.round(t))}setOption(e,t){this.xterm.setOption(e,t)}refresh(){this.xterm.refresh(0,this.xterm.rows-1)}onContextMenu(e){this.props.onContextMenu&&this.props.onContextMenu(e)}render(){var e=c("ReactXTerm",this.state.isFocused?"ReactXTerm--focused":null,this.props.className);return i.createElement("div",{ref:"container",className:e})}}t.default=l,t.XTerm=l},GQsv:function(e,t,n){"use strict";var s=n("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(n("gjeX")),r=d(n("q1tI"));n("q7KB");var o=n("pyUi"),i=n("HPVU"),c=n("uCTZ"),l=s(n("51PC"));function u(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(s,r,o):s[r]=e[r]}return s.default=e,n&&n.set(e,s),s}class h extends r.PureComponent{constructor(e){super(e),this.EstablishConnection=(()=>{return new Promise(()=>{var e=this.props,t=e.tenantID,n=e.serviceID,s=e.podName,r=e.containerName,l=e.WebsocketURL,u=e.updateTitle,d=e.namespace;if(!this.inputRef.current)return null;var h=this.inputRef.current.getTerminal(),p=l.replace("/event_log","/docker_console"),m=new o.ConnectionFactory(p,i.protocols),f="",v=(0,a.default)("".concat(t,"_").concat(n,"_").concat(s)),g={T_id:t,S_id:n,C_id:s,containerName:r,Md5:v,namespace:d},b=new c.Xterm(h);b.removeMessage=this.clearMessage,b.setWindowTitle=(e=>{u&&u(e)});var _=new i.WebTTY(b,m,g,f),w=_.open();this.closer=w,this.clearMessage()})}),this.clearMessage=(()=>{this.setState({message:""})}),this.inputRef=r.default.createRef(),this.state={message:"\u6b63\u5728\u8fde\u63a5"}}componentDidMount(){this.EstablishConnection()}componentWillUnmount(){null!=this.closer&&this.closer(),this.inputRef.current&&this.inputRef.current.componentWillUnmount()}render(){var e=this.state.message;return r.default.createElement("div",{style:{height:"calc(100vh - 104px)",backgroundColor:"rgb(0, 0, 0)"}},r.default.createElement(l.default,{ref:this.inputRef}),e&&r.default.createElement("div",{className:"xterm-overlay"},e))}}var p=h;t.default=p},HPVU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTTY=t.msgSetReconnect=t.msgSetPreferences=t.msgSetWindowTitle=t.msgPong=t.msgOutput=t.msgUnknownOutput=t.msgResizeTerminal=t.msgPing=t.msgInput=t.msgInputUnknown=t.protocols=void 0;var s=["webtty"];t.protocols=s;var a="0";t.msgInputUnknown=a;var r="1";t.msgInput=r;var o="2";t.msgPing=o;var i="3";t.msgResizeTerminal=i;var c="0";t.msgUnknownOutput=c;var l="1";t.msgOutput=l;var u="2";t.msgPong=u;var d="3";t.msgSetWindowTitle=d;var h="4";t.msgSetPreferences=h;var p="5";t.msgSetReconnect=p;class m{constructor(e,t,n,s){this.term=e,this.connectionFactory=t,this.args=n,this.authToken=s,this.reconnect=-1}open(){var e,t,n=this.connectionFactory.create(),s=()=>{n.onOpen(()=>{var t=this.term.info();n.send(JSON.stringify(this.args));var s=(e,t)=>{n.send(i+JSON.stringify({columns:e,rows:t}))};this.term.onResize(s),s(t.columns,t.rows),this.term.onInput(e=>{for(var t=0;t<e.length/1e3;t+=1){var s=e.substr(1e3*t,1e3);n.send(r+s)}}),e=window.setInterval(()=>{n.send(o)},3e4)}),n.onReceive(e=>{var t=e.slice(1);switch(e[0]){case l:this.term.output(atob(t));break;case u:break;case d:this.term.setWindowTitle(t);break;case h:var n=JSON.parse(t);this.term.setPreferences(n);break;case p:var s=JSON.parse(t);this.reconnect=s;break;default:break}}),n.onClose(()=>{clearInterval(e),this.term.deactivate(),this.term.showMessage("Connection Closed",0),this.reconnect>0&&(t=window.setTimeout(()=>{n=this.connectionFactory.create(),this.term.reset(),s()},1e3*this.reconnect))}),n.open()};return s(),()=>{clearTimeout(t),this.reconnect=-1,n.close()}}}t.WebTTY=m},VMuN:function(e,t,n){e.exports={nameID:"nameID___1ITqR",icon:"icon___gohI4",iconm:"iconm___1RD7_",box:"box___1Uhcz",consoleBody:"consoleBody___2DZ7p",menus:"menus___3r8E8",col:"col___3QrBB",header:"header___1eJBw",sync:"sync___3m3Ko",control:"control___mb5Yb",tabs:"tabs___3XRXq",consoleBox:"consoleBox___2Oxez",titleTab:"titleTab___Knaf3",closeTab:"closeTab___3eM_g"}},pyUi:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionFactory=t.Connection=void 0;class s{constructor(e,t){this.bare=new WebSocket(e,t)}open(){}close(){this.bare.close()}send(e){this.bare.readyState!==WebSocket.CLOSED&&this.bare.readyState!==WebSocket.CLOSING&&this.bare.send(e)}isOpen(){return this.bare.readyState===WebSocket.CONNECTING||this.bare.readyState===WebSocket.OPEN}onOpen(e){this.bare.onopen=(()=>{e()})}onReceive(e){this.bare.onmessage=(t=>{e(t.data)})}onClose(e){this.bare.onclose=(()=>{e()})}}t.Connection=s;class a{constructor(e,t){this.url=e,this.protocols=t}create(){return new s(this.url,this.protocols)}}t.ConnectionFactory=a},uCTZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Xterm=void 0;var s=n("rSVU");class a{constructor(e){this.term=e,this.messageTimeout=2e3,this.resizeListener=(()=>{this.term.scrollToBottom(),this.showMessage("".concat(String(this.term.cols),"x").concat(String(this.term.rows)),this.messageTimeout)}),this.resizeListener(),window.addEventListener("resize",()=>{this.resizeListener()}),this.decoder=new s.lib.UTF8Decoder}info(){return{columns:this.term.cols,rows:this.term.rows}}output(e){this.term.write(this.decoder.decode(e))}showMessage(e,t){}removeMessage(){}setWindowTitle(e){}onInput(e){this.term.onData((t,n)=>{e(t)})}onResize(e){this.term.onResize(t=>{e(t.cols,t.rows)})}setPreferences(e){}deactivate(){this.term&&this.term.blur()}reset(){this.removeMessage(),this.term.reset()}close(){window.removeEventListener("resize",this.resizeListener),this.term.dispose()}}t.Xterm=a},uj6I:function(e,t,n){"use strict";var s=n("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("14J3");var a=s(n("BMrR"));n("jCWc");var r=s(n("kPKH"));n("T2oS");var o=s(n("W9HT"));n("Znn+");var i=s(n("ZTPi"));n("ozfa");var c,l,u=s(n("MJZm")),d=n("MuoO"),h=g(n("q1tI")),p=s(n("QDog")),m=s(n("VMuN")),f=s(n("GQsv"));function v(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var s={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(s,r,o):s[r]=e[r]}return s.default=e,n&&n.set(e,s),s}var b=u.default.TreeNode,_=i.default.TabPane,w=(c=(0,d.connect)(e=>{var t=e.user,n=e.appControl,s=e.global,a=e.teamControl,r=e.enterprise;return{currUser:t.currentUser,appDetail:n.appDetail,pods:n.pods,groups:s.groups,build_upgrade:n.build_upgrade,currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:r.currentEnterprise}},null,null,{withRef:!0}),c(l=class extends h.PureComponent{constructor(e){super(e),this.onEdit=((e,t)=>{this[t](e)}),this.onChange=(e=>{this.setState({activeKey:e})}),this.onSelect=(e=>{if(e.length>0){var t=e[0];if(t.indexOf(".")>-1){var n=t.split("."),s=n[0],a=n[1];this.setState({podName:s,containerName:a}),this.openConsole(s,a)}}else{var r=this.state,o=r.podName,i=r.containerName;o&&i&&this.openConsole(o,i)}}),this.openConsole=((e,t)=>{var n=Math.random().toString(36).slice(-8),s={podName:e,containerName:t,title:t,key:n},a=this.state.tabs;a.push(s),this.setState({tabs:a,activeKey:n})}),this.updateTitle=((e,t)=>{var n=this.state.tabs,s=[];n.forEach(n=>{n.key==e&&(n.title=t),s.push(n)}),this.setState({tabs:s})}),this.fetchPods=(e=>{this.setState({loading:!0});var t=this.state.appDetail.service.service_id;this.props.dispatch({type:"appControl/fetchPods",payload:{team_name:p.default.getCurrTeamName(),app_alias:p.default.getComponentID()},callback:n=>{var s=[];if(n.list&&n.list.new_pods&&(s=n.list.new_pods),n.list&&n.list.old_pods&&(s=s.concat(n.list.old_pods)),this.clearLoading(),e&&s&&s.length>0&&s[0].container&&s[0].container.length>0){var a=s[0].container.filter(e=>e.container_name.includes(t)),r=a&&a.length>0?a[0].container_name:s[0].container[0].container_name,o=Math.random().toString(36).slice(-8),i={podName:s[0].pod_name,containerName:r,title:r,key:o};this.setState({tabs:[i],activeKey:o,pods:s})}else this.setState({pods:s})}})}),this.loadDetail=(()=>{this.props.dispatch({type:"appControl/fetchDetail",payload:{team_name:p.default.getCurrTeamName(),app_alias:p.default.getComponentID()},callback:e=>{this.setState({appDetail:e},()=>{this.fetchPods(!0)})}})}),this.controllLeft=(()=>{var e=this.state.leftWidth;0===e?this.setState({leftWidth:5}):this.setState({leftWidth:0})}),this.clearLoading=(()=>{this.setState({loading:!1})}),this.remove=(e=>{var t=this.state.tabs,n=t.filter(t=>t.key!==e),s=n.length>0?n[0].key:"";this.setState({tabs:n,activeKey:s})}),this.leftRender=(e=>{var t=this.state,n=t.pods,s=t.loading,a=[];return n&&n.length>0&&n[0].container&&n[0].container.length>0&&(a=[n[0].container[0].container_name]),h.default.createElement("div",{className:m.default.menus},h.default.createElement("div",{className:m.default.header},h.default.createElement("span",null,"\u5b9e\u4f8b\u5217\u8868"),h.default.createElement("span",{className:m.default.sync,onClick:()=>{this.fetchPods(!1)}},h.default.createElement("svg",{t:"1588475055820",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3297",width:"20",height:"20"},h.default.createElement("path",{d:"M134.4 518.4c19.2 0 38.4-19.2 38.4-38.4 0-185.6 153.6-339.2 339.2-339.2 115.2 0 217.6 57.6 281.6 147.2h-44.8c-19.2 0-38.4 19.2-38.4 38.4s19.2 38.4 38.4 38.4h140.8c19.2 0 38.4-19.2 38.4-38.4V192c0-19.2-19.2-38.4-38.4-38.4s-38.4 19.2-38.4 38.4v44.8C768 128 646.4 64 512 64 281.6 64 96 249.6 96 480c0 19.2 19.2 38.4 38.4 38.4z m755.2-76.8c-19.2 0-38.4 19.2-38.4 38.4 0 185.6-153.6 339.2-339.2 339.2-102.4 0-204.8-51.2-262.4-128h38.4c19.2 0 38.4-19.2 38.4-38.4s-19.2-38.4-38.4-38.4H147.2c-19.2 0-38.4 19.2-38.4 38.4v140.8c0 19.2 19.2 38.4 38.4 38.4s38.4-19.2 38.4-38.4v-57.6C262.4 838.4 384 896 512 896c230.4 0 416-185.6 416-416 0-19.2-19.2-38.4-38.4-38.4z","p-id":"3298",fill:"#ffffff"})))),h.default.createElement(o.default,{spinning:s,tip:"Loading..."},n&&n.length>0&&h.default.createElement(u.default,{defaultExpandAll:!0,onSelect:this.onSelect,defaultSelectedKeys:a},n.map(t=>{var n=t.pod_name,s=n;return s.includes("deployment")&&(s=s.slice(s.indexOf("-")+1)),h.default.createElement(b,{title:"\u5b9e\u4f8b/".concat(s),key:n},t.container.map(t=>{var s=t.container_name,a="\u5bb9\u5668/".concat(s);return s.includes(e.k8s_component_name)&&!s.includes("default-tcpmesh")?a="\u7ec4\u4ef6\u5bb9\u5668":s.includes("plugin")?a="\u63d2\u4ef6\u5bb9\u5668":s.includes("default-tcpmesh")&&(a="\u9ed8\u8ba4Mesh\u5bb9\u5668"),h.default.createElement(b,{isLeaf:!0,title:a,key:"".concat(n,".").concat(s)})}))}))))}),this.tabContent=((e,t,n)=>{var s=this.state.appDetail;return h.default.createElement(f.default,{key:e+t,tenantID:s.service.tenant_id,serviceID:s.service.service_id,WebsocketURL:s.event_websocket_url,updateTitle:e=>this.updateTitle(n,e),podName:e,containerName:t,namespace:s.service.namespace})}),this.state={loading:!1,pods:[],tabs:[],leftWidth:5,appDetail:{},activeKey:""}}componentDidMount(){this.loadDetail()}render(){var e=this.state,t=e.leftWidth,n=e.tabs,s=e.appDetail,o=e.activeKey,c=s&&s.service;return h.default.createElement(a.default,{className:m.default.box},h.default.createElement(r.default,{className:m.default.col,style:{background:"#2f2a2a"},span:t},c&&this.leftRender(c)),h.default.createElement(r.default,{className:m.default.col,span:24-t},h.default.createElement("span",{onClick:this.controllLeft,className:m.default.control},t>0?h.default.createElement("svg",{t:"1588476023049",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4836",width:"200",height:"200"},h.default.createElement("path",{d:"M68.608 517.632l207.36 159.744V357.888zM939.52 227.328H83.968c-8.704 0-15.872-7.168-15.872-15.872V144.384c0-8.704 7.168-15.872 15.872-15.872h855.552c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 906.24H83.968c-8.704 0-15.872-7.168-15.872-15.872v-67.072c0-8.704 7.168-15.872 15.872-15.872h855.552c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 453.632H429.056c-8.704 0-15.872-7.168-15.872-15.872V370.688c0-8.704 7.168-15.872 15.872-15.872h510.464c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872M939.52 679.936H429.056c-8.704 0-15.872-7.168-15.872-15.872v-67.072c0-8.704 7.168-15.872 15.872-15.872h510.464c8.704 0 15.872 7.168 15.872 15.872v67.072c0 8.704-7.168 15.872-15.872 15.872",fill:"#ffffff","p-id":"4837"})):h.default.createElement("svg",{t:"1588476580322",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5067",width:"200",height:"200"},h.default.createElement("path",{d:"M112.80000001 356L623.2 356c24.8 0 44.8 21.6 44.8 48s-20 48-44.8 48l-510.4 0c-24.8 0-44.8-21.6-44.8-48s20-48 44.80000001-48z m-1e-8 224L623.2 580c24.8 0 44.8 21.6 44.8 48s-20 48-44.8 48l-510.4-1e-8c-24.8 0-44.8-21.6-44.8-47.99999999s20-48 44.8-48zM116 796L900 796c26.4 0 48 21.6 48 48s-21.6 48-48 48l-784 0c-26.4 0-48-21.6-48-48s21.6-48 48-48zM724 356L948 516l-224 160 0-320zM900 236l-784 0c-26.4 0-48-21.6-48-48s21.6-48 48-48L900 140c26.4 0 48 21.6 48 48s-21.6 48-48 48z","p-id":"5068",fill:"#ffffff"}))),h.default.createElement("div",{className:m.default.tabs},n.length>0&&c&&h.default.createElement(i.default,{defaultActiveKey:"".concat(n[n.length-1].key),onChange:this.onChange,activeKey:o,type:"editable-card",onEdit:this.onEdit,hideAdd:!0},n.map(e=>{var t=e.title,n=e.podName,s=e.key,a=e.containerName;return h.default.createElement(_,{tab:h.default.createElement("div",null,h.default.createElement("span",{className:m.default.titleTab},t||n)),className:m.default.consoleBox,key:s},this.tabContent(n,a,s))})))))}})||l);t.default=w}}]);