(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{Jq4M:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("fOrg");var r=l(a("+KLJ"));a("jCWc");var i=l(a("kPKH"));a("sRBo");var s=l(a("kaz8"));a("+L6B");var o=l(a("2/Rp")),d=l(a("jehZ"));a("/xke");var u=l(a("TeRw"));a("y8nQ");var c=l(a("Vl3Y"));a("tU7J");var p,f,h,m=l(a("wFql")),g=l(a("18gR")),v=a("MuoO"),b=x(a("q1tI")),I=a("mLYH"),k=l(a("AklW")),E=l(a("QDog")),C=l(a("ZNrE")),y=l(a("dBUJ")),w=l(a("imTl")),S=l(a("aMNY"));function D(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(D=function(e){return e?a:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=D(t);if(a&&a.has(e))return a.get(e);var l={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var i=n?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(l,r,i):l[r]=e[r]}return l.default=e,a&&a.set(e,l),l}var P=m.default.Paragraph,R=(p=(0,v.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),f=c.default.create(),p(h=f(h=class extends b.PureComponent{constructor(e){super(e),this.initRainbondCluster=(()=>{var e=this.props,t=e.dispatch,a=e.clusterID,l=e.selectProvider,n=e.eid,r=e.rainbondInfo,i=e.enterprise,s=this.state,o=s.checked,d=s.task;o?(this.setState({loading:!0}),t({type:"cloud/initRainbondRegion",payload:{enterprise_id:n,providerName:l,clusterID:a,retry:d&&"complete"===d.status},callback:e=>{e&&(E.default.putInstallClusterLog(i,r,{eid:n,taskID:e.taskID,status:"start",install_step:"createRainbond",provider:l}),this.setState({loading:!1,task:e,showInitDetail:!0}))},handleError:e=>{e&&e.data&&7005===e.data.code?this.setState({loading:!1,showInitDetail:!0,task:e.data.data}):k.default.handleCloudAPIError(e)}})):u.default.warning({message:"\u8bf7\u9605\u8bfb\u5e76\u540c\u610f\u6ce8\u610f\u4e8b\u9879"})}),this.loadTask=(e=>{var t=this.props,a=t.dispatch,l=t.eid,n=t.clusterID,r=t.selectProvider,i=t.completeInit;a({type:"cloud/loadInitRainbondTask",payload:{enterprise_id:l,clusterID:n,providerName:r},callback:t=>{if(t&&200===t.status_code&&t.response_data&&t.response_data.data){var a=t.response_data.data;this.setState({task:a}),"inited"===a.status?i&&i(a):"complete"===a.status||e||this.setState({showInitDetail:!0})}},handleError:e=>{e&&e.data&&404===e.data.code||(k.default.handleCloudAPIError(e),this.setState({loading:!1}))}})}),this.cancelShowInitDetail=(()=>{this.setState({showInitDetail:!1}),this.loadTask(!0)}),this.setChecked=(e=>{this.setState({checked:e.target.checked})}),this.showSetRainbondCluster=(()=>{var e=this.props,t=e.eid,a=e.clusterID;(0,I.getRainbondClusterConfig)({enterprise_id:t,clusterID:a},e=>{e&&e.data&&404===e.data.code||k.default.handleCloudAPIError(e)}).then(e=>{this.setState({showClusterInitConfig:!0,initconfig:e.config})})}),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.eid,l=e.clusterID;t.validateFields((e,t)=>{e||(0,I.setRainbondClusterConfig)({enterprise_id:a,clusterID:l,config:t.config},e=>{e&&e.data&&404===e.data.code||k.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&(u.default.success({message:"\u8bbe\u7f6e\u6210\u529f"}),this.setState({showClusterInitConfig:!1}))})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,l=e.handleClick,n=void 0===l?()=>{}:l;return b.default.createElement(g.default,(0,d.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close")},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(n(),this.handleGuideStep(a))}}))}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.state={checked:!1,loading:!1,showInitDetail:!1,task:null,isComponents:!1,guideStep:10}}componentDidMount(){this.loadTask()}render(){var e=this.props,t=e.preStep,a=e.eid,l=e.selectProvider,d=e.form,u=e.clusterID,p=this.state,f=p.showInitDetail,h=p.loading,m=p.task,g=p.showClusterInitConfig,v=p.initconfig,I=p.isComponents,k=p.guideStep,E=p.checked,D={labelCol:{xs:{span:24}},wrapperCol:{xs:{span:24}}},x=d.getFieldDecorator,R=d.setFieldsValue,O=10===k?{position:"relative",zIndex:1e3,padding:"0 16px",margin:"0 -16px",background:"#fff"}:{},M=("rke"===l||"custom"===l)&&b.default.createElement(o.default,{style:{marginRight:"16px"},onClick:()=>this.handleIsComponents(!0)},"\u67e5\u770b\u7ec4\u4ef6");return b.default.createElement(c.default,null,b.default.createElement("h4",null,"\u6ce8\u610f\u4e8b\u9879\uff1a"),b.default.createElement(i.default,{span:24,style:{padding:"16px"}},"ack"===l&&b.default.createElement(P,{className:y.default.describe,style:O},b.default.createElement("ul",null,b.default.createElement("li",null,b.default.createElement("span",null,"\u82e5\u4f60\u9009\u62e9\u7684\u662f\u5df2\u7ecf\u5728\u4f7f\u7528\u7684Kubernetes\u96c6\u7fa4\uff0c\u4e0d\u8981\u62c5\u5fc3\uff0c\u63a5\u4e0b\u6765\u7684\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u96c6\u7fa4\u5df2\u6709\u7684\u4e1a\u52a1\u5f62\u6001\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u5e73\u53f0\u96c6\u7fa4\u521d\u59cb\u5316\u9700\u8981\u4ee5\u4e0b\u8d44\u6e90\uff1aRDS(1\u4e2a)\u3001NAS(1\u4e2a)\u3001SLB(1\u4e2a)\uff0c\u5e76\u5c06(80\u3001443\u30018443\u30016060\u300110000-11000)\u7aef\u53e3\u6dfb\u52a0\u5230\u5b89\u5168\u7ec4\u7b56\u7565\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u65b0\u8d2d\u8d44\u6e90\u90fd\u5c06\u91c7\u7528\u6309\u9700\u540e\u4ed8\u8d39\u6a21\u5f0f\uff0c\u56e0\u6b64\u8bf7\u786e\u4fdd\u4f60\u7684\u963f\u91cc\u4e91\u8d26\u53f7\u80fd\u591f\u8fdb\u884c\u6309\u9700\u8d2d\u4e70\u8d44\u6e90\uff0c\u540e\u7eed\u7528\u6237\u6839\u636e\u9700\u8981\u8fdb\u884c\u4ed8\u8d39\u6a21\u5f0f\u53d8\u66f4")),b.default.createElement("li",null,b.default.createElement("span",null,"\u6211\u4eec\u5c06\u901a\u8fc7KubeAPI\u8fdb\u884c\u76f8\u5173\u7684\u8d44\u6e90\u521b\u5efa\u548c\u521d\u59cb\u5316\uff0c\u96c6\u7fa4\u5bf9\u63a5\u5b8c\u6210\u540e\u5373\u53ef\u5173\u95edKubeAPI\u7684\u516c\u7f51\u8bbf\u95ee\uff08\u79fb\u9664\u7ed1\u5b9a\u7684EIP\uff09")))),("rke"===l||"custom"===l)&&b.default.createElement(P,{className:y.default.describe,style:O},b.default.createElement("ul",null,b.default.createElement("li",null,b.default.createElement("span",null,"\u82e5\u4f60\u9009\u62e9\u7684\u662f\u5df2\u7ecf\u5728\u4f7f\u7528\u7684\u5e73\u53f0\u96c6\u7fa4\uff0c\u4e0d\u8981\u62c5\u5fc3\uff0c\u63a5\u4e0b\u6765\u7684\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u96c6\u7fa4\u5df2\u6709\u7684\u4e1a\u52a1\u5f62\u6001\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u5e73\u53f0 \u96c6\u7fa4\u521d\u59cb\u5316\u65f6\u9ed8\u8ba4\u91c7\u7528\u7b2c1\u30012\u4e2a\u8282\u70b9\u4e3a\u7f51\u5173\u8282\u70b9\u548c\u6784\u5efa\u8282\u70b9\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728Kubernetes\u8282\u70b9\u4e0a\u589e\u52a0Annotations\u6765\u6307\u5b9a\u5bf9\u5e94\u8282\u70b9(rainbond.io/gateway-node=true \u6216rainbond.io/chaos-node=true)\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u7f51\u5173\u8282\u70b9\u4ee5\u4e0b\u7aef\u53e3\u5fc5\u987b\u7a7a\u95f2\uff1a80, 443, 6060, 7070, 8443, 10254, 18080, 18081\uff0c\u5426\u5219\u5c06\u5bfc\u81f4\u521d\u59cb\u5316\u5931\u8d25")),b.default.createElement("li",null,b.default.createElement("span",null,"\u5982\u679c\u96c6\u7fa4\u8282\u70b9\u6570\u91cf\u5927\u4e8e3\u5c06\u9ed8\u8ba4\u5b89\u88c5\u9ad8\u53ef\u7528\u6a21\u5f0f\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9700\u8981\u8bbf\u95ee\u7f51\u5173\u8282\u70b96443\u30018443\u30016060\u7aef\u53e3\uff0c\u8bf7\u786e\u4fdd\u76f8\u5173\u7aef\u53e3\u53ef\u88ab\u8bbf\u95ee\u3002")),b.default.createElement("li",null,b.default.createElement("span",null,"\u82e5\u60a8\u5e0c\u671b\u81ea\u5b9a\u4e49\u96c6\u7fa4\u521d\u59cb\u5316\u53c2\u6570"," ",b.default.createElement("a",{onClick:()=>{this.showSetRainbondCluster()}},"\u70b9\u51fb\u8fd9\u91cc"))))),b.default.createElement(c.default.Item,{name:"remember",valuePropName:"checked",noStyle:!0},b.default.createElement(s.default,{onChange:this.setChecked,style:O,checked:E},"\u6211\u5df2\u9605\u8bfb\u5e76\u5df2\u6e05\u695a\u8ba4\u8bc6\u4e0a\u8ff0\u6ce8\u610f\u4e8b\u9879"),10===k&&this.handleNewbieGuiding({tit:"\u8bf7\u4ed4\u7ec6\u9605\u8bfb\u5e73\u53f0\u96c6\u7fa4\u670d\u52a1\u7684\u521d\u59cb\u5316\u5b89\u88c5\u7684\u8bf4\u660e\u548c\u524d\u63d0\u6761\u4ef6\u3002",send:!1,configName:"kclustersAttentionAttention",nextStep:11,btnText:"\u5df2\u77e5\u6653",conPosition:{left:0,bottom:"-192px"},svgPosition:{left:"3px",marginTop:"-19px"},handleClick:()=>{this.setState({checked:!0})}}))),b.default.createElement(i.default,{style:{textAlign:"center",marginTop:"32px"},span:24},m&&"complete"!==m.status?b.default.createElement(b.Fragment,null,b.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},"\u4e0a\u4e00\u6b65"),M,b.default.createElement(o.default,{onClick:()=>{this.setState({showInitDetail:!0})},type:"primary"},"\u6b63\u5728\u521d\u59cb\u5316/\u786e\u8ba4\u8fdb\u5ea6")):b.default.createElement(b.Fragment,null,b.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},"\u4e0a\u4e00\u6b65"),M,b.default.createElement(o.default,{loading:h,onClick:this.initRainbondCluster,type:"primary"},m?"\u91cd\u65b0\u521d\u59cb\u5316":"\u5f00\u59cb\u521d\u59cb\u5316")),11===k&&this.handleNewbieGuiding({tit:"\u5f00\u59cb\u521d\u59cb\u5316",desc:"\u91c7\u7528\u9ed8\u8ba4\u521d\u59cb\u5316\u914d\u7f6e\u5f00\u59cb\u5b89\u88c5\u3002",send:!0,configName:"kclustersAttentionAttention",nextStep:12,conPosition:{left:"63%",bottom:"-39px"},svgPosition:{left:"58%",marginTop:"-13px"},handleClick:()=>{this.initRainbondCluster()}})),I&&u&&b.default.createElement(w.default,{eid:a,clusterID:u,providerName:l,onCancel:()=>{this.handleIsComponents(!1)}}),f&&m&&b.default.createElement(S.default,{onCancel:this.cancelShowInitDetail,eid:a,guideStep:k,handleNewbieGuiding:this.handleNewbieGuiding,providerName:l,clusterID:m.clusterID,taskID:m.taskID}),g&&b.default.createElement(n.default,{visible:!0,title:"\u8bbe\u7f6e\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e",onOk:this.handleSubmit,width:800,confirmLoading:h,onCancel:()=>{this.setState({showClusterInitConfig:!1})}},b.default.createElement(r.default,{message:"\u8bf7\u6ce8\u610f\uff0c\u9ed8\u8ba4\u6570\u636e\u4ec5\u4f5c\u4e3a\u793a\u4f8b\uff0c\u5404\u5b57\u6bb5\u82e5\u9700\u8981\u4f7f\u7528\u9ed8\u8ba4\u503c\u5219\u4e0d\u8981\u914d\u7f6e\u8be5\u5b57\u6bb5\u3002",type:"warning",style:{marginBottom:"16px"}}),b.default.createElement(C.default,{titles:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e\u5305\u542b\u5e73\u53f0\u96c6\u7fa4\u7684\u521d\u59cb\u5316\u7684\u5168\u90e8\u914d\u7f6e",setFieldsValue:R,formItemLayout:D,Form:c.default,getFieldDecorator:x,mode:"yaml",name:"config",data:v,label:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e",message:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e\u914d\u7f6e\u662f\u5fc5\u9700\u7684",width:"750px"})))}})||h)||h);t.default=R},XdbD:function(e,t,a){"use strict";var l=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("14J3");var r=l(a("BMrR"));a("y8nQ");var i=l(a("Vl3Y"));a("FJo9");var s,o,d,u=l(a("L41K")),c=a("MuoO"),p=a("7DNP"),f=b(a("q1tI")),h=l(a("Jq4M")),m=l(a("XZXw")),g=l(a("+iC2"));function v(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(v=function(e){return e?a:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=v(t);if(a&&a.has(e))return a.get(e);var l={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var i=n?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(l,r,i):l[r]=e[r]}return l.default=e,a&&a.set(e,l),l}var I=u.default.Step,k=(s=i.default.create(),o=(0,c.connect)(e=>{var t=e.user,a=e.list,l=e.loading,n=e.global,r=e.index;return{user:t.currentUser,list:a,loading:l.models.list,rainbondInfo:n.rainbondInfo,enterprise:n.enterprise,isRegist:n.isRegist,oauthLongin:l.effects["global/creatOauth"],overviewInfo:r.overviewInfo}}),s(d=o(d=class extends f.PureComponent{constructor(e){super(e),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(p.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,l=t.provider;e(p.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(l,"/kclusters")))}),this.loadSteps=(()=>{var e=[{title:"\u9009\u62e9\u4f9b\u5e94\u5546"},{title:"\u9009\u62e9(\u521b\u5efa)\u5e73\u53f0\u96c6\u7fa4"},{title:"\u521d\u59cb\u5316\u5e73\u53f0\u96c6\u7fa4"},{title:"\u5b8c\u6210\u5bf9\u63a5"}];return e}),this.completeInit=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,l=t.provider,n=t.clusterID;e(p.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(l,"/kclusters/").concat(n,"/link")))});var t=this.props.user,a=g.default.isCompanyAdmin(t);this.state={adminer:a}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(p.routerRedux.push("/"))}componentDidMount(){}render(){var e=this.props.match.params,t=e.eid,a=e.provider,l=e.clusterID,i=e.taskID;return f.default.createElement(m.default,{title:"\u6dfb\u52a0\u96c6\u7fa4",content:"\u96c6\u7fa4\u662f\u8d44\u6e90\u7684\u96c6\u5408\uff0c\u4ee5Kubernetes\u96c6\u7fa4\u4e3a\u57fa\u7840\uff0c\u90e8\u7f72\u5e73\u53f0Region\u670d\u52a1\u5373\u53ef\u6210\u4e3a\u5e73\u53f0\u96c6\u7fa4\u8d44\u6e90\u3002"},f.default.createElement(r.default,{style:{marginBottom:"16px"}},f.default.createElement(u.default,{current:2},this.loadSteps().map(e=>f.default.createElement(I,{key:e.title,title:e.title})))),f.default.createElement(n.default,null,f.default.createElement(r.default,{style:{marginBottom:"16px"}},f.default.createElement(h.default,{eid:t,completeInit:this.completeInit,selectProvider:a,taskID:i,clusterID:l,preStep:this.preStep}))))}})||d)||d);t.default=k}}]);