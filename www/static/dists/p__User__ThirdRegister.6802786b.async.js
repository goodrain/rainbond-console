(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[91],{p1oR:function(e,t,a){"use strict";var r=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var i=r(a("BMrR"));a("jCWc");var n=r(a("kPKH"));a("fOrg");var o=r(a("+KLJ"));a("miYZ");var d=r(a("tsqr")),u=r(a("p0pE"));a("y8nQ");var l,c,f,h,p=r(a("Vl3Y")),m=a("MuoO"),g=a("7DNP"),_=s(a("q1tI")),v=a("LLXN"),b=r(a("8+Sn")),E=r(a("mWxT")),y=r(a("5WY0")),k=r(a("dYZ0")),w=E.default.OauthParameter("oauth_user_id"),R=E.default.OauthParameter("code"),L=E.default.OauthParameter("service_id"),M="/user/login?disable_auto_login=true",x=(l=(0,m.connect)(e=>{var t=e.user,a=e.global;return{register:t.register,rainbondInfo:a.rainbondInfo,isRegist:a.isRegist}}),c=p.default.create(),l(f=c((h=class extends _.Component{constructor(){super(...arguments),this.state={user_info:null},this.handleSubmit=(e=>{var t=this.props.dispatch;R&&L&&w&&t({type:"user/thirdRegister",payload:(0,u.default)({},e),callback:e=>{e&&""!==e.token?(b.default.set("token",e.token),t({type:"user/fetchThirdBinding",payload:{service_id:L,oauth_user_id:w},callback:e=>{e&&200===e.status_code?d.default.success((0,v.formatMessage)({id:"login.ThirdLogin.success"}),1,()=>{var e=window.localStorage.getItem("redirect");e&&""!==e||(e="/"),e.startsWith("/")?t(g.routerRedux.push(e)):window.location.href=e}):this.handleError()},handleError:()=>{this.handleError()}})):this.handleError()}})}),this.handleError=(()=>{var e=this.props.dispatch;d.default.warning((0,v.formatMessage)({id:"ogin.Third.Authentication"}),1,()=>{e(g.routerRedux.push(M))})})}componentDidMount(){this.props.dispatch({type:"user/fetchThirdInfo",payload:{code:R,service_id:L},callback:e=>{e&&200===e.status_code&&this.setState({user_info:e.bean.user_info})}})}render(){var e=this.props,t=e.isRegist,a=e.dispatch,r=e.rainbondInfo;if(!t)return a(g.routerRedux.replace(R&&L&&w?"/user/login?code=".concat(R,"&service_id=").concat(L):M)),null;var s=this.state.user_info,d=!E.default.fetchIsFirstRegist(r),u=null;E.default.OauthbEnable(r)&&r.oauth_services&&r.oauth_services.value&&r.oauth_services.value.map(e=>{return e.service_id===L&&(u=e),e});var l=u&&u.name||"",c=s&&s.oauth_user_name||"",f=l&&"".concat((0,v.formatMessage)({id:"login.ThirdLogin.from"},{name:l})),h=e=>{return"/user/third/".concat(e,"?code=").concat(R,"&service_id=").concat(L,"&oauth_user_id=").concat(w)};return _.default.createElement("div",{className:y.default.main},_.default.createElement(o.default,{style:{margin:"24px 0"},message:"".concat(f).concat(c).concat((0,v.formatMessage)({id:"login.ThirdLogin.supplement"})),type:"info"}),_.default.createElement(i.default,{style:{marginBottom:"24px"}},_.default.createElement(n.default,{span:10,className:y.default.boxJump},!d&&_.default.createElement(g.Link,{to:h("login")},_.default.createElement(v.FormattedMessage,{id:"login.ThirdLogin.bind"}))),_.default.createElement(n.default,{span:10,style:{background:"#CDE2FF"},className:y.default.boxJump,offset:4},_.default.createElement(g.Link,{to:h("register")},_.default.createElement(v.FormattedMessage,{id:"login.ThirdLogin.creat"})))),_.default.createElement(k.default,{user_info:s,onSubmit:this.handleSubmit,type:"thirdRegister"}))}},f=h))||f)||f);t.default=x}}]);