(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[60],{Kq3J:function(e,t,a){"use strict";var r=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=r(a("bx4M"));a("g9YV");var l=r(a("wCAj"));a("P2fV");var s=r(a("NJEC"));a("Q9mQ");var o=r(a("diRs"));a("+L6B");var d=r(a("2/Rp"));a("5Dmo");var c=r(a("3S7+"));a("/xke");var p,u,h,m=r(a("TeRw")),f=a("MuoO"),g=a("7DNP"),v=r(a("wd/R")),S=i(a("q1tI")),E=a("LLXN"),b=r(a("puxM")),_=r(a("nvum")),y=r(a("XZXw")),x=a("vSx2"),P=r(a("QDog")),k=r(a("hMqj")),R=r(a("TNXg")),D=(p=(0,f.connect)(e=>{var t=e.list,a=e.loading,r=e.teamControl,i=e.enterprise;return{list:t,loading:a.models.list,currentTeam:r.currentTeam,currentRegionName:r.currentRegionName,currentEnterprise:i.currentEnterprise,currentTeamPermissionsInfo:r.currentTeamPermissionsInfo}}),p((h=class extends S.PureComponent{constructor(e){super(e),this.onPublishStore=(()=>{this.setState({selectStoreShow:!0})}),this.onPublishLocal=(()=>{this.handleShare("",{})}),this.onPageChange=(e=>{this.setState({page:e},()=>{this.fetchPublishRecoder()})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.teamName,r=t.regionName,i=t.appID;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:{team_name:a,region_name:r,group_id:i},callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1})},handleError:e=>{e&&404===e.code&&this.props.dispatch(g.routerRedux.push("/team/".concat(P.default.getCurrTeamName(),"/region/").concat(P.default.getCurrRegionName(),"/apps")))}})}),this.fetchPublishRecoder=(()=>{this.setState({loading:!0});var e=this.props.match.params,t=e.teamName,a=e.appID,r=this.props.dispatch,i=this.state,n=i.page,l=i.pageSize;r({type:"application/fetchShareRecords",payload:{team_name:t,app_id:a,page:n,page_size:l},callback:e=>{e&&this.setState({recoders:e.list,total:e.bean.total,loading:!1})}})}),this.handleShare=((e,t)=>{var a=this.props.match.params,r=a.teamName,i=a.appID,n=this.props.dispatch;n({type:"application/ShareGroup",payload:{team_name:r,group_id:i,scope:e,target:t},callback:e=>{this.continuePublish(e.bean.ID,e.bean.step)}})}),this.hideSelectStoreShow=(()=>{this.setState({selectStoreShow:!1})}),this.handleStoreLoading=(e=>{this.setState({storeLoading:e})}),this.handleSelectStore=(e=>{this.handleStoreLoading(!0);var t=e.store_id;this.handleShare("goodrain",{store_id:t})}),this.deleteRecord=(e=>{var t=this.props.match.params,a=t.teamName,r=t.appID,i=this.props.dispatch;i({type:"application/deleteShareRecord",payload:{team_name:a,app_id:r,record_id:e},callback:()=>{this.fetchPublishRecoder()}})}),this.cancelPublish=(e=>{if(void 0!==e&&""!==e){var t=this.props.match.params.teamName,a=this.props.dispatch;a({type:"application/giveupShare",payload:{team_name:t,share_id:e},callback:()=>{this.fetchPublishRecoder()}})}else m.default.warning({message:"\u53c2\u6570\u5f02\u5e38"})}),this.continuePublish=((e,t)=>{var a=this.props.dispatch,r=this.props.match.params,i=r.teamName,n=r.regionName,l=r.appID;1===t&&a(g.routerRedux.push("/team/".concat(i,"/region/").concat(n,"/apps/").concat(l,"/share/").concat(e,"/one"))),2===t&&a(g.routerRedux.push("/team/".concat(i,"/region/").concat(n,"/apps/").concat(l,"/share/").concat(e,"/two"))),this.handleStoreLoading(!1)}),this.handleBox=(e=>{return S.default.createElement("div",{className:R.default.version},S.default.createElement(c.default,{placement:"topLeft",title:e},e))}),this.state={loading:!0,appDetail:{},page:1,pageSize:10,total:0,storeLoading:!1,selectStoreShow:!1}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,r=k.default.queryAppInfo(t,"share");r||P.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.fetchPublishRecoder()}render(){var e=[],t=this.state,a=t.appDetail,r=t.loading,i=t.loadingDetail,c=t.page,p=t.pageSize,u=t.total,h=t.selectStoreShow,m=t.recoders,f=t.storeLoading,P=this.props,k=P.currentEnterprise,D=P.currentTeam,L=P.currentRegionName,C=P.dispatch;return e=(0,x.createApp)((0,x.createTeam)((0,x.createEnterprise)(e,k),D,L),D,L,{appName:a.group_name,appID:a.group_id}),S.default.createElement(y.default,{breadcrumbList:e,loading:i,title:(0,E.formatMessage)({id:"app.publish.title"}),content:(0,E.formatMessage)({id:"app.publish.desc"}),extraContent:S.default.createElement("div",null,S.default.createElement(d.default,{style:{marginRight:8},type:"primary",onClick:this.onPublishLocal},"\u53d1\u5e03\u5230\u7ec4\u4ef6\u5e93"),S.default.createElement(d.default,{style:{marginRight:8},onClick:this.onPublishStore},"\u53d1\u5e03\u5230\u4e91\u5e94\u7528\u5546\u5e97"))},S.default.createElement(n.default,{loading:r},S.default.createElement(b.default,{sm:800},S.default.createElement(l.default,{pagination:{current:c,pageSize:p,total:u,onChange:this.onPageChange},dataSource:m||[],columns:[{title:"\u53d1\u5e03\u6a21\u7248\u540d\u79f0",dataIndex:"app_model_name",render:(e,t)=>{return e||S.default.createElement("span",{style:{color:"#999999"}},0===t.status?"\u672a\u6307\u5b9a":"-")}},{title:"\u7248\u672c\u53f7(\u522b\u540d)",dataIndex:"version",align:"left",render:(e,t)=>{var a=t.version_alias&&"(".concat(t.version_alias,")")||"";if(e){var r=t.app_version_info;return S.default.createElement(o.default,{style:{marginBottom:0},content:r?this.handleBox(r):"\u6682\u65e0\u7248\u672c\u63cf\u8ff0",title:this.handleBox("".concat(e).concat(a))},S.default.createElement("div",{className:R.default.version},e,a))}return S.default.createElement("span",{style:{color:"#999999"}},"\u672a\u6307\u5b9a")}},{title:"\u53d1\u5e03\u8303\u56f4",dataIndex:"scope",align:"center",render:(e,t)=>{var a=t&&t.scope_target&&t.scope_target.store_name,r="/enterprise/".concat(k.enterprise_id,"/shared/local");switch(e){case"":return S.default.createElement(g.Link,{to:r},"\u5e94\u7528\u5e02\u573a");case"team":return S.default.createElement(g.Link,{to:r},"\u5e94\u7528\u5e02\u573a(\u56e2\u961f)");case"enterprise":return S.default.createElement(g.Link,{to:r},"\u5e94\u7528\u5e02\u573a(\u4f01\u4e1a)");default:return S.default.createElement("p",{style:{marginBottom:0}},a||"\u5e94\u7528\u5546\u5e97")}}},{title:"\u53d1\u5e03\u65f6\u95f4",align:"center",dataIndex:"create_time",render:e=>S.default.createElement("span",null,(0,v.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u72b6\u6001",align:"center",dataIndex:"status",render:e=>{switch(e){case 0:return"\u53d1\u5e03\u4e2d";case 1:return S.default.createElement("span",{style:{color:"green"}},"\u53d1\u5e03\u5b8c\u6210");case 2:return S.default.createElement("span",{style:{color:"#999999"}},"\u5df2\u53d6\u6d88")}return""}},{title:"\u64cd\u4f5c",width:"200px",dataIndex:"dataIndex",render:(e,t)=>{return S.default.createElement("div",null,0===t.status?S.default.createElement("div",null,S.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.continuePublish(t.record_id,t.step)}},"\u7ee7\u7eed\u53d1\u5e03"),S.default.createElement("a",{style:{marginRight:"5px"},onClick:()=>{this.cancelPublish(t.record_id)}},"\u53d6\u6d88\u53d1\u5e03")):S.default.createElement(s.default,{title:"\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u8bb0\u5f55\u5417?",onConfirm:()=>{this.deleteRecord(t.record_id)},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88"},S.default.createElement("a",{href:"#"},"\u5220\u9664")))}}]}))),S.default.createElement(_.default,{loading:f,dispatch:C,enterprise_id:k.enterprise_id,visible:h,onCancel:this.hideSelectStoreShow,onOk:this.handleSelectStore}))}},u=h))||u);t.default=D},TNXg:function(e,t,a){e.exports={version:"version___3lOXo"}},nvum:function(e,t,a){"use strict";var r=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=r(a("kLXV"));a("T2oS");var l=r(a("W9HT")),s=r(a("jehZ"));a("+L6B");var o=r(a("2/Rp"));a("OaEy");var d=r(a("2fM7"));a("y8nQ");var c,p,u,h=r(a("Vl3Y")),m=i(a("q1tI")),f=a("34ay"),g=r(a("e6Ls")),v=h.default.Item,S=d.default.Option,E=(c=h.default.create(),c((u=class extends m.PureComponent{constructor(e){super(e),this.getStoreList=(()=>{this.setState({loading:!0});var e=this.props,t=e.dispatch,a=e.enterprise_id;t({type:"enterprise/fetchEnterpriseStoreList",payload:{enterprise_id:a},callback:e=>{if(e){var t=e.list,a=void 0===t?[]:t,r=[];a.length>0&&(r=a.filter(e=>1===e.status&&(0,f.fetchMarketAuthority)(e,"Write"))),this.setState({storeList:r,loading:!1})}else this.setState({loading:!1})}})}),this.handleSubmit=(()=>{var e=this.props,t=e.onOk,a=e.form,r=a.validateFields;r((e,a)=>{!e&&t&&t(a)})}),this.state={loading:!0,storeList:[]}}componentDidMount(){this.getStoreList()}render(){var e=this.props,t=e.onCancel,a=e.visible,r=e.form,i=e.loading,c=void 0!==i&&i,p=r.getFieldDecorator,u=this.state,f=u.storeList,E=u.loading,b=f&&f.length>0&&f,_={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}};return m.default.createElement(n.default,{title:"\u9009\u62e9\u5e94\u7528\u5546\u5e97",visible:a,className:g.default.TelescopicModal,onOk:this.handleSubmit,onCancel:t,footer:[m.default.createElement(o.default,{onClick:t}," \u53d6\u6d88 "),b&&m.default.createElement(o.default,{type:"primary",onClick:this.handleSubmit,loading:c},"\u786e\u5b9a")]},b?m.default.createElement(h.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},m.default.createElement(v,(0,s.default)({},_,{label:"\u53d1\u5e03\u5546\u5e97"}),p("store_id",{initialValue:b[0].name||"",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u53d1\u5e03\u7684\u5546\u5e97"}]})(m.default.createElement(d.default,{getPopupContainer:e=>e.parentNode,placeholder:"\u8bf7\u9009\u62e9\u53d1\u5e03\u7684\u5546\u5e97"},b.map(e=>{var t=e.name,a=e.alias;return m.default.createElement(S,{key:"store".concat(t),value:t},a||t)}))),m.default.createElement("div",{className:g.default.conformDesc},"\u9009\u62e9\u9700\u8981\u53d1\u5e03\u7684\u5546\u5e97\u540d\u79f0"))):E?m.default.createElement("div",{style:{textAlign:"center",marginBottom:"16px"}},m.default.createElement(l.default,{tip:"\u5e94\u7528\u5546\u5e97\u5217\u8868\u52a0\u8f7d\u4e2d..."})):m.default.createElement("p",{style:{textAlign:"center"}},"\u6682\u65e0\u63a8\u9001\u6743\u9650\u7684\u5e94\u7528\u5546\u5e97"))}},p=u))||p),b=E;t.default=b}}]);