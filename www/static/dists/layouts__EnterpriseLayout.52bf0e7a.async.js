(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{W7L6:function(e,t,a){"use strict";var i=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.getMenuData=void 0;var r=i(a("p0pE")),n=i(a("qIgq")),s=a("LLXN"),l=i(a("mWxT")),o=i(a("+iC2")),u=a("+n12"),d=i(a("8pek")),c=i(a("v10I"));function h(e,t,a,i,r){var u=o.default.isCompanyAdmin(t),h=[{name:(0,s.formatMessage)({id:"menu.enterprise.dashboard"}),icon:d.default.getSvg("dashboard"),path:"/enterprise/".concat(e,"/index"),authority:["admin","user"]},{name:(0,s.formatMessage)({id:"menu.enterprise.share"}),icon:d.default.getSvg("shareAlt"),path:"/enterprise/".concat(e,"/shared/local"),authority:["admin","user"]}],m=c.default.getPluginInfo(i,"rainbond-observability"),g=c.default.getPluginInfo(i,"rainbond-enterprise-alarm"),f=c.default.getPluginInfo(i,"rainbond-enterprise-logs"),v=[];if(m&&0!==Object.keys(m).length&&v.push(m),g&&0!==Object.keys(g).length&&v.push(g),f&&0!==Object.keys(f).length&&v.push(f),v&&1==v.length){var b=Object.entries(v[0])[0];if(b.length>=1){var y=(0,n.default)(b,2),E=y[0],w=y[1];h.push({name:"\u53ef\u89c2\u6d4b\u6027",icon:d.default.getSvg("monitoringSvg"),path:"/enterprise/".concat(e,"/plugins/").concat((null===w||void 0===w?void 0:w.name)||"","?regionName=").concat(E),authority:["admin","user"]})}else{var S;h.push({name:"\u53ef\u89c2\u6d4b\u6027",icon:d.default.getSvg("monitoringSvg"),path:"/enterprise/".concat(e,"/plugins/").concat(null===(S=plugins)||void 0===S?void 0:S.name,"?regionName=").concat(regionName,"&showSelect=true"),authority:["admin","user"]})}}else if(0!=v.length&&v.length>=2){var _=[];v.forEach(e=>{if(1==Object.keys(e).length){var t,a,i,r=Object.keys(e),n=Object.values(e);_.push({name:null===(t=n[0])||void 0===t?void 0:t.display_name,icon:d.default.getSvg(null===(a=n[0])||void 0===a?void 0:a.name),path:"".concat(null===(i=n[0])||void 0===i?void 0:i.name,"?regionName=").concat(r[0]),authority:["admin","user"]})}else{var s,l,o,u=Object.keys(e),c=Object.values(e);_.push({name:null===(s=c[0])||void 0===s?void 0:s.display_name,icon:d.default.getSvg(null===(l=c[0])||void 0===l?void 0:l.name),path:"".concat(null===(o=c[0])||void 0===o?void 0:o.name,"?regionName=").concat(u[0],"&showSelect=true"),authority:["admin","user"]})}}),h.push({name:"\u53ef\u89c2\u6d4b\u6027",icon:d.default.getSvg("monitoringSvg"),path:"/enterprise/".concat(e,"/plugins"),authority:["admin","user"],children:_})}l.default.isEnableBillingFunction()&&h.push({name:"\u8ba2\u8d2d",icon:orderSvg,path:"/enterprise/".concat(e,"/orders/overviewService"),authority:["admin","user"]}),h.push({name:(0,s.formatMessage)({id:"menu.enterprise.team"}),icon:d.default.getSvg("teams"),path:"/enterprise/".concat(e,"/teams"),authority:["admin","user"]});var x=c.default.getPluginInfo(i,"rainbond-bill");if(x&&0!==Object.keys(x).length){var C=Object.entries(x)[0];if(C){var L=(0,n.default)(C,2),M=L[0];L[1];h.push({name:"\u8ba1\u91cf\u8ba1\u8d39",icon:d.default.getSvg("bill"),path:"/enterprise/".concat(e,"/plugins/rainbond-bill?regionName=").concat(M),authority:["admin","user"]})}}u&&(h.push({name:(0,s.formatMessage)({id:"menu.enterprise.cluster"}),icon:d.default.getSvg("clusters"),path:"/enterprise/".concat(e,"/clusters"),authority:["admin","user"]},{name:(0,s.formatMessage)({id:"menu.enterprise.user"}),icon:d.default.getSvg("users"),path:"/enterprise/".concat(e,"/users"),authority:["admin","user"]}),h.push({name:(0,s.formatMessage)({id:"menu.enterprise.log"}),icon:d.default.getSvg("logs"),path:"/enterprise/".concat(e,"/logs"),authority:["admin","user"]}),h.push({name:(0,s.formatMessage)({id:"menu.enterprise.extension"}),icon:d.default.getSvg("extension"),path:"/enterprise/".concat(e,"/extension"),authority:["admin","user"]}),h.push({name:(0,s.formatMessage)({id:"menu.enterprise.setting"}),icon:d.default.getSvg("setting"),path:"/enterprise/".concat(e,"/setting"),authority:["admin","user"]}));var k={};window.sessionStorage.getItem("cluster_info");if(i&&0!==Object.keys(i).length&&Object.entries(i).forEach(e=>{var t=(0,n.default)(e,2),a=t[0],i=t[1],r=c.default.segregatePluginsByHierarchy(i,"Platform");r.length>0&&(k[a]=r)}),k&&Object.keys(k).length>0){var I=[];Object.entries(k).forEach(e=>{var t=(0,n.default)(e,2),a=t[0],i=t[1],s=i.map(e=>({name:e.display_name,icon:d.default.getSvg("plugin"),path:k&&1===Object.keys(k).length?"".concat(e.name,"?regionName=").concat(a):e.name,authority:["admin","user"]}));Object.keys(k).length>1?I.push({name:p(r,a),icon:d.default.getSvg("clusters"),path:a,authority:["admin","user"],children:s}):I.push(...s)}),h.push({name:"\u63d2\u4ef6\u5217\u8868",icon:d.default.getSvg("plugin"),path:"/enterprise/".concat(e,"/plugins"),authority:["admin","user"],children:I})}return h}function p(e,t){var a=(e||[]).filter(e=>e.region_name==t);return a[0].region_alias||t}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;return e.map(e=>{var i=e.path;(0,u.isUrl)(i)||(i=t+e.path);var n=(0,r.default)({},e,{path:i,authority:e.authority||a});return e.children&&(n.children=m(e.children,"".concat(t).concat(e.path,"/"),e.authority)),n})}var g=(e,t,a,i,r)=>{var n=m(h(e,t,a,i,r));return n};t.getMenuData=g},WoCa:function(e,t,a){"use strict";var i=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("5Dmo");var n=i(a("3S7+"));a("+L6B");var s,l,o,u=i(a("2/Rp")),d=a("MuoO"),c=a("7DNP"),h=a("LLXN"),p=r(a("q1tI")),m=a("WGjm"),g=i(a("H0y2")),f=i(a("QDog")),v=i(a("tVMQ")),b=(s=(0,d.connect)(null,null,null,{withRef:!0}),s((o=class extends p.Component{constructor(e){super(e),this.onResizeStart=(e=>{}),this.onResize=(e=>{}),this.packUpOrDown=(e=>{var t=this.state.bool;t?this.setState({height:450}):this.setState({height:40}),this.setState({bool:!this.state.bool})}),this.terminalRepeal=(()=>{var e=this.props.dispatch;e({type:"region/terminalRepeal",payload:!0})}),this.newPage=(()=>{var e=this.props.dispatch;e({type:"region/terminalRepeal",payload:!0})}),this.state={bool:!1,height:400}}render(){var e=this.state,t=e.bool,a=e.height,i=f.default.getCurrEnterpriseId();return p.default.createElement(m.Resizable,{ref:"big",style:{position:"absolute",bottom:0,zIndex:9999},defaultSize:{height:400},size:{height:a},onResize:e=>this.onResize(e),onResizeStart:e=>this.onResizeStart(e),onResizeStop:(e,t,a,i)=>{this.setState({height:this.state.height+i.height})},minWidth:"100%",minHeight:40,maxHeight:"60vh"},p.default.createElement("div",{className:v.default.shell_head},p.default.createElement(n.default,{placement:"top",title:t?(0,h.formatMessage)({id:"otherEnterprise.shell.show"}):(0,h.formatMessage)({id:"otherEnterprise.shell.Pack_up"})},p.default.createElement(u.default,{type:"primary",icon:t?"vertical-align-top":"vertical-align-bottom",onClick:this.packUpOrDown,style:{margin:"0 20px 0 0"}})),p.default.createElement(c.Link,{to:"/enterprise/".concat(i,"/shell"),target:"_blank"},p.default.createElement(n.default,{placement:"top",title:(0,h.formatMessage)({id:"otherEnterprise.shell.new"})},p.default.createElement(u.default,{type:"primary",style:{margin:"0 20px 0 0"},icon:"arrows-alt",onClick:this.newPage}))),p.default.createElement(n.default,{placement:"top",title:(0,h.formatMessage)({id:"otherEnterprise.shell.down"})},p.default.createElement(u.default,{type:"primary",icon:"close",onClick:this.terminalRepeal,style:{margin:"0 20px 0 0"}}))),p.default.createElement("div",{style:{padding:"24px 24px 0 24px",height:"100%"}},p.default.createElement(g.default,{height:a})))}},l=o))||l),y=b;t.default=y},tVMQ:function(e,t,a){e.exports={box:"box___3Y3y1",shell_head:"shell_head___1Vcux"}},uHcJ:function(e,t,a){"use strict";var i=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fOrg");var n=r(a("+KLJ"));a("B9cy");var s=r(a("Ol7k")),l=r(a("TSYQ")),o=a("MuoO"),u=a("7DNP"),d=a("4zCG"),c=r(a("XaGS")),h=r(a("Wwog")),p=r(a("bALw")),m=r(a("17x9")),g=a("s4NR"),f=i(a("q1tI")),v=a("iTG7"),b=a("LLXN"),y=a("E6Dt"),E=r(a("i8i4")),w=r(a("ZFw/")),S=r(a("W2Kv")),_=a("W7L6"),x=r(a("/VoG")),C=r(a("NtFa")),L=r(a("h3zL")),M=r(a("CmFy")),k=r(a("xqX8")),I=r(a("AgvA")),N=(r(a("IamK")),r(a("HZnN"))),P=r(a("QDog")),R=r(a("mWxT")),O=r(a("+iC2")),j=r(a("2tDf")),T=r(a("R1Dz")),D=r(a("WoCa")),W=r(a("u95X")),A=r(a("v10I")),z=(a("mLYH"),r(a("ZShK")));a("d+3G");var G,U=s.default.Content,J=(0,h.default)(e=>{var t={},a=e=>{e.forEach(e=>{e.children&&a(e.children),t[e.path]=e})};return a(e),t},c.default),H={"screen-xs":{maxWidth:575},"screen-sm":{minWidth:576,maxWidth:767},"screen-md":{minWidth:768,maxWidth:991},"screen-lg":{minWidth:992,maxWidth:1199},"screen-xl":{minWidth:1200}};(0,d.enquireScreen)(e=>{G=e});class q extends f.PureComponent{constructor(e){super(e),this.handleLoadEnterpriseClusters=(()=>{var e=this.props.dispatch,t=P.default.getCurrEnterpriseId();e({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:t},callback:e=>{if(200==e.status_code&&(null===e||void 0===e?void 0:e.list)){this.setState({clusterList:null===e||void 0===e?void 0:e.list});var t=null===e||void 0===e?void 0:e.list.map(e=>{return this.handlePluginList(e.region_name)});Promise.all(t).then(()=>{this.setState({key:!1})}).catch(e=>{this.setState({key:!1})})}}})}),this.handlePluginList=(e=>{return new Promise((t,a)=>{var i=this.props.dispatch,r=P.default.getCurrEnterpriseId();i({type:"global/getPluginList",payload:{enterprise_id:r,region_name:e},callback:a=>{if(a&&a.list){i({type:"rbdPlugin/fetchPluginList",payload:a.list});var r=A.default.isInstallEnterprisePlugin(a.list);r?(window.localStorage.setItem("showEnterprisePlugin",r),this.setState({showEnterprisePlugin:r})):window.localStorage.setItem("showEnterprisePlugin","false");var n=this.state.pluginList;n[e]=a.list,this.setState({pluginList:n}),t()}},handleError:e=>{e&&(this.setState({pluginList:{}}),a(new Error("Failed to get component language version")))}})})}),this.handleGetEnterpeiseMsg=((e,t)=>{var a=this.props.dispatch,i=this.state.offLineDisNew;a({type:"global/fetchRainbondInfo",callback:r=>{if(r&&"false"!==r.is_offline&&(r.is_offline||"true"===r.is_offline))a({type:"global/putNewbieGuideConfig",payload:{arr:[...i]},callback:i=>{if(i){var r=R.default.isEnableNewbieGuide(e);a({type:"global/fetchNewbieGuideConfig",callback:e=>{e&&e.list&&3===e.list.length&&r&&a(u.routerRedux.push("/enterprise/".concat(t,"/clusters")))}})}},handleError:e=>{}});else{var n=R.default.isEnableNewbieGuide(e);n&&this.getNewbieGuideConfig(t)}},handleError:e=>{}})}),this.getEnterpriseList=(()=>{var e=this.props.dispatch;e({type:"global/fetchEnterpriseList",callback:e=>{if(e&&200===e.status_code){var t=!!(e.list&&e.list.length>0);this.setState({enterpriseList:e.list,ready:t},()=>{t?(this.redirectEnterpriseView(),this.load(),this.getAlertInfo()):this.handleJumpLogin()})}else this.handleJumpLogin()},handleError:()=>{this.handleJumpLogin()}})}),this.loadClusters=(e=>{var t=this.props,a=t.dispatch,i=t.currentUser;a({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:e,check_status:"no"},callback:t=>{var r=O.default.isCompanyAdmin(i);t&&t.list&&0===t.list.length&&r&&a(u.routerRedux.push("/enterprise/".concat(e,"/shared/local?init=true")))}})}),this.load=(()=>{(0,d.enquireScreen)(e=>{this.setState({isMobile:e})})}),this.getChildContext=(()=>{var e=this.props.location;return{location:e,breadcrumbNameMap:this.breadcrumbNameMap}}),this.matchParamsPath=(e=>{var t=Object.keys(this.breadcrumbNameMap).find(t=>{return(0,p.default)(t).test(e)});return this.breadcrumbNameMap[t]}),this.handleMenuCollapse=(e=>{var t=this.props.dispatch;t({type:"global/changeLayoutCollapsed",payload:e})}),this.handleJumpLogin=(()=>{var e=this.props.dispatch;e(u.routerRedux.push("/user/login"))}),this.redirectEnterpriseView=(()=>{var e=this.props,t=e.dispatch,a=e.currentUser,i=e.rainbondInfo,r=e.match.params.eid,n=this.state.enterpriseList;if((!r||"auto"===r)&&n.length>0){var s=null;n.map(e=>{return e.enterprise_id===a.enterprise_id&&(s=e),e}),null==s&&(s=n[0]),this.handlePutLog(i,s),this.fetchEnterpriseInfo(s.enterprise_id),this.setState({enterpriseInfo:s});var l=this.getLoginRole(a);t(u.routerRedux.replace(l))}else n.map(e=>{return e.enterprise_id===r&&(this.fetchEnterpriseInfo(r),this.handlePutLog(i,e),this.setState({enterpriseInfo:e})),e})}),this.handlePutLog=((e,t)=>{P.default.putLog(Object.assign(e,t))}),this.getNewbieGuideConfig=(e=>{var t=this.props.dispatch;t({type:"global/fetchNewbieGuideConfig",callback:t=>{var a=R.default.handleNewbie(t&&t.list,"welcome");a&&this.loadClusters(e)}})}),this.fetchEnterpriseInfo=(e=>{if(!e)return null;var t=this.props.dispatch;t({type:"global/fetchEnterpriseInfo",payload:{enterprise_id:e},callback:t=>{t&&t.bean&&this.handleGetEnterpeiseMsg(t.bean,e)}})}),this.fetchEnterpriseService=(e=>{var t=this.props.dispatch;t({type:"order/fetchEnterpriseService",payload:{enterprise_id:e}})}),this.getAlertInfo=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"global/getRainbondAlert",payload:{enterprise_id:a},callback:e=>{e&&e.bean&&e.list.length>0&&this.setState({alertInfo:e.list})},handleError:e=>{console.log(e)}})}),this.onJumpPersonal=(()=>{var e=this.props,t=(e.match.params.eid,e.dispatch),a=e.currentUser;t(u.routerRedux.replace(this.getLoginRole(a)))}),this.getLoginRole=(e=>{this.props.dispatch;var t=e.teams;if(t&&t.length>0){var a=t[0],i=a.team_name,r=a.region,n=r[0].team_region_name;if(i&&n)return"/team/".concat(i,"/region/").concat(n,"/index")}else if(null===e||void 0===e?void 0:e.is_enterprise_admin)return"/enterprise/".concat(null===e||void 0===e?void 0:e.enterprise_id,"/index")}),this.breadcrumbNameMap=J((0,_.getMenuData)(this.props.groups)),this.state={isMobile:G,enterpriseList:[],enterpriseInfo:!1,ready:!1,alertInfo:[],offLineDisNew:[{key:"welcome",value:!0},{key:"applicationInfo",value:!0},{key:"installApp",value:!0}],showMenu:!0,pluginList:{},key:!0,showEnterprisePlugin:!1}}componentDidMount(){this.handleMenuCollapse(!1),this.getEnterpriseList(),this.handleLoadEnterpriseClusters();var e=new URL(window.location.href);if(e){var t=e.href.includes("/shell");t&&this.setState({showMenu:!1})}}getContext(){var e=this.props.location;return{location:e,breadcrumbNameMap:this.breadcrumbNameMap}}render(){var e=this.props,t=e.memoryTip,a=e.currentUser,i=e.collapsed,r=e.location,o=e.location.pathname,d=e.match.params.eid,c=e.orders,h=e.children,p=e.rainbondInfo,m=e.enterprise,P=e.showAuthCompany,O=e.terminalStatus,A=this.state,G=A.enterpriseList,J=A.enterpriseInfo,q=A.ready,X=A.alertInfo,B=A.pluginList,F=A.clusterList,Q=(A.showEnterprisePlugin,R.default.isEnableBillingFunction()),V=(0,g.stringify)({redirect:window.location.href});if(!q||!J)return f.default.createElement(k.default,null);if(!a||!p||0===G.length)return f.default.createElement(u.Redirect,{to:"/user/login?".concat(V)});var K=R.default.fetchLogo(p,m)||S.default,Y=()=>{return f.default.createElement("div",{className:L.default.enterprise,onClick:this.onJumpPersonal},f.default.createElement("img",{src:K,alt:""}))},Z=()=>{return f.default.createElement(u.Link,{style:{color:"#fff",fontSize:"16px",fontWeight:"bolder"},onClick:this.onJumpPersonal},(0,b.formatMessage)({id:"enterpriseTeamManagement.other.personal"}))},$=()=>{var e=this.props.rainbondInfo,t=e&&e.is_alarm&&e.is_alarm.enable,l=this.state,c=l.showMenu,p=l.key,g=new URL(window.location.href),b=g.href.includes("/addCluster"),y=g.href.includes("/provider"),E=b||y;return f.default.createElement(s.default,null,f.default.createElement(s.default,null,f.default.createElement(C.default,{eid:d,logo:K,isPubCloud:e&&e.is_public&&e.is_public.enable,is_enterprise:!0,currentUser:a,collapsed:i,onCollapse:this.handleMenuCollapse,isMobile:this.state.isMobile,customHeaderImg:Y,customHeader:Z}),f.default.createElement(s.default,{style:{flexDirection:"row"}},f.default.createElement(M.default,{key:p,currentEnterprise:J,enterpriseList:G,title:e&&e.title&&e.title.enable&&e.title.value,currentUser:a,Authorized:N.default,menuData:(0,_.getMenuData)(d,a,m,B,F),showMenu:c,pathname:o,location:r,isMobile:this.state.isMobile,collapsed:i,onCollapse:this.handleMenuCollapse}),f.default.createElement("div",{style:{width:c?i?"calc( 100% - 56px)":"calc( 100% - 200px)":"100%"}},f.default.createElement(v.TransitionGroup,{style:{height:"calc(100vh - 64px)",overflow:"auto",width:"100%"}},f.default.createElement(v.CSSTransition,{timeout:300,classNames:{enter:"animate__animated",enterActive:"animate__fadeIn"},unmountOnExit:!0,key:E?"":this.props.location.pathname},f.default.createElement(U,{key:d,style:{height:"calc(100vh - 64px)",overflow:"auto",width:"100%"},className:W.default.bgc},t?X.length>0&&X.map(e=>{return f.default.createElement("div",{className:W.default.alerts},f.default.createElement(n.default,{style:{textAlign:"left",marginTop:"4px",marginBottom:"4px",color:"#c40000",background:"#fff1f0",border:" 1px solid red"},message:e.annotations.description||e.annotations.summary,type:"warning",showIcon:!0}))}):null,f.default.createElement("div",{style:{margin:"24px 24px 0"}},f.default.createElement(N.default,{logined:!0,authority:["admin","user"],noMatch:f.default.createElement(u.Redirect,{to:"/user/login"})},h,c&&f.default.createElement(z.default,null))))))))))},ee=R.default.fetchSiteTitle(p);return f.default.createElement(f.Fragment,null,f.default.createElement(w.default,{title:ee},f.default.createElement(y.ContainerQuery,{query:H},e=>f.default.createElement(T.default.Provider,{value:this.getContext()},f.default.createElement("div",{className:(0,l.default)(e)},$())))),P&&f.default.createElement(x.default,{eid:d,marketName:P,currStep:0}),t&&f.default.createElement(j.default,{memoryTip:t}),c&&Q&&f.default.createElement(I.default,{eid:d,orders:c}),O&&E.default.createPortal(f.default.createElement(D.default,null),document.getElementById("root")))}}q.childContextTypes={location:m.default.object,breadcrumbNameMap:m.default.object,currRegion:m.default.string,currTeam:m.default.string};var X=(0,o.connect)(e=>{var t=e.user,a=e.global,i=e.index,r=e.loading,n=e.region;return{currentUser:t.currentUser,notifyCount:t.notifyCount,collapsed:a.collapsed,groups:a.groups,fetchingNotices:r.effects["global/fetchNotices"],notices:a.notices,currTeam:P.default.getCurrTeamName(),currRegion:P.default.getCurrRegionName(),rainbondInfo:a.rainbondInfo,payTip:a.payTip,memoryTip:a.memoryTip,noMoneyTip:a.noMoneyTip,showAuthCompany:a.showAuthCompany,orders:a.orders,overviewInfo:i.overviewInfo,nouse:a.nouse,enterprise:a.enterprise,terminalStatus:n.terminal_status,rainbondInfo:a.rainbondInfo}})(q);t.default=X}}]);