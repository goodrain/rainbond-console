(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{IWTo:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var s=l(a("bx4M"));a("jCWc");var d=l(a("kPKH"));a("14J3");var i=l(a("BMrR"));a("/zsF");var n=l(a("PArb"));a("qVdP");var o=l(a("jsC+"));a("lUTK");var u=l(a("BvKs")),c=l(a("jehZ"));a("y8nQ");var m=l(a("Vl3Y"));a("tU7J");var p=l(a("wFql"));a("FJo9");var f,h,C,g,v=l(a("L41K")),y=l(a("18gR")),E=l(a("puxM")),_=a("MuoO"),b=a("7DNP"),k=r(a("q1tI")),M=a("LLXN"),S=l(a("sYrh")),w=l(a("VQ3Z")),I=l(a("XZXw")),F=l(a("QDog")),x=(l(a("AklW")),l(a("mWxT"))),A=l(a("+iC2")),L=l(a("2lxJ")),N=l(a("nfvM")),D=(v.default.Step,p.default.Paragraph,f=m.default.create(),h=(0,_.connect)(e=>{var t=e.user,a=e.list,l=e.loading,r=e.global,s=e.index;return{user:t.currentUser,list:a,loading:l.models.list,rainbondInfo:r.rainbondInfo,enterprise:r.enterprise,isRegist:r.isRegist,oauthLongin:l.effects["global/creatOauth"],overviewInfo:s.overviewInfo}}),f(C=h((g=class extends k.PureComponent{constructor(e){super(e),this.setProvider=(e=>{this.setState({selectProvider:e})}),this.loadClusters=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:a},callback:e=>{if(e&&e.list){var t=[];e.list.map((e,a)=>{return e.key="cluster".concat(a),t.push(e),e}),this.setState({clusters:t})}else this.setState({clusters:[]})}})}),this.cancelAddCluster=(()=>{this.setState({addClusterShow:!1})}),this.cancelAddCustomCluster=(()=>{this.setState({addCustomClusterShow:!1})}),this.addClusterShow=(()=>{this.setState({addClusterShow:!0})}),this.toClusterList=(e=>{var t=this.props.dispatch,a=this.props.match.params.eid,l={initializing:"/enterprise/{eid}/provider/{provider}/kclusters/append?event_id={eventId}",initialized:"/enterprise/{eid}/provider/{provider}/kclusters?event_id={eventId}",installing:"/enterprise/{eid}/provider/{provider}/kclusters?type=installing&event_id={eventId}",installed:"/enterprise/{eid}/provider/{provider}/kclusters?event_id={eventId}",integrating:"/enterprise/{eid}/provider/{provider}/kclusters/init?event_id={eventId}",integrated:"/enterprise/{eid}/provider/{provider}/kclusters/check?event_id={eventId}"};t({type:"region/fetchClusterInfo",payload:{cluster_id:""},callback:r=>{if(r&&200===r.status_code){window.localStorage.setItem("event_id",r.bean.event_id);var s=r.bean.create_status,d=l[s]||l.initializing;d=d.replace("{eid}",a).replace("{provider}",e),d.includes("{eventId}")&&(d=d.replace("{eventId}",r.bean.event_id)),t(b.routerRedux.push(d))}}})}),this.handleInstallRegion=(e=>{var t=this.props,a=t.dispatch,l=t.match.params.eid;switch(e){case"helm":a(b.routerRedux.push("/enterprise/".concat(l,"/provider/ACksterList")));break;case"aliyun":a(b.routerRedux.push("/enterprise/".concat(l,"/provider/ACksterList?mode=ack")));break;case"tencent":a(b.routerRedux.push("/enterprise/".concat(l,"/provider/ACksterList?mode=tencent")));break;case"huawei":a(b.routerRedux.push("/enterprise/".concat(l,"/provider/ACksterList?mode=huawei")));break;default:break}}),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(b.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.state.currentStep;this.setState({currentStep:e-1})}),this.loadSteps=(()=>{var e=[{title:(0,M.formatMessage)({id:"enterpriseColony.addCluster.supplier"})},{title:(0,M.formatMessage)({id:"enterpriseColony.addCluster.cluster"})},{title:(0,M.formatMessage)({id:"enterpriseColony.addCluster.Initialize"})},{title:(0,M.formatMessage)({id:"enterpriseColony.addCluster.clusterInit"})},{title:(0,M.formatMessage)({id:"enterpriseColony.addCluster.docking"})}];return e}),this.showInitTaskDetail=(e=>{this.setState({showInitTaskDetail:!0,initTask:e})}),this.completeInit=(e=>{this.setState({currentStep:3,selectProvider:e.providerName})}),this.cancelShowInitDetail=(()=>{this.setState({showInitTaskDetail:!1})}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep;return k.default.createElement(y.default,(0,c.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close")},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(this.toClusterList("rke"),this.handleGuideStep(a),4===a&&document.getElementById("cloudServiceBtn").scrollIntoView())}}))});var t=this.props.user,a=A.default.isCompanyAdmin(t);this.state={adminer:a,addClusterShow:!1,addCustomClusterShow:!1,selectProvider:"ack",currentStep:0,guideStep:2,loading:!1,initTask:{},clusters:null}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(b.routerRedux.push("/"))}componentDidMount(){this.loadClusters()}render(){var e=this.state,t=e.addClusterShow,a=e.addCustomClusterShow,l=(e.selectProvider,e.currentStep,e.guideStep),r=(e.loading,e.showInitTaskDetail,e.initTask,e.clusters),c=this.props.match.params.eid,m=(x.default.isEnableK8sCluster(),k.default.createElement(u.default,null,k.default.createElement(u.default.Item,null,k.default.createElement("a",{onClick:e=>{e.preventDefault(),this.addClusterShow()}},k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.cluster"}))))),p=k.default.createElement("div",null,k.default.createElement(o.default,{overlay:m,placement:"bottomRight"},F.default.fetchSvg("omitIcon")));return k.default.createElement(I.default,{title:k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.button.text"}),content:k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.PageHeaderLayout.content"}),extraContent:p,titleSvg:L.default.getPageHeaderSvg("clusters",18)},k.default.createElement(E.default,{sm:840},k.default.createElement(s.default,{style:{marginBottom:"16px",borderRadius:5}},k.default.createElement(i.default,null,k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.infrastructure"})),k.default.createElement(n.default,null)),k.default.createElement(i.default,null,k.default.createElement(d.default,{span:12},k.default.createElement("div",{onClick:()=>this.toClusterList("rke"),className:N.default.import},k.default.createElement("div",{className:N.default.importicon},F.default.fetchSvg("hostIcon")),k.default.createElement("div",{className:N.default.importDesc},k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.host"})),k.default.createElement("p",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.automatically"})))),2===l&&r&&0===r.length&&this.handleNewbieGuiding({tit:(0,M.formatMessage)({id:"enterpriseColony.addCluster.install"}),configName:"hostInstall",desc:(0,M.formatMessage)({id:"enterpriseColony.addCluster.common"}),nextStep:3,svgPosition:{marginLeft:"58px"}})),k.default.createElement(d.default,{span:12},k.default.createElement("div",{onClick:()=>{this.handleInstallRegion("helm")},className:N.default.import},k.default.createElement("div",{className:N.default.importicon},F.default.fetchSvg("kubernetesIcon")),k.default.createElement("div",{className:N.default.importDesc},k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.colony"})),k.default.createElement("p",null," ",k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.management"}))))))),k.default.createElement(s.default,{style:{borderRadius:5}},k.default.createElement(i.default,null,k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.service"})),k.default.createElement(n.default,null)),k.default.createElement(i.default,{style:{display:"flex",justifyContent:"space-around"}},k.default.createElement(d.default,{style:{width:"33%"}},k.default.createElement("div",{onClick:()=>{this.handleInstallRegion("aliyun")},className:N.default.import},k.default.createElement("div",{className:N.default.importicon},F.default.fetchSvg("aliIcon")),k.default.createElement("div",{className:N.default.importDesc},k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.ali"})),k.default.createElement("p",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.manage"}))))),k.default.createElement(d.default,{style:{width:"33%"}},k.default.createElement("div",{onClick:()=>{this.handleInstallRegion("huawei")},className:N.default.import},k.default.createElement("div",{className:N.default.importicon},F.default.fetchSvg("huaweiIcon")),k.default.createElement("div",{className:N.default.importDesc},k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.huawei"})),k.default.createElement("p",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.Docking"}))))),k.default.createElement(d.default,{style:{width:"33%"}},k.default.createElement("div",{onClick:()=>{this.handleInstallRegion("tencent")},className:N.default.import},k.default.createElement("div",{className:N.default.importicon},F.default.fetchSvg("tencentIcon")),k.default.createElement("div",{className:N.default.importDesc},k.default.createElement("h3",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.tenxun"})),k.default.createElement("p",null,k.default.createElement(M.FormattedMessage,{id:"enterpriseColony.addCluster.clusters"}))))))),t&&k.default.createElement(S.default,{eid:c,onOk:this.addClusterOK,onCancel:this.cancelAddCluster}),a&&k.default.createElement(w.default,{eid:c,onCancel:this.cancelAddCustomCluster})))}},C=g))||C)||C);t.default=D},VQ3Z:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=l(a("kLXV"));a("jCWc");var d=l(a("kPKH"));a("y8nQ");var i=l(a("Vl3Y"));a("5NDa");var n=l(a("5rEg"));a("/xke");var o,u,c,m=l(a("TeRw")),p=l(a("p0pE")),f=a("MuoO"),h=r(a("q1tI")),C=a("LLXN"),g=l(a("AklW")),v=l(a("ZNrE")),y=l(a("e6Ls")),E=(o=(0,f.connect)(),o((c=class extends h.PureComponent{constructor(e){super(e),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.eid,r=e.onOK;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,p.default)({enterprise_id:l,provider_name:"custom"},t),callback:e=>{e&&r&&r(e)},handleError:e=>{e&&e.data&&7005===e.data.code?this.setState({loading:!1}):(g.default.handleCloudAPIError(e),this.setState({loading:!1}))}}))})}),this.beforeUpload=((e,t)=>{var a=e.name.split("."),l=a.length,r="yaml"===a[l-1]||"yml"===a[l-1];return!!r||(t&&m.default.warning({message:(0,C.formatMessage)({id:"notification.warn.yaml_file"})}),!1)}),this.checkConfigFile=((e,t,a)=>{if(t){if(!t.file.name.endsWith(".yaml")&&!t.file.name.endsWith(".yml"))return void a("\u8bf7\u4e0a\u4f20\u4ee5yaml\u3001yml\u7ed3\u5c3e\u7684 Region Config \u6587\u4ef6");if(t.fileList.length>0){var l=t.fileList.splice(-1);return this.readFileContents(l,"token"),void a()}a("\u4e0a\u4f20\u7684 Region Config \u6587\u4ef6\u975e\u6cd5")}else a()}),this.state={loading:!1}}render(){var e=this.props,t=e.form,a=e.onCancel,l=this.state.loading,r=t.getFieldDecorator,o=t.setFieldsValue,u={padding:"0 16px"},c={labelCol:{xs:{span:24}},wrapperCol:{xs:{span:24}}};return h.default.createElement(s.default,{visible:!0,title:h.default.createElement(C.FormattedMessage,{id:"enterpriseColony.CustomClusterAdd.title"}),className:y.default.TelescopicModal,onOk:this.handleSubmit,width:800,confirmLoading:l,onCancel:a},h.default.createElement(i.default,{labelAlign:"left",onSubmit:this.handleSubmit},h.default.createElement(d.default,{style:u},h.default.createElement(i.default.Item,{label:h.default.createElement(C.FormattedMessage,{id:"enterpriseColony.addCluster.host.name_Cluster"})},r("name",{initialValue:"",rules:[{required:!0,message:(0,C.formatMessage)({id:"enterpriseColony.addCluster.host.required"})},{pattern:/^[a-z0-9A-Z-]+$/,message:(0,C.formatMessage)({id:"enterpriseColony.addCluster.host.supported"})},{max:24,message:(0,C.formatMessage)({id:"enterpriseColony.addCluster.host.max"})}]})(h.default.createElement(n.default,{placeholder:(0,C.formatMessage)({id:"enterpriseColony.addCluster.host.only"})})))),h.default.createElement(d.default,{style:u},h.default.createElement(v.default,{titles:h.default.createElement(C.FormattedMessage,{id:"enterpriseColony.CustomClusterAdd.titles"}),setFieldsValue:o,formItemLayout:c,Form:i.default,getFieldDecorator:r,beforeUpload:this.beforeUpload,mode:"yaml",name:"kubeconfig",label:"KubeConfig",message:h.default.createElement(C.FormattedMessage,{id:"enterpriseColony.CustomClusterAdd.msg"}),width:"720px"}))))}},u=c))||u),_=i.default.create()(E),b=_;t.default=b},nfvM:function(e,t,a){e.exports={nameID:"nameID___1S-1f",icon:"icon___14fiC",iconm:"iconm___1EpSz",import:"import___1oF_y",importicon:"importicon___3k-FZ",importDesc:"importDesc___1Ra8i",provider:"provider___rOvOw",providerActive:"providerActive___3ToCd",providericon:"providericon___2Gf-J",providerDesc:"providerDesc___1ThEV",providerChecked:"providerChecked___1sdfZ",disable:"disable___1AiPb",noCluster:"noCluster___2k16e",describe:"describe___uPL4n",initModal:"initModal___XS-LF"}},sYrh:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var s=l(a("kLXV"));a("jCWc");var d=l(a("kPKH")),i=l(a("jehZ"));a("5NDa");var n=l(a("5rEg")),o=l(a("p0pE"));a("/xke");var u=l(a("TeRw"));a("y8nQ");var c,m,p,f=l(a("Vl3Y")),h=a("MuoO"),C=r(a("q1tI")),g=a("LLXN"),v=l(a("QDog")),y=l(a("ZNrE")),E=l(a("e6Ls")),_=f.default.Item,b=(c=(0,h.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),c((p=class extends C.PureComponent{constructor(){super(...arguments),this.handleSubmit=(()=>{var e=this.props.form,t=e.validateFields;t((e,t)=>{e||this.createClusters(t)})}),this.beforeUpload=((e,t)=>{var a=e.name.split("."),l=a.length,r="yaml"===a[l-1]||"yml"===a[l-1];return!!r||(t&&u.default.warning({message:(0,g.formatMessage)({id:"notification.warn.yaml_file"})}),!1)}),this.checkConfigFile=((e,t,a)=>{if(t){if(!t.file.name.endsWith(".yaml")&&!t.file.name.endsWith(".yml"))return void a("\u8bf7\u4e0a\u4f20\u4ee5yaml\u3001yml\u7ed3\u5c3e\u7684 Region Config \u6587\u4ef6");if(t.fileList.length>0){var l=t.fileList.splice(-1);return this.readFileContents(l,"token"),void a()}a("\u4e0a\u4f20\u7684 Region Config \u6587\u4ef6\u975e\u6cd5")}else a()}),this.createClusters=(e=>{var t=this.props,a=t.onOk,l=t.dispatch,r=t.eid,s=t.rainbondInfo,d=t.enterprise;l({type:"region/createEnterpriseCluster",payload:(0,o.default)({},e,{region_type:["custom"],enterprise_id:r,provider:"directly",providerClusterID:""}),callback:e=>{e&&200===e._condition&&(u.default.success({message:(0,g.formatMessage)({id:"notification.success.add"})}),v.default.putInstallClusterLog(d,s,{eid:r,status:"complete",install_step:"directly",provider:"directly"}),a&&a())}})})}render(){var e=this.props,t=e.form,a=e.onCancel,l=t.getFieldDecorator,r=t.setFieldsValue,o={labelCol:{xs:{span:24}},wrapperCol:{xs:{span:24}}};return C.default.createElement(s.default,{visible:!0,title:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.BaseAddCluster.add"}),className:E.default.TelescopicModal,onOk:this.handleSubmit,width:800,onCancel:a},C.default.createElement(f.default,{labelAlign:"left",onSubmit:this.handleSubmit},C.default.createElement(d.default,{style:{display:"flex"}},C.default.createElement(_,(0,i.default)({},o,{label:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.BaseAddCluster.id"}),style:{width:"50%",padding:"0 16px"}}),l("region_name",{initialValue:"",rules:[{required:!0,message:(0,g.formatMessage)({id:"enterpriseColony.BaseAddCluster.not"})},{pattern:/^[a-z0-9A-Z-_]+$/,message:(0,g.formatMessage)({id:"enterpriseColony.addCluster.host.supported"})}]})(C.default.createElement(n.default,{placeholder:(0,g.formatMessage)({id:"enterpriseColony.BaseAddCluster.input_id"})}))),C.default.createElement(_,(0,i.default)({},o,{label:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.addCluster.host.name_Cluster"}),style:{width:"50%",padding:"0 16px"}}),l("region_alias",{initialValue:"",rules:[{required:!0,message:(0,g.formatMessage)({id:"enterpriseColony.addCluster.host.input_name"})},{max:24,message:(0,g.formatMessage)({id:"enterpriseColony.addCluster.host.max"})}]})(C.default.createElement(n.default,{placeholder:(0,g.formatMessage)({id:"enterpriseColony.BaseAddCluster.name"})})))),C.default.createElement(d.default,{style:{display:"flex"}},C.default.createElement(_,(0,i.default)({},o,{label:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.BaseAddCluster.lable"}),style:{width:"100%",padding:"0 16px"}}),l("desc",{initialValue:""})(C.default.createElement(n.default,{placeholder:(0,g.formatMessage)({id:"enterpriseColony.BaseAddCluster.Remarks"})})))),C.default.createElement(y.default,{titles:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.BaseAddCluster.titles"}),setFieldsValue:r,formItemLayout:o,Form:f.default,getFieldDecorator:l,beforeUpload:this.beforeUpload,mode:"yaml",name:"token",label:"Region Config",message:C.default.createElement(g.FormattedMessage,{id:"enterpriseColony.CustomClusterAdd.msg"}),width:"752px"})))}},m=p))||m),k=f.default.create()(b),M=k;t.default=M}}]);