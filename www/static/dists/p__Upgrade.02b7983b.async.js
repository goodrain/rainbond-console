<<<<<<< HEAD:www/static/dists/p__Upgrade.2a06fe51.async.js
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[73],{NkCp:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("IzEo");var s=l(a("bx4M"));a("+L6B");var i=l(a("2/Rp"));a("y8nQ");var o,d,c,p,u=l(a("Vl3Y")),h=l(a("e6Ls")),m=a("MuoO"),g=r(a("q1tI")),f=a("xpXo"),_=l(a("4W9V")),v=l(a("VZuE")),k=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordDetails=(()=>{var e=this.props,t=e.team_name,a=e.group_id,l=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordDetails)({team_name:t,group_id:a,record_id:l.ID,noModels:!0}).then(e=>{var t=e.bean||{};this.setState({list:t.service_record||[],textState:t.status,recordLoading:!1},()=>{4===t.status&&setTimeout(()=>{this.fetchRollsBackRecordDetails()},3e3)})}).catch(e=>{(0,_.default)(e)})}),this.handleRetry=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.team_name,r=e.group_id,n=e.info,s=this.state.upgradeLoading;t.validateFields(e=>{e||s||this.setState({upgradeLoading:!0},()=>{a({type:"global/fetchAppRedeploy",payload:{team_name:l,group_id:r,record_id:n.ID},callback:e=>{e&&200===e.status_code&&this.setState({upgradeLoading:!1},()=>{this.fetchRollsBackRecordDetails()})},handleError:e=>{(0,_.default)(e),this.fetchRollsBackRecordDetails()}})})})}),this.state={list:[],textState:"",upgradeLoading:!1,recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordDetails()}render(){var e=this.props,t=e.onCancel,a=e.loading,l=void 0!==a&&a,r=this.state,o=r.recordLoading,d=r.list,c=r.textState,p=r.upgradeLoading,u={width:d&&1===d.length?"100%":"50%",textAlign:"center"},m=[7,10].includes(c);return g.default.createElement(n.default,{visible:!0,title:"\u56de\u6eda\u8be6\u60c5",width:1e3,confirmLoading:l,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(s.default,{title:"\u7ec4\u4ef6\u5217\u8868",loading:o,extra:g.default.createElement(i.default,{type:"primary",loading:p,onClick:m?this.handleRetry:t},m?"\u91cd\u8bd5":v.default.getStatusCNS(c))},d&&d.length>0&&d.map(e=>{var t=e.ID,a=e.status,l=e.service_cname;return g.default.createElement(s.default.Grid,{key:t,style:u},l," \u72b6\u6001\uff1a",g.default.createElement("span",{style:{color:v.default.getStatusColor(a)}},v.default.getStatusCNS(a)))})))}},c=p))||c)||c);t.default=k},T40H:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var n=l(a("2/Rp"));a("2qtc");var s=l(a("kLXV")),i=l(a("jehZ"));a("g9YV");var o=l(a("wCAj"));a("Mwp2");var d=l(a("VXEj"));a("Telt");var c=l(a("Tckk"));a("T2oS");var p=l(a("W9HT"));a("+BJd");var u=l(a("mr32"));a("5Dmo");var h=l(a("3S7+"));a("y8nQ");var m=l(a("Vl3Y"));a("Znn+");var g,f,_,v,k=l(a("ZTPi")),b=l(a("x9lC")),L=a("MuoO"),E=a("7DNP"),R=l(a("wd/R")),y=r(a("q1tI")),C=l(a("iPMB")),w=l(a("XZXw")),D=a("xpXo"),S=a("vSx2"),I=l(a("4W9V")),x=l(a("QDog")),M=l(a("hMqj")),A=l(a("Utb7")),z=l(a("NkCp")),N=l(a("ZBNA")),P=l(a("VZuE")),T=k.default.TabPane,U=(g=m.default.create(),f=(0,L.connect)(e=>{var t=e.user,a=e.global,l=e.application,r=e.teamControl,n=e.enterprise;return{groupDetail:l.groupDetail||{},currUser:t.pageUser,groups:a.groups||[],currentTeam:r.currentTeam,currentRegionName:r.currentRegionName,currentEnterprise:n.currentEnterprise,currentTeamPermissionsInfo:r.currentTeamPermissionsInfo}}),g(_=f((v=class extends y.PureComponent{constructor(e){super(e),this.onUpgrade=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.getAppModelLastRecord)({appID:l,team_name:a,upgrade_group_id:e.upgrade_group_id}).then(t=>{var a=t.bean&&t.bean.status;if(a){if([6,10].includes(a))return void this.setState({isDeploymentFailure:10===a,isPartiallyCompleted:6===a,showLastUpgradeRecord:!0,upgradeItem:e});if([3,8].includes(a))return void this.createNewRecord(e);this.openInfoPage(t.bean)}else this.createNewRecord(e)})}),this.getApplication=(()=>{var e=this.props.dispatch;e({type:"global/application",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId()},callback:e=>{e&&200===e.status_code&&this.setState({dataList:e.list||[]}),this.handleCancelLoading()}})}),this.getParameter=(()=>{var e=this.props.match.params,t=e.teamName,a=e.regionName,l=e.appID;return{team_name:t,region_name:a,group_id:l}}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.getUpgradeRecordsList=(()=>{var e=this.state,t=e.page,a=e.pageSize,l=this.getParameter(),r=l.team_name,n=l.group_id;this.props.dispatch({type:"global/CloudAppUpdateRecordsList",payload:{team_name:r,group_id:n,page:t,pageSize:a,status__gt:1},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list||[],total:e.bean&&e.bean.total}),this.handleCancelLoading()}})}),this.getVersionChangeShow=(e=>{return e.market_name?y.default.createElement("div",null,"\u901a\u8fc7\u5e94\u7528\u5546\u5e97\uff08",e.market_name,"\uff09\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version)):y.default.createElement("div",null,"\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version))}),this.fetchAppLastUpgradeRecord=(()=>{var e=this.getParameter(),t=e.team_name,a=e.group_id;(0,D.getAppModelLastRecord)({team_name:t,appID:a,noModels:!0}).then(e=>{var t=e.bean;t&&"{}"!==JSON.stringify(t)&&this.setState({lastRecord:t,showLastUpgradeRecord:[2].includes(t.status)})}).catch(e=>{(0,I.default)(e)})}),this.fetchAppLastRollbackRecord=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.getAppModelLastRecord)({team_name:a,appID:l,record_type:"rollback",noModels:!0}).then(t=>{var a=t.bean;if(a&&"{}"!==JSON.stringify(a)){var l=[4].includes(a.status);l?this.setState({lastRecord:a,showLastRollbackRecord:l}):this.onUpgrade(e)}else this.onUpgrade(e)}).catch(e=>{(0,I.default)(e)})}),this.getUpgradeRecordsHelmList=(()=>{var e=this.state,t=e.page,a=e.pageSize;this.props.dispatch({type:"global/fetchUpgradeRecordsHelmList",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId(),page:t,pageSize:a},callback:e=>{this.handleLoading(),e&&200===e.status_code&&this.setState({list:e.list||[]}),this.handleCancelLoading()}})}),this.handleLoading=(()=>{this.setState({loadingList:!1,recordLoading:!1,upgradeLoading:!1})}),this.createNewRecord=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.postUpgradeRecord)({team_name:a,appID:l,upgrade_group_id:e.upgrade_group_id,noModels:!0}).then(e=>{this.openInfoPage(e.bean)}).catch(e=>{(0,I.default)(e)})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:this.getParameter(),callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1},()=>{e.bean&&e.bean.app_type&&"helm"===e.bean.app_type?this.handleTabs("2"):this.getApplication()})},handleError:t=>{t&&404===t.code&&e(E.routerRedux.push("/team/".concat(x.default.getCurrTeamName(),"/region/").concat(x.default.getCurrRegionName(),"/apps")))}})}),this.openInfoPage=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id,r=this.props.dispatch;r(E.routerRedux.push("/team/".concat(a,"/region/").concat(x.default.getCurrRegionName(),"/apps/").concat(l,"/upgrade/").concat(e.upgrade_group_id,"/record/").concat(e.ID,"?app_id=").concat(e.group_key)))}),this.showMarketAppDetail=(e=>{this.setState({showApp:e,showMarketAppDetail:!0})}),this.showRollback=(e=>{this.setState({showRollbackConfirm:e,rollbackRecord:e})}),this.showRollbackList=(e=>{this.setState({rollbackRecords:e})}),this.showRollbackDetails=(e=>{this.setState({rollbackRecordDetails:e})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.handleTabs=(e=>{var t=this.state.appDetail;this.setState({upgradeLoading:!0,recordLoading:!0,activeKey:e},()=>{"helm"===t.app_type?this.getUpgradeRecordsHelmList():"2"===e?this.getUpgradeRecordsList():this.getApplication()})}),this.handleTableChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.getUpgradeRecordsList()})}),this.rollbackUpgrade=(()=>{this.handleBackUpgradeLoading(!0);var e=this.state.rollbackRecord,t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.rollbackUpgrade)({team_name:a,appID:l,record_id:e.ID}).then(e=>{this.handleBackUpgradeLoading(!1),this.showRollback(!1),this.showRollbackDetails(e&&e.bean)}).catch(e=>{this.handleBackUpgradeLoading(!1),(0,I.default)(e)})}),this.handleBackUpgradeLoading=(e=>{this.setState({backUpgradeLoading:e})}),this.showComponentVersion=(e=>{this.setState({isComponent:e})}),this.handleCancelComponent=(()=>{this.setState({isComponent:!1})}),this.handleCancelLoading=(()=>{this.setState({loadingList:!1,upgradeLoading:!1,recordLoading:!1})}),this.state={loadingDetail:!0,loadingList:!0,isDeploymentFailure:!1,isPartiallyCompleted:!1,upgradeLoading:!0,recordLoading:!0,isComponent:!1,showApp:{},showMarketAppDetail:!1,list:[],activeKey:"1",page:1,pageSize:10,total:0,dataList:[],appDetail:{},backUpgradeLoading:!1,showLastUpgradeRecord:!1,showLastRollbackRecord:!1,rollbackRecords:!1,rollbackRecordDetails:!1}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,l=M.default.queryAppInfo(t,"upgrade");l||x.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.getApplication(),this.fetchAppLastUpgradeRecord()}render(){var e=this.props,t=e.currentEnterprise,l=e.currentTeam,r=e.currentRegionName,m=this.state,g=m.loadingList,f=m.recordLoading,_=m.upgradeLoading,v=m.list,L=m.showMarketAppDetail,E=m.showApp,D=m.activeKey,I=m.page,x=m.total,M=m.pageSize,U=m.dataList,V=m.appDetail,B=m.isComponent,O=m.loadingDetail,X=m.lastRecord,Y=m.showLastUpgradeRecord,q=m.showLastRollbackRecord,F=m.upgradeItem,H=m.isDeploymentFailure,Z=m.isPartiallyCompleted,j=m.showRollbackConfirm,G=m.rollbackRecords,K=m.rollbackRecordDetails,J=m.backUpgradeLoading,Q={onChange:this.handleTableChange,pageSize:M,total:x,page:I},W=e=>{var t=e.data,a=t.upgrade_versions,l=t.current_version;return y.default.createElement("div",{className:A.default.listContent},y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:"\u5f53\u524d\u7248\u672c\u662f\u6307\u5b89\u88c5\u7684\u7ec4\u4ef6\u4e2d\u6700\u5927\u7684\u7248\u672c\u53f7\uff0c\u56e0\u6b64\u5347\u7ea7\u5176\u4e2d\u4e00\u4e2a\u7ec4\u4ef6\u8be5\u7248\u672c\u53f7\u8ddf\u968f\u589e\u52a0\u3002"},y.default.createElement("span",null,"\u5f53\u524d\u7248\u672c")),y.default.createElement("p",null,y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},l))),y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:"\u53ef\u5347\u7ea7\u7248\u672c\u662f\u6307\u6bd4\u5f53\u524d\u7248\u672c\u53f7\u5927\u7684\u7248\u672c"},y.default.createElement("span",null,"\u53ef\u5347\u7ea7\u7248\u672c")),y.default.createElement("p",null,a&&a.length>0?a.map(e=>{return y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small",key:e},e)}):"\u6682\u65e0")))},$=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:"20%",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>y.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>this.getVersionChangeShow(t)},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>y.default.createElement("span",null,P.default.getStatusText(e))},{title:"\u64cd\u4f5c",dataIndex:"tenant_id",key:"5",width:"15%",render:(e,t)=>t.can_rollback&&y.default.createElement("div",null,y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollback(t)}},"\u56de\u6eda"),y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollbackList(t)}},"\u56de\u6eda\u8bb0\u5f55"))}],ee=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"updated",key:"1",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u540d\u5b57",dataIndex:"chart",key:"2",render:e=>y.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"app_version",key:"3",render:e=>y.default.createElement("span",null,e)},{title:"\u72b6\u6001",dataIndex:"status",key:"4",render:e=>y.default.createElement("span",null,P.default.getHelmStatus(e))}],te=[];te=(0,S.createApp)((0,S.createTeam)((0,S.createEnterprise)(te,t),l,r),l,r,{appName:V.group_name,appID:V.group_id});var ae=V&&V.app_type&&"helm"===V.app_type;return y.default.createElement(w.default,{breadcrumbList:te,loading:O,title:"\u5347\u7ea7\u7ba1\u7406",content:"\u5f53\u524d\u5e94\u7528\u5185\u5177\u6709\u4ece\u5e94\u7528\u5e02\u573a\u6216\u5e94\u7528\u5546\u5e97\u5b89\u88c5\u800c\u6765\u7684\u7ec4\u4ef6\u65f6\uff0c\u5347\u7ea7\u7ba1\u7406\u529f\u80fd\u53ef\u7528\u3002\u82e5\u5b89\u88c5\u6e90\u7684\u5e94\u7528\u7248\u672c\u6709\u53d8\u66f4\u5219\u53ef\u4ee5\u8fdb\u884c\u5347\u7ea7\u64cd\u4f5c",extraContent:null},y.default.createElement("div",null,O?y.default.createElement(p.default,null):y.default.createElement(k.default,{activeKey:D,onChange:this.handleTabs,className:A.default.tabss},!ae&&y.default.createElement(T,{tab:"\u5e94\u7528\u6a21\u578b\u5217\u8868",key:"1"},y.default.createElement("div",{className:A.default.cardList},y.default.createElement(d.default,{rowKey:"id",size:"large",loading:g,dataSource:[...U],renderItem:e=>y.default.createElement(d.default.Item,{actions:[y.default.createElement("a",{onClick:t=>{t.preventDefault(),this.fetchAppLastRollbackRecord(e)}},"\u5347\u7ea7"),y.default.createElement("a",{onClick:()=>{this.showComponentVersion(e)}},"\u67e5\u770b\u7ec4\u4ef6")]},y.default.createElement(d.default.Item.Meta,{avatar:y.default.createElement(c.default,{src:e.pic||a("Vkwn"),shape:"square",size:"large"}),title:y.default.createElement("a",{onClick:()=>{this.showMarketAppDetail(e)}},e.group_name),description:e.describe}),y.default.createElement(W,{data:e}))}))),y.default.createElement(T,{tab:"\u5347\u7ea7\u8bb0\u5f55",key:"2"},y.default.createElement(o.default,{style:{padding:"24px"},loading:f||_,columns:ae?ee:$,dataSource:v,pagination:Q})))),B&&y.default.createElement(b.default,(0,i.default)({onCancel:this.handleCancelComponent,data:B,ok:this.getApplication},this.getParameter())),L&&y.default.createElement(C.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:E}),Y&&(X||F)&&y.default.createElement(s.default,{visible:!0,title:"\u5347\u7ea7\u63d0\u793a",onCancel:()=>{this.setState({showLastUpgradeRecord:!1}),F&&this.createNewRecord(F)},okText:"\u7ee7\u7eed",cancelText:F?"\u65b0\u5347\u7ea7":"\u53d6\u6d88",onOk:()=>{this.openInfoPage(X||F)}},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},X&&X.group_name||F&&F.group_name),Z?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u5206\u7ec4\u4ef6\u66f4\u65b0\u6210\u529f\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":H?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u7f72\u5931\u8d25\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u5347\u7ea7\u4efb\u52a1\uff0c\u662f\u5426\u7ee7\u7eed\u5b8c\u6210\u4e0a\u6b21\u4efb\u52a1\uff1f")),q&&y.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u63d0\u793a",onCancel:()=>{this.setState({showLastRollbackRecord:!1})},footer:[y.default.createElement(n.default,{style:{marginTop:"20px"},onClick:()=>{this.setState({showLastRollbackRecord:!1})}},"\u5173\u95ed")]},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},X&&X.group_name),"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u56de\u6eda\u4efb\u52a1\uff0c\u65e0\u6cd5\u7ee7\u7eed\u5347\u7ea7")),G&&y.default.createElement(N.default,(0,i.default)({},this.getParameter(),{info:G,showRollbackDetails:e=>{this.showRollbackDetails(e)},onCancel:()=>{this.showRollbackList(!1)}})),K&&y.default.createElement(z.default,(0,i.default)({},this.getParameter(),{info:K,onCancel:()=>{this.showRollbackDetails(!1)}})),j&&y.default.createElement(s.default,{visible:!0,confirmLoading:J,title:"\u56de\u6eda\u786e\u8ba4",onCancel:()=>{this.showRollback(!1)},onOk:()=>{this.rollbackUpgrade()}},y.default.createElement("span",{style:{color:"red"}},"\u786e\u8ba4\u8981\u56de\u6eda\u5417\uff1f"),y.default.createElement("span",{style:{display:"block",marginTop:"16px"}},"\u56de\u6eda\u8fc7\u7a0b\u4e0d\u4f1a\u5220\u9664\u65b0\u589e\u7ec4\u4ef6\u3002")))}},_=v))||_)||_);t.default=U},Utb7:function(e,t,a){e.exports={nameID:"nameID___MNSNW",icon:"icon___2AsL9",iconm:"iconm___qqaow",customBtn:"customBtn___SyQT6",versions:"versions___1Z8uj",cardList:"cardList___Yf-MH",card:"card___3ovxG",item:"item___1Ils1",tabss:"tabss___uEiMM",textzt:"textzt___3pFoJ",zsldis:"zsldis___1GahJ",zslbor:"zslbor___2ZXVM",zsllbor:"zsllbor___3pSS2",extraImg:"extraImg___2CzFB",newButton:"newButton___2YSwX",cardAvatar:"cardAvatar___1xUfe",cardDescription:"cardDescription___2vI9s",pageHeaderContent:"pageHeaderContent___1B8bR",contentLink:"contentLink___1LQb0",zslcheck:"zslcheck___115pt",zslIcon:"zslIcon___3tP6k",zslGroup:"zslGroup___ahs1r",zslMt:"zslMt___3-U0F",active:"active___17Zw6",zslcen:"zslcen___2982Y",zslborl:"zslborl___XdlyT",zslborr:"zslborr___10Zhw",zslh:"zslh___3CELq",listContent:"listContent___3FKvX",listContentItem:"listContentItem___3GH5D",standardList:"standardList___lVj3g",headerInfo:"headerInfo___2zfaG",extraContentSearch:"extraContentSearch___bx9rK",listCard:"listCard___IhqPy",standardListForm:"standardListForm___2itqX",formResult:"formResult___1LmUn"}},ZBNA:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("g9YV");var s=l(a("wCAj"));a("+L6B");var i=l(a("2/Rp"));a("y8nQ");var o,d,c,p,u=l(a("Vl3Y")),h=l(a("e6Ls")),m=a("MuoO"),g=r(a("q1tI")),f=a("xpXo"),_=l(a("4W9V")),v=l(a("Utb7")),k=l(a("VZuE")),b=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordList=(()=>{var e=this.props,t=e.team_name,a=e.group_id,l=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordList)({team_name:t,group_id:a,record_id:l.ID,noModels:!0}).then(e=>{this.setState({list:e.list||[],recordLoading:!1})}).catch(e=>{(0,_.default)(e)})}),this.state={list:[],recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordList()}render(){var e=this.props,t=e.onCancel,a=e.loading,l=void 0!==a&&a,r=e.showRollbackDetails,o=this.state,d=o.recordLoading,c=o.list,p=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:200,render:e=>g.default.createElement("span",null,e)},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>g.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>g.default.createElement("div",null,"\u56de\u6eda\u5230",g.default.createElement("span",{className:v.default.versions},t.version))},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>g.default.createElement("span",null,k.default.getStatusText(e))},{title:"\u8be6\u60c5",dataIndex:"ID",key:"45",render:(e,t)=>g.default.createElement("a",{onClick:()=>{r(t)}},"\u8be6\u60c5")}];return g.default.createElement(n.default,{visible:!0,title:"\u56de\u6eda\u8bb0\u5f55",width:1e3,confirmLoading:l,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(s.default,{loading:d,columns:p,dataSource:c,pagination:!1}))}},c=p))||c)||c);t.default=b},x9lC:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("g9YV");var s=l(a("wCAj"));a("+L6B");var i=l(a("2/Rp"));a("5Dmo");var o=l(a("3S7+"));a("/xke");var d=l(a("TeRw"));a("y8nQ");var c=l(a("Vl3Y"));a("OaEy");var p,u,h,m,g=l(a("2fM7")),f=a("MuoO"),_=a("7DNP"),v=r(a("q1tI")),k=l(a("4W9V")),b=l(a("e6Ls")),L=g.default.Option,E=c.default.Item,R=(p=c.default.create(),u=(0,f.connect)(),p(h=u((m=class extends v.PureComponent{constructor(e){super(e),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.fetchComponentVersion=(()=>{var e=this.props,t=e.dispatch,a=e.form,l=e.data,r=void 0===l?{}:l,n=e.team_name,s=e.group_id;a.setFieldsValue;t({type:"application/fetchComponentVersion",payload:{team_name:n,app_model_key:r.group_key,upgrade_group_id:r.upgrade_group_id,group_id:s},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list}),this.handleCancel()},handleError:e=>{this.handleError(e)}})}),this.handleDeploy=(e=>{var t=this.props,a=t.team_name,l=t.dispatch,r=t.ok,n=this.props.form,s=e.service_alias;n.validateFields(["".concat(s)],(e,t)=>{e||(this.setState({loading:!0}),l({type:"appControl/putUpgrade",payload:{team_name:a,app_alias:s,group_version:t[s]},callback:e=>{e&&200===e.status_code&&(this.fetchComponentVersion(),r&&r(),d.default.success({message:"\u5347\u7ea7\u6210\u529f"}))},handleError:e=>{this.handleError(e)}}))})}),this.handleError=(e=>{(0,k.default)(e),this.handleCancel()}),this.handleCancel=(()=>{this.setState({loading:!1})}),this.state={loading:!0,list:[]}}componentDidMount(){this.fetchComponentVersion()}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.form,r=(e.data,e.team_name),d=e.region_name,p=this.state,u=p.list,h=p.loading,m=l.getFieldDecorator,f=[{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"service_cname",key:"service_cname",width:180,render:(e,t)=>{return v.default.createElement(_.Link,{to:"/team/".concat(r,"/region/").concat(d,"/components/").concat(t.service_alias,"/overview")},e)}},{title:"\u5f53\u524d\u7248\u672c",dataIndex:"current_version",key:"current_version",width:180,render:e=>{return v.default.createElement(o.default,{title:e},v.default.createElement("div",{className:b.default.over},e))}},{title:"\u53ef\u5347\u7ea7\u7248\u672c",dataIndex:"upgradable_versions",key:"upgradable_versions",render:(e,t)=>{var a=e&&e.length>0&&e[0];return v.default.createElement(c.default,null,v.default.createElement(E,{style:{margin:0}},m("".concat(t.service_alias),{initialValue:a||"\u65e0",rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(v.default.createElement(g.default,{disabled:!a,onChange:this.handleChange},e.map(e=>{return v.default.createElement(L,{key:e,value:e},e)})))))}},{title:"\u64cd\u4f5c",dataIndex:"component_id",rowKey:"component_id",align:"center",width:150,render:(e,t)=>{return t.upgradable_versions&&t.upgradable_versions.length>0?v.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{this.handleDeploy(t)}},"\u5347\u7ea7"):v.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.45)"}},"\u65e0\u53ef\u5347\u7ea7\u7684\u7248\u672c")}}];return v.default.createElement(n.default,{title:t||"\u7ec4\u4ef6\u5217\u8868",visible:!0,width:800,confirmLoading:h,className:b.default.TelescopicModal,onCancel:a,onOk:this.onOk,footer:[v.default.createElement(i.default,{style:{marginTop:"20px"},onClick:a},"\u5173\u95ed")]},v.default.createElement(s.default,{dataSource:u,columns:f,loading:h,pagination:!1}))}},h=m))||h)||h);t.default=R}}]);
=======
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[67],{NkCp:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("IzEo");var s=l(a("bx4M"));a("+L6B");var i=l(a("2/Rp"));a("y8nQ");var o,d,c,p,u=l(a("Vl3Y")),h=l(a("e6Ls")),m=a("MuoO"),g=r(a("q1tI")),f=a("xpXo"),_=l(a("4W9V")),v=l(a("VZuE")),k=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordDetails=(()=>{var e=this.props,t=e.team_name,a=e.group_id,l=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordDetails)({team_name:t,group_id:a,record_id:l.ID,noModels:!0}).then(e=>{var t=e.bean||{};this.setState({list:t.service_record||[],textState:t.status,recordLoading:!1},()=>{4===t.status&&setTimeout(()=>{this.fetchRollsBackRecordDetails()},3e3)})}).catch(e=>{(0,_.default)(e)})}),this.handleRetry=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.team_name,r=e.group_id,n=e.info,s=this.state.upgradeLoading;t.validateFields(e=>{e||s||this.setState({upgradeLoading:!0},()=>{a({type:"global/fetchAppRedeploy",payload:{team_name:l,group_id:r,record_id:n.ID},callback:e=>{e&&200===e.status_code&&this.setState({upgradeLoading:!1},()=>{this.fetchRollsBackRecordDetails()})},handleError:e=>{(0,_.default)(e),this.fetchRollsBackRecordDetails()}})})})}),this.state={list:[],textState:"",upgradeLoading:!1,recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordDetails()}render(){var e=this.props,t=e.onCancel,a=e.loading,l=void 0!==a&&a,r=this.state,o=r.recordLoading,d=r.list,c=r.textState,p=r.upgradeLoading,u={width:d&&1===d.length?"100%":"50%",textAlign:"center"},m=[7,10].includes(c);return g.default.createElement(n.default,{visible:!0,title:"\u56de\u6eda\u8be6\u60c5",width:1e3,confirmLoading:l,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(s.default,{title:"\u7ec4\u4ef6\u5217\u8868",loading:o,extra:g.default.createElement(i.default,{type:"primary",loading:p,onClick:m?this.handleRetry:t},m?"\u91cd\u8bd5":v.default.getStatusCNS(c))},d&&d.length>0&&d.map(e=>{var t=e.ID,a=e.status,l=e.service_cname;return g.default.createElement(s.default.Grid,{key:t,style:u},l," \u72b6\u6001\uff1a",g.default.createElement("span",{style:{color:v.default.getStatusColor(a)}},v.default.getStatusCNS(a)))})))}},c=p))||c)||c);t.default=k},T40H:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var n=l(a("2/Rp"));a("2qtc");var s=l(a("kLXV")),i=l(a("jehZ"));a("g9YV");var o=l(a("wCAj"));a("Mwp2");var d=l(a("VXEj"));a("Telt");var c=l(a("Tckk"));a("T2oS");var p=l(a("W9HT"));a("+BJd");var u=l(a("mr32"));a("5Dmo");var h=l(a("3S7+"));a("y8nQ");var m=l(a("Vl3Y"));a("Znn+");var g,f,_,v,k=l(a("ZTPi")),b=l(a("x9lC")),L=a("MuoO"),E=a("7DNP"),R=l(a("wd/R")),y=r(a("q1tI")),C=l(a("iPMB")),w=l(a("XZXw")),D=a("xpXo"),S=a("vSx2"),I=l(a("4W9V")),x=l(a("QDog")),M=l(a("hMqj")),A=l(a("Utb7")),z=l(a("NkCp")),N=l(a("ZBNA")),P=l(a("VZuE")),T=k.default.TabPane,U=(g=m.default.create(),f=(0,L.connect)(e=>{var t=e.user,a=e.global,l=e.application,r=e.teamControl,n=e.enterprise;return{groupDetail:l.groupDetail||{},currUser:t.pageUser,groups:a.groups||[],currentTeam:r.currentTeam,currentRegionName:r.currentRegionName,currentEnterprise:n.currentEnterprise,currentTeamPermissionsInfo:r.currentTeamPermissionsInfo}}),g(_=f((v=class extends y.PureComponent{constructor(e){super(e),this.onUpgrade=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.getAppModelLastRecord)({appID:l,team_name:a,upgrade_group_id:e.upgrade_group_id}).then(t=>{var a=t.bean&&t.bean.status;if(a){if([6,10].includes(a))return void this.setState({isDeploymentFailure:10===a,isPartiallyCompleted:6===a,showLastUpgradeRecord:!0,upgradeItem:e});if([3,8].includes(a))return void this.createNewRecord(e);this.openInfoPage(t.bean)}else this.createNewRecord(e)})}),this.getApplication=(()=>{var e=this.props.dispatch;e({type:"global/application",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId()},callback:e=>{e&&200===e.status_code&&this.setState({dataList:e.list||[]}),this.handleCancelLoading()}})}),this.getParameter=(()=>{var e=this.props.match.params,t=e.teamName,a=e.regionName,l=e.appID;return{team_name:t,region_name:a,group_id:l}}),this.getGroupId=(()=>{var e=this.props.match.params;return e.appID}),this.getUpgradeRecordsList=(()=>{var e=this.state,t=e.page,a=e.pageSize,l=this.getParameter(),r=l.team_name,n=l.group_id;this.props.dispatch({type:"global/CloudAppUpdateRecordsList",payload:{team_name:r,group_id:n,page:t,pageSize:a,status__gt:1},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list||[],total:e.bean&&e.bean.total}),this.handleCancelLoading()}})}),this.getVersionChangeShow=(e=>{return e.market_name?y.default.createElement("div",null,"\u901a\u8fc7\u5e94\u7528\u5546\u5e97\uff08",e.market_name,"\uff09\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version)):y.default.createElement("div",null,"\u4ece\u7248\u672c",y.default.createElement("span",{className:A.default.versions},e.old_version),"\u5347\u7ea7\u5230",y.default.createElement("span",{className:A.default.versions},e.version))}),this.fetchAppLastUpgradeRecord=(()=>{var e=this.getParameter(),t=e.team_name,a=e.group_id;(0,D.getAppModelLastRecord)({team_name:t,appID:a,noModels:!0}).then(e=>{var t=e.bean;t&&"{}"!==JSON.stringify(t)&&this.setState({lastRecord:t,showLastUpgradeRecord:[2].includes(t.status)})}).catch(e=>{(0,I.default)(e)})}),this.fetchAppLastRollbackRecord=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.getAppModelLastRecord)({team_name:a,appID:l,record_type:"rollback",noModels:!0}).then(t=>{var a=t.bean;if(a&&"{}"!==JSON.stringify(a)){var l=[4].includes(a.status);l?this.setState({lastRecord:a,showLastRollbackRecord:l}):this.onUpgrade(e)}else this.onUpgrade(e)}).catch(e=>{(0,I.default)(e)})}),this.getUpgradeRecordsHelmList=(()=>{var e=this.state,t=e.page,a=e.pageSize;this.props.dispatch({type:"global/fetchUpgradeRecordsHelmList",payload:{team_name:x.default.getCurrTeamName(),group_id:this.getGroupId(),page:t,pageSize:a},callback:e=>{this.handleLoading(),e&&200===e.status_code&&this.setState({list:e.list||[]}),this.handleCancelLoading()}})}),this.handleLoading=(()=>{this.setState({loadingList:!1,recordLoading:!1,upgradeLoading:!1})}),this.createNewRecord=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.postUpgradeRecord)({team_name:a,appID:l,upgrade_group_id:e.upgrade_group_id,noModels:!0}).then(e=>{this.openInfoPage(e.bean)}).catch(e=>{(0,I.default)(e)})}),this.fetchAppDetail=(()=>{var e=this.props.dispatch;this.setState({loadingDetail:!0}),e({type:"application/fetchGroupDetail",payload:this.getParameter(),callback:e=>{e&&200===e.status_code&&this.setState({appDetail:e.bean,loadingDetail:!1},()=>{e.bean&&e.bean.app_type&&"helm"===e.bean.app_type?this.handleTabs("2"):this.getApplication()})},handleError:t=>{t&&404===t.code&&e(E.routerRedux.push("/team/".concat(x.default.getCurrTeamName(),"/region/").concat(x.default.getCurrRegionName(),"/apps")))}})}),this.openInfoPage=(e=>{var t=this.getParameter(),a=t.team_name,l=t.group_id,r=this.props.dispatch;r(E.routerRedux.push("/team/".concat(a,"/region/").concat(x.default.getCurrRegionName(),"/apps/").concat(l,"/upgrade/").concat(e.upgrade_group_id,"/record/").concat(e.ID,"?app_id=").concat(e.group_key)))}),this.showMarketAppDetail=(e=>{this.setState({showApp:e,showMarketAppDetail:!0})}),this.showRollback=(e=>{this.setState({showRollbackConfirm:e,rollbackRecord:e})}),this.showRollbackList=(e=>{this.setState({rollbackRecords:e})}),this.showRollbackDetails=(e=>{this.setState({rollbackRecordDetails:e})}),this.hideMarketAppDetail=(()=>{this.setState({showApp:{},showMarketAppDetail:!1})}),this.handleTabs=(e=>{var t=this.state.appDetail;this.setState({upgradeLoading:!0,recordLoading:!0,activeKey:e},()=>{"helm"===t.app_type?this.getUpgradeRecordsHelmList():"2"===e?this.getUpgradeRecordsList():this.getApplication()})}),this.handleTableChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.getUpgradeRecordsList()})}),this.rollbackUpgrade=(()=>{this.handleBackUpgradeLoading(!0);var e=this.state.rollbackRecord,t=this.getParameter(),a=t.team_name,l=t.group_id;(0,D.rollbackUpgrade)({team_name:a,appID:l,record_id:e.ID}).then(e=>{this.handleBackUpgradeLoading(!1),this.showRollback(!1),this.showRollbackDetails(e&&e.bean)}).catch(e=>{this.handleBackUpgradeLoading(!1),(0,I.default)(e)})}),this.handleBackUpgradeLoading=(e=>{this.setState({backUpgradeLoading:e})}),this.showComponentVersion=(e=>{this.setState({isComponent:e})}),this.handleCancelComponent=(()=>{this.setState({isComponent:!1})}),this.handleCancelLoading=(()=>{this.setState({loadingList:!1,upgradeLoading:!1,recordLoading:!1})}),this.state={loadingDetail:!0,loadingList:!0,isDeploymentFailure:!1,isPartiallyCompleted:!1,upgradeLoading:!0,recordLoading:!0,isComponent:!1,showApp:{},showMarketAppDetail:!1,list:[],activeKey:"1",page:1,pageSize:10,total:0,dataList:[],appDetail:{},backUpgradeLoading:!1,showLastUpgradeRecord:!1,showLastRollbackRecord:!1,rollbackRecords:!1,rollbackRecordDetails:!1}}componentWillMount(){var e=this.props,t=e.currentTeamPermissionsInfo,a=e.dispatch,l=M.default.queryAppInfo(t,"upgrade");l||x.default.withoutPermission(a)}componentDidMount(){this.fetchAppDetail(),this.getApplication(),this.fetchAppLastUpgradeRecord()}render(){var e=this.props,t=e.currentEnterprise,l=e.currentTeam,r=e.currentRegionName,m=this.state,g=m.loadingList,f=m.recordLoading,_=m.upgradeLoading,v=m.list,L=m.showMarketAppDetail,E=m.showApp,D=m.activeKey,I=m.page,x=m.total,M=m.pageSize,U=m.dataList,V=m.appDetail,B=m.isComponent,O=m.loadingDetail,X=m.lastRecord,Y=m.showLastUpgradeRecord,q=m.showLastRollbackRecord,F=m.upgradeItem,H=m.isDeploymentFailure,Z=m.isPartiallyCompleted,j=m.showRollbackConfirm,G=m.rollbackRecords,K=m.rollbackRecordDetails,J=m.backUpgradeLoading,Q={onChange:this.handleTableChange,pageSize:M,total:x,page:I},W=e=>{var t=e.data,a=t.upgrade_versions,l=t.current_version;return y.default.createElement("div",{className:A.default.listContent},y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:"\u5f53\u524d\u7248\u672c\u662f\u6307\u5b89\u88c5\u7684\u7ec4\u4ef6\u4e2d\u6700\u5927\u7684\u7248\u672c\u53f7\uff0c\u56e0\u6b64\u5347\u7ea7\u5176\u4e2d\u4e00\u4e2a\u7ec4\u4ef6\u8be5\u7248\u672c\u53f7\u8ddf\u968f\u589e\u52a0\u3002"},y.default.createElement("span",null,"\u5f53\u524d\u7248\u672c")),y.default.createElement("p",null,y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small"},l))),y.default.createElement("div",{className:A.default.listContentItem},y.default.createElement(h.default,{title:"\u53ef\u5347\u7ea7\u7248\u672c\u662f\u6307\u6bd4\u5f53\u524d\u7248\u672c\u53f7\u5927\u7684\u7248\u672c"},y.default.createElement("span",null,"\u53ef\u5347\u7ea7\u7248\u672c")),y.default.createElement("p",null,a&&a.length>0?a.map(e=>{return y.default.createElement(u.default,{style:{height:"17px",lineHeight:"16px",marginBottom:"3px"},color:"green",size:"small",key:e},e)}):"\u6682\u65e0")))},$=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:"20%",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>y.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>this.getVersionChangeShow(t)},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>y.default.createElement("span",null,P.default.getStatusText(e))},{title:"\u64cd\u4f5c",dataIndex:"tenant_id",key:"5",width:"15%",render:(e,t)=>t.can_rollback&&y.default.createElement("div",null,y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollback(t)}},"\u56de\u6eda"),y.default.createElement("a",{onClick:e=>{e.preventDefault(),this.showRollbackList(t)}},"\u56de\u6eda\u8bb0\u5f55"))}],ee=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"updated",key:"1",render:e=>y.default.createElement("span",null,(0,R.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))},{title:"\u540d\u5b57",dataIndex:"chart",key:"2",render:e=>y.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"app_version",key:"3",render:e=>y.default.createElement("span",null,e)},{title:"\u72b6\u6001",dataIndex:"status",key:"4",render:e=>y.default.createElement("span",null,P.default.getHelmStatus(e))}],te=[];te=(0,S.createApp)((0,S.createTeam)((0,S.createEnterprise)(te,t),l,r),l,r,{appName:V.group_name,appID:V.group_id});var ae=V&&V.app_type&&"helm"===V.app_type;return y.default.createElement(w.default,{breadcrumbList:te,loading:O,title:"\u5347\u7ea7\u7ba1\u7406",content:"\u5f53\u524d\u5e94\u7528\u5185\u5177\u6709\u4ece\u5e94\u7528\u5e02\u573a\u6216\u5e94\u7528\u5546\u5e97\u5b89\u88c5\u800c\u6765\u7684\u7ec4\u4ef6\u65f6\uff0c\u5347\u7ea7\u7ba1\u7406\u529f\u80fd\u53ef\u7528\u3002\u82e5\u5b89\u88c5\u6e90\u7684\u5e94\u7528\u7248\u672c\u6709\u53d8\u66f4\u5219\u53ef\u4ee5\u8fdb\u884c\u5347\u7ea7\u64cd\u4f5c",extraContent:null},y.default.createElement("div",null,O?y.default.createElement(p.default,null):y.default.createElement(k.default,{activeKey:D,onChange:this.handleTabs,className:A.default.tabss},!ae&&y.default.createElement(T,{tab:"\u5e94\u7528\u6a21\u578b\u5217\u8868",key:"1"},y.default.createElement("div",{className:A.default.cardList},y.default.createElement(d.default,{rowKey:"id",size:"large",loading:g,dataSource:[...U],renderItem:e=>y.default.createElement(d.default.Item,{actions:[y.default.createElement("a",{onClick:t=>{t.preventDefault(),this.fetchAppLastRollbackRecord(e)}},"\u5347\u7ea7"),y.default.createElement("a",{onClick:()=>{this.showComponentVersion(e)}},"\u67e5\u770b\u7ec4\u4ef6")]},y.default.createElement(d.default.Item.Meta,{avatar:y.default.createElement(c.default,{src:e.pic||a("Vkwn"),shape:"square",size:"large"}),title:y.default.createElement("a",{onClick:()=>{this.showMarketAppDetail(e)}},e.group_name),description:e.describe}),y.default.createElement(W,{data:e}))}))),y.default.createElement(T,{tab:"\u5347\u7ea7\u8bb0\u5f55",key:"2"},y.default.createElement(o.default,{style:{padding:"24px"},loading:f||_,columns:ae?ee:$,dataSource:v,pagination:Q})))),B&&y.default.createElement(b.default,(0,i.default)({onCancel:this.handleCancelComponent,data:B,ok:this.getApplication},this.getParameter())),L&&y.default.createElement(C.default,{onOk:this.hideMarketAppDetail,onCancel:this.hideMarketAppDetail,app:E}),Y&&(X||F)&&y.default.createElement(s.default,{visible:!0,title:"\u5347\u7ea7\u63d0\u793a",onCancel:()=>{this.setState({showLastUpgradeRecord:!1}),F&&this.createNewRecord(F)},okText:"\u7ee7\u7eed",cancelText:F?"\u65b0\u5347\u7ea7":"\u53d6\u6d88",onOk:()=>{this.openInfoPage(X||F)}},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},X&&X.group_name||F&&F.group_name),Z?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u5206\u7ec4\u4ef6\u66f4\u65b0\u6210\u529f\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":H?"\u4e0a\u6b21\u5347\u7ea7\u4efb\u52a1\u90e8\u7f72\u5931\u8d25\uff0c\u662f\u5426\u7ee7\u7eed\u91cd\u8bd5\uff1f":"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u5347\u7ea7\u4efb\u52a1\uff0c\u662f\u5426\u7ee7\u7eed\u5b8c\u6210\u4e0a\u6b21\u4efb\u52a1\uff1f")),q&&y.default.createElement(s.default,{visible:!0,title:"\u56de\u6eda\u63d0\u793a",onCancel:()=>{this.setState({showLastRollbackRecord:!1})},footer:[y.default.createElement(n.default,{style:{marginTop:"20px"},onClick:()=>{this.setState({showLastRollbackRecord:!1})}},"\u5173\u95ed")]},y.default.createElement("span",null,"\u5e94\u7528\u6a21\u578b",y.default.createElement("span",{style:{color:"4d73b1"}},X&&X.group_name),"\u5b58\u5728\u672a\u5b8c\u6210\u7684\u56de\u6eda\u4efb\u52a1\uff0c\u65e0\u6cd5\u7ee7\u7eed\u5347\u7ea7")),G&&y.default.createElement(N.default,(0,i.default)({},this.getParameter(),{info:G,showRollbackDetails:e=>{this.showRollbackDetails(e)},onCancel:()=>{this.showRollbackList(!1)}})),K&&y.default.createElement(z.default,(0,i.default)({},this.getParameter(),{info:K,onCancel:()=>{this.showRollbackDetails(!1)}})),j&&y.default.createElement(s.default,{visible:!0,confirmLoading:J,title:"\u56de\u6eda\u786e\u8ba4",onCancel:()=>{this.showRollback(!1)},onOk:()=>{this.rollbackUpgrade()}},y.default.createElement("span",{style:{color:"red"}},"\u786e\u8ba4\u8981\u56de\u6eda\u5417\uff1f"),y.default.createElement("span",{style:{display:"block",marginTop:"16px"}},"\u56de\u6eda\u8fc7\u7a0b\u4e0d\u4f1a\u5220\u9664\u65b0\u589e\u7ec4\u4ef6\u3002")))}},_=v))||_)||_);t.default=U},Utb7:function(e,t,a){e.exports={nameID:"nameID___MNSNW",icon:"icon___2AsL9",iconm:"iconm___qqaow",customBtn:"customBtn___SyQT6",versions:"versions___1Z8uj",cardList:"cardList___Yf-MH",card:"card___3ovxG",item:"item___1Ils1",tabss:"tabss___uEiMM",textzt:"textzt___3pFoJ",zsldis:"zsldis___1GahJ",zslbor:"zslbor___2ZXVM",zsllbor:"zsllbor___3pSS2",extraImg:"extraImg___2CzFB",newButton:"newButton___2YSwX",cardAvatar:"cardAvatar___1xUfe",cardDescription:"cardDescription___2vI9s",pageHeaderContent:"pageHeaderContent___1B8bR",contentLink:"contentLink___1LQb0",zslcheck:"zslcheck___115pt",zslIcon:"zslIcon___3tP6k",zslGroup:"zslGroup___ahs1r",zslMt:"zslMt___3-U0F",active:"active___17Zw6",zslcen:"zslcen___2982Y",zslborl:"zslborl___XdlyT",zslborr:"zslborr___10Zhw",zslh:"zslh___3CELq",listContent:"listContent___3FKvX",listContentItem:"listContentItem___3GH5D",standardList:"standardList___lVj3g",headerInfo:"headerInfo___2zfaG",extraContentSearch:"extraContentSearch___bx9rK",listCard:"listCard___IhqPy",standardListForm:"standardListForm___2itqX",formResult:"formResult___1LmUn"}},ZBNA:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("g9YV");var s=l(a("wCAj"));a("+L6B");var i=l(a("2/Rp"));a("y8nQ");var o,d,c,p,u=l(a("Vl3Y")),h=l(a("e6Ls")),m=a("MuoO"),g=r(a("q1tI")),f=a("xpXo"),_=l(a("4W9V")),v=l(a("Utb7")),k=l(a("VZuE")),b=(o=(0,m.connect)(),d=u.default.create(),o(c=d((p=class extends g.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.handleLoading=(e=>{this.setState({recordLoading:e})}),this.fetchRollsBackRecordList=(()=>{var e=this.props,t=e.team_name,a=e.group_id,l=e.info;this.handleLoading(!0),(0,f.getRollsBackRecordList)({team_name:t,group_id:a,record_id:l.ID,noModels:!0}).then(e=>{this.setState({list:e.list||[],recordLoading:!1})}).catch(e=>{(0,_.default)(e)})}),this.state={list:[],recordLoading:!1}}componentDidMount(){this.fetchRollsBackRecordList()}render(){var e=this.props,t=e.onCancel,a=e.loading,l=void 0!==a&&a,r=e.showRollbackDetails,o=this.state,d=o.recordLoading,c=o.list,p=[{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time",key:"1",width:200,render:e=>g.default.createElement("span",null,e)},{title:"\u5e94\u7528\u6a21\u7248\u540d\u79f0",dataIndex:"group_name",key:"2",width:"20%",render:e=>g.default.createElement("span",null,e)},{title:"\u7248\u672c",dataIndex:"version",key:"3",width:"30%",render:(e,t)=>g.default.createElement("div",null,"\u56de\u6eda\u5230",g.default.createElement("span",{className:v.default.versions},t.version))},{title:"\u72b6\u6001",dataIndex:"status",key:"4",width:"15%",render:e=>g.default.createElement("span",null,k.default.getStatusText(e))},{title:"\u8be6\u60c5",dataIndex:"ID",key:"45",render:(e,t)=>g.default.createElement("a",{onClick:()=>{r(t)}},"\u8be6\u60c5")}];return g.default.createElement(n.default,{visible:!0,title:"\u56de\u6eda\u8bb0\u5f55",width:1e3,confirmLoading:l,className:h.default.TelescopicModal,onCancel:t,footer:[g.default.createElement(i.default,{style:{marginTop:"20px"},onClick:t},"\u5173\u95ed")]},g.default.createElement(s.default,{loading:d,columns:p,dataSource:c,pagination:!1}))}},c=p))||c)||c);t.default=b},x9lC:function(e,t,a){"use strict";var l=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var n=l(a("kLXV"));a("g9YV");var s=l(a("wCAj"));a("+L6B");var i=l(a("2/Rp"));a("5Dmo");var o=l(a("3S7+"));a("/xke");var d=l(a("TeRw"));a("y8nQ");var c=l(a("Vl3Y"));a("OaEy");var p,u,h,m,g=l(a("2fM7")),f=a("MuoO"),_=a("7DNP"),v=r(a("q1tI")),k=l(a("4W9V")),b=l(a("e6Ls")),L=g.default.Option,E=c.default.Item,R=(p=c.default.create(),u=(0,f.connect)(),p(h=u((m=class extends v.PureComponent{constructor(e){super(e),this.onOk=(e=>{e.preventDefault();var t=this.props,a=t.form,l=t.onOk;a.validateFields({force:!0},(e,t)=>{!e&&l&&l(t)})}),this.fetchComponentVersion=(()=>{var e=this.props,t=e.dispatch,a=e.form,l=e.data,r=void 0===l?{}:l,n=e.team_name,s=e.group_id;a.setFieldsValue;t({type:"application/fetchComponentVersion",payload:{team_name:n,app_model_key:r.group_key,upgrade_group_id:r.upgrade_group_id,group_id:s},callback:e=>{e&&200===e.status_code&&this.setState({list:e.list}),this.handleCancel()},handleError:e=>{this.handleError(e)}})}),this.handleDeploy=(e=>{var t=this.props,a=t.team_name,l=t.dispatch,r=t.ok,n=this.props.form,s=e.service_alias;n.validateFields(["".concat(s)],(e,t)=>{e||(this.setState({loading:!0}),l({type:"appControl/putUpgrade",payload:{team_name:a,app_alias:s,group_version:t[s]},callback:e=>{e&&200===e.status_code&&(this.fetchComponentVersion(),r&&r(),d.default.success({message:"\u5347\u7ea7\u6210\u529f"}))},handleError:e=>{this.handleError(e)}}))})}),this.handleError=(e=>{(0,k.default)(e),this.handleCancel()}),this.handleCancel=(()=>{this.setState({loading:!1})}),this.state={loading:!0,list:[]}}componentDidMount(){this.fetchComponentVersion()}render(){var e=this.props,t=e.title,a=e.onCancel,l=e.form,r=(e.data,e.team_name),d=e.region_name,p=this.state,u=p.list,h=p.loading,m=l.getFieldDecorator,f=[{title:"\u7ec4\u4ef6\u540d\u79f0",dataIndex:"service_cname",key:"service_cname",width:180,render:(e,t)=>{return v.default.createElement(_.Link,{to:"/team/".concat(r,"/region/").concat(d,"/components/").concat(t.service_alias,"/overview")},e)}},{title:"\u5f53\u524d\u7248\u672c",dataIndex:"current_version",key:"current_version",width:180,render:e=>{return v.default.createElement(o.default,{title:e},v.default.createElement("div",{className:b.default.over},e))}},{title:"\u53ef\u5347\u7ea7\u7248\u672c",dataIndex:"upgradable_versions",key:"upgradable_versions",render:(e,t)=>{var a=e&&e.length>0&&e[0];return v.default.createElement(c.default,null,v.default.createElement(E,{style:{margin:0}},m("".concat(t.service_alias),{initialValue:a||"\u65e0",rules:[{required:!0,message:"\u4e0d\u80fd\u4e3a\u7a7a!"}]})(v.default.createElement(g.default,{disabled:!a,onChange:this.handleChange},e.map(e=>{return v.default.createElement(L,{key:e,value:e},e)})))))}},{title:"\u64cd\u4f5c",dataIndex:"component_id",rowKey:"component_id",align:"center",width:150,render:(e,t)=>{return t.upgradable_versions&&t.upgradable_versions.length>0?v.default.createElement(i.default,{type:"link",style:{padding:0},onClick:()=>{this.handleDeploy(t)}},"\u5347\u7ea7"):v.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.45)"}},"\u65e0\u53ef\u5347\u7ea7\u7684\u7248\u672c")}}];return v.default.createElement(n.default,{title:t||"\u7ec4\u4ef6\u5217\u8868",visible:!0,width:800,confirmLoading:h,className:b.default.TelescopicModal,onCancel:a,onOk:this.onOk,footer:[v.default.createElement(i.default,{style:{marginTop:"20px"},onClick:a},"\u5173\u95ed")]},v.default.createElement(s.default,{dataSource:u,columns:f,loading:h,pagination:!1}))}},h=m))||h)||h);t.default=R}}]);
>>>>>>> 5a2d228cf1d7cb5d08c91e445d88c202fdea2011:www/static/dists/p__Upgrade.02b7983b.async.js
