(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[90],{"7KHJ":function(e,t,a){"use strict";var s=a("g09b"),i=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var r=s(a("BMrR"));a("jCWc");var n=s(a("kPKH"));a("fOrg");var o=s(a("+KLJ"));a("miYZ");var u,d,l,c=s(a("tsqr")),f=s(a("p0pE")),m=a("MuoO"),g=a("7DNP"),h=i(a("q1tI")),p=a("LLXN"),_=s(a("8+Sn")),b=s(a("mWxT")),v=s(a("w2qy")),w=s(a("CTfg")),y=b.default.OauthParameter("code"),E=b.default.OauthParameter("service_id"),L=b.default.OauthParameter("oauth_user_id"),k=(u=(0,m.connect)(e=>{var t=e.loading,a=e.global;return{login:{},isRegist:a.isRegist,rainbondInfo:a.rainbondInfo,submitting:t.effects["user/login"]}}),u((l=class extends h.Component{constructor(){super(...arguments),this.state={user_info:null},this.handleSubmit=(e=>{var t=this.props.dispatch;y&&E&&L&&t({type:"user/thirdLogin",payload:(0,f.default)({},e),callback:e=>{e&&200===e.status_code&&(_.default.set("token",e.bean.token),t({type:"user/fetchThirdBinding",payload:{service_id:E,oauth_user_id:L},callback:e=>{e&&e.status&&400===e.status?c.default.warning("".concat((0,p.formatMessage)({id:"login.Third.Authentication"})),1,()=>{t(g.routerRedux.replace("/user/login?disable_auto_login=true"))}):e&&200===e.status_code&&c.default.success("".concat((0,p.formatMessage)({id:"login.ThirdLogin.success"})),1,()=>{var e=window.localStorage.getItem("redirect");e&&""!=e||(e="/"),e.startsWith("/")?t(g.routerRedux.push(e)):window.location.href=e,window.localStorage.setItem("redirect","")})}}))}})})}componentDidMount(){this.props.dispatch({type:"user/fetchThirdInfo",payload:{code:y,service_id:E},callback:e=>{e&&200===e.status_code&&this.setState({user_info:e.bean.user_info})}})}render(){var e=this.props,t=e.rainbondInfo,a=e.isRegist,s=this.state.user_info,i=!b.default.fetchIsFirstRegist(t),u=null;b.default.OauthbEnable(t)&&t.oauth_services&&t.oauth_services.value&&t.oauth_services.value.map(e=>{e.service_id==E&&(u=e)});var d=u&&u.name||"",l=s&&s.oauth_user_name||"",c=d&&"".concat((0,p.formatMessage)({id:"login.ThirdLogin.from"},{name:d})),f=e=>{return"/user/third/".concat(e,"?code=").concat(y,"&service_id=").concat(E,"&oauth_user_id=").concat(L)};return h.default.createElement("div",{className:v.default.main},h.default.createElement(o.default,{style:{margin:"24px 0"},message:"".concat(c).concat(l).concat((0,p.formatMessage)({id:"login.ThirdLogin.supplement"})),type:"info"}),h.default.createElement(r.default,{style:{marginBottom:"24px"}},h.default.createElement(n.default,{span:10,className:v.default.boxJump,style:{background:"#CDE2FF"}},!i&&h.default.createElement(g.Link,{to:f("login")},h.default.createElement(p.FormattedMessage,{id:"login.ThirdLogin.bind"}))),a&&h.default.createElement(n.default,{span:10,className:v.default.boxJump,offset:4},h.default.createElement(g.Link,{to:f("register")},h.default.createElement(p.FormattedMessage,{id:"login.ThirdLogin.creat"})))),h.default.createElement(w.default,{onSubmit:this.handleSubmit,type:"thirdLogin"}))}},d=l))||d);t.default=k}}]);