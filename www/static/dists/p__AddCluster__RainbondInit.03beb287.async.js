(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{Jq4M:function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var i=l(a("kLXV"));a("fOrg");var s=l(a("+KLJ"));a("jCWc");var r=l(a("kPKH"));a("sRBo");var d=l(a("kaz8"));a("+L6B");var o=l(a("2/Rp")),u=l(a("jehZ"));a("/xke");var c=l(a("TeRw"));a("y8nQ");var p=l(a("Vl3Y"));a("tU7J");var h,m,f,g,I=l(a("wFql")),v=l(a("18gR")),E=a("MuoO"),k=n(a("q1tI")),b=a("mLYH"),C=l(a("AklW")),S=l(a("QDog")),D=l(a("ZNrE")),w=l(a("dBUJ")),x=l(a("imTl")),y=l(a("aMNY")),R=I.default.Paragraph,P=(h=(0,E.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),m=p.default.create(),h(f=m((g=class extends k.PureComponent{constructor(e){super(e),this.initRainbondCluster=(()=>{var e=this.props,t=e.dispatch,a=e.clusterID,l=e.selectProvider,n=e.eid,i=e.rainbondInfo,s=e.enterprise,r=this.state,d=r.checked,o=r.task;d?(this.setState({loading:!0}),t({type:"cloud/initRainbondRegion",payload:{enterprise_id:n,providerName:l,clusterID:a,retry:o&&"complete"===o.status},callback:e=>{e&&(S.default.putInstallClusterLog(s,i,{eid:n,taskID:e.taskID,status:"start",install_step:"createRainbond",provider:l}),this.setState({loading:!1,task:e,showInitDetail:!0}))},handleError:e=>{e&&e.data&&7005===e.data.code?this.setState({loading:!1,showInitDetail:!0,task:e.data.data}):C.default.handleCloudAPIError(e)}})):c.default.warning({message:"\u8bf7\u9605\u8bfb\u5e76\u540c\u610f\u6ce8\u610f\u4e8b\u9879"})}),this.loadTask=(e=>{var t=this.props,a=t.dispatch,l=t.eid,n=t.clusterID,i=t.selectProvider,s=t.completeInit;a({type:"cloud/loadInitRainbondTask",payload:{enterprise_id:l,clusterID:n,providerName:i},callback:t=>{if(t&&200===t.status_code&&t.response_data&&t.response_data.data){var a=t.response_data.data;this.setState({task:a}),"inited"===a.status?s&&s(a):"complete"===a.status||e||this.setState({showInitDetail:!0})}},handleError:e=>{e&&e.data&&404===e.data.code||(C.default.handleCloudAPIError(e),this.setState({loading:!1}))}})}),this.cancelShowInitDetail=(()=>{this.setState({showInitDetail:!1}),this.loadTask(!0)}),this.setChecked=(e=>{this.setState({checked:e.target.checked})}),this.showSetRainbondCluster=(()=>{var e=this.props,t=e.eid,a=e.clusterID;(0,b.getRainbondClusterConfig)({enterprise_id:t,clusterID:a},e=>{e&&e.data&&404===e.data.code||C.default.handleCloudAPIError(e)}).then(e=>{this.setState({showClusterInitConfig:!0,initconfig:e.config})})}),this.handleSubmit=(()=>{var e=this.props,t=e.form,a=e.eid,l=e.clusterID;t.validateFields((e,t)=>{e||(0,b.setRainbondClusterConfig)({enterprise_id:a,clusterID:l,config:t.config},e=>{e&&e.data&&404===e.data.code||C.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&(c.default.success({message:"\u8bbe\u7f6e\u6210\u529f"}),this.setState({showClusterInitConfig:!1}))})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,l=e.handleClick,n=void 0===l?()=>{}:l;return k.default.createElement(v.default,(0,u.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close")},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(n(),this.handleGuideStep(a))}}))}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.state={checked:!1,loading:!1,showInitDetail:!1,task:null,isComponents:!1,guideStep:10}}componentDidMount(){this.loadTask()}render(){var e=this.props,t=e.preStep,a=e.eid,l=e.selectProvider,n=e.form,u=e.clusterID,c=this.state,h=c.showInitDetail,m=c.loading,f=c.task,g=c.showClusterInitConfig,I=c.initconfig,v=c.isComponents,E=c.guideStep,b=c.checked,C={labelCol:{xs:{span:24}},wrapperCol:{xs:{span:24}}},S=n.getFieldDecorator,P=n.setFieldsValue,N=10===E?{position:"relative",zIndex:1e3,padding:"0 16px",margin:"0 -16px",background:"#fff"}:{},A=("rke"===l||"custom"===l)&&k.default.createElement(o.default,{style:{marginRight:"16px"},onClick:()=>this.handleIsComponents(!0)},"\u67e5\u770b\u7ec4\u4ef6");return k.default.createElement(p.default,null,k.default.createElement("h4",null,"\u6ce8\u610f\u4e8b\u9879\uff1a"),k.default.createElement(r.default,{span:24,style:{padding:"16px"}},"ack"===l&&k.default.createElement(R,{className:w.default.describe,style:N},k.default.createElement("ul",null,k.default.createElement("li",null,k.default.createElement("span",null,"\u82e5\u4f60\u9009\u62e9\u7684\u662f\u5df2\u7ecf\u5728\u4f7f\u7528\u7684Kubernetes\u96c6\u7fa4\uff0c\u4e0d\u8981\u62c5\u5fc3\uff0c\u63a5\u4e0b\u6765\u7684\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u96c6\u7fa4\u5df2\u6709\u7684\u4e1a\u52a1\u5f62\u6001\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u5e73\u53f0\u96c6\u7fa4\u521d\u59cb\u5316\u9700\u8981\u4ee5\u4e0b\u8d44\u6e90\uff1aRDS(1\u4e2a)\u3001NAS(1\u4e2a)\u3001SLB(1\u4e2a)\uff0c\u5e76\u5c06(80\u3001443\u30018443\u30016060\u300110000-11000)\u7aef\u53e3\u6dfb\u52a0\u5230\u5b89\u5168\u7ec4\u7b56\u7565\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u65b0\u8d2d\u8d44\u6e90\u90fd\u5c06\u91c7\u7528\u6309\u9700\u540e\u4ed8\u8d39\u6a21\u5f0f\uff0c\u56e0\u6b64\u8bf7\u786e\u4fdd\u4f60\u7684\u963f\u91cc\u4e91\u8d26\u53f7\u80fd\u591f\u8fdb\u884c\u6309\u9700\u8d2d\u4e70\u8d44\u6e90\uff0c\u540e\u7eed\u7528\u6237\u6839\u636e\u9700\u8981\u8fdb\u884c\u4ed8\u8d39\u6a21\u5f0f\u53d8\u66f4")),k.default.createElement("li",null,k.default.createElement("span",null,"\u6211\u4eec\u5c06\u901a\u8fc7KubeAPI\u8fdb\u884c\u76f8\u5173\u7684\u8d44\u6e90\u521b\u5efa\u548c\u521d\u59cb\u5316\uff0c\u96c6\u7fa4\u5bf9\u63a5\u5b8c\u6210\u540e\u5373\u53ef\u5173\u95edKubeAPI\u7684\u516c\u7f51\u8bbf\u95ee\uff08\u79fb\u9664\u7ed1\u5b9a\u7684EIP\uff09")))),("rke"===l||"custom"===l)&&k.default.createElement(R,{className:w.default.describe,style:N},k.default.createElement("ul",null,k.default.createElement("li",null,k.default.createElement("span",null,"\u82e5\u4f60\u9009\u62e9\u7684\u662f\u5df2\u7ecf\u5728\u4f7f\u7528\u7684\u5e73\u53f0\u96c6\u7fa4\uff0c\u4e0d\u8981\u62c5\u5fc3\uff0c\u63a5\u4e0b\u6765\u7684\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u96c6\u7fa4\u5df2\u6709\u7684\u4e1a\u52a1\u5f62\u6001\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u5e73\u53f0 \u96c6\u7fa4\u521d\u59cb\u5316\u65f6\u9ed8\u8ba4\u91c7\u7528\u7b2c1\u30012\u4e2a\u8282\u70b9\u4e3a\u7f51\u5173\u8282\u70b9\u548c\u6784\u5efa\u8282\u70b9\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728Kubernetes\u8282\u70b9\u4e0a\u589e\u52a0Annotations\u6765\u6307\u5b9a\u5bf9\u5e94\u8282\u70b9(rainbond.io/gateway-node=true \u6216rainbond.io/chaos-node=true)\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u7f51\u5173\u8282\u70b9\u4ee5\u4e0b\u7aef\u53e3\u5fc5\u987b\u7a7a\u95f2\uff1a80, 443, 6060, 7070, 8443, 10254, 18080, 18081\uff0c\u5426\u5219\u5c06\u5bfc\u81f4\u521d\u59cb\u5316\u5931\u8d25")),k.default.createElement("li",null,k.default.createElement("span",null,"\u5982\u679c\u96c6\u7fa4\u8282\u70b9\u6570\u91cf\u5927\u4e8e3\u5c06\u9ed8\u8ba4\u5b89\u88c5\u9ad8\u53ef\u7528\u6a21\u5f0f\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9700\u8981\u8bbf\u95ee\u7f51\u5173\u8282\u70b96443\u30018443\u30016060\u7aef\u53e3\uff0c\u8bf7\u786e\u4fdd\u76f8\u5173\u7aef\u53e3\u53ef\u88ab\u8bbf\u95ee\u3002")),k.default.createElement("li",null,k.default.createElement("span",null,"\u82e5\u60a8\u5e0c\u671b\u81ea\u5b9a\u4e49\u96c6\u7fa4\u521d\u59cb\u5316\u53c2\u6570"," ",k.default.createElement("a",{onClick:()=>{this.showSetRainbondCluster()}},"\u70b9\u51fb\u8fd9\u91cc"))))),k.default.createElement(p.default.Item,{name:"remember",valuePropName:"checked",noStyle:!0},k.default.createElement(d.default,{onChange:this.setChecked,style:N,checked:b},"\u6211\u5df2\u9605\u8bfb\u5e76\u5df2\u6e05\u695a\u8ba4\u8bc6\u4e0a\u8ff0\u6ce8\u610f\u4e8b\u9879"),10===E&&this.handleNewbieGuiding({tit:"\u8bf7\u4ed4\u7ec6\u9605\u8bfb\u5e73\u53f0\u96c6\u7fa4\u670d\u52a1\u7684\u521d\u59cb\u5316\u5b89\u88c5\u7684\u8bf4\u660e\u548c\u524d\u63d0\u6761\u4ef6\u3002",send:!1,configName:"kclustersAttentionAttention",nextStep:11,btnText:"\u5df2\u77e5\u6653",conPosition:{left:0,bottom:"-192px"},svgPosition:{left:"3px",marginTop:"-19px"},handleClick:()=>{this.setState({checked:!0})}}))),k.default.createElement(r.default,{style:{textAlign:"center",marginTop:"32px"},span:24},f&&"complete"!==f.status?k.default.createElement(k.Fragment,null,k.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},"\u4e0a\u4e00\u6b65"),A,k.default.createElement(o.default,{onClick:()=>{this.setState({showInitDetail:!0})},type:"primary"},"\u6b63\u5728\u521d\u59cb\u5316/\u786e\u8ba4\u8fdb\u5ea6")):k.default.createElement(k.Fragment,null,k.default.createElement(o.default,{onClick:t,style:{marginRight:"16px"}},"\u4e0a\u4e00\u6b65"),A,k.default.createElement(o.default,{loading:m,onClick:this.initRainbondCluster,type:"primary"},f?"\u91cd\u65b0\u521d\u59cb\u5316":"\u5f00\u59cb\u521d\u59cb\u5316")),11===E&&this.handleNewbieGuiding({tit:"\u5f00\u59cb\u521d\u59cb\u5316",desc:"\u91c7\u7528\u9ed8\u8ba4\u521d\u59cb\u5316\u914d\u7f6e\u5f00\u59cb\u5b89\u88c5\u3002",send:!0,configName:"kclustersAttentionAttention",nextStep:12,conPosition:{left:"63%",bottom:"-39px"},svgPosition:{left:"58%",marginTop:"-13px"},handleClick:()=>{this.initRainbondCluster()}})),v&&u&&k.default.createElement(x.default,{eid:a,clusterID:u,providerName:l,onCancel:()=>{this.handleIsComponents(!1)}}),h&&f&&k.default.createElement(y.default,{onCancel:this.cancelShowInitDetail,eid:a,guideStep:E,handleNewbieGuiding:this.handleNewbieGuiding,providerName:l,clusterID:f.clusterID,taskID:f.taskID}),g&&k.default.createElement(i.default,{visible:!0,title:"\u8bbe\u7f6e\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e",onOk:this.handleSubmit,width:800,confirmLoading:m,onCancel:()=>{this.setState({showClusterInitConfig:!1})}},k.default.createElement(s.default,{message:"\u8bf7\u6ce8\u610f\uff0c\u9ed8\u8ba4\u6570\u636e\u4ec5\u4f5c\u4e3a\u793a\u4f8b\uff0c\u5404\u5b57\u6bb5\u82e5\u9700\u8981\u4f7f\u7528\u9ed8\u8ba4\u503c\u5219\u4e0d\u8981\u914d\u7f6e\u8be5\u5b57\u6bb5\u3002",type:"warning",style:{marginBottom:"16px"}}),k.default.createElement(D.default,{titles:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e\u5305\u542b\u5e73\u53f0\u96c6\u7fa4\u7684\u521d\u59cb\u5316\u7684\u5168\u90e8\u914d\u7f6e",setFieldsValue:P,formItemLayout:C,Form:p.default,getFieldDecorator:S,mode:"yaml",name:"config",data:I,label:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e",message:"\u96c6\u7fa4\u521d\u59cb\u5316\u914d\u7f6e\u914d\u7f6e\u662f\u5fc5\u9700\u7684",width:"750px"})))}},f=g))||f)||f);t.default=P},XdbD:function(e,t,a){"use strict";var l=a("g09b"),n=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=l(a("bx4M"));a("14J3");var s=l(a("BMrR"));a("y8nQ");var r=l(a("Vl3Y"));a("FJo9");var d,o,u,c,p=l(a("L41K")),h=a("MuoO"),m=a("7DNP"),f=n(a("q1tI")),g=l(a("Jq4M")),I=l(a("XZXw")),v=l(a("+iC2")),E=p.default.Step,k=(d=r.default.create(),o=(0,h.connect)(e=>{var t=e.user,a=e.list,l=e.loading,n=e.global,i=e.index;return{user:t.currentUser,list:a,loading:l.models.list,rainbondInfo:n.rainbondInfo,enterprise:n.enterprise,isRegist:n.isRegist,oauthLongin:l.effects["global/creatOauth"],overviewInfo:i.overviewInfo}}),d(u=o((c=class extends f.PureComponent{constructor(e){super(e),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(m.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,l=t.provider;e(m.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(l,"/kclusters")))}),this.loadSteps=(()=>{var e=[{title:"\u9009\u62e9\u4f9b\u5e94\u5546"},{title:"\u9009\u62e9(\u521b\u5efa)\u5e73\u53f0\u96c6\u7fa4"},{title:"\u521d\u59cb\u5316\u5e73\u53f0\u96c6\u7fa4"},{title:"\u5b8c\u6210\u5bf9\u63a5"}];return e}),this.completeInit=(()=>{var e=this.props.dispatch,t=this.props.match.params,a=t.eid,l=t.provider,n=t.clusterID;e(m.routerRedux.push("/enterprise/".concat(a,"/provider/").concat(l,"/kclusters/").concat(n,"/link")))});var t=this.props.user,a=v.default.isCompanyAdmin(t);this.state={adminer:a}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(m.routerRedux.push("/"))}componentDidMount(){}render(){var e=this.props.match.params,t=e.eid,a=e.provider,l=e.clusterID,n=e.taskID;return f.default.createElement(I.default,{title:"\u6dfb\u52a0\u96c6\u7fa4",content:"\u96c6\u7fa4\u662f\u8d44\u6e90\u7684\u96c6\u5408\uff0c\u4ee5Kubernetes\u96c6\u7fa4\u4e3a\u57fa\u7840\uff0c\u90e8\u7f72\u5e73\u53f0Region\u670d\u52a1\u5373\u53ef\u6210\u4e3a\u5e73\u53f0\u96c6\u7fa4\u8d44\u6e90\u3002"},f.default.createElement(s.default,{style:{marginBottom:"16px"}},f.default.createElement(p.default,{current:2},this.loadSteps().map(e=>f.default.createElement(E,{key:e.title,title:e.title})))),f.default.createElement(i.default,null,f.default.createElement(s.default,{style:{marginBottom:"16px"}},f.default.createElement(g.default,{eid:t,completeInit:this.completeInit,selectProvider:a,taskID:n,clusterID:l,preStep:this.preStep}))))}},u=c))||u)||u);t.default=k}}]);