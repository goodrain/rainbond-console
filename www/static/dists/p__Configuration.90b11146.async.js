(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[31],{RKMq:function(e,t,a){e.exports={cardHeader:"cardHeader___2RlGZ",cardBody:"cardBody___W1ScI"}},"s+T3":function(e,t,a){"use strict";var n=a("tAuX"),r=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o,s=n(a("q1tI")),l=a("MuoO"),c=r(a("QDog")),d=r(a("9Qkj")),u=r(a("nckk")),p=r(a("zmNr")),f=a("vSx2"),m=(i=(0,l.connect)(e=>{var t=e.teamControl,a=e.enterprise;return{currentTeam:t.currentTeam,currentRegionName:t.currentRegionName,currentEnterprise:a.currentEnterprise,currentTeamPermissionsInfo:t.currentTeamPermissionsInfo}}),i(o=class extends s.PureComponent{constructor(e){super(e),this.state={appConfigGroupPermissions:d.default.queryPermissionsInfo(this.props.currentTeamPermissionsInfo&&this.props.currentTeamPermissionsInfo.team,"app_config_group","app_".concat(c.default.getAppID()))}}render(){var e=this.props,t=e.currentEnterprise,a=e.currentTeam,n=e.currentRegionName,r=e.match,i=this.state.appConfigGroupPermissions,o=r.params,l=o.teamName,c=o.regionName,m=o.appID,g={regionName:c,teamName:l,appID:m,appConfigGroupPermissions:i},h=[];return h=(0,f.createTeam)((0,f.createEnterprise)(h,t),a,n),i.isAccess?s.default.createElement(u.default,{breadcrumbList:h},s.default.createElement(p.default,g)):d.default.noPermission()}})||o);t.default=m},zmNr:function(e,t,a){"use strict";var n=a("g09b"),r=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=n(a("bx4M"));a("g9YV");var o=n(a("wCAj"));a("Awhp");var s=n(a("KrTs"));a("Q9mQ");var l=n(a("diRs"));a("14J3");var c=n(a("BMrR"));a("jCWc");var d=n(a("kPKH"));a("+L6B");var u=n(a("2/Rp"));a("5NDa");var p=n(a("5rEg"));a("/xke");var f=n(a("TeRw"));a("y8nQ");var m=n(a("Vl3Y"));a("2qtc");var g,h,C,v=n(a("kLXV")),b=n(a("q76B")),E=a("xpXo"),_=a("MuoO"),M=a("7DNP"),y=n(a("wd/R")),I=r(a("q1tI")),N=a("LLXN"),k=n(a("RKMq")),D=v.default.confirm,P=m.default.Item,S=(g=(0,_.connect)(e=>{var t=e.loading,a=e.teamControl,n=e.enterprise;return{deleteConfigurationLoading:t.effects["global/DeleteConfiguration"],currentTeam:a.currentTeam,currentRegionName:a.currentRegionName,currentEnterprise:n.currentEnterprise,currentTeamPermissionsInfo:a.currentTeamPermissionsInfo}}),g((C=class extends I.PureComponent{constructor(e){var t;super(e),t=this,this.onPageChange=((e,t)=>{this.setState({page:e,pageSize:t},()=>{this.fetchConfigurationList()})}),this.fetchConfigurationList=(()=>{var e=this.props,t=e.dispatch,a=e.teamName,n=e.regionName,r=e.appID,i=this.state,o=i.page,s=i.pageSize,l=i.query;t({type:"global/fetchConfigurationList",payload:{team_name:a,group_id:r,region:n,query:l,page:o,page_size:s},callback:e=>{e&&200===e.status_code&&this.setState({loading:!1,apps:e.list,total:e.total})}})}),this.handleConfigurationOperation=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=t.props,n=a.dispatch,r=a.regionName,i=a.teamName,o=a.appID,s=e?e.config_group_name:"add";n(M.routerRedux.push("/team/".concat(i,"/region/").concat(r,"/apps/").concat(o,"/configgroups/details/").concat(s)))},this.handleSearch=(()=>{this.fetchConfigurationList()}),this.handelChange=(e=>{this.setState({query:e.target.value})}),this.handleEnter=(()=>{this.handleSearch()}),this.handleDelete=(e=>{this.setState({deleteVar:!0,info:e})}),this.cancelDeleteVariabl=(()=>{this.setState({deleteVar:!1})}),this.handleResetInfo=(()=>{this.setState({info:{}})}),this.handleDeleteVariabl=(()=>{var e=this.props,t=e.dispatch,a=e.regionName,n=e.teamName,r=e.appID,i=this.state,o=i.page,s=i.pageSize,l=i.query,c=i.info,d=[];c&&c.services&&c.services.length>0&&c.services.map(e=>{d.push(e.service_id)}),t({type:"global/DeleteConfiguration",payload:{region_name:a,team_name:n,group_id:r,name:c.config_group_name,query:l,page:o,page_size:s},callback:e=>{e&&200===e.status_code&&(this.fetchConfigurationList(),this.cancelDeleteVariabl(),d.length>0?this.showRemind(d):this.handleResetInfo(),f.default.success({message:(0,N.formatMessage)({id:"notification.success.delete"})}))}})}),this.showRemind=(e=>{var t=this;D({title:(0,N.formatMessage)({id:"notification.hint.confiuration.update.title"}),content:(0,N.formatMessage)({id:"notification.hint.confiuration.update.content"}),okText:(0,N.formatMessage)({id:"button.update"}),cancelText:(0,N.formatMessage)({id:"button.cancel"}),onOk(){return t.handleBatchOperation(e),new Promise((e,t)=>{setTimeout(Math.random()>.5?e:t,2e3)}).catch(()=>console.log("Oops errors!"))},onCancel(){t.handleResetInfo()}})}),this.handleBatchOperation=(e=>{var t=this.props.teamName;(0,E.batchOperation)({action:"upgrade",team_name:t,serviceIds:e&&e.length>0?e.join(","):""}).then(e=>{e&&(f.default.success({message:(0,N.formatMessage)({id:"notification.success.updates"}),duration:"3"}),this.handleResetInfo())})}),this.state={apps:[],loading:!0,page:1,query:"",pageSize:10,info:{},deleteVar:!1}}componentDidMount(){this.fetchConfigurationList()}render(){var e=this.props,t=e.deleteConfigurationLoading,a=e.appConfigGroupPermissions,n=a.isCreate,r=a.isDelete,f=a.isEdit,g=e.regionName,h=e.teamName,C=(e.appID,this.state),v=C.apps,E=C.loading,_=C.page,D=C.pageSize,S=C.total,R=C.deleteVar;return I.default.createElement("div",null,R&&I.default.createElement(b.default,{onOk:this.handleDeleteVariabl,onCancel:this.cancelDeleteVariabl,loading:t,title:(0,N.formatMessage)({id:"confirmModal.delete.configuration.title"}),desc:(0,N.formatMessage)({id:"confirmModal.delete.configuration.desc"}),subDesc:(0,N.formatMessage)({id:"confirmModal.delete.strategy.subDesc"})}),I.default.createElement(i.default,{style:{borderRadius:5},className:k.default.cardBody},I.default.createElement(c.default,{className:k.default.cardHeader},I.default.createElement(d.default,{span:20},I.default.createElement(m.default,{layout:"inline",style:{display:"inline-block"}},I.default.createElement(P,null,I.default.createElement(p.default,{placeholder:(0,N.formatMessage)({id:"appConfiguration.placeholder"}),onChange:this.handelChange,onPressEnter:this.handleEnter,style:{width:250}})),I.default.createElement(P,null,I.default.createElement(u.default,{type:"primary",onClick:this.handleSearch,icon:"search"},(0,N.formatMessage)({id:"appConfiguration.btn.search"}))))),I.default.createElement(d.default,{span:4},n&&I.default.createElement(u.default,{type:"primary",icon:"plus",style:{float:"right",margin:"4px 0 0"},onClick:()=>{this.handleConfigurationOperation()}},(0,N.formatMessage)({id:"appConfiguration.btn.add"})))),I.default.createElement("div",{style:{padding:24}},I.default.createElement(o.default,{size:"default",rowKey:(e,t)=>t,pagination:{size:"default",current:_,pageSize:D,total:S,onChange:this.onPageChange,onShowSizeChange:this.onPageChange,showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>"\u5171 ".concat(e," \u6761"),hideOnSinglePage:S<=10},dataSource:v||[],loading:E,columns:[{title:(0,N.formatMessage)({id:"appConfiguration.table.name"}),dataIndex:"config_group_name"},{title:(0,N.formatMessage)({id:"appConfiguration.table.createTime"}),dataIndex:"create_time",align:"center",render:e=>{return"".concat((0,y.default)(e).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"))}},{title:(0,N.formatMessage)({id:"appConfiguration.table.componentNum"}),dataIndex:"services_num",align:"center",render:(e,t)=>{return I.default.createElement("div",null,e?I.default.createElement(l.default,{placement:"top",title:(0,N.formatMessage)({id:"appConfiguration.table.take_effect_component"}),content:I.default.createElement("div",null,t.services.map(e=>{var t=e.service_cname,a=e.service_alias;return I.default.createElement(M.Link,{key:a,to:"/team/".concat(h,"/region/").concat(g,"/components/").concat(a,"/overview")},t)})),trigger:"click"},I.default.createElement("a",null,e)):0)}},{title:(0,N.formatMessage)({id:"appConfiguration.table.status"}),dataIndex:"enable",align:"center",render:e=>{return I.default.createElement("div",null,I.default.createElement(s.default,{status:e?"success":"error",text:I.default.createElement("span",null,e?(0,N.formatMessage)({id:"appConfiguration.table.take_effect"}):(0,N.formatMessage)({id:"appConfiguration.table.not_take_effect"}))}))}},{title:(0,N.formatMessage)({id:"appConfiguration.table.operate"}),dataIndex:"action",align:"center",render:(e,t)=>{return I.default.createElement("div",null,f&&I.default.createElement("a",{onClick:()=>{this.handleConfigurationOperation(t)}},(0,N.formatMessage)({id:"appConfiguration.table.btn.edit"})),r&&I.default.createElement("a",{onClick:()=>{this.handleDelete(t)}},(0,N.formatMessage)({id:"appConfiguration.table.btn.delete"})))}}]}))))}},h=C))||h);t.default=S}}]);