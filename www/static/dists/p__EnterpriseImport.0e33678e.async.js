(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{AkSM:function(e,t,a){e.exports={tit:"tit___AJoBY",upText:"upText___25PJ2",mb10:"mb10___3z1Aa",rl:"rl___nfYuz",box:"box___3iPdf",con:"con___3LnAo",desc:"desc___1V9Za",btn:"btn___77hST"}},NlwA:function(e,t,a){"use strict";var s=a("g09b"),l=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("+L6B");var r=s(a("2/Rp"));a("OaEy");var n=s(a("2fM7"));a("7Kak");var i=s(a("9yH6"));a("sRBo");var d=s(a("kaz8"));a("DZo9");var u=s(a("8z0m"));a("Pwec");var o=s(a("CtXQ"));a("MXD1");var c=s(a("CFYs"));a("IzEo");var p=s(a("bx4M"));a("14J3");var m=s(a("BMrR"));a("jCWc");var f=s(a("kPKH"));a("/xke");var h=s(a("TeRw"));a("2qtc");var _,v,g,y=s(a("kLXV")),b=a("MuoO"),E=a("7DNP"),k=l(a("q1tI")),x=s(a("XZXw")),S=s(a("+iC2")),w=s(a("AkSM")),C=y.default.confirm,I=(_=(0,b.connect)(e=>{var t=e.user,a=e.global;return{user:t.currentUser,rainbondInfo:a.rainbondInfo}}),_((g=class extends k.PureComponent{constructor(e){super(e),this.cancelImport=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/cancelImportApp",payload:{enterprise_id:a,event_id:this.state.event_id},callback:e=>{e&&(h.default.success({message:"\u53d6\u6d88\u6210\u529f"}),t(E.routerRedux.push("/enterprise/".concat(a,"/shared/local"))))}})}),this.complete=(()=>{this.props.onOK&&this.props.onOK()}),this.onChangeUpload=(e=>{var t=e.fileList;t=t.filter(e=>{return!e.response||"success"===e.response.msg}),e&&e.event&&e.event.percent&&this.setState({percents:e.event.percent});var a=e.file.status;"done"===a&&this.setState({percents:!1}),this.setState({fileList:t})}),this.onRemove=(()=>{this.setState({fileList:[]})}),this.onFileChange=(e=>{this.setState({file_list:e})}),this.openQueryImportStatus=(()=>{this.statusloop=!0,this.queryImportStatus()}),this.handleSubmit=(()=>{var e=this.props.match.params.eid,t=this.state,a=t.scopeValue,s=t.tenant_name,l=t.event_id,r=t.file_list;if(0===r.length)return h.default.destroy(),void h.default.warning({message:"\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u5e94\u7528"});if(""===s&&"enterprise"!==a)return h.default.destroy(),void h.default.warning({message:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u56e2\u961f"});var n="";r.map(e=>{return n+="".concat(e,","),e}),n=n.slice(0,n.length-1),this.props.dispatch({type:"market/importApp",payload:{scope:a,tenant_name:s,enterprise_id:e,event_id:l,file_name:n},callback:e=>{e&&(h.default.success({message:"\u5f00\u59cb\u5bfc\u5165\u5e94\u7528"}),this.loop=!1,this.openQueryImportStatus())}})}),this.queryImportRecord=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/queryImportRecord",payload:{enterprise_id:a},callback:e=>{e&&200===e.status_code&&(e.bean&&""!==e.bean.region_name||C({content:"\u60a8\u8fd8\u672a\u5bf9\u63a5\u96c6\u7fa4\uff0c\u5e94\u7528\u6a21\u7248\u5bfc\u5165\u529f\u80fd\u6682\u4e0d\u53ef\u7528"}),this.setState({record:e.bean,event_id:e.bean.event_id,region_name:e.bean&&e.bean.region_name},()=>{""!==e.bean.region_name&&(this.openQueryImportStatus(),this.handleQueryImportDir())}))}})}),this.queryImportStatus=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/queryImportApp",payload:{enterprise_id:a,event_id:this.state.event_id},callback:e=>{if(e&&200===e.status_code){if(this.setState({import_file_status:e.list}),e.bean&&"uploading"===e.bean.status)return;if(e.bean&&"partial_success"===e.bean.status)return void h.default.success({message:"\u90e8\u5206\u5e94\u7528\u5bfc\u5165\u5931\u8d25\uff0c\u4f60\u53ef\u4ee5\u91cd\u8bd5\u6216\u53d6\u6d88\u5bfc\u5165"});if(e.bean&&"success"===e.bean.status)return h.default.success({message:"\u5bfc\u5165\u5b8c\u6210"}),void t(E.routerRedux.push("/enterprise/".concat(a,"/shared/local")));if(e.bean&&"failed"===e.bean.status)return h.default.warning({message:"\u5e94\u7528\u5bfc\u5165\u5931\u8d25"}),void this.setState({import_file_status:[]});this.statusloop&&setTimeout(()=>{this.queryImportStatus()},3e3)}},handleError:()=>{}})}),this.handleQueryImportDir=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"market/queryImportDirApp",payload:{enterprise_id:a,event_id:this.state.event_id},callback:e=>{e&&this.setState({existFileList:e.list}),this.loop&&setTimeout(()=>{this.handleQueryImportDir()},6e3)},handleError:()=>{}})}),this.onChangeRadio=(e=>{this.setState({scopeValue:e.target.value})}),this.getUserTeams=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"global/fetchMyTeams",payload:{enterprise_id:a,page:1,page_size:999},callback:e=>{e&&200===e.status_code&&this.setState({userTeamList:e.list})}})}),this.handleChangeTeam=(e=>{this.setState({tenant_name:e})});var t=this.props.user,a=S.default.isCompanyAdmin(t);this.state={enterpriseAdmin:a,fileList:[],existFileList:[],record:{},event_id:"",file_list:[],import_file_status:[],userTeamList:[],scopeValue:a?"enterprise":"team",tenant_name:"",percents:!1,region_name:""}}componentDidMount(){this.loop=!0,this.queryImportRecord(),this.getUserTeams()}componentWillUnmount(){this.loop=!1,this.statusloop=!1}render(){var e=()=>k.default.createElement("svg",{t:"1582646117495",viewBox:"0 0 1026 1024","p-id":"5405",width:"23",height:"23"},k.default.createElement("path",{d:"M536.149154 400.348544c56.251093 47.113428 112.500379 94.243113 168.749666 141.372797 20.850997 17.471561 22.241786 33.339199 4.763001 54.179359-17.460724 20.858222-33.353649 22.249011-54.20284 4.779257-34.630646-29.020528-69.259485-58.042862-103.906387-87.045328v448.330764c0 27.203471-11.259972 38.458025-38.477893 38.458024-27.201665 0-38.477893-11.254553-38.477894-38.458024V513.634629a541926.23157 541926.23157 0 0 0-103.906387 87.045328c-20.850997 17.469755-36.72586 16.078966-54.206452-4.779257-17.478786-20.84016-16.086191-36.707798 4.763001-54.179359 56.252899-47.129684 112.502185-94.259369 168.751472-141.372797 16.660568-13.953045 29.490145-13.953045 46.150713 0z",fill:"#4D73B1","p-id":"5406"}),k.default.createElement("path",{d:"M923.532655 8.543418H102.61494C45.939386 8.543418 0 54.477385 0 111.113203v512.865179c0 56.632205 45.939386 102.569785 102.61494 102.569784h217.178022c27.216115 0 38.494149-11.272616 38.494149-38.476087 0-27.187215-11.276228-38.459831-38.494149-38.459831H102.61494c-18.148893 0-25.662766-7.506648-25.662766-25.63206V111.115009c0-18.125412 7.513873-25.633867 25.662766-25.633867h820.917715c18.148893 0 25.66096 7.508454 25.66096 25.633867v512.865179c0 18.125412-7.512067 25.63206-25.66096 25.63206H706.356439c-27.216115 0-38.494149 11.272616-38.494149 38.459831 0 27.205278 11.276228 38.476087 38.494149 38.476087h217.176216c56.675554 0 102.61494-45.93758 102.61494-102.569784V111.113203c0-56.635817-45.939386-102.569785-102.61494-102.569785z",fill:"#4D73B1","p-id":"5407"})),t={},a=this.state,s=a.existFileList,l=a.percents,h=a.userTeamList,_=a.record,v=a.region_name,g=a.enterpriseAdmin,y=a.import_file_status,b=s&&s.length>0&&s,E={display:"block",height:"30px",lineHeight:"30px"},S=h&&h.length>0&&h;return k.default.createElement(x.default,{title:"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165",content:"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165\u662f\u521b\u5efa\u672c\u5730\u5171\u4eab\u5e93\u5e94\u7528\u6a21\u578b\u7684\u65b9\u5f0f\u4e4b\u4e00\uff0c\u79bb\u7ebf\u5e94\u7528\u5305\u53ef\u4ee5\u6765\u81ea\u5176\u4ed6\u5728\u7ebf\u5e73\u53f0\u5bfc\u51fa\u6216\u4e91\u5e94\u7528\u5546\u5e97\u5bfc\u51fa"},k.default.createElement("div",{style:{margin:"75px 21px 0 24px"}},k.default.createElement("div",{className:w.default.tit},"\u79bb\u7ebf\u5e94\u7528\u6a21\u7248\u5bfc\u5165"),k.default.createElement(p.default,{bodyStyle:{padding:"25px 0 25px 29px"},className:w.default.mb10},k.default.createElement(m.default,{className:w.default.box},k.default.createElement(f.default,{span:24,className:w.default.desc},"\u6b63\u5728\u4f7f\u7528",k.default.createElement("span",null,"\u201c",v,"\u201d"),"\u5b8c\u6210\u672c\u6b21\u5bfc\u5165\u4efb\u52a1"))),k.default.createElement(p.default,{bodyStyle:{padding:"0 0 0 27px"},className:w.default.mb10},k.default.createElement(m.default,{className:w.default.box},k.default.createElement(f.default,{span:23,className:w.default.con},"\u4e0a\u4f20APP\u6587\u4ef6",l&&k.default.createElement(c.default,{percent:parseInt(l),size:"small",style:{width:"98%"}})),k.default.createElement(f.default,{span:1,className:w.default.rl},k.default.createElement(u.default,{showUploadList:!1,name:"appTarFile",accept:".zip,.tar,.gz",action:_.upload_url,fileList:this.state.fileList,onChange:this.onChangeUpload,onRemove:this.onRemove,headers:t,disabled:""===v},k.default.createElement(o.default,{component:e}),k.default.createElement("div",{className:w.default.upText},"\u4e0a\u4f20"))))),b&&k.default.createElement("div",null,k.default.createElement("div",{className:w.default.tit},"\u5df2\u4e0a\u4f20\u6587\u4ef6\u5217\u8868"),k.default.createElement(p.default,{className:w.default.mb10},k.default.createElement(d.default.Group,{style:{width:"100%"},onChange:this.onFileChange},k.default.createElement(m.default,null,b.map(e=>{return k.default.createElement(f.default,{key:"col".concat(e),span:24},k.default.createElement(d.default,{key:e,value:e},e," ",y.map(t=>{if(t.file_name===e)switch(t.status){case"failed":return k.default.createElement(o.default,{type:"check-circle",theme:"twoTone",twoToneColor:"red"});case"success":return k.default.createElement(o.default,{type:"check-circle",theme:"twoTone",twoToneColor:"#52c41a"});default:return k.default.createElement(o.default,{type:"sync",spin:!0})}})))})))),k.default.createElement("div",{className:w.default.tit},"\u5bfc\u5165\u8303\u56f4"),k.default.createElement(p.default,{className:w.default.mb10},k.default.createElement(i.default.Group,{onChange:this.onChangeRadio,value:this.state.scopeValue},k.default.createElement(i.default,{style:E,value:"enterprise",disabled:!g},"\u4e0a\u4f20\u5230\u4f01\u4e1a"),k.default.createElement(i.default,{style:E,value:"team"},"\u4e0a\u4f20\u5230\u56e2\u961f",k.default.createElement(n.default,{getPopupContainer:e=>e.parentNode,size:"small",defaultValue:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u56e2\u961f",style:{width:150,marginLeft:"15px"},onChange:this.handleChangeTeam},S&&S.map(e=>{var t=e.team_id,a=e.team_alias,s=e.team_name;return k.default.createElement(Option,{key:t,value:s},a)}))))),k.default.createElement(m.default,{style:{marginTop:"25px"}},k.default.createElement(f.default,{span:24,className:w.default.btn},k.default.createElement(r.default,{onClick:()=>{this.cancelImport()}},"\u653e\u5f03\u5bfc\u5165"),0===this.state.import_file_status.length&&k.default.createElement(r.default,{type:"primary",onClick:()=>{this.handleSubmit()}},"\u786e\u8ba4\u5bfc\u5165"))))))}},v=g))||v);t.default=I}}]);