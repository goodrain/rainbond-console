(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{2457:function(e,t,a){e.exports={nameID:"nameID___lHOPc",icon:"icon___3bO_J",iconm:"iconm___1h3X6",cmd:"cmd___1CeOh",logline:"logline___2nRMf"}},"52ST":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=l(a("bx4M"));a("jCWc");var n=l(a("kPKH"));a("5Dmo");var i=l(a("3S7+"));a("14J3");var d=l(a("BMrR"));a("+L6B");var o=l(a("2/Rp")),u=l(a("jehZ"));a("y8nQ");var c=l(a("Vl3Y"));a("FJo9");var h,p,f,m,g=l(a("L41K")),C=l(a("18gR")),v=a("MuoO"),E=a("7DNP"),k=s(a("q1tI")),b=l(a("sQyZ")),I=l(a("VQ3Z")),y=l(a("LjLi")),S=l(a("s6ox")),w=l(a("5ov5")),_=l(a("XZXw")),x=l(a("AklW")),D=l(a("QDog")),P=l(a("+iC2")),T=g.default.Step,K=(h=c.default.create(),p=(0,v.connect)(e=>{var t=e.user,a=e.list,l=e.loading,s=e.global,r=e.index;return{user:t.currentUser,list:a,loading:l.models.list,rainbondInfo:s.rainbondInfo,enterprise:s.enterprise,isRegist:s.isRegist,oauthLongin:l.effects["global/creatOauth"],overviewInfo:r.overviewInfo}}),h(f=p((m=class extends k.PureComponent{constructor(e){super(e),this.startInit=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,s=a.provider,r=this.state,n=r.selectClusterID,i=r.rainbondInit;t(E.routerRedux.push("/enterprise/".concat(l,"/provider/").concat(s,"/kclusters/").concat(n,"/").concat(i?"link":"init")))}),this.selectCluster=(e=>{this.setState({selectClusterID:e.clusterID,rainbondInit:e.rainbond_init})}),this.loadLastTask=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,s=a.provider;t({type:"cloud/loadLastTask",payload:{enterprise_id:l,provider_name:s},callback:e=>{e&&(this.setState({lastTask:e,currentClusterID:e.clusterID}),"start"===e.status&&this.setState({showTaskDetail:!0}))},handleError:e=>{x.default.handleCloudAPIError(e)}})}),this.loadKubernetesCluster=(()=>{var e=this.props,t=e.dispatch,a=e.match.params,l=a.eid,s=a.provider;this.setState({loading:!0}),t({type:"cloud/loadKubereneteClusters",payload:{enterprise_id:l,provider_name:s},callback:e=>{if(e&&e.clusters&&e.clusters.length>0){var t="running"===e.clusters[0].state;this.setState({k8sClusters:e.clusters,loading:!1}),t&&document.getElementById("initializeBtn").scrollIntoView(),this.loadRainbondClusters()}else"custom"!==s&&"rke"!==s||this.showBuyClusterConfig(),this.setState({loading:!1})},handleError:e=>{x.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.handleStartLog=((e,t,a)=>{var l=this.props,s=l.match.params,r=s.eid,n=s.provider,i=l.rainbondInfo,d=l.enterprise;D.default.putInstallClusterLog(d,i,{eid:r,taskID:e,status:a?t:"start",install_step:"createK8s",provider:n})}),this.loadRainbondClusters=(()=>{var e=this.props,t=e.dispatch,a=e.match.params.eid;t({type:"region/fetchEnterpriseClusters",payload:{enterprise_id:a,check_status:"no"},callback:e=>{if(e&&e.list){var t=new Map;e.list.map(e=>{return""!==e.provider_cluster_id&&t.set(e.provider_cluster_id,!0),e}),this.setState({linkedClusters:t})}}})}),this.showBuyClusterConfig=(()=>{this.setState({showBuyClusterConfig:!0})}),this.cancelAddCluster=(()=>{this.setState({showBuyClusterConfig:!1})}),this.cancelShowCreateDetail=(()=>{this.setState({showTaskDetail:!1}),this.loadKubernetesCluster()}),this.addClusterOK=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(E.routerRedux.push("/enterprise/".concat(t,"/clusters")))}),this.preStep=(()=>{var e=this.props.dispatch,t=this.props.match.params.eid;e(E.routerRedux.push("/enterprise/".concat(t,"/addCluster")))}),this.loadSteps=(()=>{var e=[{title:"\u9009\u62e9\u4f9b\u5e94\u5546"},{title:"\u9009\u62e9(\u521b\u5efa)\u5e73\u53f0\u96c6\u7fa4"},{title:"\u521d\u59cb\u5316\u5e73\u53f0\u96c6\u7fa4"},{title:"\u5b8c\u6210\u5bf9\u63a5"}];return e}),this.handleOk=((e,t,a)=>{this.setState(t),e&&e.taskID&&this.handleStartLog(e.taskID,e.status,a),this.cancelAddCluster(),this.loadKubernetesCluster()}),this.handleGuideStep=(e=>{this.setState({guideStep:e})}),this.handleNewbieGuiding=(e=>{var t=e.prevStep,a=e.nextStep,l=e.handleClick,s=void 0===l?()=>{}:l,r=e.handleClosed,n=void 0===r?()=>{}:r;return k.default.createElement(C.default,(0,u.default)({},e,{totals:14,handleClose:()=>{this.handleGuideStep("close"),this.selectCluster({clusterID:"",rainbond_init:!1}),n()},handlePrev:()=>{t&&this.handleGuideStep(t)},handleNext:()=>{a&&(s(),this.handleGuideStep(a))}}))}),this.renderCreateClusterShow=(()=>{var e=this.props.match.params,t=e.eid,a=e.provider,l=this.state.guideStep;switch(a){case"ack":return k.default.createElement(b.default,{eid:t,selectProvider:a,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});case"tke":break;case"custom":return k.default.createElement(I.default,{eid:t,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={currentClusterID:e.clusterID};this.handleOk(e,t,!0)}});case"rke":return k.default.createElement(S.default,{eid:t,guideStep:l,handleNewbieGuiding:this.handleNewbieGuiding,onCancel:()=>{this.cancelAddCluster()},onOK:e=>{var t={lastTask:e,showTaskDetail:!0,currentClusterID:e.clusterID};this.handleOk(e,t)}});default:}});var t=this.props.user,a=P.default.isCompanyAdmin(t);this.state={adminer:a,showBuyClusterConfig:!1,k8sClusters:[],loading:!0,rainbondInit:!1,selectClusterID:"",showTaskDetail:!1,linkedClusters:new Map,lastTask:{},guideStep:3,currentClusterID:""}}componentWillMount(){var e=this.state.adminer,t=this.props.dispatch;e||t(E.routerRedux.push("/"))}componentDidMount(){this.loadKubernetesCluster(),this.loadLastTask()}render(){var e=this.props,t=e.match.params,a=t.eid,l=t.provider,s=e.location.query,u=s.clusterID,c=s.updateKubernetes,h=this.state,p=h.k8sClusters,f=h.showBuyClusterConfig,m=h.loading,C=h.selectClusterID,v=h.showTaskDetail,E=h.lastTask,b=h.linkedClusters,I=h.currentClusterID,S=h.guideStep,x=""===C,D="\u96c6\u7fa4\u5217\u8868";switch(l){case"ack":D+="(\u963f\u91cc\u4e91 ACK)";break;case"tke":D+="(\u817e\u8baf\u4e91 TKE)";break;case"custom":D+="(\u81ea\u5b9a\u4e49)";break;case"rke":D+="(\u57fa\u4e8e\u4e3b\u673a\u81ea\u5efa)";break;default:D+="(\u4e0d\u652f\u6301\u7684\u9a71\u52a8\u7c7b\u578b: ".concat(l,")")}var P=k.default.createElement(o.default,{style:{marginLeft:"16px"},type:"primary",onClick:this.startInit,disabled:x,id:"initializeBtn"},"\u4e0b\u4e00\u6b65"),K=!1,R="",A=!1;return p&&p.length&&p.map(e=>{var t=e.state;"running"===t&&(A=e.rainbond_init,R=e.cluster_id,K=!0)}),k.default.createElement(_.default,{title:"\u6dfb\u52a0\u96c6\u7fa4",content:"\u96c6\u7fa4\u662f\u8d44\u6e90\u7684\u96c6\u5408\uff0c\u4ee5\u96c6\u7fa4\u4e3a\u57fa\u7840\uff0c\u90e8\u7f72\u5e73\u53f0Region\u670d\u52a1\u5373\u53ef\u6210\u4e3a\u5e73\u53f0\u96c6\u7fa4\u8d44\u6e90\u3002"},k.default.createElement(d.default,{style:{marginBottom:"16px"}},k.default.createElement(g.default,{current:1},this.loadSteps().map(e=>k.default.createElement(T,{key:e.title,title:e.title})))),k.default.createElement(r.default,{title:D},k.default.createElement(y.default,{eid:a,loading:m,loadKubernetesCluster:this.loadKubernetesCluster,selectCluster:this.selectCluster,selectProvider:l,data:p,lastTask:E,showLastTaskDetail:()=>{this.setState({showTaskDetail:!0})},guideStep:S,handleNewbieGuiding:this.handleNewbieGuiding,loadLastTask:this.loadLastTask,linkedClusters:b,showBuyClusterConfig:this.showBuyClusterConfig,updateKubernetes:c,updateKubernetesClusterID:u}),!K||3!==S&&8!==S?"":this.handleNewbieGuiding({tit:"\u8bf7\u9009\u62e9Kubernetes\u96c6\u7fa4",desc:"\u53ef\u9009\u62e9\u5df2\u7ecf\u6b63\u5e38\u8fd0\u884c\u7684\u96c6\u7fa4",send:!1,configName:"kclustersInitializationCluster",nextStep:9,svgPosition:{left:"44px",marginTop:"-35px"},handleClick:()=>{this.selectCluster({clusterID:R,rainbond_init:A})}}),f&&this.renderCreateClusterShow(),k.default.createElement(n.default,{style:{textAlign:"center",marginTop:"32px"},span:24},k.default.createElement(o.default,{onClick:this.preStep},"\u4e0a\u4e00\u6b65"),x?k.default.createElement(i.default,{title:"\u8bf7\u9009\u62e9\u9700\u8981\u521d\u59cb\u5316\u7684\u96c6\u7fa4"},P):P,K&&9===S?this.handleNewbieGuiding({tit:"\u5f00\u59cbRainbond\u96c6\u7fa4\u670d\u52a1",desc:"\u521d\u59cb\u5316\u5b89\u88c5",send:!0,configName:"kclustersInitializationCluster",nextStep:10,conPosition:{left:"60%",bottom:"-24px"},svgPosition:{left:"54%",marginTop:"-11px"},handleClick:()=>{x||this.startInit()}}):""),v&&E&&k.default.createElement(w.default,{onCancel:this.cancelShowCreateDetail,eid:a,selectProvider:l,taskID:E.taskID,clusterID:I})))}},f=m))||f)||f);t.default=K},"5ov5":function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,i,d=l(a("jehZ")),o=a("MuoO"),u=s(a("q1tI")),c=l(a("AklW")),h=l(a("QDog")),p=l(a("UBd8")),f=(r=(0,o.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),r((i=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTask=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.taskID;t({type:"cloud/loadTask",payload:{enterprise_id:a,taskID:l},callback:e=>{e&&this.setState({complete:"complete"===e.status})},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.taskID,s=e.rainbondInfo,r=e.enterprise;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:l},callback:e=>{if(e){var t=c.default.showCreateKubernetesSteps(e.events),n=t.complete,i=t.steps;n&&i&&i.length>0&&h.default.putInstallClusterLog(r,s,{eid:a,taskID:l,status:i[i.length-1].Status,message:i[i.length-1].Message,install_step:"createK8s",provider:"rke"}),this.setState({complete:n,loading:!1,steps:i}),this.refresh&&!n&&setTimeout(()=>{this.loadTaskEvents()},4e3)}},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1}),this.refresh&&setTimeout(()=>{this.loadTaskEvents()},8e3)}})}),this.queryCreateLog=(()=>{this.setState({showCreateLog:!0})}),this.state={loading:!0,complete:!1,steps:[],showCreateLog:!1}}componentDidMount(){this.loadTask(),this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(p.default,(0,d.default)({title:e||"\u96c6\u7fa4\u521b\u5efa\u8fdb\u5ea6",msg:"\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u9884\u8ba110\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u82e5\u9047\u5230\u9519\u8bef\u8bf7\u53cd\u9988\u5230\u793e\u533a"},this.state,this.props))}},n=i))||n),m=f;t.default=m},LjLi:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=l(a("kLXV"));a("g9YV");var n=l(a("wCAj"));a("14J3");var i=l(a("BMrR"));a("P2fV");var d=l(a("NJEC"));a("+L6B");var o=l(a("2/Rp"));a("5Dmo");var u=l(a("3S7+"));a("7Kak");var c=l(a("9yH6"));a("jCWc");var h=l(a("kPKH"));a("Pwec");var p=l(a("CtXQ"));a("/xke");var f=l(a("TeRw"));a("miYZ");var m=l(a("tsqr"));a("tU7J");var g,C,v,E=l(a("wFql")),k=l(a("+QRC")),b=a("MuoO"),I=s(a("q1tI")),y=l(a("9tdr")),S=a("ArA+"),w=a("mLYH"),_=l(a("AklW")),x=l(a("dBUJ")),D=l(a("imTl")),P=l(a("3//m")),T=l(a("s6ox")),K=l(a("gtfS")),R=l(a("T8HY")),A=l(a("2457")),L=E.default.Paragraph,N=(g=(0,b.connect)(),g((v=class extends I.PureComponent{constructor(e){super(e),this.handleLoadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{this.setState({initCmd:e&&e.response_data&&e.response_data.cmd||""})}})}),this.autoPage=(()=>{var e=this.props,t=e.updateKubernetes,a=e.updateKubernetesClusterID;t&&a&&this.updateCluster(a)}),this.queryCreateLog=(e=>{this.setState({showCreateLog:!0,clusterID:e.cluster_id})}),this.reInstallCluster=(e=>{var t=this.props,a=t.dispatch,l=t.eid,s=t.selectProvider,r=t.loadKubernetesCluster,n=t.loadLastTask;if("rke"!==s)return m.default.warning("\u8be5\u63d0\u4f9b\u5546\u4e0d\u652f\u6301\u96c6\u7fa4\u91cd\u88c5"),void this.handleInstallLoading(!1);a({type:"cloud/reInstall",payload:{enterprise_id:l,clusterID:e},callback:e=>{this.handleInstallRemind(!1),this.handleInstallLoading(!1),e&&(r&&r(),n&&n())},handleError:e=>{this.handleInstallLoading(!1),_.default.handleCloudAPIError(e)}})}),this.updateCluster=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,w.getUpdateKubernetesTask)({clusterID:e,providerName:l,enterprise_id:a},e=>{_.default.handleCloudAPIError(e)}).then(t=>{t.task&&"complete"!==t.task.status?this.setState({showUpdateKubernetesTasks:!0,updateTask:t.task}):this.setState({showUpdateKubernetes:!0,nodeList:t.nodeList,rkeConfig:t.rkeConfig,updateClusterID:e})}).catch(e=>{console.log(e)})}),this.uninstallCluster=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,w.uninstallRegion)({provider_name:l,enterprise_id:a,clusterID:e},e=>{_.default.handleCloudAPIError(e)}).then(e=>{e&&200===e.status_code&&f.default.success({message:"\u96c6\u7fa4\u6b63\u5728\u5378\u8f7d\u4e2d\uff0c\u7a0d\u540e\u8bf7\u5237\u65b0\u5217\u8868"})})}),this.handleInstallLoading=(e=>{this.setState({installLoading:e})}),this.handleInstallRemind=(e=>{this.setState({isInstallRemind:e})}),this.handleCommandBox=(e=>{return I.default.createElement(h.default,{span:24,style:{marginTop:"16px"}},I.default.createElement("span",{className:K.default.cmd},I.default.createElement(p.default,{className:K.default.copy,type:"copy",onClick:()=>{(0,k.default)(e),f.default.success({message:"\u590d\u5236\u6210\u529f"})}}),e))}),this.cancelShowUpdateKubernetes=(()=>{var e=this.props.loadKubernetesCluster;this.setState({showUpdateKubernetesTasks:!1,updateTask:null}),e&&e()}),this.getKubeConfig=(e=>{var t=this.props,a=t.eid,l=t.selectProvider;(0,w.getKubeConfig)({clusterID:e,enterprise_id:a,providerName:l}).then(e=>{200===e.status_code&&this.setState({kubeConfig:e.config})})}),this.handleIsComponents=(e=>{this.setState({isComponents:e})}),this.state={selectClusterName:"",clusterID:"",showCreateLog:!1,isInstallRemind:!1,installLoading:!1,isComponents:!1,initCmd:null}}componentDidMount(){this.autoPage(),this.handleLoadInitNodeCmd()}deleteCluster(e){var t=this.props,a=t.dispatch,l=t.eid,s=t.selectProvider,r=t.loadKubernetesCluster;a({type:"cloud/deleteKubernetesCluster",payload:{enterprise_id:l,providerName:s,clusterID:e},callback:()=>{r&&r()},handleError:e=>{_.default.handleCloudAPIError(e)}})}render(){var e=this.props,t=e.selectProvider,a=e.linkedClusters,l=e.eid,s=e.selectCluster,m=this.state,g=m.selectClusterName,C=m.initCmd,v=[{width:50,dataIndex:"radio",render:(e,t)=>{var l=t.cluster_id,r="running"!==t.state||a.get(l)||t.parameters&&t.parameters.DisableRainbondInit,n=t.parameters&&t.parameters.Message,i=t.name;return I.default.createElement(u.default,{title:n},I.default.createElement(c.default,{disabled:r,checked:g===i,onClick:()=>{r||(this.setState({selectClusterName:i}),s&&s({clusterID:l,name:i,can_init:t.can_init,rainbond_init:t.state&&"running"===t.state&&t.rainbond_init}))}},e))}},{title:"\u540d\u79f0(ID)",width:120,dataIndex:"name",render:(e,t)=>{var a="".concat(e,"(").concat(t.cluster_id,")");return I.default.createElement(u.default,{title:a},I.default.createElement("div",{className:A.default.nameID},a))}},{title:"\u7c7b\u578b",width:180,dataIndex:"cluster_type",render:e=>{return _.default.getAliyunClusterName(e)}}];"custom"!==t&&"rke"!==t?(v.push({title:"\u533a\u57df",dataIndex:"region_id",render:e=>{return _.default.getAliyunRegionName(e)}}),v.push({title:"\u53ef\u7528\u533a",dataIndex:"zone_id"})):v.push({title:"API\u5730\u5740",width:300,dataIndex:"master_url.api_server_endpoint"}),v.push({title:"\u8282\u70b9\u6570\u91cf",width:100,dataIndex:"size"}),v.push({title:"\u7248\u672c",width:250,dataIndex:"current_version"}),v.push({title:"\u72b6\u6001",width:150,dataIndex:"state",render:(e,t)=>{return _.default.getAliyunClusterStatus(e,t,a)}}),v.push({title:"\u64cd\u4f5c",dataIndex:"cluster_id",render:(e,s)=>{return I.default.createElement("div",null,"running"===s.state&&I.default.createElement("a",{onClick:()=>this.getKubeConfig(s.cluster_id||s.name)},"KubeConfig"),"failed"===s.state&&"rke"===t&&I.default.createElement("a",{onClick:()=>{this.handleInstallRemind(s.cluster_id||s.name)}},"\u91cd\u65b0\u5b89\u88c5"),!0===s.rainbond_init&&!a.get(s.cluster_id)&&I.default.createElement(S.Link,{to:"/enterprise/".concat(l,"/provider/").concat(t,"/kclusters/").concat(s.cluster_id,"/link")},"\u5bf9\u63a5"),"rke"!==t&&s.create_log_path&&s.create_log_path.startsWith("http")&&I.default.createElement(o.default,{type:"link",style:{padding:0},onClick:()=>{window.open(s.create_log_path,"_blank")}},"\u67e5\u770b\u65e5\u5fd7"),"rke"===t&&I.default.createElement(o.default,{type:"link",style:{padding:0},onClick:()=>{this.queryCreateLog(s)}},"\u67e5\u770b\u65e5\u5fd7"),!s.rainbond_init&&("rke"===t||"custom"===t)&&I.default.createElement(d.default,{placement:"top",title:"\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u96c6\u7fa4\u5417\uff1f",onConfirm:()=>{this.deleteCluster(s.cluster_id||s.name)},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},I.default.createElement("a",null,"\u5220\u9664")),"rke"===t&&I.default.createElement("a",{onClick:()=>this.updateCluster(s.cluster_id||s.name)},"\u96c6\u7fa4\u914d\u7f6e"),"running"===s.state&&("rke"===t||"custom"===t)&&I.default.createElement("a",{onClick:()=>this.handleIsComponents(s.cluster_id)},"\u67e5\u770b\u7ec4\u4ef6"),!0===s.rainbond_init&&I.default.createElement(d.default,{placement:"top",title:"\u5378\u8f7d\u540e\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u8ba4\u8981\u5378\u8f7d\u5f53\u524d\u96c6\u7fa4\u7684\u5e73\u53f0\u670d\u52a1\u5417\uff1f",onConfirm:()=>{this.uninstallCluster(s.cluster_id||s.name)},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88"},I.default.createElement("a",null,"\u5378\u8f7d")))}});var E=this.props,b=E.data,w=E.showBuyClusterConfig,N=E.loadKubernetesCluster,B=E.loading,M=E.lastTask,O=E.showLastTaskDetail,V=this.state,U=V.clusterID,F=V.kubeConfig,q=V.showUpdateKubernetes,j=V.nodeList,W=V.rkeConfig,G=V.updateClusterID,J=V.showUpdateKubernetesTasks,X=V.updateTask,Z=V.showCreateLog,H=V.installLoading,Q=V.isComponents,z=V.isInstallRemind,Y="docker rm -vf $(docker ps -a | grep 'rke-tools\\|hyperkube\\|coreos-etcd\\|k8s' | awk '{print $1}')",$="rm -rf /var/lib/etcd /etc/kubernetes /etc/cni /opt/cni /var/lib/cni /var/run/calico /opt/rke";return I.default.createElement("div",null,I.default.createElement(i.default,{style:{marginBottom:"20px"}},"ack"===t&&I.default.createElement(h.default,{span:24,style:{padding:"16px"}},I.default.createElement(L,{className:x.default.describe},I.default.createElement("ul",null,I.default.createElement("li",null,I.default.createElement("span",null,"\u76ee\u524d\u5e73\u53f0\u652f\u6301\u963f\u91cc\u4e91\u6258\u7ba1\u96c6\u7fa4\u81ea\u52a8\u5316\u8d2d\u4e70")),I.default.createElement("li",null,I.default.createElement("span",null,"\u82e5\u6682\u65e0\u53ef\u7528\u96c6\u7fa4\uff0c\u53ef\u70b9\u51fb",I.default.createElement(o.default,{type:"link",onClick:w},"\u65b0\u8d2d\u4e70\u96c6\u7fa4"),"\u5feb\u901f\u8d2d\u4e70")),I.default.createElement("li",null,I.default.createElement("span",null,"\u82e5\u96c6\u7fa4\u521b\u5efa\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u518d\u6b21\u786e\u4fdd\u4ee5\u4e0b\u670d\u52a1\u5df2\u5f00\u901a\u6216\u6388\u6743\u5df2\u6388\u4e88\u540e\u91cd\u8bd5\uff1a",_.default.getAliyunCountDescribe().map(e=>{return I.default.createElement("a",{style:{marginRight:"8px"},href:e.href,target:"_blank",rel:"noreferrer"},e.title)}))),I.default.createElement("li",null,I.default.createElement("span",null,"\u96c6\u7fa4\u8d2d\u4e70\u6210\u529f\u540e\u5904\u4e8e\u521d\u59cb\u5316\u4e2d\u7684\u72b6\u6001\uff0c\u963f\u91cc\u4e91\u5c06\u5b8c\u6210\u96c6\u7fa4\u521b\u5efa\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b10\u5206\u949f\u5de6\u53f3\u5373\u53ef\u521d\u59cb\u5316\u5b8c\u6210"))))),I.default.createElement(h.default,{span:12,style:{textAlign:"left"}},g&&I.default.createElement("span",{style:{marginRight:"16px"}},"\u5df2\u9009\u62e9\u96c6\u7fa4: ",g,", \u8be5\u96c6\u7fa4\u7b26\u5408\u5e73\u53f0\u63a5\u5165\u89c4\u5219\uff0c\u53ef\u4ee5\u5f00\u59cb\u5e73\u53f0\u96c6\u7fa4\u521d\u59cb\u5316\u3002"),!g&&M&&M.name&&O&&I.default.createElement("span",null,"\u4e0a\u4e00\u6b21\u521b\u5efa\u4efb\u52a1: ",M.name,",",I.default.createElement(o.default,{onClick:O,type:"link"},"\u70b9\u51fb\u67e5\u770b\u521b\u5efa\u8fdb\u5ea6"))),I.default.createElement(h.default,{span:12,style:{textAlign:"right"}},I.default.createElement(o.default,{type:"primary",onClick:w},"\u65b0\u589e\u96c6\u7fa4"),I.default.createElement(o.default,{style:{marginLeft:"16px"},onClick:N},I.default.createElement(p.default,{type:"reload"})))),I.default.createElement(n.default,{scroll:{x:!(window.innerWidth>1500)&&1500},loading:B,pagination:!1,columns:v,dataSource:b}),z&&I.default.createElement(r.default,{title:"\u786e\u5b9a\u8981\u91cd\u65b0\u5b89\u88c5\u5f53\u524d\u96c6\u7fa4\u5417?",confirmLoading:H,className:K.default.TelescopicModal,width:900,visible:!0,onOk:()=>{this.handleInstallLoading(!0),this.reInstallCluster(z)},onCancel:()=>{this.handleInstallRemind(!1)}},I.default.createElement(i.default,{style:{padding:"0 16px"}},I.default.createElement("span",{style:{fontWeight:600,color:"red"}},"\u8bf7\u5728\u91cd\u65b0\u5b89\u88c5\u524d\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4ee5\u4e0b \u4e24\u6761\u547d\u4ee4\uff08\u8be5\u547d\u4ee4\u5c06\u4f1a\u6e05\u9664k8s\u7684\u76f8\u5173\u5bb9\u5668\u53ca\u914d\u7f6e\uff09",I.default.createElement("br",null),"\u6267\u884c\u7528\u6237\u9700\u8981\u5177\u6709sudo\u6743\u9650\uff1a"),this.handleCommandBox(Y),this.handleCommandBox($),this.handleCommandBox(C))),Z&&I.default.createElement(P.default,{eid:l,clusterID:U,selectProvider:t,onCancel:()=>{this.setState({clusterID:"",showCreateLog:!1})}}),F&&I.default.createElement(r.default,{visible:!0,width:1e3,maskClosable:!1,onCancel:()=>{this.setState({kubeConfig:""})},title:"KubeConfig",bodyStyle:{background:"#000"},onOk:()=>{(0,k.default)(F),f.default.success({message:"\u590d\u5236\u6210\u529f"})},okText:"\u590d\u5236"},I.default.createElement("div",{className:A.default.cmd},I.default.createElement(y.default,{value:F,options:{mode:{name:"javascript",json:!0},lineNumbers:!0,theme:"seti",lineWrapping:!0,smartIndent:!0,matchBrackets:!0,scrollbarStyle:null,showCursorWhenSelecting:!0,height:500}}))),q&&I.default.createElement(T.default,{eid:l,onOK:e=>{this.setState({clusterID:e.clusterID,showUpdateKubernetes:!1,updateTask:e,showUpdateKubernetesTasks:!0})},onCancel:()=>{this.setState({showUpdateKubernetes:!1})},clusterID:G,nodeList:j,rkeConfig:W}),J&&I.default.createElement(R.default,{eid:l,clusterID:U,task:X,selectProvider:t,onCancel:this.cancelShowUpdateKubernetes}),Q&&I.default.createElement(D.default,{eid:l,clusterID:Q,providerName:t,onCancel:()=>{this.handleIsComponents(!1)}}))}},C=v))||C);t.default=N},T8HY:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,i,d=l(a("jehZ")),o=a("MuoO"),u=s(a("q1tI")),c=l(a("AklW")),h=l(a("QDog")),p=l(a("UBd8")),f=(r=(0,o.connect)(e=>{var t=e.global;return{rainbondInfo:t.rainbondInfo,enterprise:t.enterprise}}),r((i=class extends u.PureComponent{constructor(e){super(e),this.refresh=!0,this.loadTaskEvents=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.task,s=e.selectProvider,r=e.enterprise,n=e.rainbondInfo;t({type:"cloud/loadTaskEvents",payload:{enterprise_id:a,taskID:l.taskID},callback:e=>{if(e){var t=c.default.showUpdateClusterSteps(e.events),i=t.complete,d=t.steps;i&&d.length>0&&h.default.putInstallClusterLog(r,n,{eid:a,taskID:l.taskID,status:d[d.length-1].Status,message:d[d.length-1].Message,install_step:"createK8s",provider:s}),this.setState({complete:i,loading:!1,steps:d}),!i&&this.refresh&&setTimeout(()=>this.loadTaskEvents(),4e3)}},handleError:e=>{c.default.handleCloudAPIError(e),this.setState({loading:!1})}})}),this.state={loading:!0,complete:!1,steps:[]}}componentDidMount(){this.loadTaskEvents()}componentWillUnmount(){this.refresh=!1}render(){var e=this.props.title;return u.default.createElement(p.default,(0,d.default)({title:e||"Kubernetes \u96c6\u7fa4\u914d\u7f6e\u8fdb\u5ea6\u67e5\u8be2",msg:"\u914d\u7f6e\u6d41\u7a0b\u9884\u8ba1\u8017\u65f610\u5206\u949f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u82e5\u9047\u5230\u9519\u8bef\u8bf7\u53cd\u9988\u5230\u793e\u533a"},this.state,this.props))}},n=i))||n),m=f;t.default=m},gtfS:function(e,t,a){e.exports={nameID:"nameID___3Iawl",icon:"icon___Vw_QE",iconm:"iconm___3oFjI",describe:"describe___K7ShE","editable-cell":"editable-cell___2hRGL","editable-cell-value-wrap":"editable-cell-value-wrap___3VH19","editable-row":"editable-row___2R9L_",cmd:"cmd___1wxk3",copy:"copy___3mXdm"}},s6ox:function(e,t,a){"use strict";(function(e){var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var r=l(a("wCAj"));a("fOrg");var n=l(a("+KLJ"));a("2qtc");var i=l(a("kLXV"));a("14J3");var d=l(a("BMrR"));a("jCWc");var o=l(a("kPKH"));a("Pwec");var u=l(a("CtXQ"));a("+L6B");var c=l(a("2/Rp"));a("P2fV");var h=l(a("NJEC"));a("+BJd");var p=l(a("mr32"));a("miYZ");var f=l(a("tsqr"));a("/xke");var m=l(a("TeRw"));a("5Dmo");var g=l(a("3S7+"));a("5NDa");var C=l(a("5rEg"));a("giR+");var v=l(a("fyUT"));a("OaEy");var E=l(a("2fM7")),k=l(a("p0pE"));a("y8nQ");var b=l(a("Vl3Y")),I=l(a("Y/ft"));a("Znn+");var y=l(a("ZTPi"));a("tU7J");var S,w,_,x,D=l(a("wFql")),P=l(a("ZNrE")),T=l(a("+QRC")),K=a("MuoO"),R=s(a("q1tI")),A=a("mLYH"),L=l(a("AklW")),N=l(a("gtfS")),B=D.default.Paragraph,M=y.default.TabPane,O=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/,V=/^[1-9]\d*$/,U=R.default.createContext(),F=e=>{var t=e.form,a=(e.index,(0,I.default)(e,["form","index"]));return R.default.createElement(U.Provider,{value:t},R.default.createElement("tr",a))},q=b.default.create()(F);class j extends R.default.Component{constructor(){super(...arguments),this.state={editing:!1},this.toggleEdit=(()=>{var e=!this.state.editing;this.setState({editing:e},()=>{e&&this.input.focus()})}),this.save=((e,t)=>{var a=this.props,l=a.record,s=a.handleSave;this.form.validateFields((a,r)=>{s((0,k.default)({},l,r)),a&&a[t||e&&e.currentTarget.id]||this.toggleEdit()})}),this.renderCell=(e=>{this.form=e;var t=this.props,a=t.children,l=t.dataIndex,s=t.record,r=t.title,n=t.dataSource,i=this.state.editing,d=[{required:!0,message:"".concat(r," \u662f\u5fc5\u9700\u7684")}],o="ip"===l||"internalIP"===l;o&&d.push({message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",pattern:new RegExp(O,"g")});var u="sshPort"===l;u&&d.push({message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7",min:1,max:65536,pattern:new RegExp(V,"g")});var c=s[l];return i||o&&!c?R.default.createElement(b.default.Item,{style:{margin:0}},e.getFieldDecorator(l,{rules:d,initialValue:c})("roles"===l?R.default.createElement(E.default,{getPopupContainer:e=>e.parentNode,ref:e=>this.input=e,onPressEnter:this.save,onBlur:()=>{this.save(!1,l)},allowClear:!0,mode:"multiple"},R.default.createElement(E.default.Option,{value:"controlplane"},"\u7ba1\u7406"),R.default.createElement(E.default.Option,{value:"etcd"},"ETCD"),R.default.createElement(E.default.Option,{value:"worker"},"\u8ba1\u7b97")):u?R.default.createElement(v.default,{style:{width:"100%"},ref:e=>this.input=e,onPressEnter:this.save,onBlur:this.save,min:1,max:65536}):R.default.createElement(C.default,{placeholder:"\u8bf7\u8f93\u5165".concat(r),ref:e=>{this.input=e,"ip"===l&&!c&&n&&n.length>1&&e.focus()},onPressEnter:this.save,onBlur:this.save}))):R.default.createElement(g.default,{title:"\u70b9\u51fb\u4fee\u6539"},R.default.createElement("div",{className:"editable-cell-value-wrap",style:{cursor:"pointer"},onClick:this.toggleEdit},a))})}componentWillMount(){var e=this.props.handleClustersMount;e&&e(this)}render(){var e=this.props,t=e.editable,a=e.children,l=(0,I.default)(e,["editable","children"]);return R.default.createElement("td",l,t?R.default.createElement(U.Consumer,null,this.renderCell):a)}}var W=(S=b.default.create(),w=(0,K.connect)(),S(_=w((x=class extends R.PureComponent{constructor(t){var a;super(t),a=this,this.componentDidMount=(()=>{var e=this.props.clusterID;this.loadInitNodeCmd(),e?this.setNodeList():(this.fetchRkeconfig(),this.handleAdd())}),this.setNodeList=(()=>{var e=this.props,t=e.nodeList,a=e.rkeConfig,l=e.form,s=l.setFieldsValue;if(t&&t.length>0)for(var r=0;r<t.length;r++)t[r].key=Math.random(),t[r].sshPort&&0!==t[r].sshPort||(t[r].sshPort=22),t[r].disable=!0;if(a){var n=this.decodeBase64Content(a);s({yamls:n}),this.setState({yamlVal:n})}this.setState({dataSource:t||[],count:t&&t.length||0})}),this.handleClustersMount=(e=>{this.clusters=e}),this.encodeBase64Content=(t=>{var a=e.from(t).toString("base64");return a}),this.decodeBase64Content=(t=>{var a=t.replace(/\s/g,"+");return a=e.from(a,"base64").toString(),a}),this.loadInitNodeCmd=(()=>{var e=this.props.dispatch;e({type:"cloud/getInitNodeCmd",callback:e=>{var t=e&&e.response_data||{},a=e&&e.response_data&&e.data||{},l=e&&e.cmd||a.cmd||t.cmd;this.setState({initNodeCmd:l})}})}),this.fetchRkeconfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,l=a.props,s=l.form,r=l.eid,n=a.state.activeKey,i=s.setFieldsValue,d=Object.assign({},e,{enterprise_id:r});(0,A.rkeconfig)(d).then(e=>{if(e&&200===e.status_code&&e.response_data){var l=e.response_data||{},s=l.encodeRKEConfig,r=l.nodes,d=a.decodeBase64Content(s);i({yamls:d});var o="",u="";r&&(r&&r.length&&r.map(e=>{e.key=Math.random(),t&&(O.test(e.ip||"")?O.test(e.internalIP||"")?V.test(e.sshPort||"")?e.sshPort>65536?(u="sshPort",o="\u7aef\u53e3\u53f7\u6700\u592765536"):e.roles||(u="roles",o="\u8282\u70b9\u7c7b\u578b\u662f\u5fc5\u987b\u7684"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7",u="sshPort"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",u="internalIP"):(o="\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740",u="ip"))}),o&&a.handleCheck(!1),a.setState({helpType:u,helpError:o,dataSource:r})),a.setState({yamlVal:d}),"1"===n&&t&&o&&m.default.warning({message:o}),t&&!o&&a.handleStartCheck(t)}}).catch(e=>{if(e){var l=e.data?e.data.code:e.code;if(!l)return t&&a.setState({activeKey:"2"}),a.setState({isCheck:!1,helpType:"RKE",helpError:"RKE\u96c6\u7fa4\u914d\u7f6e\u4e0d\u5408\u683c\u3001\u8bf7\u91cd\u65b0\u914d\u7f6e"}),null}a.handleCheck(!1),L.default.handleCloudAPIError(e)})},this.updateCluster=(()=>{var e=this.props,t=e.dispatch,a=e.eid,l=e.clusterID,s=e.form,r=this.state,n=r.dataSource,i=r.yamlVal;n&&0===n.length&&f.default.warning("\u8bf7\u5b9a\u4e49\u96c6\u7fa4\u8282\u70b9"),s.validateFields((e,s)=>{e||(this.setState({loading:!0}),t({type:"cloud/updateKubernetesCluster",payload:{enterprise_id:a,clusterID:l,provider:"rke",encodedRKEConfig:this.encodeBase64Content(s.yamls||i)},callback:e=>{this.handleOk(e&&e.response_data)},handleError:e=>{this.handleError(e)}}))})}),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.eid,s=e.clusterID;if(s)return this.updateCluster(),null;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,k.default)({enterprise_id:l,provider_name:"rke",encodedRKEConfig:this.encodeBase64Content(t.yamls)},t),callback:e=>{this.handleOk(e)},handleError:e=>{this.handleError(e)}}))})}),this.handleOk=(e=>{var t=this.props.onOK;e&&t&&t(e||{})}),this.handleError=(e=>{var t=this.props.onOK;e&&e.data&&7005===e.data.code&&t?t(e.data.data):(L.default.handleCloudAPIError(e),this.setState({loading:!1}))}),this.handleDelete=(e=>{var t=[...this.state.dataSource];this.setState({dataSource:t.filter(t=>t.key!==e)})}),this.handleEnvGroup=((e,t)=>{return this.clusters&&this.clusters.form?this.clusters.form.validateFields({force:!0},a=>{if(!a&&e)return e();t()}):t&&t(),!1}),this.handleAdd=(()=>{var e=this.state,t=e.count,a=e.dataSource,l={key:Math.random(),ip:"",internalIP:"",sshPort:22,roles:["etcd","controlplane","worker"]};t>2&&(l.roles=["worker"]);var s=()=>{this.setState({dataSource:[...a,l],count:t+1})};this.handleEnvGroup(s,s)}),this.handleSave=(e=>{var t=[...this.state.dataSource],a=t.findIndex(t=>e.key===t.key),l=t[a];t.splice(a,1,(0,k.default)({},l,e)),this.setState({dataSource:t})}),this.beforeUpload=((e,t)=>{var a=e.name.split("."),l=a.length,s="yaml"===a[l-1]||"yml"===a[l-1];return!!s||(t&&m.default.warning({message:"\u8bf7\u4e0a\u4f20\u4ee5.yaml\u3001.yml\u7ed3\u5c3e\u7684 Region Config \u6587\u4ef6"}),!1)}),this.nodeRole=(e=>{switch(e){case"controlplane":return"\u7ba1\u7406";case"worker":return"\u8ba1\u7b97";case"etcd":return"ETCD";default:return"\u672a\u77e5"}}),this.handleStartCheck=(e=>{var t=!1,a=this.state.activeKey;"1"===a?this.handleEnvGroup(()=>{t=!0},()=>{this.handleActiveKey("1"),this.handleCheck(!1)}):t=!0,this.props.form.validateFields(e=>{t&&e&&e.yamls&&(this.handleActiveKey("2"),t=!1),e&&e.yamls&&this.setState({isCheck:!1,helpType:"RKE",helpError:"\u586b\u5199RKE\u96c6\u7fa4\u914d\u7f6e"}),!e&&t&&this.handleCheck(t)}),t&&e&&this.createCluster()}),this.handleCheck=(e=>{this.setState({isCheck:e,forbiddenConfig:!0,countNum:15,countConfig:!0,countContent:null},()=>{var t=this.props.guideStep;e&&7!==t&&this.handleCountDown(),!e&&clearInterval(this.timerId)})}),this.handleActiveKey=(e=>{this.setState({activeKey:e})}),this.handleTabs=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=a.state,s=l.dataSource,r=l.yamlVal,n=a.props.form,i=n.getFieldValue,d={},o=i("yamls")||r;(o||s&&s.length>0)&&("2"===e?(d.nodes=s,d.encodedRKEConfig=o&&a.encodeBase64Content(o)):d.encodedRKEConfig=o&&a.encodeBase64Content(o)),a.fetchRkeconfig(d,t),t||a.handleActiveKey("".concat(e))},this.handleCountDown=(()=>{var e=this.state.countNum;this.setState({countConfig:!1,countContent:"".concat(e,"s")}),this.timerId=setInterval(()=>{if(this.setState({countNum:e--,countContent:"".concat(e,"s")}),e<0)return clearInterval(this.timerId),this.setState(()=>({forbiddenConfig:!1,countConfig:!0})),null},1e3)}),this.state={loading:!1,dataSource:[],count:0,isCheck:!1,yamlVal:"",initNodeCmd:"",activeKey:"1",helpError:"",helpType:"",forbiddenConfig:!0,countConfig:!0,countNum:15,countContent:null},this.clusters=[]}render(){var e=this.props,t=e.onCancel,a=e.form,l=e.clusterID,s=e.guideStep,f=e.handleNewbieGuiding,g=a.getFieldDecorator,v=a.setFieldsValue,E=this.state,I=E.helpType,S=E.helpError,w=E.loading,_=E.dataSource,x=E.initNodeCmd,D=E.isCheck,K=E.activeKey,A=E.yamlVal,L=E.forbiddenConfig,O=E.countContent,V=E.countConfig,U={labelCol:{xs:{span:3}},wrapperCol:{xs:{span:24}}},F={body:{row:q,cell:j}},W=[{title:"IP \u5730\u5740",dataIndex:"ip",width:150,editable:!0},{title:"\u5185\u7f51 IP \u5730\u5740",dataIndex:"internalIP",width:170,editable:!0},{title:"SSH \u7aef\u53e3",dataIndex:"sshPort",width:140,editable:!0},{title:"\u8282\u70b9\u7c7b\u578b",dataIndex:"roles",width:160,editable:!0,render:e=>e&&e.length>0&&e.map(e=>R.default.createElement(p.default,{color:"blue"},this.nodeRole(e)))},{title:"\u64cd\u4f5c",dataIndex:"name",width:80,align:"center",render:(e,t)=>{return _&&_.length>1?R.default.createElement(h.default,{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417?",onConfirm:()=>this.handleDelete(t.key)},R.default.createElement("a",null,"\u5220\u9664")):"-"}}],G=W.map(e=>{return e.editable?(0,k.default)({},e,{onCell:t=>{return{record:t,helpType:I,helpError:S,index:t.key,editable:e.editable,dataIndex:e.dataIndex,title:e.title,dataSource:_,handleClustersMount:this.handleClustersMount,handleSave:this.handleSave}}}):e}),J={position:"relative",zIndex:1e3,background:"#fff"};return R.default.createElement(i.default,{visible:!0,title:l?"\u914d\u7f6e\u96c6\u7fa4":"\u57fa\u4e8e\u4e3b\u673a\u5b89\u88c5\u96c6\u7fa4",className:N.default.TelescopicModal,width:900,destroyOnClose:!0,footer:R.default.createElement(R.Fragment,null,R.default.createElement(c.default,{type:"primary",onClick:()=>{this.handleStartCheck()},loading:w},l?"\u66f4\u65b0\u96c6\u7fa4":"\u5f00\u59cb\u5b89\u88c5"),s&&6===s&&f&&R.default.createElement(R.Fragment,null,f({tit:"6.\u5f00\u59cb\u5b89\u88c5",send:!0,configName:"kclustersAttention",desc:"\u786e\u8ba4RKE\u96c6\u7fa4\u914d\u7f6e\u4fe1\u606f\u586b\u5199\u6b63\u786e\u5e76\u7acb\u5373\u5f00\u59cb\u5b89\u88c5\u3002",nextStep:7,btnText:"\u5b89\u88c5",conPosition:{right:"110px",bottom:0},svgPosition:{right:"50px",marginTop:"-11px"},handleClick:()=>{this.handleStartCheck()}}))),confirmLoading:w,onCancel:t,maskClosable:!1},D&&R.default.createElement(i.default,{title:"\u786e\u5b9a\u5df2\u5b8c\u6210\u6240\u6709\u8282\u70b9\u7684\u521d\u59cb\u5316\u5e76\u5f00\u59cb\n            ".concat(l?"\u914d\u7f6e":"\u5b89\u88c5","\n           \u96c6\u7fa4\u5417?"),confirmLoading:w,className:N.default.TelescopicModal,width:900,visible:!0,footer:[R.default.createElement(c.default,{key:"back",onClick:()=>{this.handleCheck(!1)}},"\u53d6\u6d88"),R.default.createElement(c.default,{key:"link",type:"primary",onClick:()=>{this.setState({loading:!0},()=>{this.handleTabs("1"===K?"2":"1",!0)})},disabled:L},!V&&"\u6211\u5df2\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4,\u5f00\u59cb\u5b89\u88c5(".concat(O,")")||" \u6211\u5df2\u5728\u6240\u6709\u8282\u70b9\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4,\u5f00\u59cb\u5b89\u88c5")]},R.default.createElement(d.default,{style:{padding:"0 16px"}},R.default.createElement("span",{style:{fontWeight:600,color:"red"}},"\u8bf7\u5728\u5f00\u59cb",l?"\u914d\u7f6e\u524d\u5728\u65b0\u52a0":"\u5b89\u88c5\u524d\u6240\u6709","\u8282\u70b9\u5148\u6267\u884c\u4ee5\u4e0b\u521d\u59cb\u5316\u547d\u4ee4\uff08\u6267\u884c\u7528\u6237\u9700\u8981\u5177\u6709sudo\u6743\u9650\uff09\uff1a"),R.default.createElement(o.default,{span:24,style:{marginTop:"16px"}},R.default.createElement("span",{className:N.default.cmd},R.default.createElement(u.default,{className:N.default.copy,type:"copy",onClick:()=>{(0,T.default)(x),m.default.success({message:"\u590d\u5236\u6210\u529f"})}}),s&&7===s&&f({tit:"\u8282\u70b9\u7684\u521d\u59cb\u5316",send:!0,configName:"nodeInitialization",handleClick:()=>{(0,T.default)(x),this.handleCountDown()},handleClosed:()=>{this.handleCountDown()},desc:"\u8bf7\u590d\u5236\u4e0a\u8ff0\u547d\u4ee4\u5b8c\u6210\u6240\u6709\u8282\u70b9\u7684\u521d\u59cb\u5316,\u70b9\u51fb\u786e\u5b9a\u3001\u8bf7\u7b49\u5f85 RKE \u96c6\u7fa4\u5b89\u88c5\u5b8c\u6210\u3002",prevStep:!1,btnText:"\u590d\u5236\u547d\u4ee4",nextStep:8,conPosition:{left:"0",bottom:"-156px"},svgPosition:{right:"-20px",marginTop:"-11px"}}),x)))),l&&R.default.createElement(n.default,{type:"warning",message:"\u96c6\u7fa4\u8282\u70b9\u914d\u7f6e\u7279\u522b\u662f\u7ba1\u7406\u8282\u70b9\u3001ETCD\u8282\u70b9\u914d\u7f6e\u5177\u6709\u4e00\u5b9a\u98ce\u9669\uff0c\u8bf7\u9009\u62e9\u5408\u9002\u7684\u65f6\u95f4\u8fdb\u884c"}),R.default.createElement(b.default,null,R.default.createElement(d.default,null,R.default.createElement(o.default,{span:24,style:{padding:"16px"}},R.default.createElement(B,{className:N.default.describe,style:s&&3===s&&J||{}},R.default.createElement("ul",null,R.default.createElement("li",null,R.default.createElement("span",null,"\u57fa\u4e8e\u63d0\u4f9b\u7684\u4e3b\u673a\u5b89\u88c5\u96c6\u7fa4\u3002")),R.default.createElement("li",null,R.default.createElement("span",null,"\u8bf7\u786e\u4fdd\u63d0\u4f9b\u7684\u4e3b\u673a",!l&&"\u7684 IP \u5730\u5740\u7684",R.default.createElement("b",null,"SSH \u7aef\u53e3"),"\u548c",R.default.createElement("b",null,"6443\u7aef\u53e3"),"\u90fd\u53ef\u4ee5\u88ab\u5f53\u524d\u7f51\u7edc\u76f4\u63a5\u8bbf\u95ee\u3002")),R.default.createElement("li",null,R.default.createElement("span",null,"\u8282\u70b9\u521d\u59cb\u5316\u811a\u672c\u4f1a\u8fdb\u884c",R.default.createElement("b",null,"\u7cfb\u7edf\u68c0\u67e5"),"\u3001",R.default.createElement("b",null,"\u914d\u7f6eSSH\u514d\u5bc6"),"\u3001",R.default.createElement("b",null,"Docker\u5b89\u88c5"),"\u4e09\u9879\u52a8\u4f5c\u3002")),R.default.createElement("li",null,R.default.createElement("span",null,"\u5982\u679c\u4f60\u7684\u4e3b\u673a\u5df2\u7ecf\u5b89\u88c5 Docker\uff0c\u8bf7\u786e\u4fdd\u4e0d\u80fd\u5927\u4e8e",R.default.createElement("b",null,"19.03.x")," \u548c\u4f4e\u4e8e",R.default.createElement("b",null,"1.13.x")," \u7248\u672c\u3002")))),s&&3===s&&f&&R.default.createElement(R.Fragment,null,f({tit:"\u6ce8\u610f\u4e8b\u9879",send:!1,configName:"kclustersAttention",showSvg:!1,showArrow:!0,desc:"\u6ce8\u610f\u67e5\u770b\u4e3b\u673a\u9700\u8981\u6ee1\u8db3\u7684\u524d\u63d0\u6761\u4ef6\u548c\u5b89\u88c5\u8bf4\u660e\u3002",nextStep:4,conPosition:{right:"15px",bottom:"-134px"}})))),!l&&R.default.createElement(d.default,null,R.default.createElement(o.default,{span:12,style:{padding:s&&4===s?"":"0 16px"}},R.default.createElement(b.default.Item,{label:"\u96c6\u7fa4\u540d\u79f0",style:s&&4===s&&Object.assign({},{padding:"0 16px"},J)||{}},g("name",{initialValue:"",rules:[{required:!0,message:"\u96c6\u7fa4\u540d\u79f0\u5fc5\u586b"},{pattern:/^[a-z0-9A-Z-]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e2d\u5212\u7ebf\u7ec4\u5408"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(R.default.createElement(C.default,{placeholder:"\u96c6\u7fa4\u540d\u79f0,\u8bf7\u786e\u4fdd\u5176\u4fdd\u6301\u552f\u4e00"}))),s&&4===s&&f&&R.default.createElement(R.Fragment,null,f({tit:"\u586b\u5199\u96c6\u7fa4\u540d\u79f0",showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:"\u586b\u5199RKE\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u521d\u6b21\u4f53\u9a8c\u5355\u8282\u70b9\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5b89\u88c5\u54e6\u3002",nextStep:5,conPosition:{marginTop:"-22px"}})))),R.default.createElement(y.default,{activeKey:K,onChange:e=>{this.handleTabs(e)}},R.default.createElement(M,{tab:"\u53ef\u89c6\u5316\u914d\u7f6e",key:"1"},R.default.createElement("div",null,R.default.createElement(d.default,null,R.default.createElement(o.default,{span:24,style:{padding:"0 16px"}},R.default.createElement(b.default.Item,{label:"\u8282\u70b9\u5217\u8868",style:s&&5===s&&Object.assign({},{padding:"0 16px"},J)||{}},g("nodeLists",{initialValue:""})(R.default.createElement(r.default,{dataSource:_,columns:G,components:F,bordered:!0,rowClassName:()=>"editable-row",pagination:!1}))),R.default.createElement(c.default,{onClick:this.handleAdd,style:{marginBottom:16}},"\u589e\u52a0\u8282\u70b9"))))),R.default.createElement(M,{tab:"\u81ea\u5b9a\u4e49\u914d\u7f6e",key:"2"})),s&&5===s&&f&&R.default.createElement(R.Fragment,null,f({tit:"\u586b\u5199\u8282\u70b9",showSvg:!1,showArrow:!0,send:!1,configName:"kclustersAttention",desc:"\u586b\u5199RKE\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u521d\u6b21\u4f53\u9a8c\u5355\u8282\u70b9\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5b89\u88c5\u54e6\u3002",nextStep:6,conPosition:{bottom:"-14px",left:"39px"}})),R.default.createElement("div",{style:{display:"1"===K?"none":"block"}},(l&&"2"===K||!l)&&R.default.createElement(P.default,{help:S,data:A||"",label:"RKE\u96c6\u7fa4\u914d\u7f6e",bg:"151718",width:"100%",marginTop:120,setFieldsValue:v,formItemLayout:U,Form:b.default,getFieldDecorator:g,beforeUpload:this.beforeUpload,mode:"yaml",name:"yamls",message:"\u586b\u5199RKE\u96c6\u7fa4\u914d\u7f6e"}))))}},_=x))||_)||_);t.default=W}).call(this,a("tjlA").Buffer)},sQyZ:function(e,t,a){"use strict";var l=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("2qtc");var r=l(a("kLXV"));a("14J3");var n=l(a("BMrR"));a("giR+");var i=l(a("fyUT"));a("5NDa");var d=l(a("5rEg"));a("jCWc");var o=l(a("kPKH")),u=l(a("p0pE"));a("y8nQ");var c=l(a("Vl3Y"));a("OaEy");var h=l(a("2fM7"));a("tU7J");var p,f,m,g,C=l(a("wFql")),v=a("MuoO"),E=s(a("q1tI")),k=l(a("AklW")),b=l(a("dBUJ")),I=C.default.Paragraph,y=h.default.Option,S=(p=c.default.create(),f=(0,v.connect)(),p(m=f((g=class extends E.PureComponent{constructor(e){super(e),this.createCluster=(()=>{var e=this.props,t=e.form,a=e.dispatch,l=e.eid,s=e.onOK;t.validateFields((e,t)=>{e||(this.setState({loading:!0}),a({type:"cloud/createKubernetesCluster",payload:(0,u.default)({enterprise_id:l,provider_name:"ack"},t),callback:e=>{e&&s&&s(e)},handleError:e=>{e&&e.data&&7005===e.data.code?s(e.data.data):(k.default.handleCloudAPIError(e),this.setState({loading:!1}))}}))})}),this.changeWorkerType=(e=>{""===e&&this.setState({customResource:!0})}),this.state={customResource:!1,loading:!1}}render(){var e=this.props.onCancel,t=this.props.form.getFieldDecorator,a=this.state,l=a.customResource,s=a.loading;return E.default.createElement(r.default,{visible:!0,title:"\u8d2d\u4e70\u963f\u91cc\u4e91 ACK \u96c6\u7fa4",onOk:this.createCluster,width:800,confirmLoading:s,onCancel:e},E.default.createElement(c.default,null,E.default.createElement(n.default,null,E.default.createElement(o.default,{span:24,style:{padding:"16px"}},E.default.createElement(I,{className:b.default.describe},E.default.createElement("ul",null,E.default.createElement("li",null,E.default.createElement("span",null,"\u59d4\u6258\u8d2d\u4e70\u65f6\u5c06\u8d2d\u4e70\u4ee5\u4e0b\u8d44\u6e90\uff1a\u6807\u51c6\u6258\u7ba1\u96c6\u7fa4(1\u4e2a)\u3001VPC(1\u4e2a)")),E.default.createElement("li",null,E.default.createElement("span",null,"\u65b0\u8d2d\u96c6\u7fa4\u90fd\u5c06\u91c7\u7528\u6309\u9700\u540e\u4ed8\u8d39\u6a21\u5f0f\uff0c\u56e0\u6b64\u8bf7\u786e\u4fdd\u4f60\u7684\u963f\u91cc\u4e91\u8d26\u53f7\u80fd\u591f\u8fdb\u884c\u6309\u9700\u8d2d\u4e70\u8d44\u6e90")),E.default.createElement("li",null,E.default.createElement("span",null,"\u8d2d\u4e70\u7684Kubernetes\u5c06\u5f00\u542fEIP,\u901a\u8fc7\u516c\u7f51\u8bbf\u95eeKubeApiserver, \u96c6\u7fa4\u5bf9\u63a5\u5b8c\u6bd5\u540e\u53ef\u4ee5\u624b\u5de5\u5173\u95ed\u96c6\u7fa4\u7684\u5916\u7f51\u8bbf\u95eeEIP")),E.default.createElement("li",null,E.default.createElement("span",null,"\u9ed8\u8ba4\u91c7\u7528\u63a8\u8350\u7684\u8d44\u6e90\u7c7b\u578b\u914d\u7f6e\uff0c\u82e5\u4e0d\u7b26\u5408\u4f60\u7684\u9884\u671f\uff0c\u4f60\u53ef\u76f4\u63a5\u524d\u5f80\u963f\u91cc\u4e91\u63a7\u5236\u53f0\u81ea\u5b9a\u4e49\u8d2d\u4e70\u6258\u7ba1\u96c6\u7fa4\uff0c\u7136\u540e\u8fd4\u56de\u5230\u96c6\u7fa4\u5217\u8868\u9009\u62e9\u540e\u5f00\u59cb\u521d\u59cb\u5316")),E.default.createElement("li",null,E.default.createElement("span",null,"\u8d2d\u4e70\u96c6\u7fa4\u7684\u6210\u529f\u6027\u548c\u8017\u65f6\u53d6\u51b3\u4e8e\u963f\u91cc\u4e91\u7684\u5b9e\u9645\u72b6\u6001\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u9884\u8ba110\u5206\u949f\u53ef\u4ee5\u5b8c\u6210\u96c6\u7fa4\u8d2d\u4e70")),l&&E.default.createElement("li",null,E.default.createElement("span",null,"\u81ea\u5b9a\u4e49\u8d44\u6e90\u89c4\u683c\u65f6\u8bf7\u53c2\u8003"," ",E.default.createElement("a",{target:"_blank",rel:"noreferrer",href:"https://ecs-buy.aliyun.com/instanceTypes"},"\u963f\u91cc\u4e91ECS\u89c4\u683c\u8bf4\u660e\u6587\u6863")," ","\u83b7\u53d6\u8d44\u6e90\u89c4\u683cID"))))),E.default.createElement(o.default,{span:12,style:{padding:"0 16px"}},E.default.createElement(c.default.Item,{label:"\u533a\u57df"},t("region",{initialValue:"cn-hangzhou",rules:[{required:!0,message:"\u96c6\u7fa4\u521b\u5efa\u533a\u57df\u5fc5\u9009"}]})(E.default.createElement(h.default,{placeholder:"\u533a\u57df",getPopupContainer:e=>e.parentNode},k.default.getAllAliyunRegions().map(e=>{return E.default.createElement(y,{key:e.RegionId,value:e.RegionId},e.LocalName)}))))),E.default.createElement(o.default,{span:12,style:{padding:"0 16px"}},E.default.createElement(c.default.Item,{label:"\u540d\u79f0"},t("name",{initialValue:"",rules:[{required:!0,message:"\u96c6\u7fa4\u540d\u79f0\u5fc5\u586b"},{pattern:/^[a-z0-9A-Z-]+$/,message:"\u53ea\u652f\u6301\u5b57\u6bcd\u3001\u6570\u5b57\u548c\u4e2d\u5212\u7ebf\u7ec4\u5408"},{max:24,message:"\u6700\u5927\u957f\u5ea624\u4f4d"}]})(E.default.createElement(d.default,{placeholder:"\u96c6\u7fa4\u540d\u79f0,\u8bf7\u786e\u4fdd\u5176\u4fdd\u6301\u552f\u4e00"})))),E.default.createElement(o.default,{span:12,style:{padding:"0 16px"}},!l&&E.default.createElement(c.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"ecs.g5.xlarge",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"}]})(E.default.createElement(h.default,{getPopupContainer:e=>e.parentNode,onChange:this.changeWorkerType,placeholder:"\u96c6\u7fa4\u540d\u79f0"},E.default.createElement(y,{value:"ecs.g5.large"},"\u6700\u5c0f\u914d\u7f6e\uff08\u5355\u8282\u70b92Core/8GB RAM, \u6309\u9700\u9884\u8ba12\u5143/\u5c0f\u65f6\uff09"),E.default.createElement(y,{value:"ecs.g5.xlarge"},"\u666e\u901a\u914d\u7f6e\uff08\u5355\u8282\u70b94Core/16GB RAM, \u6309\u9700\u9884\u8ba14\u5143/\u5c0f\u65f6\uff09"),E.default.createElement(y,{value:"ecs.g5.2xlarge"},"\u751f\u4ea7\u914d\u7f6e\uff08\u5355\u8282\u70b98Core/32GB RAM, \u6309\u9700\u9884\u8ba18\u5143/\u5c0f\u65f6\uff09"),E.default.createElement(y,{value:""},"\u81ea\u5b9a\u4e49")))),l&&E.default.createElement(c.default.Item,{label:"\u8d44\u6e90\u914d\u7f6e"},t("resourceType",{initialValue:"",rules:[{required:!0,message:"\u8d44\u6e90\u914d\u7f6e\u5fc5\u987b\u6307\u5b9a"},{pattern:/^[a-z0-9A-Z.]+$/,message:"\u8bf7\u786e\u5b9a\u8d44\u6e90\u914d\u7f6e\u89c4\u683c\u662f\u5426\u5408\u6cd5"}]})(E.default.createElement(d.default,{placeholder:"\u963f\u91cc\u4e91ECS\u89c4\u683c"})))),E.default.createElement(o.default,{span:12,style:{padding:"0 16px"}},E.default.createElement(c.default.Item,{label:"\u8282\u70b9\u6570\u91cf"},t("workerNum",{initialValue:2,rules:[{required:!0,message:"\u8282\u70b9\u6570\u91cf\u5fc5\u987b\u6307\u5b9a"}]})(E.default.createElement(i.default,{style:{width:"100%"},min:2,placeholder:"\u8282\u70b9\u6570\u91cf"})))))))}},m=g))||m)||m);t.default=S}}]);