(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[34],{"+EK0":function(e,t,a){"use strict";(function(e){var o=a("g09b"),s=a("tAuX");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=o(a("bx4M"));a("Pwec");var n=o(a("CtXQ"));a("+L6B");var r=o(a("2/Rp")),l=o(a("p0pE"));a("2qtc");var c=o(a("kLXV"));a("y8nQ");var d,u,m,p,h,f,g=o(a("Vl3Y")),C=a("MuoO"),k=a("7DNP"),v=s(a("q1tI")),y=a("LLXN"),_=o(a("9tdr")),b=o(a("q76B")),E=o(a("0zE7")),M=o(a("ALo4")),S=o(a("XZXw")),I=o(a("9Qkj")),N=a("4/zt"),T=o(a("QDog")),D=o(a("mWxT")),w=o(a("rIpq")),A=o(a("+iC2"));a("ztCB"),a("p77/"),a("ToSm");var P=(d=g.default.create(),d((m=class extends v.PureComponent{constructor(e){super(e),this.handleSubmit=(e=>{e.preventDefault();var t=this.props,a=t.form,o=t.onSubmit;a.validateFields((e,t)=>{!e&&o&&o(t)})}),this.state={compose:""}}componentDidMount(){(0,N.getComposeByComposeId)({team_name:T.default.getCurrTeamName(),compose_id:this.props.compose_id}).then(e=>{e&&e.bean&&this.setState({compose:e.bean.compose_content})})}render(){var e=this.props.form,t=e.getFieldDecorator,a=(e.getFieldValue,this.props.data,{lineNumbers:!0,theme:"monokai",mode:"yaml"});return this.state.compose?v.default.createElement(c.default,{visible:!0,title:(0,y.formatMessage)({id:"confirmModal.compose.update.title"}),onOk:this.handleSubmit,onCancel:this.props.onCancel},v.default.createElement(g.default,{onSubmit:this.handleSubmit,layout:"horizontal",hideRequiredMark:!0},v.default.createElement(g.default.Item,null,t("yaml_content",{initialValue:this.state.compose||"",rules:[{required:!0,message:(0,y.formatMessage)({id:"placeholder.input_content"})}]})(v.default.createElement(_.default,{options:a,placeholder:""}))))):null}},u=m))||u),R=(p=(0,C.connect)(t=>{var a=t.user;return{currUser:a.currentUser,rainbondInfo:e.rainbondInfo}},null,null,{withRef:!0}),p((f=class extends v.PureComponent{constructor(e){super(e),this.getCheckuuid=(()=>{this.getAppAlias();var e=T.default.getCurrTeamName(),t=this.getParams();(0,N.getComposeCheckuuid)((0,l.default)({team_name:e},t)).then(e=>{e&&(e.bean.check_uuid?(this.state.check_uuid=e.bean.check_uuid,this.loopStatus()):this.startCheck())})}),this.startCheck=(e=>{var t=this.getAppAlias(),a=T.default.getCurrTeamName(),o=this.getParams();(0,N.getCreateComposeCheckInfo)((0,l.default)({team_name:a,app_alias:t},o),e=>{404===e.status&&this.props.dispatch(k.routerRedux.replace("/team/".concat(T.default.getCurrTeamName(),"/region/").concat(T.default.getCurrRegionName(),"/exception/404")))}).then(t=>{t&&(this.state.check_uuid=t.bean.check_uuid,this.setState({eventId:t.bean.check_event_id,appDetail:t.bean}),!1!==e&&this.loopStatus())})}),this.loopStatus=(()=>{if(this.mount){var e=this.getParams(),t=T.default.getCurrTeamName();(0,N.getCreateComposeCheckResult)((0,l.default)({team_name:t,check_uuid:this.state.check_uuid},e)).then(e=>{if(e&&this.mount){var t=e.bean.check_status,a=e.bean.error_infos||[],o=e.bean.service_info||[];this.setState({status:t,errorInfo:a,serviceInfo:o})}}).finally(()=>{this.mount&&"checking"===this.state.status&&setTimeout(()=>{this.loopStatus()},5e3)})}}),this.handleCreate=(()=>{this.getAppAlias()}),this.showModifyCompose=(()=>{this.setState({modifyCompose:!0})}),this.showDelete=(()=>{this.setState({showDelete:!0})}),this.handleSetting=(()=>{var e=this.getParams();this.props.dispatch(k.routerRedux.push("/team/".concat(T.default.getCurrTeamName(),"/region/").concat(T.default.getCurrRegionName(),"/create/create-compose-setting/").concat(e.group_id,"/").concat(e.compose_id)))}),this.handleBuild=(()=>{var e=T.default.getCurrTeamName(),t=(this.state.appDetail,this.getParams());this.props.dispatch({type:"application/buildCompose",payload:(0,l.default)({team_name:T.default.getCurrTeamName()},t),callback:()=>{this.props.dispatch({type:"global/fetchGroups",payload:{team_name:e}}),this.props.dispatch(k.routerRedux.replace("/team/".concat(T.default.getCurrTeamName(),"/region/").concat(T.default.getCurrRegionName(),"/apps/").concat(t.group_id,"/overview")))}})}),this.handleDelete=(()=>{var e=this.getParams();this.props.dispatch({type:"application/deleteCompose",payload:(0,l.default)({team_name:T.default.getCurrTeamName(),app_name:this.props.location&&this.props.location.query&&this.props.location.query.app_name},e),callback:()=>{this.props.dispatch({type:"global/fetchGroups",payload:{team_name:T.default.getCurrTeamName()}}),this.props.dispatch(k.routerRedux.replace("/team/".concat(T.default.getCurrTeamName(),"/region/").concat(T.default.getCurrRegionName(),"/index")))}})}),this.unbindEvent=(()=>{document.removeEventListener("click",this.handleClick)}),this.bindEvent=(()=>{document.addEventListener("click",this.handleClick,!1)}),this.recheck=(()=>{this.setState({status:"checking"},()=>{this.startCheck()})}),this.cancelModifyCompose=(()=>{this.setState({modifyCompose:!1})}),this.handleClick=(e=>{var t=e.target;while(t){if(t===document.body)return;var a=t.getAttribute("action_type");if("modify_compose"===a)return void this.setState({modifyCompose:!0});t=t.parentNode}}),this.handleModifyCompose=(e=>{var t=this.getParams();this.props.dispatch({type:"application/editAppCreateCompose",payload:{team_name:T.default.getCurrTeamName(),group_id:t.group_id,compose_content:e.yaml_content},callback:e=>{this.cancelModifyCompose()}})}),this.renderChecking=(()=>{var e=v.default.createElement(r.default,{onClick:this.showDelete,type:"default"},(0,y.formatMessage)({id:"button.abandon_create"})),t=v.default.createElement("div",null,this.state.eventId&&v.default.createElement(E.default,{opened:!0,socketUrl:this.socketUrl,eventId:this.state.eventId}));return v.default.createElement(M.default,{type:"ing",title:(0,y.formatMessage)({id:"confirmModal.component.check.title.loading"}),extra:t,description:(0,y.formatMessage)({id:"confirmModal.component.check.appShare.desc"}),actions:e,style:{marginTop:48,marginBottom:16}})}),this.renderSuccess=(()=>{var e=this.props.rainbondInfo,t=this.state.serviceInfo||[],a=v.default.createElement("div",null,t.map(e=>{return v.default.createElement("div",{style:{marginBottom:16}},v.default.createElement("p",null,(0,y.formatMessage)({id:"componentCheck.modify_image_name.label.component_cname"}),e.service_cname),(e.service_info||[]).map(e=>{return v.default.createElement("div",{style:{marginBottom:16}},this.renderSuccessInfo(e))}))})),o=[v.default.createElement(r.default,{onClick:this.handleBuild,type:"primary"}," ",(0,y.formatMessage)({id:"button.build_component"})," "),v.default.createElement(r.default,{type:"default",onClick:this.handleSetting},(0,y.formatMessage)({id:"button.advanced_setup"})),v.default.createElement(r.default,{onClick:this.showDelete,type:"default"}," ",(0,y.formatMessage)({id:"button.abandon_create"})," ")],s=D.default.documentPlatform_url(e);return v.default.createElement(M.default,{type:"success",title:(0,y.formatMessage)({id:"confirmModal.component.check.title.success.component_check"}),description:v.default.createElement("div",null,v.default.createElement("div",null,(0,y.formatMessage)({id:"componentCheck.tooltip.title.p3"})),(0,y.formatMessage)({id:"componentCheck.tooltip.title.p4"}),(0,y.formatMessage)({id:"componentCheck.tooltip.title.p9"}),s&&v.default.createElement("span",null,v.default.createElement("a",{href:"".concat(s,"docs/use-manual/component-create/language-support/"),target:"_blank"},(0,y.formatMessage)({id:"componentCheck.tooltip.title.p8"})))||""," ",(0,y.formatMessage)({id:"componentCheck.tooltip.title.p6"})),extra:a,actions:o,style:{marginTop:48,marginBottom:16}})}),this.renderSuccessInfo=(e=>{if(e.value)return"string"===typeof e.value?v.default.createElement("div",{style:{paddingLeft:32}},v.default.createElement("span",{style:{verticalAlign:"top",display:"inline-block",fontWeight:"bold"}},e.key,"\uff1a"),e.value):v.default.createElement("div",{style:{paddingLeft:32}},v.default.createElement("span",{style:{verticalAlign:"top",display:"inline-block",fontWeight:"bold"}},e.key,"\uff1a"),v.default.createElement("div",{style:{display:"inline-block"}},(e.value||[]).map(e=>{return v.default.createElement("p",{style:{marginBottom:0}},e)})))}),this.renderError=(()=>{var e=this.state.errorInfo,t=v.default.createElement("div",null,e.map(e=>{return v.default.createElement("div",{style:{marginBottom:16}},v.default.createElement(n.default,{style:{color:"#f5222d",marginRight:8},type:"close-circle-o"}),v.default.createElement("span",{dangerouslySetInnerHTML:{__html:"<span>".concat(e.error_info||""," ").concat(e.solve_advice||"","</span>")}}))})),a=[v.default.createElement(r.default,{onClick:this.showDelete,type:"default"},(0,y.formatMessage)({id:"button.abandon_create"})),v.default.createElement(r.default,{onClick:this.recheck,type:"primary"},(0,y.formatMessage)({id:"button.retest_check"}))];return v.default.createElement(M.default,{type:"error",title:(0,y.formatMessage)({id:"confirmModal.component.check.title.error.component_check"}),description:(0,y.formatMessage)({id:"confirmModal.component.check.title.error.description"}),extra:t,actions:a,style:{marginTop:48,marginBottom:16}})}),this.state={status:"",check_uuid:"",errorInfo:[],serviceInfo:[],showDelete:!1,modifyCompose:!1},this.mount=!1,this.socketUrl="";var t=T.default.getCurrTeamName(),a=T.default.getCurrRegionName(),o=A.default.hasTeamAndRegion(this.props.currUser,t,a);o&&(this.socketUrl=w.default.getEventWebSocketUrl(o))}componentDidMount(){T.default.getCurrTeamName();this.getCheckuuid(),this.mount=!0,this.bindEvent(),I.default.refreshPermissionsInfo("",!0)}componentWillUnmount(){this.mount=!1,this.unbindEvent()}getParams(){return{group_id:this.props.match.params.appID,compose_id:this.props.match.params.composeId}}getAppAlias(){return this.props.match.params.appAlias}render(){var e=this.state,t=e.status,a=e.modifyCompose,o=e.showDelete,s=this.getParams();return v.default.createElement(S.default,null,v.default.createElement(i.default,{bordered:!1},v.default.createElement("div",{style:{minHeight:400}},"checking"===t?this.renderChecking():null,"success"===t?this.renderSuccess():null,"failure"===t?this.renderError():null)),a?v.default.createElement(P,{compose_id:s.compose_id,onSubmit:this.handleModifyCompose,onCancel:this.cancelModifyCompose}):null,o&&v.default.createElement(b.default,{onOk:this.handleDelete,title:(0,y.formatMessage)({id:"confirmModal.abandon_create.create_check.title"}),subDesc:(0,y.formatMessage)({id:"confirmModal.delete.strategy.subDesc"}),desc:(0,y.formatMessage)({id:"confirmModal.delete.create_check.desc"}),onCancel:()=>{this.setState({showDelete:!1})}}))}},h=f))||h);t.default=R}).call(this,a("yLpj"))}}]);